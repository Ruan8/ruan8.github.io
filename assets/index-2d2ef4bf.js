var Qr=Object.defineProperty;var Zr=(e,t,n)=>t in e?Qr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var zt=(e,t,n)=>(Zr(e,typeof t!="symbol"?t+"":t,n),n);import{G as Pe,H as xt,f as un,I as ei,d as ot,J as ti,u as Wn,h as _e,o as N,c as oe,b as $,r as Be,n as ee,e as V,y as ae,v as J,j as W,K as Ht,L as Fe,M as qe,l as re,k as it,T as wt,_ as Ut,w as $n,N as ni,O as ri,P as Hn,Q as Yn,R as vn,s as q,g as ii,i as si,S as oi,U as Ie,V as We,W as ai,t as me,X as $e,Y as li,A as Qe,E as jt,Z as ui,$ as ci,a0 as Xn,a1 as ht,a2 as kt,a as yn,a3 as Dt,a4 as fi,a5 as Nt,a6 as di,a7 as hi,a8 as pi,a9 as _i,aa as nt,ab as gt,B as ge,ac as Jn,ad as cn,ae as pt,af as Mt,ag as En,ah as mi,ai as gi,aj as xn,ak as It,al as vi,am as Wt,an as yi,F as we,ao as Ei,ap as xi,aq as Si,ar as qn,m as at,as as Ci,at as fn,au as Qn,av as Zn,C as Ge,aw as dn,ax as bi,ay as Ri,az as Yt,p as hn,x as Bt,aA as Ti,aB as Li,aC as Ai,aD as Oi,aE as Pi,aF as ki,aG as Di,aH as Mi,q as Ii,aI as Bi,aJ as Fi,aK as Sn,aL as wi,aM as Ui}from"./index-4ab2f7e6.js";function ji(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in e)){const y=Object.getOwnPropertyDescriptor(r,i);y&&Object.defineProperty(e,i,y.get?y:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}const Ni='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',Vi=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,Cn=e=>Array.from(e.querySelectorAll(Ni)).filter(t=>Gi(t)&&Vi(t)),Gi=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},Xt="_trap-focus-children",Je=[],bn=e=>{if(Je.length===0)return;const t=Je[Je.length-1][Xt];if(t.length>0&&e.code===xt.tab){if(t.length===1){e.preventDefault(),document.activeElement!==t[0]&&t[0].focus();return}const n=e.shiftKey,r=e.target===t[0],i=e.target===t[t.length-1];r&&n&&(e.preventDefault(),t[t.length-1].focus()),i&&!n&&(e.preventDefault(),t[0].focus())}},Ki={beforeMount(e){e[Xt]=Cn(e),Je.push(e),Je.length<=1&&document.addEventListener("keydown",bn)},updated(e){Pe(()=>{e[Xt]=Cn(e)})},unmounted(){Je.shift(),Je.length===0&&document.removeEventListener("keydown",bn)}},zi=un({type:{type:String,values:["success","info","warning","danger",""],default:""},closable:Boolean,disableTransitions:Boolean,hit:Boolean,color:{type:String,default:""},size:{type:String,values:ei,default:""},effect:{type:String,values:["dark","light","plain"],default:"light"},round:Boolean}),Wi={close:e=>e instanceof MouseEvent,click:e=>e instanceof MouseEvent},$i=ot({name:"ElTag"}),Hi=ot({...$i,props:zi,emits:Wi,setup(e,{emit:t}){const n=e,r=ti(),i=Wn("tag"),y=_e(()=>{const{type:p,hit:g,effect:l,closable:o,round:s}=n;return[i.b(),i.is("closable",o),i.m(p),i.m(r.value),i.m(l),i.is("hit",g),i.is("round",s)]}),S=p=>{t("close",p)},m=p=>{t("click",p)};return(p,g)=>p.disableTransitions?(N(),oe("span",{key:0,class:ee(V(y)),style:it({backgroundColor:p.color}),onClick:m},[$("span",{class:ee(V(i).e("content"))},[Be(p.$slots,"default")],2),p.closable?(N(),ae(V(qe),{key:0,class:ee(V(i).e("close")),onClick:Fe(S,["stop"])},{default:J(()=>[W(V(Ht))]),_:1},8,["class","onClick"])):re("v-if",!0)],6)):(N(),ae(wt,{key:1,name:`${V(i).namespace.value}-zoom-in-center`,appear:""},{default:J(()=>[$("span",{class:ee(V(y)),style:it({backgroundColor:p.color}),onClick:m},[$("span",{class:ee(V(i).e("content"))},[Be(p.$slots,"default")],2),p.closable?(N(),ae(V(qe),{key:0,class:ee(V(i).e("close")),onClick:Fe(S,["stop"])},{default:J(()=>[W(V(Ht))]),_:1},8,["class","onClick"])):re("v-if",!0)],6)]),_:3},8,["name"]))}});var Yi=Ut(Hi,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tag/src/tag.vue"]]);const Xi=$n(Yi),Ji=un({...ni,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0}}),qi=ri,Qi=ot({name:"ElDrawer",components:{ElOverlay:Hn,ElFocusTrap:Yn,ElIcon:qe,Close:Ht},inheritAttrs:!1,props:Ji,emits:qi,setup(e,{slots:t}){vn({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},_e(()=>!!t.title)),vn({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},_e(()=>!!e.customClass));const n=q(),r=q(),i=Wn("drawer"),{t:y}=ii(),S=_e(()=>e.direction==="rtl"||e.direction==="ltr"),m=_e(()=>si(e.size));return{...oi(e,n),drawerRef:n,focusStartRef:r,isHorizontal:S,drawerSize:m,ns:i,t:y}}}),Zi=["aria-label","aria-labelledby","aria-describedby"],es=["id"],ts=["aria-label"],ns=["id"];function rs(e,t,n,r,i,y){const S=Ie("close"),m=Ie("el-icon"),p=Ie("el-focus-trap"),g=Ie("el-overlay");return N(),ae(li,{to:"body",disabled:!e.appendToBody},[W(wt,{name:e.ns.b("fade"),onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,onBeforeLeave:e.beforeLeave,persisted:""},{default:J(()=>[We(W(g,{mask:e.modal,"overlay-class":e.modalClass,"z-index":e.zIndex,onClick:e.onModalClick},{default:J(()=>[W(p,{loop:"",trapped:e.visible,"focus-trap-el":e.drawerRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:J(()=>[$("div",ai({ref:"drawerRef","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:e.titleId,"aria-describedby":e.bodyId},e.$attrs,{class:[e.ns.b(),e.direction,e.visible&&"open",e.customClass],style:e.isHorizontal?"width: "+e.drawerSize:"height: "+e.drawerSize,role:"dialog",onClick:t[1]||(t[1]=Fe(()=>{},["stop"]))}),[$("span",{ref:"focusStartRef",class:ee(e.ns.e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?(N(),oe("header",{key:0,class:ee(e.ns.e("header"))},[e.$slots.title?Be(e.$slots,"title",{key:1},()=>[re(" DEPRECATED SLOT ")]):Be(e.$slots,"header",{key:0,close:e.handleClose,titleId:e.titleId,titleClass:e.ns.e("title")},()=>[e.$slots.title?re("v-if",!0):(N(),oe("span",{key:0,id:e.titleId,role:"heading",class:ee(e.ns.e("title"))},me(e.title),11,es))]),e.showClose?(N(),oe("button",{key:2,"aria-label":e.t("el.drawer.close"),class:ee(e.ns.e("close-btn")),type:"button",onClick:t[0]||(t[0]=(...l)=>e.handleClose&&e.handleClose(...l))},[W(m,{class:ee(e.ns.e("close"))},{default:J(()=>[W(S)]),_:1},8,["class"])],10,ts)):re("v-if",!0)],2)):re("v-if",!0),e.rendered?(N(),oe("div",{key:1,id:e.bodyId,class:ee(e.ns.e("body"))},[Be(e.$slots,"default")],10,ns)):re("v-if",!0),e.$slots.footer?(N(),oe("div",{key:2,class:ee(e.ns.e("footer"))},[Be(e.$slots,"footer")],2)):re("v-if",!0)],16,Zi)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[$e,e.visible]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}var is=Ut(Qi,[["render",rs],["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const ss=$n(is),os=ot({name:"ElMessageBox",directives:{TrapFocus:Ki},components:{ElButton:Qe,ElFocusTrap:Yn,ElInput:jt,ElOverlay:Hn,ElIcon:qe,...ui},inheritAttrs:!1,props:{buttonSize:{type:String,validator:ci},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,roundButton:{default:!1,type:Boolean},container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(e,{emit:t}){const{locale:n,zIndex:r,ns:i,size:y}=Xn("message-box",_e(()=>e.buttonSize)),{t:S}=n,{nextZIndex:m}=r,p=q(!1),g=ht({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:null,inputValidator:null,inputErrorMessage:"",message:null,modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:m()}),l=_e(()=>{const M=g.type;return{[i.bm("icon",M)]:M&&kt[M]}}),o=yn(),s=yn(),v=_e(()=>g.icon||kt[g.type]||""),c=_e(()=>!!g.message),_=q(),E=q(),f=q(),u=q(),d=q(),h=_e(()=>g.confirmButtonClass);Dt(()=>g.inputValue,async M=>{await Pe(),e.boxType==="prompt"&&M!==null&&A()},{immediate:!0}),Dt(()=>p.value,M=>{var D,I;M&&(e.boxType!=="prompt"&&(g.autofocus?f.value=(I=(D=d.value)==null?void 0:D.$el)!=null?I:_.value:f.value=_.value),g.zIndex=m()),e.boxType==="prompt"&&(M?Pe().then(()=>{var Y;u.value&&u.value.$el&&(g.autofocus?f.value=(Y=R())!=null?Y:_.value:f.value=_.value)}):(g.editorErrorMessage="",g.validateError=!1))});const a=_e(()=>e.draggable);fi(_,E,a),Nt(async()=>{await Pe(),e.closeOnHashChange&&window.addEventListener("hashchange",x)}),di(()=>{e.closeOnHashChange&&window.removeEventListener("hashchange",x)});function x(){p.value&&(p.value=!1,Pe(()=>{g.action&&t("action",g.action)}))}const C=()=>{e.closeOnClickModal&&O(g.distinguishCancelAndClose?"close":"cancel")},b=_i(C),L=M=>{if(g.inputType!=="textarea")return M.preventDefault(),O("confirm")},O=M=>{var D;e.boxType==="prompt"&&M==="confirm"&&!A()||(g.action=M,g.beforeClose?(D=g.beforeClose)==null||D.call(g,M,g,x):x())},A=()=>{if(e.boxType==="prompt"){const M=g.inputPattern;if(M&&!M.test(g.inputValue||""))return g.editorErrorMessage=g.inputErrorMessage||S("el.messagebox.error"),g.validateError=!0,!1;const D=g.inputValidator;if(typeof D=="function"){const I=D(g.inputValue);if(I===!1)return g.editorErrorMessage=g.inputErrorMessage||S("el.messagebox.error"),g.validateError=!0,!1;if(typeof I=="string")return g.editorErrorMessage=I,g.validateError=!0,!1}}return g.editorErrorMessage="",g.validateError=!1,!0},R=()=>{const M=u.value.$refs;return M.input||M.textarea},T=()=>{O("close")},P=()=>{e.closeOnPressEscape&&T()};return e.lockScroll&&hi(p),{...pi(g),ns:i,overlayEvent:b,visible:p,hasMessage:c,typeClass:l,contentId:o,inputId:s,btnSize:y,iconComponent:v,confirmButtonClasses:h,rootRef:_,focusStartRef:f,headerRef:E,inputRef:u,confirmRef:d,doClose:x,handleClose:T,onCloseRequested:P,handleWrapperClick:C,handleInputEnter:L,handleAction:O,t:S}}}),as=["aria-label","aria-describedby"],ls=["aria-label"],us=["id"];function cs(e,t,n,r,i,y){const S=Ie("el-icon"),m=Ie("close"),p=Ie("el-input"),g=Ie("el-button"),l=Ie("el-focus-trap"),o=Ie("el-overlay");return N(),ae(wt,{name:"fade-in-linear",onAfterLeave:t[11]||(t[11]=s=>e.$emit("vanish")),persisted:""},{default:J(()=>[We(W(o,{"z-index":e.zIndex,"overlay-class":[e.ns.is("message-box"),e.modalClass],mask:e.modal},{default:J(()=>[$("div",{role:"dialog","aria-label":e.title,"aria-modal":"true","aria-describedby":e.showInput?void 0:e.contentId,class:ee(`${e.ns.namespace.value}-overlay-message-box`),onClick:t[8]||(t[8]=(...s)=>e.overlayEvent.onClick&&e.overlayEvent.onClick(...s)),onMousedown:t[9]||(t[9]=(...s)=>e.overlayEvent.onMousedown&&e.overlayEvent.onMousedown(...s)),onMouseup:t[10]||(t[10]=(...s)=>e.overlayEvent.onMouseup&&e.overlayEvent.onMouseup(...s))},[W(l,{loop:"",trapped:e.visible,"focus-trap-el":e.rootRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:J(()=>[$("div",{ref:"rootRef",class:ee([e.ns.b(),e.customClass,e.ns.is("draggable",e.draggable),{[e.ns.m("center")]:e.center}]),style:it(e.customStyle),tabindex:"-1",onClick:t[7]||(t[7]=Fe(()=>{},["stop"]))},[e.title!==null&&e.title!==void 0?(N(),oe("div",{key:0,ref:"headerRef",class:ee(e.ns.e("header"))},[$("div",{class:ee(e.ns.e("title"))},[e.iconComponent&&e.center?(N(),ae(S,{key:0,class:ee([e.ns.e("status"),e.typeClass])},{default:J(()=>[(N(),ae(nt(e.iconComponent)))]),_:1},8,["class"])):re("v-if",!0),$("span",null,me(e.title),1)],2),e.showClose?(N(),oe("button",{key:0,type:"button",class:ee(e.ns.e("headerbtn")),"aria-label":e.t("el.messagebox.close"),onClick:t[0]||(t[0]=s=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel")),onKeydown:t[1]||(t[1]=gt(Fe(s=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),["prevent"]),["enter"]))},[W(S,{class:ee(e.ns.e("close"))},{default:J(()=>[W(m)]),_:1},8,["class"])],42,ls)):re("v-if",!0)],2)):re("v-if",!0),$("div",{id:e.contentId,class:ee(e.ns.e("content"))},[$("div",{class:ee(e.ns.e("container"))},[e.iconComponent&&!e.center&&e.hasMessage?(N(),ae(S,{key:0,class:ee([e.ns.e("status"),e.typeClass])},{default:J(()=>[(N(),ae(nt(e.iconComponent)))]),_:1},8,["class"])):re("v-if",!0),e.hasMessage?(N(),oe("div",{key:1,class:ee(e.ns.e("message"))},[Be(e.$slots,"default",{},()=>[e.dangerouslyUseHTMLString?(N(),ae(nt(e.showInput?"label":"p"),{key:1,for:e.showInput?e.inputId:void 0,innerHTML:e.message},null,8,["for","innerHTML"])):(N(),ae(nt(e.showInput?"label":"p"),{key:0,for:e.showInput?e.inputId:void 0},{default:J(()=>[ge(me(e.dangerouslyUseHTMLString?"":e.message),1)]),_:1},8,["for"]))])],2)):re("v-if",!0)],2),We($("div",{class:ee(e.ns.e("input"))},[W(p,{id:e.inputId,ref:"inputRef",modelValue:e.inputValue,"onUpdate:modelValue":t[2]||(t[2]=s=>e.inputValue=s),type:e.inputType,placeholder:e.inputPlaceholder,"aria-invalid":e.validateError,class:ee({invalid:e.validateError}),onKeydown:gt(e.handleInputEnter,["enter"])},null,8,["id","modelValue","type","placeholder","aria-invalid","class","onKeydown"]),$("div",{class:ee(e.ns.e("errormsg")),style:it({visibility:e.editorErrorMessage?"visible":"hidden"})},me(e.editorErrorMessage),7)],2),[[$e,e.showInput]])],10,us),$("div",{class:ee(e.ns.e("btns"))},[e.showCancelButton?(N(),ae(g,{key:0,loading:e.cancelButtonLoading,class:ee([e.cancelButtonClass]),round:e.roundButton,size:e.btnSize,onClick:t[3]||(t[3]=s=>e.handleAction("cancel")),onKeydown:t[4]||(t[4]=gt(Fe(s=>e.handleAction("cancel"),["prevent"]),["enter"]))},{default:J(()=>[ge(me(e.cancelButtonText||e.t("el.messagebox.cancel")),1)]),_:1},8,["loading","class","round","size"])):re("v-if",!0),We(W(g,{ref:"confirmRef",type:"primary",loading:e.confirmButtonLoading,class:ee([e.confirmButtonClasses]),round:e.roundButton,disabled:e.confirmButtonDisabled,size:e.btnSize,onClick:t[5]||(t[5]=s=>e.handleAction("confirm")),onKeydown:t[6]||(t[6]=gt(Fe(s=>e.handleAction("confirm"),["prevent"]),["enter"]))},{default:J(()=>[ge(me(e.confirmButtonText||e.t("el.messagebox.confirm")),1)]),_:1},8,["loading","class","round","disabled","size"]),[[$e,e.showConfirmButton]])],2)],6)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,as)]),_:3},8,["z-index","overlay-class","mask"]),[[$e,e.visible]])]),_:3})}var fs=Ut(os,[["render",cs],["__file","/home/runner/work/element-plus/element-plus/packages/components/message-box/src/index.vue"]]);const _t=new Map,ds=e=>{let t=document.body;return e.appendTo&&(cn(e.appendTo)&&(t=document.querySelector(e.appendTo)),It(e.appendTo)&&(t=e.appendTo),It(t)||(t=document.body)),t},hs=(e,t,n=null)=>{const r=W(fs,e,xn(e.message)||pt(e.message)?{default:xn(e.message)?e.message:()=>e.message}:null);return r.appContext=n,Mt(r,t),ds(e).appendChild(t.firstElementChild),r.component},ps=()=>document.createElement("div"),_s=(e,t)=>{const n=ps();e.onVanish=()=>{Mt(null,n),_t.delete(i)},e.onAction=y=>{const S=_t.get(i);let m;e.showInput?m={value:i.inputValue,action:y}:m=y,e.callback?e.callback(m,r.proxy):y==="cancel"||y==="close"?e.distinguishCancelAndClose&&y!=="cancel"?S.reject("close"):S.reject("cancel"):S.resolve(m)};const r=hs(e,n,t),i=r.proxy;for(const y in e)En(e,y)&&!En(i.$props,y)&&(i[y]=e[y]);return i.visible=!0,i};function lt(e,t=null){if(!Jn)return Promise.reject();let n;return cn(e)||pt(e)?e={message:e}:n=e.callback,new Promise((r,i)=>{const y=_s(e,t??lt._context);_t.set(y,{options:e,callback:n,resolve:r,reject:i})})}const ms=["alert","confirm","prompt"],gs={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};ms.forEach(e=>{lt[e]=vs(e)});function vs(e){return(t,n,r,i)=>{let y="";return mi(n)?(r=n,y=""):gi(n)?y="":y=n,lt(Object.assign({title:y,message:t,type:"",...gs[e]},r,{boxType:e}),i)}}lt.close=()=>{_t.forEach((e,t)=>{t.doClose()}),_t.clear()};lt._context=null;const ze=lt;ze.install=e=>{ze._context=e._context,e.config.globalProperties.$msgbox=ze,e.config.globalProperties.$messageBox=ze,e.config.globalProperties.$alert=ze.alert,e.config.globalProperties.$confirm=ze.confirm,e.config.globalProperties.$prompt=ze.prompt};const Ye=ze,er=["success","info","warning","error"],ys=un({customClass:{type:String,default:""},dangerouslyUseHTMLString:{type:Boolean,default:!1},duration:{type:Number,default:4500},icon:{type:vi},id:{type:String,default:""},message:{type:Wt([String,Object]),default:""},offset:{type:Number,default:0},onClick:{type:Wt(Function),default:()=>{}},onClose:{type:Wt(Function),required:!0},position:{type:String,values:["top-right","top-left","bottom-right","bottom-left"],default:"top-right"},showClose:{type:Boolean,default:!0},title:{type:String,default:""},type:{type:String,values:[...er,""],default:""},zIndex:Number}),Es={destroy:()=>!0},xs=["id"],Ss=["textContent"],Cs={key:0},bs=["innerHTML"],Rs=ot({name:"ElNotification"}),Ts=ot({...Rs,props:ys,emits:Es,setup(e,{expose:t}){const n=e,{ns:r,zIndex:i}=Xn("notification"),{nextZIndex:y,currentZIndex:S}=i,{Close:m}=Ei,p=q(!1);let g;const l=_e(()=>{const d=n.type;return d&&kt[n.type]?r.m(d):""}),o=_e(()=>n.type&&kt[n.type]||n.icon),s=_e(()=>n.position.endsWith("right")?"right":"left"),v=_e(()=>n.position.startsWith("top")?"top":"bottom"),c=_e(()=>{var d;return{[v.value]:`${n.offset}px`,zIndex:(d=n.zIndex)!=null?d:S.value}});function _(){n.duration>0&&({stop:g}=xi(()=>{p.value&&f()},n.duration))}function E(){g==null||g()}function f(){p.value=!1}function u({code:d}){d===xt.delete||d===xt.backspace?E():d===xt.esc?p.value&&f():_()}return Nt(()=>{_(),y(),p.value=!0}),yi(document,"keydown",u),t({visible:p,close:f}),(d,h)=>(N(),ae(wt,{name:V(r).b("fade"),onBeforeLeave:d.onClose,onAfterLeave:h[1]||(h[1]=a=>d.$emit("destroy")),persisted:""},{default:J(()=>[We($("div",{id:d.id,class:ee([V(r).b(),d.customClass,V(s)]),style:it(V(c)),role:"alert",onMouseenter:E,onMouseleave:_,onClick:h[0]||(h[0]=(...a)=>d.onClick&&d.onClick(...a))},[V(o)?(N(),ae(V(qe),{key:0,class:ee([V(r).e("icon"),V(l)])},{default:J(()=>[(N(),ae(nt(V(o))))]),_:1},8,["class"])):re("v-if",!0),$("div",{class:ee(V(r).e("group"))},[$("h2",{class:ee(V(r).e("title")),textContent:me(d.title)},null,10,Ss),We($("div",{class:ee(V(r).e("content")),style:it(d.title?void 0:{margin:0})},[Be(d.$slots,"default",{},()=>[d.dangerouslyUseHTMLString?(N(),oe(we,{key:1},[re(" Caution here, message could've been compromised, never use user's input as message "),$("p",{innerHTML:d.message},null,8,bs)],2112)):(N(),oe("p",Cs,me(d.message),1))])],6),[[$e,d.message]]),d.showClose?(N(),ae(V(qe),{key:0,class:ee(V(r).e("closeBtn")),onClick:Fe(f,["stop"])},{default:J(()=>[W(V(m))]),_:1},8,["class","onClick"])):re("v-if",!0)],2)],46,xs),[[$e,p.value]])]),_:3},8,["name","onBeforeLeave"]))}});var Ls=Ut(Ts,[["__file","/home/runner/work/element-plus/element-plus/packages/components/notification/src/notification.vue"]]);const Ft={"top-left":[],"top-right":[],"bottom-left":[],"bottom-right":[]},Jt=16;let As=1;const st=function(e={},t=null){if(!Jn)return{close:()=>{}};(typeof e=="string"||pt(e))&&(e={message:e});const n=e.position||"top-right";let r=e.offset||0;Ft[n].forEach(({vm:l})=>{var o;r+=(((o=l.el)==null?void 0:o.offsetHeight)||0)+Jt}),r+=Jt;const i=`notification_${As++}`,y=e.onClose,S={...e,offset:r,id:i,onClose:()=>{Os(i,n,y)}};let m=document.body;It(e.appendTo)?m=e.appendTo:cn(e.appendTo)&&(m=document.querySelector(e.appendTo)),It(m)||(m=document.body);const p=document.createElement("div"),g=W(Ls,S,pt(S.message)?{default:()=>S.message}:null);return g.appContext=t??st._context,g.props.onDestroy=()=>{Mt(null,p)},Mt(g,p),Ft[n].push({vm:g}),m.appendChild(p.firstElementChild),{close:()=>{g.component.exposed.visible.value=!1}}};er.forEach(e=>{st[e]=(t={})=>((typeof t=="string"||pt(t))&&(t={message:t}),st({...t,type:e}))});function Os(e,t,n){const r=Ft[t],i=r.findIndex(({vm:g})=>{var l;return((l=g.component)==null?void 0:l.props.id)===e});if(i===-1)return;const{vm:y}=r[i];if(!y)return;n==null||n(y);const S=y.el.offsetHeight,m=t.split("-")[0];r.splice(i,1);const p=r.length;if(!(p<1))for(let g=i;g<p;g++){const{el:l,component:o}=r[g].vm,s=Number.parseInt(l.style[m],10)-S-Jt;o.props.offset=s}}function Ps(){for(const e of Object.values(Ft))e.forEach(({vm:t})=>{t.component.exposed.visible.value=!1})}st.closeAll=Ps;st._context=null;const ks=Si(st,"$notify");const je=Object.create(null);je.open="0";je.close="1";je.ping="2";je.pong="3";je.message="4";je.upgrade="5";je.noop="6";const St=Object.create(null);Object.keys(je).forEach(e=>{St[je[e]]=e});const Ds={type:"error",data:"parser error"},Ms=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Is=typeof ArrayBuffer=="function",Bs=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,tr=({type:e,data:t},n,r)=>Ms&&t instanceof Blob?n?r(t):Rn(t,r):Is&&(t instanceof ArrayBuffer||Bs(t))?n?r(t):Rn(new Blob([t]),r):r(je[e]+(t||"")),Rn=(e,t)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];t("b"+(r||""))},n.readAsDataURL(e)},Tn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",dt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<Tn.length;e++)dt[Tn.charCodeAt(e)]=e;const Fs=e=>{let t=e.length*.75,n=e.length,r,i=0,y,S,m,p;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const g=new ArrayBuffer(t),l=new Uint8Array(g);for(r=0;r<n;r+=4)y=dt[e.charCodeAt(r)],S=dt[e.charCodeAt(r+1)],m=dt[e.charCodeAt(r+2)],p=dt[e.charCodeAt(r+3)],l[i++]=y<<2|S>>4,l[i++]=(S&15)<<4|m>>2,l[i++]=(m&3)<<6|p&63;return g},ws=typeof ArrayBuffer=="function",nr=(e,t)=>{if(typeof e!="string")return{type:"message",data:rr(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:Us(e.substring(1),t)}:St[n]?e.length>1?{type:St[n],data:e.substring(1)}:{type:St[n]}:Ds},Us=(e,t)=>{if(ws){const n=Fs(e);return rr(n,t)}else return{base64:!0,data:e}},rr=(e,t)=>{switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}},ir=String.fromCharCode(30),js=(e,t)=>{const n=e.length,r=new Array(n);let i=0;e.forEach((y,S)=>{tr(y,!1,m=>{r[S]=m,++i===n&&t(r.join(ir))})})},Ns=(e,t)=>{const n=e.split(ir),r=[];for(let i=0;i<n.length;i++){const y=nr(n[i],t);if(r.push(y),y.type==="error")break}return r},sr=4;function ve(e){if(e)return Vs(e)}function Vs(e){for(var t in ve.prototype)e[t]=ve.prototype[t];return e}ve.prototype.on=ve.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};ve.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};ve.prototype.off=ve.prototype.removeListener=ve.prototype.removeAllListeners=ve.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+e],this};ve.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this};ve.prototype.emitReserved=ve.prototype.emit;ve.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};ve.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Oe=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function or(e,...t){return t.reduce((n,r)=>(e.hasOwnProperty(r)&&(n[r]=e[r]),n),{})}const Gs=Oe.setTimeout,Ks=Oe.clearTimeout;function Vt(e,t){t.useNativeTimers?(e.setTimeoutFn=Gs.bind(Oe),e.clearTimeoutFn=Ks.bind(Oe)):(e.setTimeoutFn=Oe.setTimeout.bind(Oe),e.clearTimeoutFn=Oe.clearTimeout.bind(Oe))}const zs=1.33;function Ws(e){return typeof e=="string"?$s(e):Math.ceil((e.byteLength||e.size)*zs)}function $s(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}class Hs extends Error{constructor(t,n,r){super(t),this.description=n,this.context=r,this.type="TransportError"}}class ar extends ve{constructor(t){super(),this.writable=!1,Vt(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,n,r){return super.emitReserved("error",new Hs(t,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=nr(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}}const lr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),qt=64,Ys={};let Ln=0,vt=0,An;function On(e){let t="";do t=lr[e%qt]+t,e=Math.floor(e/qt);while(e>0);return t}function ur(){const e=On(+new Date);return e!==An?(Ln=0,An=e):e+"."+On(Ln++)}for(;vt<qt;vt++)Ys[lr[vt]]=vt;function cr(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function Xs(e){let t={},n=e.split("&");for(let r=0,i=n.length;r<i;r++){let y=n[r].split("=");t[decodeURIComponent(y[0])]=decodeURIComponent(y[1])}return t}let fr=!1;try{fr=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Js=fr;function dr(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Js))return new XMLHttpRequest}catch{}if(!t)try{return new Oe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function qs(){}const Qs=function(){return new dr({xdomain:!1}).responseType!=null}();class Zs extends ar{constructor(t){if(super(t),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||i!==t.port,this.xs=t.secure!==r}const n=t&&t.forceBase64;this.supportsBinary=Qs&&!n}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};Ns(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,js(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.query||{};const n=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=ur()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.opts.port&&(n==="https"&&Number(this.opts.port)!==443||n==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=cr(t),y=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(y?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Ue(this.uri(),t)}doWrite(t,n){const r=this.request({method:"POST",data:t});r.on("success",n),r.on("error",(i,y)=>{this.onError("xhr post error",i,y)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=t}}class Ue extends ve{constructor(t,n){super(),Vt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=t,this.async=n.async!==!1,this.data=n.data!==void 0?n.data:null,this.create()}create(){const t=or(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const n=this.xhr=new dr(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=Ue.requestsCount++,Ue.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=qs,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Ue.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Ue.requestsCount=0;Ue.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Pn);else if(typeof addEventListener=="function"){const e="onpagehide"in Oe?"pagehide":"unload";addEventListener(e,Pn,!1)}}function Pn(){for(let e in Ue.requests)Ue.requests.hasOwnProperty(e)&&Ue.requests[e].abort()}const hr=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0))(),yt=Oe.WebSocket||Oe.MozWebSocket,kn=!0,eo="arraybuffer",Dn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class to extends ar{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),n=this.opts.protocols,r=Dn?{}:or(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=kn&&!Dn?n?new yt(t,n):new yt(t):new yt(t,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||eo,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const r=t[n],i=n===t.length-1;tr(r,this.supportsBinary,y=>{const S={};try{kn&&this.ws.send(y)}catch{}i&&hr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const n=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(n==="wss"&&Number(this.opts.port)!==443||n==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=ur()),this.supportsBinary||(t.b64=1);const i=cr(t),y=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(y?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!yt}}const no={websocket:to,polling:Zs},ro=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,io=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Qt(e){const t=e,n=e.indexOf("["),r=e.indexOf("]");n!=-1&&r!=-1&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let i=ro.exec(e||""),y={},S=14;for(;S--;)y[io[S]]=i[S]||"";return n!=-1&&r!=-1&&(y.source=t,y.host=y.host.substring(1,y.host.length-1).replace(/;/g,":"),y.authority=y.authority.replace("[","").replace("]","").replace(/;/g,":"),y.ipv6uri=!0),y.pathNames=so(y,y.path),y.queryKey=oo(y,y.query),y}function so(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&r.splice(0,1),t.slice(-1)=="/"&&r.splice(r.length-1,1),r}function oo(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,y){i&&(n[i]=y)}),n}let pr=class tt extends ve{constructor(t,n={}){super(),this.writeBuffer=[],t&&typeof t=="object"&&(n=t,t=null),t?(t=Qt(t),n.hostname=t.host,n.secure=t.protocol==="https"||t.protocol==="wss",n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=Qt(n.host).host),Vt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Xs(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=sr,n.transport=t,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts.transportOptions[t],this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new no[t](r)}open(){let t;if(this.opts.rememberUpgrade&&tt.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch{this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(t){let n=this.createTransport(t),r=!1;tt.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",o=>{if(!r)if(o.type==="pong"&&o.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;tt.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(l(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const s=new Error("probe error");s.transport=n.name,this.emitReserved("upgradeError",s)}}))};function y(){r||(r=!0,l(),n.close(),n=null)}const S=o=>{const s=new Error("probe error: "+o);s.transport=n.name,y(),this.emitReserved("upgradeError",s)};function m(){S("transport closed")}function p(){S("socket closed")}function g(o){n&&o.name!==n.name&&y()}const l=()=>{n.removeListener("open",i),n.removeListener("error",S),n.removeListener("close",m),this.off("close",p),this.off("upgrading",g)};n.once("open",i),n.once("error",S),n.once("close",m),this.once("close",p),this.once("upgrading",g),n.open()}onOpen(){if(this.readyState="open",tt.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let t=0;const n=this.upgrades.length;for(;t<n;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=t.data,this.onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=Ws(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(t,n,r){return this.sendPacket("message",t,n,r),this}send(t,n,r){return this.sendPacket("message",t,n,r),this}sendPacket(t,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const y={type:t,data:n,options:r};this.emitReserved("packetCreate",y),this.writeBuffer.push(y),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():t()}):this.upgrading?r():t()),this}onError(t){tt.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const n=[];let r=0;const i=t.length;for(;r<i;r++)~this.transports.indexOf(t[r])&&n.push(t[r]);return n}};pr.protocol=sr;function ao(e,t="",n){let r=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),r=Qt(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const y=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+y+":"+r.port+t,r.href=r.protocol+"://"+y+(n&&n.port===r.port?"":":"+r.port),r}const lo=typeof ArrayBuffer=="function",uo=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,_r=Object.prototype.toString,co=typeof Blob=="function"||typeof Blob<"u"&&_r.call(Blob)==="[object BlobConstructor]",fo=typeof File=="function"||typeof File<"u"&&_r.call(File)==="[object FileConstructor]";function pn(e){return lo&&(e instanceof ArrayBuffer||uo(e))||co&&e instanceof Blob||fo&&e instanceof File}function Ct(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,r=e.length;n<r;n++)if(Ct(e[n]))return!0;return!1}if(pn(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return Ct(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&Ct(e[n]))return!0;return!1}function ho(e){const t=[],n=e.data,r=e;return r.data=Zt(n,t),r.attachments=t.length,{packet:r,buffers:t}}function Zt(e,t){if(!e)return e;if(pn(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=Zt(e[r],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=Zt(e[r],t));return n}return e}function po(e,t){return e.data=en(e.data,t),delete e.attachments,e}function en(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=en(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=en(e[n],t));return e}const _o=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],mo=5;var se;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(se||(se={}));class go{constructor(t){this.replacer=t}encode(t){return(t.type===se.EVENT||t.type===se.ACK)&&Ct(t)?this.encodeAsBinary({type:t.type===se.EVENT?se.BINARY_EVENT:se.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===se.BINARY_EVENT||t.type===se.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=ho(t),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}function Mn(e){return Object.prototype.toString.call(e)==="[object Object]"}class _n extends ve{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const r=n.type===se.BINARY_EVENT;r||n.type===se.BINARY_ACK?(n.type=r?se.EVENT:se.ACK,this.reconstructor=new vo(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(pn(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const r={type:Number(t.charAt(0))};if(se[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===se.BINARY_EVENT||r.type===se.BINARY_ACK){const y=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const S=t.substring(y,n);if(S!=Number(S)||t.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(S)}if(t.charAt(n+1)==="/"){const y=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););r.nsp=t.substring(y,n)}else r.nsp="/";const i=t.charAt(n+1);if(i!==""&&Number(i)==i){const y=n+1;for(;++n;){const S=t.charAt(n);if(S==null||Number(S)!=S){--n;break}if(n===t.length)break}r.id=Number(t.substring(y,n+1))}if(t.charAt(++n)){const y=this.tryParse(t.substr(n));if(_n.isPayloadValid(r.type,y))r.data=y;else throw new Error("invalid payload")}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case se.CONNECT:return Mn(n);case se.DISCONNECT:return n===void 0;case se.CONNECT_ERROR:return typeof n=="string"||Mn(n);case se.EVENT:case se.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&_o.indexOf(n[0])===-1);case se.ACK:case se.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class vo{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=po(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const yo=Object.freeze(Object.defineProperty({__proto__:null,Decoder:_n,Encoder:go,get PacketType(){return se},protocol:mo},Symbol.toStringTag,{value:"Module"}));function Me(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Eo=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class mr extends ve{constructor(t,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Me(t,"open",this.onopen.bind(this)),Me(t,"packet",this.onpacket.bind(this)),Me(t,"error",this.onerror.bind(this)),Me(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){if(Eo.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const r={type:se.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const S=this.ids++,m=n.pop();this._registerAckCallback(S,m),r.id=S}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(t,n){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[t]=n;return}const y=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let S=0;S<this.sendBuffer.length;S++)this.sendBuffer[S].id===t&&this.sendBuffer.splice(S,1);n.call(this,new Error("operation has timed out"))},i);this.acks[t]=(...S)=>{this.io.clearTimeoutFn(y),n.apply(this,[null,...S])}}emitWithAck(t,...n){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,y)=>{n.push((S,m)=>r?S?y(S):i(m):i(S)),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...y)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...y)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:se.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case se.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case se.EVENT:case se.BINARY_EVENT:this.onevent(t);break;case se.ACK:case se.BINARY_ACK:this.onack(t);break;case se.DISCONNECT:this.ondisconnect();break;case se.CONNECT_ERROR:this.destroy();const r=new Error(t.data.message);r.data=t.data.data,this.emitReserved("connect_error",r);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:se.ACK,id:t,data:i}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(n.apply(this,t.data),delete this.acks[t.id])}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:se.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,t.data)}}}function ut(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}ut.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0};ut.prototype.reset=function(){this.attempts=0};ut.prototype.setMin=function(e){this.ms=e};ut.prototype.setMax=function(e){this.max=e};ut.prototype.setJitter=function(e){this.jitter=e};class tn extends ve{constructor(t,n){var r;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Vt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new ut({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||yo;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new pr(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Me(n,"open",function(){r.onopen(),t&&t()}),y=Me(n,"error",S=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",S),t?t(S):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const S=this._timeout;S===0&&i();const m=this.setTimeoutFn(()=>{i(),n.close(),n.emit("error",new Error("timeout"))},S);this.opts.autoUnref&&m.unref(),this.subs.push(function(){clearTimeout(m)})}return this.subs.push(i),this.subs.push(y),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Me(t,"ping",this.onping.bind(this)),Me(t,"data",this.ondata.bind(this)),Me(t,"error",this.onerror.bind(this)),Me(t,"close",this.onclose.bind(this)),Me(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){hr(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let r=this.nsps[t];return r?this._autoConnect&&!r.active&&r.connect():(r=new mr(this,t,n),this.nsps[t]=r),r}_destroy(t){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let r=0;r<n.length;r++)this.engine.write(n[r],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const ct={};function bt(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=ao(e,t.path||"/socket.io"),r=n.source,i=n.id,y=n.path,S=ct[i]&&y in ct[i].nsps,m=t.forceNew||t["force new connection"]||t.multiplex===!1||S;let p;return m?p=new tn(r,t):(ct[i]||(ct[i]=new tn(r,t)),p=ct[i]),n.query&&!t.query&&(t.query=n.queryKey),p.socket(n.path,t)}Object.assign(bt,{Manager:tn,Socket:mr,io:bt,connect:bt});let le=null;const xo=({query:e})=>new Promise(t=>{le=bt("wss://121.36.99.231:3000",{reconnection:!0,forceNew:!0,transports:["websocket"],query:e,auth:{token:"Bearer "+localStorage.getItem("live_token")}}),le.on("connect",()=>{t(),console.log(le.id,"监听客户端连接成功-connect")})});let gr=!0,vr=!0;function Rt(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Ze(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(S,m){if(S!==t)return i.apply(this,arguments);const p=g=>{const l=n(g);l&&(m.handleEvent?m.handleEvent(l):m(l))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(m,p),i.apply(this,[S,p])};const y=r.removeEventListener;r.removeEventListener=function(S,m){if(S!==t||!this._eventMap||!this._eventMap[t])return y.apply(this,arguments);if(!this._eventMap[t].has(m))return y.apply(this,arguments);const p=this._eventMap[t].get(m);return this._eventMap[t].delete(m),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,y.apply(this,[S,p])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(S){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),S&&this.addEventListener(t,this["_on"+t]=S)},enumerable:!0,configurable:!0})}function So(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(gr=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Co(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(vr=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function yr(){if(typeof window=="object"){if(gr)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function mn(e,t){vr&&console.warn(e+" is deprecated, please use "+t+" instead.")}function bo(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Rt(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Rt(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=Rt(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function In(e){return Object.prototype.toString.call(e)==="[object Object]"}function Er(e){return In(e)?Object.keys(e).reduce(function(t,n){const r=In(e[n]),i=r?Er(e[n]):e[n],y=r&&!Object.keys(i).length;return i===void 0||y?t:Object.assign(t,{[n]:i})},{}):e}function nn(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?nn(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{nn(e,e.get(i),n)})}))}function Bn(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const y=[];return e.forEach(S=>{S.type==="track"&&S.trackIdentifier===t.id&&y.push(S)}),y.forEach(S=>{e.forEach(m=>{m.type===r&&m.trackId===S.id&&nn(e,m,i)})}),i}const Fn=yr;function xr(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(m){if(typeof m!="object"||m.mandatory||m.optional)return m;const p={};return Object.keys(m).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const l=typeof m[g]=="object"?m[g]:{ideal:m[g]};l.exact!==void 0&&typeof l.exact=="number"&&(l.min=l.max=l.exact);const o=function(s,v){return s?s+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(l.ideal!==void 0){p.optional=p.optional||[];let s={};typeof l.ideal=="number"?(s[o("min",g)]=l.ideal,p.optional.push(s),s={},s[o("max",g)]=l.ideal,p.optional.push(s)):(s[o("",g)]=l.ideal,p.optional.push(s))}l.exact!==void 0&&typeof l.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[o("",g)]=l.exact):["min","max"].forEach(s=>{l[s]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[o(s,g)]=l[s])})}),m.advanced&&(p.optional=(p.optional||[]).concat(m.advanced)),p},i=function(m,p){if(t.version>=61)return p(m);if(m=JSON.parse(JSON.stringify(m)),m&&typeof m.audio=="object"){const g=function(l,o,s){o in l&&!(s in l)&&(l[s]=l[o],delete l[o])};m=JSON.parse(JSON.stringify(m)),g(m.audio,"autoGainControl","googAutoGainControl"),g(m.audio,"noiseSuppression","googNoiseSuppression"),m.audio=r(m.audio)}if(m&&typeof m.video=="object"){let g=m.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const l=t.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!l)){delete m.video.facingMode;let o;if(g.exact==="environment"||g.ideal==="environment"?o=["back","rear"]:(g.exact==="user"||g.ideal==="user")&&(o=["front"]),o)return n.mediaDevices.enumerateDevices().then(s=>{s=s.filter(c=>c.kind==="videoinput");let v=s.find(c=>o.some(_=>c.label.toLowerCase().includes(_)));return!v&&s.length&&o.includes("back")&&(v=s[s.length-1]),v&&(m.video.deviceId=g.exact?{exact:v.deviceId}:{ideal:v.deviceId}),m.video=r(m.video),Fn("chrome: "+JSON.stringify(m)),p(m)})}m.video=r(m.video)}return Fn("chrome: "+JSON.stringify(m)),p(m)},y=function(m){return t.version>=64?m:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[m.name]||m.name,message:m.message,constraint:m.constraint||m.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},S=function(m,p,g){i(m,l=>{n.webkitGetUserMedia(l,p,o=>{g&&g(y(o))})})};if(n.getUserMedia=S.bind(n),n.mediaDevices.getUserMedia){const m=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(p){return i(p,g=>m(g).then(l=>{if(g.audio&&!l.getAudioTracks().length||g.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(o=>{o.stop()}),new DOMException("","NotFoundError");return l},l=>Promise.reject(y(l))))}}}function Ro(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(i=>{const y=r.video&&r.video.width,S=r.video&&r.video.height,m=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:m||3}},y&&(r.video.mandatory.maxWidth=y),S&&(r.video.mandatory.maxHeight=S),e.navigator.mediaDevices.getUserMedia(r)})}}}function Sr(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Cr(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let y;e.RTCPeerConnection.prototype.getReceivers?y=this.getReceivers().find(m=>m.track&&m.track.id===i.track.id):y={track:i.track};const S=new Event("track");S.track=i.track,S.receiver=y,S.transceiver={receiver:y},S.streams=[r.stream],this.dispatchEvent(S)}),r.stream.getTracks().forEach(i=>{let y;e.RTCPeerConnection.prototype.getReceivers?y=this.getReceivers().find(m=>m.track&&m.track.id===i.id):y={track:i};const S=new Event("track");S.track=i,S.receiver=y,S.transceiver={receiver:y},S.streams=[r.stream],this.dispatchEvent(S)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ze(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function br(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,y){return{track:y,get dtmf(){return this._dtmf===void 0&&(y.kind==="audio"?this._dtmf=i.createDTMFSender(y):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(m,p){let g=i.apply(this,arguments);return g||(g=t(this,m),this._senders.push(g)),g};const y=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(m){y.apply(this,arguments);const p=this._senders.indexOf(m);p!==-1&&this._senders.splice(p,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(y){this._senders=this._senders||[],n.apply(this,[y]),y.getTracks().forEach(S=>{this._senders.push(t(this,S))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(y){this._senders=this._senders||[],r.apply(this,[y]),y.getTracks().forEach(S=>{const m=this._senders.find(p=>p.track===S);m&&this._senders.splice(this._senders.indexOf(m),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Rr(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,i,y]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const S=function(p){const g={};return p.result().forEach(o=>{const s={id:o.id,timestamp:o.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[o.type]||o.type};o.names().forEach(v=>{s[v]=o.stat(v)}),g[s.id]=s}),g},m=function(p){return new Map(Object.keys(p).map(g=>[g,p[g]]))};if(arguments.length>=2){const p=function(g){i(m(S(g)))};return t.apply(this,[p,r])}return new Promise((p,g)=>{t.apply(this,[function(l){p(m(S(l)))},g])}).then(i,y)}}function Tr(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const y=n.apply(this,[]);return y.forEach(S=>S._pc=this),y});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const y=r.apply(this,arguments);return y._pc=this,y}),e.RTCRtpSender.prototype.getStats=function(){const y=this;return this._pc.getStats().then(S=>Bn(S,y.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(y=>y._pc=this),i}),Ze(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(y=>Bn(y,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let i,y,S;return this.getSenders().forEach(m=>{m.track===r&&(i?S=!0:i=m)}),this.getReceivers().forEach(m=>(m.track===r&&(y?S=!0:y=m),m.track===r)),S||i&&y?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():y?y.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Lr(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(S=>this._shimmedLocalStreams[S][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(S,m){if(!m)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=t.apply(this,arguments);return this._shimmedLocalStreams[m.id]?this._shimmedLocalStreams[m.id].indexOf(p)===-1&&this._shimmedLocalStreams[m.id].push(p):this._shimmedLocalStreams[m.id]=[m,p],p};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(S){this._shimmedLocalStreams=this._shimmedLocalStreams||{},S.getTracks().forEach(g=>{if(this.getSenders().find(o=>o.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const m=this.getSenders();n.apply(this,arguments);const p=this.getSenders().filter(g=>m.indexOf(g)===-1);this._shimmedLocalStreams[S.id]=[S].concat(p)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[S.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},S&&Object.keys(this._shimmedLocalStreams).forEach(m=>{const p=this._shimmedLocalStreams[m].indexOf(S);p!==-1&&this._shimmedLocalStreams[m].splice(p,1),this._shimmedLocalStreams[m].length===1&&delete this._shimmedLocalStreams[m]}),i.apply(this,arguments)}}function Ar(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Lr(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const l=n.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(o=>this._reverseStreams[o.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(o=>{if(this.getSenders().find(v=>v.track===o))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const o=new e.MediaStream(l.getTracks());this._streams[l.id]=o,this._reverseStreams[o.id]=l,l=o}r.apply(this,[l])};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},e.RTCPeerConnection.prototype.addTrack=function(l,o){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const s=[].slice.call(arguments,1);if(s.length!==1||!s[0].getTracks().find(_=>_===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(_=>_.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const c=this._streams[o.id];if(c)c.addTrack(l),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const _=new e.MediaStream([l]);this._streams[o.id]=_,this._reverseStreams[_.id]=o,this.addStream(_)}return this.getSenders().find(_=>_.track===l)};function y(g,l){let o=l.sdp;return Object.keys(g._reverseStreams||[]).forEach(s=>{const v=g._reverseStreams[s],c=g._streams[v.id];o=o.replace(new RegExp(c.id,"g"),v.id)}),new RTCSessionDescription({type:l.type,sdp:o})}function S(g,l){let o=l.sdp;return Object.keys(g._reverseStreams||[]).forEach(s=>{const v=g._reverseStreams[s],c=g._streams[v.id];o=o.replace(new RegExp(v.id,"g"),c.id)}),new RTCSessionDescription({type:l.type,sdp:o})}["createOffer","createAnswer"].forEach(function(g){const l=e.RTCPeerConnection.prototype[g],o={[g](){const s=arguments;return arguments.length&&typeof arguments[0]=="function"?l.apply(this,[c=>{const _=y(this,c);s[0].apply(null,[_])},c=>{s[1]&&s[1].apply(null,c)},arguments[2]]):l.apply(this,arguments).then(c=>y(this,c))}};e.RTCPeerConnection.prototype[g]=o[g]});const m=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?m.apply(this,arguments):(arguments[0]=S(this,arguments[0]),m.apply(this,arguments))};const p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const g=p.get.apply(this);return g.type===""?g:y(this,g)}}),e.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(l._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let s;Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(_=>l.track===_)&&(s=this._streams[v])}),s&&(s.getTracks().length===1?this.removeStream(this._reverseStreams[s.id]):s.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function rn(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function Or(e,t){Ze(e,"negotiationneeded",n=>{const r=n.target;if(!((t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const wn=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Or,shimAddTrackRemoveTrack:Ar,shimAddTrackRemoveTrackWithNative:Lr,shimGetDisplayMedia:Ro,shimGetSendersWithDtmf:br,shimGetStats:Rr,shimGetUserMedia:xr,shimMediaStream:Sr,shimOnTrack:Cr,shimPeerConnection:rn,shimSenderReceiverGetStats:Tr},Symbol.toStringTag,{value:"Module"}));function Pr(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,y,S){mn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(y,S)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(S,m,p){m in S&&!(p in S)&&(S[p]=S[m],delete S[m])},y=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(S){return typeof S=="object"&&typeof S.audio=="object"&&(S=JSON.parse(JSON.stringify(S)),i(S.audio,"autoGainControl","mozAutoGainControl"),i(S.audio,"noiseSuppression","mozNoiseSuppression")),y(S)},r&&r.prototype.getSettings){const S=r.prototype.getSettings;r.prototype.getSettings=function(){const m=S.apply(this,arguments);return i(m,"mozAutoGainControl","autoGainControl"),i(m,"mozNoiseSuppression","noiseSuppression"),m}}if(r&&r.prototype.applyConstraints){const S=r.prototype.applyConstraints;r.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),i(m,"autoGainControl","mozAutoGainControl"),i(m,"noiseSuppression","mozNoiseSuppression")),S.apply(this,[m])}}}}function To(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function kr(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function sn(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const y=e.RTCPeerConnection.prototype[i],S={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),y.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=S[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[y,S,m]=arguments;return r.apply(this,[y||null]).then(p=>{if(t.version<53&&!S)try{p.forEach(g=>{g.type=n[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;p.forEach((l,o)=>{p.set(o,Object.assign({},l,{type:n[l.type]||l.type}))})}return p}).then(S,m)}}function Dr(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(y=>y._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Mr(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Ze(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ir(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){mn("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Br(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Fr(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(S=>{if("rid"in S&&!/^[a-z0-9]{0,16}$/i.test(S.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in S&&!(parseFloat(S.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in S&&!(parseFloat(S.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const y=t.apply(this,arguments);if(i){const{sender:S}=y,m=S.getParameters();(!("encodings"in m)||m.encodings.length===1&&Object.keys(m.encodings[0]).length===0)&&(m.encodings=r,S.sendEncodings=r,this.setParametersPromises.push(S.setParameters(m).then(()=>{delete S.sendEncodings}).catch(()=>{delete S.sendEncodings})))}return y})}function wr(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Ur(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function jr(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const Un=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Fr,shimCreateAnswer:jr,shimCreateOffer:Ur,shimGetDisplayMedia:To,shimGetParameters:wr,shimGetUserMedia:Pr,shimOnTrack:kr,shimPeerConnection:sn,shimRTCDataChannel:Br,shimReceiverGetStats:Mr,shimRemoveStream:Ir,shimSenderGetStats:Dr},Symbol.toStringTag,{value:"Module"}));function Nr(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>t.call(this,i,r)),r.getVideoTracks().forEach(i=>t.call(this,i,r))},e.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(y=>{this._localStreams?this._localStreams.includes(y)||this._localStreams.push(y):this._localStreams=[y]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(y=>{i.includes(y.track)&&this.removeTrack(y)})})}}function Vr(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const y=new Event("addstream");y.stream=i,this.dispatchEvent(y)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(y=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(y)>=0)return;r._remoteStreams.push(y);const S=new Event("addstream");S.stream=y,r.dispatchEvent(S)})}),t.apply(r,arguments)}}}function Gr(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,y=t.setRemoteDescription,S=t.addIceCandidate;t.createOffer=function(g,l){const o=arguments.length>=2?arguments[2]:arguments[0],s=n.apply(this,[o]);return l?(s.then(g,l),Promise.resolve()):s},t.createAnswer=function(g,l){const o=arguments.length>=2?arguments[2]:arguments[0],s=r.apply(this,[o]);return l?(s.then(g,l),Promise.resolve()):s};let m=function(p,g,l){const o=i.apply(this,[p]);return l?(o.then(g,l),Promise.resolve()):o};t.setLocalDescription=m,m=function(p,g,l){const o=y.apply(this,[p]);return l?(o.then(g,l),Promise.resolve()):o},t.setRemoteDescription=m,m=function(p,g,l){const o=S.apply(this,[p]);return l?(o.then(g,l),Promise.resolve()):o},t.addIceCandidate=m}function Kr(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(zr(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(r,i,y){t.mediaDevices.getUserMedia(r).then(i,y)}.bind(t))}function zr(e){return e&&e.video!==void 0?Object.assign({},e,{video:Er(e.video)}):e}function Wr(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const y=[];for(let S=0;S<r.iceServers.length;S++){let m=r.iceServers[S];m.urls===void 0&&m.url?(mn("RTCIceServer.url","RTCIceServer.urls"),m=JSON.parse(JSON.stringify(m)),m.urls=m.url,delete m.url,y.push(m)):y.push(r.iceServers[S])}r.iceServers=y}return new t(r,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function $r(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Hr(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(S=>S.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const y=this.getTransceivers().find(S=>S.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&y?y.direction==="sendrecv"?y.setDirection?y.setDirection("sendonly"):y.direction="sendonly":y.direction==="recvonly"&&(y.setDirection?y.setDirection("inactive"):y.direction="inactive"):r.offerToReceiveVideo===!0&&!y&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Yr(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const jn=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Yr,shimCallbacksAPI:Gr,shimConstraints:zr,shimCreateOfferLegacy:Hr,shimGetUserMedia:Kr,shimLocalStreamsAPI:Nr,shimRTCIceServerUrls:Wr,shimRemoteStreamsAPI:Vr,shimTrackEventTransceiver:$r},Symbol.toStringTag,{value:"Module"}));var Xr={exports:{}};(function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,y)=>(y>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let y=8;y<r.length;y+=2)switch(r[y]){case"raddr":i.relatedAddress=r[y+1];break;case"rport":i.relatedPort=parseInt(r[y+1],10);break;case"tcptype":i.tcpType=r[y+1];break;case"ufrag":i.ufrag=r[y+1],i.usernameFragment=r[y+1];break;default:i[r[y]]===void 0&&(i[r[y]]=r[y+1]);break}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const y=n.type;return r.push("typ"),r.push(y),y!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const y=n.substring(n.indexOf(" ")+1).split(";");for(let S=0;S<y.length;S++)i=y[S].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const y=[];Object.keys(n.parameters).forEach(S=>{n.parameters[S]!==void 0?y.push(S+"="+n.parameters[S]):y.push(S)}),r+="a=fmtp:"+i+" "+y.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(y=>{r+="a=rtcp-fb:"+i+" "+y.type+(y.parameter&&y.parameter.length?" "+y.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},y=n.indexOf(":",r);return y>-1?(i.attribute=n.substring(r+1,y),i.value=n.substring(y+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(y=>{i+="a=fingerprint:"+y.algorithm+" "+y.value+`\r
`}),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],y=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&y?{usernameFragment:i.substring(12),password:y.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},y=t.splitLines(n)[0].split(" ");r.profile=y[2];for(let m=3;m<y.length;m++){const p=y[m],g=t.matchPrefix(n,"a=rtpmap:"+p+" ")[0];if(g){const l=t.parseRtpMap(g),o=t.matchPrefix(n,"a=fmtp:"+p+" ");switch(l.parameters=o.length?t.parseFmtp(o[0]):{},l.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+p+" ").map(t.parseRtcpFb),r.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(l.name.toUpperCase());break}}}t.matchPrefix(n,"a=extmap:").forEach(m=>{r.headerExtensions.push(t.parseExtmap(m))});const S=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(m=>{S.forEach(p=>{m.rtcpFeedback.find(l=>l.type===p.type&&l.parameter===p.parameter)||m.rtcpFeedback.push(p)})}),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(S=>S.preferredPayloadType!==void 0?S.preferredPayloadType:S.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(S=>{i+=t.writeRtpMap(S),i+=t.writeFmtp(S),i+=t.writeRtcpFb(S)});let y=0;return r.codecs.forEach(S=>{S.maxptime>y&&(y=S.maxptime)}),y>0&&(i+="a=maxptime:"+y+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(S=>{i+=t.writeExtmap(S)}),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),y=i.fecMechanisms.indexOf("RED")!==-1,S=i.fecMechanisms.indexOf("ULPFEC")!==-1,m=t.matchPrefix(n,"a=ssrc:").map(s=>t.parseSsrcMedia(s)).filter(s=>s.attribute==="cname"),p=m.length>0&&m[0].ssrc;let g;const l=t.matchPrefix(n,"a=ssrc-group:FID").map(s=>s.substring(17).split(" ").map(c=>parseInt(c,10)));l.length>0&&l[0].length>1&&l[0][0]===p&&(g=l[0][1]),i.codecs.forEach(s=>{if(s.name.toUpperCase()==="RTX"&&s.parameters.apt){let v={ssrc:p,codecPayloadType:parseInt(s.parameters.apt,10)};p&&g&&(v.rtx={ssrc:g}),r.push(v),y&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:p,mechanism:S?"red+ulpfec":"red"},r.push(v))}}),r.length===0&&p&&r.push({ssrc:p});let o=t.matchPrefix(n,"b=");return o.length&&(o[0].indexOf("b=TIAS:")===0?o=parseInt(o[0].substring(7),10):o[0].indexOf("b=AS:")===0?o=parseInt(o[0].substring(5),10)*1e3*.95-50*40*8:o=void 0,r.forEach(s=>{s.maxBitrate=o})),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map(m=>t.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const y=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=y.length>0,r.compound=y.length===0;const S=t.matchPrefix(n,"a=rtcp-mux");return r.mux=S.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const y=t.matchPrefix(n,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="msid");if(y.length>0)return r=y[0].value.split(" "),{stream:r[0],track:r[1]}},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let y;i.length>0&&(y=parseInt(i[0].substring(19),10)),isNaN(y)&&(y=65536);const S=t.matchPrefix(n,"a=sctp-port:");if(S.length>0)return{port:parseInt(S[0].substring(12),10),protocol:r.fmt,maxMessageSize:y};const m=t.matchPrefix(n,"a=sctpmap:");if(m.length>0){const p=m[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:y}}},t.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let y;const S=r!==void 0?r:2;return n?y=n:y=t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+y+" "+S+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let y=0;y<i.length;y++)switch(i[y]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[y].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(Xr);var Jr=Xr.exports;const rt=qn(Jr),Lo=ji({__proto__:null,default:rt},[Jr]);function Tt(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new t(r),y=rt.parseCandidate(r.candidate);for(const S in y)S in i||Object.defineProperty(i,S,{value:y[S]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,Ze(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function on(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ze(e,"icecandidate",t=>{if(t.candidate){const n=rt.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function Lt(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(m){if(!m||!m.sdp)return!1;const p=rt.splitSections(m.sdp);return p.shift(),p.some(g=>{const l=rt.parseMLine(g);return l&&l.kind==="application"&&l.protocol.indexOf("SCTP")!==-1})},r=function(m){const p=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const g=parseInt(p[1],10);return g!==g?-1:g},i=function(m){let p=65536;return t.browser==="firefox"&&(t.version<57?m===-1?p=16384:p=2147483637:t.version<60?p=t.version===57?65535:65536:p=2147483637),p},y=function(m,p){let g=65536;t.browser==="firefox"&&t.version===57&&(g=65535);const l=rt.matchPrefix(m.sdp,"a=max-message-size:");return l.length>0?g=parseInt(l[0].substring(19),10):t.browser==="firefox"&&p!==-1&&(g=2147483637),g},S=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const p=r(arguments[0]),g=i(p),l=y(arguments[0],p);let o;g===0&&l===0?o=Number.POSITIVE_INFINITY:g===0||l===0?o=Math.max(g,l):o=Math.min(g,l);const s={};Object.defineProperty(s,"maxMessageSize",{get(){return o}}),this._sctp=s}return S.apply(this,arguments)}}function At(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const y=r.send;r.send=function(){const m=arguments[0],p=m.length||m.size||m.byteLength;if(r.readyState==="open"&&i.sctp&&p>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return y.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},Ze(e,"datachannel",r=>(t(r.channel,r.target),r))}function an(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const y=i.target;if(y._lastConnectionState!==y.connectionState){y._lastConnectionState=y.connectionState;const S=new Event("connectionstatechange",i);y.dispatchEvent(S)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function ln(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const y=i.sdp.split(`
`).filter(S=>S.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:y}):i.sdp=y}return n.apply(this,arguments)}}function Ot(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Pt(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(S=>n.apply(this,[S]))})}const Ao=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:ln,shimAddIceCandidateNullOrEmpty:Ot,shimConnectionState:an,shimMaxMessageSize:Lt,shimParameterlessSetLocalDescription:Pt,shimRTCIceCandidate:Tt,shimRTCIceCandidateRelayProtocol:on,shimSendThrowTypeError:At},Symbol.toStringTag,{value:"Module"}));function Oo({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=yr,r=bo(e),i={browserDetails:r,commonShim:Ao,extractVersion:Rt,disableLog:So,disableWarnings:Co,sdp:Lo};switch(r.browser){case"chrome":if(!wn||!rn||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=wn,Ot(e,r),Pt(e),xr(e,r),Sr(e),rn(e,r),Cr(e),Ar(e,r),br(e),Rr(e),Tr(e),Or(e,r),Tt(e),on(e),an(e),Lt(e,r),At(e),ln(e,r);break;case"firefox":if(!Un||!sn||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Un,Ot(e,r),Pt(e),Pr(e,r),sn(e,r),kr(e),Ir(e),Dr(e),Mr(e),Br(e),Fr(e),wr(e),Ur(e),jr(e),Tt(e),an(e),Lt(e,r),At(e);break;case"safari":if(!jn||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=jn,Ot(e,r),Pt(e),Wr(e),Hr(e),Gr(e),Nr(e),Vr(e),$r(e),Kr(e),Yr(e),Tt(e),on(e),Lt(e,r),At(e),ln(e,r);break;default:n("Unsupported browser!");break}return i}Oo({window:typeof window>"u"?void 0:window});const Po={bundlePolicy:"balanced",iceTransportPolicy:"all",rtcpMuxPolicy:"negotiate",iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:121.36.99.231:3478",username:"ruan8",credential:"123456"}]},Nn=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,ko=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription;class Do{constructor({onTarck:t,onCandidate:n,onMessage:r}){zt(this,"conn",null);zt(this,"dataChannel",null);Nn||Ye.alert("当前浏览器不支持RTCPeerConnection！"),this.conn=new Nn(Po),this.conn.addEventListener("icecandidate",i=>{i.candidate&&n(i.candidate)}),this.conn.addEventListener("track",t),this.conn.addEventListener("connectionstatechange",()=>{this.conn.connectionState==="connected"&&console.log("对等连接成功！")}),this.createDataChannel({onMessage:r})}createOffer(t){this.conn&&this.conn.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(n=>{this.conn.setLocalDescription(n),t(n)}).catch(()=>{console.log("创建offer失败")})}createAnswer(t){this.conn&&this.conn.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(n=>{this.conn&&this.conn.setLocalDescription(n),t(n)}).catch(()=>{console.log("创建answer失败")})}setRemoteDescription(t){var n;(n=this.conn)==null||n.setRemoteDescription(new ko(t))}setCandidate(t){this.conn&&t&&this.conn.addIceCandidate(new RTCIceCandidate(t)).catch(n=>{console.log(n)})}addTrack(t){this.conn&&t&&t.getTracks().forEach(n=>{this.conn.addTrack(n,t)})}createDataChannel({onMessage:t}){if(this.dataChannel)return!1;this.dataChannel=this.conn.createDataChannel("channel",{ordered:!0,maxRetransmits:5}),this.onDataChannel({onMessage:t})}onDataChannel({onMessage:t}){this.conn.ondatachannel=n=>{var r=n.channel;r.onmessage=function(i){typeof t=="function"&&t(i)},r.onopen=function(){console.log("dataChannel open")},r.onclose=function(){console.log("dataChannel close")}}}}var qr={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(self,function(){return function(){var n={"./node_modules/es6-promise/dist/es6-promise.js":function(S,m,p){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(g,l){S.exports=l()})(this,function(){function g(k){var F=typeof k;return k!==null&&(F==="object"||F==="function")}function l(k){return typeof k=="function"}var o=void 0;Array.isArray?o=Array.isArray:o=function(k){return Object.prototype.toString.call(k)==="[object Array]"};var s=o,v=0,c=void 0,_=void 0,E=function(F,w){T[v]=F,T[v+1]=w,v+=2,v===2&&(_?_(P):D())};function f(k){_=k}function u(k){E=k}var d=typeof window<"u"?window:void 0,h=d||{},a=h.MutationObserver||h.WebKitMutationObserver,x=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",C=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function b(){return function(){return process.nextTick(P)}}function L(){return typeof c<"u"?function(){c(P)}:R()}function O(){var k=0,F=new a(P),w=document.createTextNode("");return F.observe(w,{characterData:!0}),function(){w.data=k=++k%2}}function A(){var k=new MessageChannel;return k.port1.onmessage=P,function(){return k.port2.postMessage(0)}}function R(){var k=setTimeout;return function(){return k(P,1)}}var T=new Array(1e3);function P(){for(var k=0;k<v;k+=2){var F=T[k],w=T[k+1];F(w),T[k]=void 0,T[k+1]=void 0}v=0}function M(){try{var k=Function("return this")().require("vertx");return c=k.runOnLoop||k.runOnContext,L()}catch{return R()}}var D=void 0;x?D=b():a?D=O():C?D=A():d===void 0?D=M():D=R();function I(k,F){var w=this,G=new this.constructor(X);G[Q]===void 0&&Ke(G);var Z=w._state;if(Z){var te=arguments[Z-1];E(function(){return Ne(Z,G,te,w._result)})}else Se(w,G,k,F);return G}function Y(k){var F=this;if(k&&typeof k=="object"&&k.constructor===F)return k;var w=new F(X);return xe(w,k),w}var Q=Math.random().toString(36).substring(2);function X(){}var ne=void 0,ue=1,H=2;function ie(){return new TypeError("You cannot resolve a promise with itself")}function Re(){return new TypeError("A promises callback cannot return that same promise.")}function ce(k,F,w,G){try{k.call(F,w,G)}catch(Z){return Z}}function fe(k,F,w){E(function(G){var Z=!1,te=ce(w,F,function(Ee){Z||(Z=!0,F!==Ee?xe(G,Ee):de(G,Ee))},function(Ee){Z||(Z=!0,z(G,Ee))},"Settle: "+(G._label||" unknown promise"));!Z&&te&&(Z=!0,z(G,te))},k)}function Ce(k,F){F._state===ue?de(k,F._result):F._state===H?z(k,F._result):Se(F,void 0,function(w){return xe(k,w)},function(w){return z(k,w)})}function ye(k,F,w){F.constructor===k.constructor&&w===I&&F.constructor.resolve===Y?Ce(k,F):w===void 0?de(k,F):l(w)?fe(k,F,w):de(k,F)}function xe(k,F){if(k===F)z(k,ie());else if(g(F)){var w=void 0;try{w=F.then}catch(G){z(k,G);return}ye(k,F,w)}else de(k,F)}function Te(k){k._onerror&&k._onerror(k._result),Le(k)}function de(k,F){k._state===ne&&(k._result=F,k._state=ue,k._subscribers.length!==0&&E(Le,k))}function z(k,F){k._state===ne&&(k._state=H,k._result=F,E(Te,k))}function Se(k,F,w,G){var Z=k._subscribers,te=Z.length;k._onerror=null,Z[te]=F,Z[te+ue]=w,Z[te+H]=G,te===0&&k._state&&E(Le,k)}function Le(k){var F=k._subscribers,w=k._state;if(F.length!==0){for(var G=void 0,Z=void 0,te=k._result,Ee=0;Ee<F.length;Ee+=3)G=F[Ee],Z=F[Ee+w],G?Ne(w,G,Z,te):Z(te);k._subscribers.length=0}}function Ne(k,F,w,G){var Z=l(w),te=void 0,Ee=void 0,et=!0;if(Z){try{te=w(G)}catch(mt){et=!1,Ee=mt}if(F===te){z(F,Re());return}}else te=G;F._state!==ne||(Z&&et?xe(F,te):et===!1?z(F,Ee):k===ue?de(F,te):k===H&&z(F,te))}function ke(k,F){try{F(function(G){xe(k,G)},function(G){z(k,G)})}catch(w){z(k,w)}}var De=0;function Ve(){return De++}function Ke(k){k[Q]=De++,k._state=void 0,k._result=void 0,k._subscribers=[]}function j(){return new Error("Array Methods must be provided an Array")}var B=function(){function k(F,w){this._instanceConstructor=F,this.promise=new F(X),this.promise[Q]||Ke(this.promise),s(w)?(this.length=w.length,this._remaining=w.length,this._result=new Array(this.length),this.length===0?de(this.promise,this._result):(this.length=this.length||0,this._enumerate(w),this._remaining===0&&de(this.promise,this._result))):z(this.promise,j())}return k.prototype._enumerate=function(w){for(var G=0;this._state===ne&&G<w.length;G++)this._eachEntry(w[G],G)},k.prototype._eachEntry=function(w,G){var Z=this._instanceConstructor,te=Z.resolve;if(te===Y){var Ee=void 0,et=void 0,mt=!1;try{Ee=w.then}catch(Kt){mt=!0,et=Kt}if(Ee===I&&w._state!==ne)this._settledAt(w._state,G,w._result);else if(typeof Ee!="function")this._remaining--,this._result[G]=w;else if(Z===pe){var Gt=new Z(X);mt?z(Gt,et):ye(Gt,w,Ee),this._willSettleAt(Gt,G)}else this._willSettleAt(new Z(function(Kt){return Kt(w)}),G)}else this._willSettleAt(te(w),G)},k.prototype._settledAt=function(w,G,Z){var te=this.promise;te._state===ne&&(this._remaining--,w===H?z(te,Z):this._result[G]=Z),this._remaining===0&&de(te,this._result)},k.prototype._willSettleAt=function(w,G){var Z=this;Se(w,void 0,function(te){return Z._settledAt(ue,G,te)},function(te){return Z._settledAt(H,G,te)})},k}();function U(k){return new B(this,k).promise}function K(k){var F=this;return s(k)?new F(function(w,G){for(var Z=k.length,te=0;te<Z;te++)F.resolve(k[te]).then(w,G)}):new F(function(w,G){return G(new TypeError("You must pass an array to race."))})}function Ae(k){var F=this,w=new F(X);return z(w,k),w}function be(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function He(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var pe=function(){function k(F){this[Q]=Ve(),this._result=this._state=void 0,this._subscribers=[],X!==F&&(typeof F!="function"&&be(),this instanceof k?ke(this,F):He())}return k.prototype.catch=function(w){return this.then(null,w)},k.prototype.finally=function(w){var G=this,Z=G.constructor;return l(w)?G.then(function(te){return Z.resolve(w()).then(function(){return te})},function(te){return Z.resolve(w()).then(function(){throw te})}):G.then(w,w)},k}();pe.prototype.then=I,pe.all=U,pe.race=K,pe.resolve=Y,pe.reject=Ae,pe._setScheduler=f,pe._setAsap=u,pe._asap=E;function he(){var k=void 0;if(typeof p.g<"u")k=p.g;else if(typeof self<"u")k=self;else try{k=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var F=k.Promise;if(F){var w=null;try{w=Object.prototype.toString.call(F.resolve())}catch{}if(w==="[object Promise]"&&!F.cast)return}k.Promise=pe}return pe.polyfill=he,pe.Promise=pe,pe})},"./node_modules/events/events.js":function(S){var m=typeof Reflect=="object"?Reflect:null,p=m&&typeof m.apply=="function"?m.apply:function(R,T,P){return Function.prototype.apply.call(R,T,P)},g;m&&typeof m.ownKeys=="function"?g=m.ownKeys:Object.getOwnPropertySymbols?g=function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:g=function(R){return Object.getOwnPropertyNames(R)};function l(A){console&&console.warn&&console.warn(A)}var o=Number.isNaN||function(R){return R!==R};function s(){s.init.call(this)}S.exports=s,S.exports.once=b,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var v=10;function c(A){if(typeof A!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof A)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return v},set:function(A){if(typeof A!="number"||A<0||o(A))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+A+".");v=A}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(R){if(typeof R!="number"||R<0||o(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this};function _(A){return A._maxListeners===void 0?s.defaultMaxListeners:A._maxListeners}s.prototype.getMaxListeners=function(){return _(this)},s.prototype.emit=function(R){for(var T=[],P=1;P<arguments.length;P++)T.push(arguments[P]);var M=R==="error",D=this._events;if(D!==void 0)M=M&&D.error===void 0;else if(!M)return!1;if(M){var I;if(T.length>0&&(I=T[0]),I instanceof Error)throw I;var Y=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw Y.context=I,Y}var Q=D[R];if(Q===void 0)return!1;if(typeof Q=="function")p(Q,this,T);else for(var X=Q.length,ne=a(Q,X),P=0;P<X;++P)p(ne[P],this,T);return!0};function E(A,R,T,P){var M,D,I;if(c(T),D=A._events,D===void 0?(D=A._events=Object.create(null),A._eventsCount=0):(D.newListener!==void 0&&(A.emit("newListener",R,T.listener?T.listener:T),D=A._events),I=D[R]),I===void 0)I=D[R]=T,++A._eventsCount;else if(typeof I=="function"?I=D[R]=P?[T,I]:[I,T]:P?I.unshift(T):I.push(T),M=_(A),M>0&&I.length>M&&!I.warned){I.warned=!0;var Y=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(R)+" listeners added. Use emitter.setMaxListeners() to increase limit");Y.name="MaxListenersExceededWarning",Y.emitter=A,Y.type=R,Y.count=I.length,l(Y)}return A}s.prototype.addListener=function(R,T){return E(this,R,T,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(R,T){return E(this,R,T,!0)};function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(A,R,T){var P={fired:!1,wrapFn:void 0,target:A,type:R,listener:T},M=f.bind(P);return M.listener=T,P.wrapFn=M,M}s.prototype.once=function(R,T){return c(T),this.on(R,u(this,R,T)),this},s.prototype.prependOnceListener=function(R,T){return c(T),this.prependListener(R,u(this,R,T)),this},s.prototype.removeListener=function(R,T){var P,M,D,I,Y;if(c(T),M=this._events,M===void 0)return this;if(P=M[R],P===void 0)return this;if(P===T||P.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete M[R],M.removeListener&&this.emit("removeListener",R,P.listener||T));else if(typeof P!="function"){for(D=-1,I=P.length-1;I>=0;I--)if(P[I]===T||P[I].listener===T){Y=P[I].listener,D=I;break}if(D<0)return this;D===0?P.shift():x(P,D),P.length===1&&(M[R]=P[0]),M.removeListener!==void 0&&this.emit("removeListener",R,Y||T)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(R){var T,P,M;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[R]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[R]),this;if(arguments.length===0){var D=Object.keys(P),I;for(M=0;M<D.length;++M)I=D[M],I!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=P[R],typeof T=="function")this.removeListener(R,T);else if(T!==void 0)for(M=T.length-1;M>=0;M--)this.removeListener(R,T[M]);return this};function d(A,R,T){var P=A._events;if(P===void 0)return[];var M=P[R];return M===void 0?[]:typeof M=="function"?T?[M.listener||M]:[M]:T?C(M):a(M,M.length)}s.prototype.listeners=function(R){return d(this,R,!0)},s.prototype.rawListeners=function(R){return d(this,R,!1)},s.listenerCount=function(A,R){return typeof A.listenerCount=="function"?A.listenerCount(R):h.call(A,R)},s.prototype.listenerCount=h;function h(A){var R=this._events;if(R!==void 0){var T=R[A];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?g(this._events):[]};function a(A,R){for(var T=new Array(R),P=0;P<R;++P)T[P]=A[P];return T}function x(A,R){for(;R+1<A.length;R++)A[R]=A[R+1];A.pop()}function C(A){for(var R=new Array(A.length),T=0;T<R.length;++T)R[T]=A[T].listener||A[T];return R}function b(A,R){return new Promise(function(T,P){function M(I){A.removeListener(R,D),P(I)}function D(){typeof A.removeListener=="function"&&A.removeListener("error",M),T([].slice.call(arguments))}O(A,R,D,{once:!0}),R!=="error"&&L(A,M,{once:!0})})}function L(A,R,T){typeof A.on=="function"&&O(A,"error",R,T)}function O(A,R,T,P){if(typeof A.on=="function")P.once?A.once(R,T):A.on(R,T);else if(typeof A.addEventListener=="function")A.addEventListener(R,function M(D){P.once&&A.removeEventListener(R,M),T(D)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof A)}},"./node_modules/webworkify-webpack/index.js":function(S,m,p){function g(f){var u={};function d(a){if(u[a])return u[a].exports;var x=u[a]={i:a,l:!1,exports:{}};return f[a].call(x.exports,x,x.exports,d),x.l=!0,x.exports}d.m=f,d.c=u,d.i=function(a){return a},d.d=function(a,x,C){d.o(a,x)||Object.defineProperty(a,x,{configurable:!1,enumerable:!0,get:C})},d.r=function(a){Object.defineProperty(a,"__esModule",{value:!0})},d.n=function(a){var x=a&&a.__esModule?function(){return a.default}:function(){return a};return d.d(x,"a",x),x},d.o=function(a,x){return Object.prototype.hasOwnProperty.call(a,x)},d.p="/",d.oe=function(a){throw console.error(a),a};var h=d(d.s=ENTRY_MODULE);return h.default||h}var l="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+l+").*?\\)";function s(f){return(f+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function v(f){return!isNaN(1*f)}function c(f,u,d){var h={};h[d]=[];var a=u.toString(),x=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!x)return h;for(var C=x[1],b=new RegExp("(\\\\n|\\W)"+s(C)+o,"g"),L;L=b.exec(a);)L[3]!=="dll-reference"&&h[d].push(L[3]);for(b=new RegExp("\\("+s(C)+'\\("(dll-reference\\s('+l+'))"\\)\\)'+o,"g");L=b.exec(a);)f[L[2]]||(h[d].push(L[1]),f[L[2]]=p(L[1]).m),h[L[2]]=h[L[2]]||[],h[L[2]].push(L[4]);for(var O=Object.keys(h),A=0;A<O.length;A++)for(var R=0;R<h[O[A]].length;R++)v(h[O[A]][R])&&(h[O[A]][R]=1*h[O[A]][R]);return h}function _(f){var u=Object.keys(f);return u.reduce(function(d,h){return d||f[h].length>0},!1)}function E(f,u){for(var d={main:[u]},h={main:[]},a={main:{}};_(d);)for(var x=Object.keys(d),C=0;C<x.length;C++){var b=x[C],L=d[b],O=L.pop();if(a[b]=a[b]||{},!(a[b][O]||!f[b][O])){a[b][O]=!0,h[b]=h[b]||[],h[b].push(O);for(var A=c(f,f[b][O],b),R=Object.keys(A),T=0;T<R.length;T++)d[R[T]]=d[R[T]]||[],d[R[T]]=d[R[T]].concat(A[R[T]])}}return h}S.exports=function(f,u){u=u||{};var d={main:p.m},h=u.all?{main:Object.keys(d.main)}:E(d,f),a="";Object.keys(h).filter(function(O){return O!=="main"}).forEach(function(O){for(var A=0;h[O][A];)A++;h[O].push(A),d[O][A]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+O+" = ("+g.toString().replace("ENTRY_MODULE",JSON.stringify(A))+")({"+h[O].map(function(R){return""+JSON.stringify(R)+": "+d[O][R].toString()}).join(",")+`});
`}),a=a+"new (("+g.toString().replace("ENTRY_MODULE",JSON.stringify(f))+")({"+h.main.map(function(O){return""+JSON.stringify(O)+": "+d.main[O].toString()}).join(",")+"}))(self);";var x=new window.Blob([a],{type:"text/javascript"});if(u.bare)return x;var C=window.URL||window.webkitURL||window.mozURL||window.msURL,b=C.createObjectURL(x),L=new window.Worker(b);return L.objectURL=b,L}},"./src/config.js":function(S,m,p){p.r(m),p.d(m,{defaultConfig:function(){return g},createDefaultConfig:function(){return l}});var g={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function l(){return Object.assign({},g)}},"./src/core/features.js":function(S,m,p){p.r(m);var g=p("./src/io/io-controller.js"),l=p("./src/config.js"),o=function(){function s(){}return s.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},s.supportNetworkStreamIO=function(){var v=new g.default({},(0,l.createDefaultConfig)()),c=v.loaderType;return v.destroy(),c=="fetch-stream-loader"||c=="xhr-moz-chunked-loader"},s.getNetworkLoaderTypeName=function(){var v=new g.default({},(0,l.createDefaultConfig)()),c=v.loaderType;return v.destroy(),c},s.supportNativeMediaPlayback=function(v){s.videoElement==null&&(s.videoElement=window.document.createElement("video"));var c=s.videoElement.canPlayType(v);return c==="probably"||c=="maybe"},s.getFeatureList=function(){var v={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return v.mseFlvPlayback=s.supportMSEH264Playback(),v.networkStreamIO=s.supportNetworkStreamIO(),v.networkLoaderName=s.getNetworkLoaderTypeName(),v.mseLiveFlvPlayback=v.mseFlvPlayback&&v.networkStreamIO,v.nativeMP4H264Playback=s.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),v.nativeWebmVP8Playback=s.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),v.nativeWebmVP9Playback=s.supportNativeMediaPlayback('video/webm; codecs="vp9"'),v},s}();m.default=o},"./src/core/media-info.js":function(S,m,p){p.r(m);var g=function(){function l(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return l.prototype.isComplete=function(){var o=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,s=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&o&&s},l.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},l.prototype.getNearestKeyframe=function(o){if(this.keyframesIndex==null)return null;var s=this.keyframesIndex,v=this._search(s.times,o);return{index:v,milliseconds:s.times[v],fileposition:s.filepositions[v]}},l.prototype._search=function(o,s){var v=0,c=o.length-1,_=0,E=0,f=c;for(s<o[0]&&(v=0,E=f+1);E<=f;)if(_=E+Math.floor((f-E)/2),_===c||s>=o[_]&&s<o[_+1]){v=_;break}else o[_]<s?E=_+1:f=_-1;return v},l}();m.default=g},"./src/core/media-segment-info.js":function(S,m,p){p.r(m),p.d(m,{SampleInfo:function(){return g},MediaSegmentInfo:function(){return l},IDRSampleList:function(){return o},MediaSegmentInfoList:function(){return s}});var g=function(){function v(c,_,E,f,u){this.dts=c,this.pts=_,this.duration=E,this.originalDts=f,this.isSyncPoint=u,this.fileposition=null}return v}(),l=function(){function v(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return v.prototype.appendSyncPoint=function(c){c.isSyncPoint=!0,this.syncPoints.push(c)},v}(),o=function(){function v(){this._list=[]}return v.prototype.clear=function(){this._list=[]},v.prototype.appendArray=function(c){var _=this._list;c.length!==0&&(_.length>0&&c[0].originalDts<_[_.length-1].originalDts&&this.clear(),Array.prototype.push.apply(_,c))},v.prototype.getLastSyncPointBeforeDts=function(c){if(this._list.length==0)return null;var _=this._list,E=0,f=_.length-1,u=0,d=0,h=f;for(c<_[0].dts&&(E=0,d=h+1);d<=h;)if(u=d+Math.floor((h-d)/2),u===f||c>=_[u].dts&&c<_[u+1].dts){E=u;break}else _[u].dts<c?d=u+1:h=u-1;return this._list[E]},v}(),s=function(){function v(c){this._type=c,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(v.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),v.prototype.isEmpty=function(){return this._list.length===0},v.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},v.prototype._searchNearestSegmentBefore=function(c){var _=this._list;if(_.length===0)return-2;var E=_.length-1,f=0,u=0,d=E,h=0;if(c<_[0].originalBeginDts)return h=-1,h;for(;u<=d;)if(f=u+Math.floor((d-u)/2),f===E||c>_[f].lastSample.originalDts&&c<_[f+1].originalBeginDts){h=f;break}else _[f].originalBeginDts<c?u=f+1:d=f-1;return h},v.prototype._searchNearestSegmentAfter=function(c){return this._searchNearestSegmentBefore(c)+1},v.prototype.append=function(c){var _=this._list,E=c,f=this._lastAppendLocation,u=0;f!==-1&&f<_.length&&E.originalBeginDts>=_[f].lastSample.originalDts&&(f===_.length-1||f<_.length-1&&E.originalBeginDts<_[f+1].originalBeginDts)?u=f+1:_.length>0&&(u=this._searchNearestSegmentBefore(E.originalBeginDts)+1),this._lastAppendLocation=u,this._list.splice(u,0,E)},v.prototype.getLastSegmentBefore=function(c){var _=this._searchNearestSegmentBefore(c);return _>=0?this._list[_]:null},v.prototype.getLastSampleBefore=function(c){var _=this.getLastSegmentBefore(c);return _!=null?_.lastSample:null},v.prototype.getLastSyncPointBefore=function(c){for(var _=this._searchNearestSegmentBefore(c),E=this._list[_].syncPoints;E.length===0&&_>0;)_--,E=this._list[_].syncPoints;return E.length>0?E[E.length-1]:null},v}()},"./src/core/mse-controller.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),l=p.n(g),o=p("./src/utils/logger.js"),s=p("./src/utils/browser.js"),v=p("./src/core/mse-events.js"),c=p("./src/core/media-segment-info.js"),_=p("./src/utils/exception.js"),E=function(){function f(u){this.TAG="MSEController",this._config=u,this._emitter=new(l()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new c.IDRSampleList}return f.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},f.prototype.on=function(u,d){this._emitter.addListener(u,d)},f.prototype.off=function(u,d){this._emitter.removeListener(u,d)},f.prototype.attachMediaElement=function(u){if(this._mediaSource)throw new _.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var d=this._mediaSource=new window.MediaSource;d.addEventListener("sourceopen",this.e.onSourceOpen),d.addEventListener("sourceended",this.e.onSourceEnded),d.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=u,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),u.src=this._mediaSourceObjectURL},f.prototype.detachMediaElement=function(){if(this._mediaSource){var u=this._mediaSource;for(var d in this._sourceBuffers){var h=this._pendingSegments[d];h.splice(0,h.length),this._pendingSegments[d]=null,this._pendingRemoveRanges[d]=null,this._lastInitSegments[d]=null;var a=this._sourceBuffers[d];if(a){if(u.readyState!=="closed"){try{u.removeSourceBuffer(a)}catch(x){o.default.e(this.TAG,x.message)}a.removeEventListener("error",this.e.onSourceBufferError),a.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[d]=null,this._sourceBuffers[d]=null}}if(u.readyState==="open")try{u.endOfStream()}catch(x){o.default.e(this.TAG,x.message)}u.removeEventListener("sourceopen",this.e.onSourceOpen),u.removeEventListener("sourceended",this.e.onSourceEnded),u.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},f.prototype.appendInitSegment=function(u,d){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(u),this._pendingSegments[u.type].push(u);return}var h=u,a=""+h.container;h.codec&&h.codec.length>0&&(a+=";codecs="+h.codec);var x=!1;if(o.default.v(this.TAG,"Received Initialization Segment, mimeType: "+a),this._lastInitSegments[h.type]=h,a!==this._mimeTypes[h.type]){if(this._mimeTypes[h.type])o.default.v(this.TAG,"Notice: "+h.type+" mimeType changed, origin: "+this._mimeTypes[h.type]+", target: "+a);else{x=!0;try{var C=this._sourceBuffers[h.type]=this._mediaSource.addSourceBuffer(a);C.addEventListener("error",this.e.onSourceBufferError),C.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(b){o.default.e(this.TAG,b.message),this._emitter.emit(v.default.ERROR,{code:b.code,msg:b.message});return}}this._mimeTypes[h.type]=a}d||this._pendingSegments[h.type].push(h),x||this._sourceBuffers[h.type]&&!this._sourceBuffers[h.type].updating&&this._doAppendSegments(),s.default.safari&&h.container==="audio/mpeg"&&h.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=h.mediaDuration/1e3,this._updateMediaSourceDuration())},f.prototype.appendMediaSegment=function(u){var d=u;this._pendingSegments[d.type].push(d),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var h=this._sourceBuffers[d.type];h&&!h.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},f.prototype.seek=function(u){for(var d in this._sourceBuffers)if(this._sourceBuffers[d]){var h=this._sourceBuffers[d];if(this._mediaSource.readyState==="open")try{h.abort()}catch(O){o.default.e(this.TAG,O.message)}this._idrList.clear();var a=this._pendingSegments[d];if(a.splice(0,a.length),this._mediaSource.readyState!=="closed"){for(var x=0;x<h.buffered.length;x++){var C=h.buffered.start(x),b=h.buffered.end(x);this._pendingRemoveRanges[d].push({start:C,end:b})}if(h.updating||this._doRemoveRanges(),s.default.safari){var L=this._lastInitSegments[d];L&&(this._pendingSegments[d].push(L),h.updating||this._doAppendSegments())}}}},f.prototype.endOfStream=function(){var u=this._mediaSource,d=this._sourceBuffers;if(!u||u.readyState!=="open"){u&&u.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}d.video&&d.video.updating||d.audio&&d.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,u.endOfStream())},f.prototype.getNearestKeyframe=function(u){return this._idrList.getLastSyncPointBeforeDts(u)},f.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var u=this._mediaElement.currentTime;for(var d in this._sourceBuffers){var h=this._sourceBuffers[d];if(h){var a=h.buffered;if(a.length>=1&&u-a.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},f.prototype._doCleanupSourceBuffer=function(){var u=this._mediaElement.currentTime;for(var d in this._sourceBuffers){var h=this._sourceBuffers[d];if(h){for(var a=h.buffered,x=!1,C=0;C<a.length;C++){var b=a.start(C),L=a.end(C);if(b<=u&&u<L+3){if(u-b>=this._config.autoCleanupMaxBackwardDuration){x=!0;var O=u-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[d].push({start:b,end:O})}}else L<u&&(x=!0,this._pendingRemoveRanges[d].push({start:b,end:L}))}x&&!h.updating&&this._doRemoveRanges()}}},f.prototype._updateMediaSourceDuration=function(){var u=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(u.video&&u.video.updating||u.audio&&u.audio.updating)){var d=this._mediaSource.duration,h=this._pendingMediaDuration;h>0&&(isNaN(d)||h>d)&&(o.default.v(this.TAG,"Update MediaSource duration from "+d+" to "+h),this._mediaSource.duration=h),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},f.prototype._doRemoveRanges=function(){for(var u in this._pendingRemoveRanges)if(!(!this._sourceBuffers[u]||this._sourceBuffers[u].updating))for(var d=this._sourceBuffers[u],h=this._pendingRemoveRanges[u];h.length&&!d.updating;){var a=h.shift();d.remove(a.start,a.end)}},f.prototype._doAppendSegments=function(){var u=this._pendingSegments;for(var d in u)if(!(!this._sourceBuffers[d]||this._sourceBuffers[d].updating)&&u[d].length>0){var h=u[d].shift();if(h.timestampOffset){var a=this._sourceBuffers[d].timestampOffset,x=h.timestampOffset/1e3,C=Math.abs(a-x);C>.1&&(o.default.v(this.TAG,"Update MPEG audio timestampOffset from "+a+" to "+x),this._sourceBuffers[d].timestampOffset=x),delete h.timestampOffset}if(!h.data||h.data.byteLength===0)continue;try{this._sourceBuffers[d].appendBuffer(h.data),this._isBufferFull=!1,d==="video"&&h.hasOwnProperty("info")&&this._idrList.appendArray(h.info.syncPoints)}catch(b){this._pendingSegments[d].unshift(h),b.code===22?(this._isBufferFull||this._emitter.emit(v.default.BUFFER_FULL),this._isBufferFull=!0):(o.default.e(this.TAG,b.message),this._emitter.emit(v.default.ERROR,{code:b.code,msg:b.message}))}}},f.prototype._onSourceOpen=function(){if(o.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var u=this._pendingSourceBufferInit;u.length;){var d=u.shift();this.appendInitSegment(d,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(v.default.SOURCE_OPEN)},f.prototype._onSourceEnded=function(){o.default.v(this.TAG,"MediaSource onSourceEnded")},f.prototype._onSourceClose=function(){o.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},f.prototype._hasPendingSegments=function(){var u=this._pendingSegments;return u.video.length>0||u.audio.length>0},f.prototype._hasPendingRemoveRanges=function(){var u=this._pendingRemoveRanges;return u.video.length>0||u.audio.length>0},f.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(v.default.UPDATE_END)},f.prototype._onSourceBufferError=function(u){o.default.e(this.TAG,"SourceBuffer Error: "+u)},f}();m.default=E},"./src/core/mse-events.js":function(S,m,p){p.r(m);var g={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};m.default=g},"./src/core/transmuxer.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),l=p.n(g),o=p("./node_modules/webworkify-webpack/index.js"),s=p.n(o),v=p("./src/utils/logger.js"),c=p("./src/utils/logging-control.js"),_=p("./src/core/transmuxing-controller.js"),E=p("./src/core/transmuxing-events.js"),f=p("./src/core/media-info.js"),u=function(){function d(h,a){if(this.TAG="Transmuxer",this._emitter=new(l()),a.enableWorker&&typeof Worker<"u")try{this._worker=s()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[h,a]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},c.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:c.default.getConfig()})}catch{v.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new _.default(h,a)}else this._controller=new _.default(h,a);if(this._controller){var x=this._controller;x.on(E.default.IO_ERROR,this._onIOError.bind(this)),x.on(E.default.DEMUX_ERROR,this._onDemuxError.bind(this)),x.on(E.default.INIT_SEGMENT,this._onInitSegment.bind(this)),x.on(E.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),x.on(E.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),x.on(E.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),x.on(E.default.MEDIA_INFO,this._onMediaInfo.bind(this)),x.on(E.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),x.on(E.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),x.on(E.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),x.on(E.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return d.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),c.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},d.prototype.on=function(h,a){this._emitter.addListener(h,a)},d.prototype.off=function(h,a){this._emitter.removeListener(h,a)},d.prototype.hasWorker=function(){return this._worker!=null},d.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},d.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},d.prototype.seek=function(h){this._worker?this._worker.postMessage({cmd:"seek",param:h}):this._controller.seek(h)},d.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},d.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},d.prototype._onInitSegment=function(h,a){var x=this;Promise.resolve().then(function(){x._emitter.emit(E.default.INIT_SEGMENT,h,a)})},d.prototype._onMediaSegment=function(h,a){var x=this;Promise.resolve().then(function(){x._emitter.emit(E.default.MEDIA_SEGMENT,h,a)})},d.prototype._onLoadingComplete=function(){var h=this;Promise.resolve().then(function(){h._emitter.emit(E.default.LOADING_COMPLETE)})},d.prototype._onRecoveredEarlyEof=function(){var h=this;Promise.resolve().then(function(){h._emitter.emit(E.default.RECOVERED_EARLY_EOF)})},d.prototype._onMediaInfo=function(h){var a=this;Promise.resolve().then(function(){a._emitter.emit(E.default.MEDIA_INFO,h)})},d.prototype._onMetaDataArrived=function(h){var a=this;Promise.resolve().then(function(){a._emitter.emit(E.default.METADATA_ARRIVED,h)})},d.prototype._onScriptDataArrived=function(h){var a=this;Promise.resolve().then(function(){a._emitter.emit(E.default.SCRIPTDATA_ARRIVED,h)})},d.prototype._onStatisticsInfo=function(h){var a=this;Promise.resolve().then(function(){a._emitter.emit(E.default.STATISTICS_INFO,h)})},d.prototype._onIOError=function(h,a){var x=this;Promise.resolve().then(function(){x._emitter.emit(E.default.IO_ERROR,h,a)})},d.prototype._onDemuxError=function(h,a){var x=this;Promise.resolve().then(function(){x._emitter.emit(E.default.DEMUX_ERROR,h,a)})},d.prototype._onRecommendSeekpoint=function(h){var a=this;Promise.resolve().then(function(){a._emitter.emit(E.default.RECOMMEND_SEEKPOINT,h)})},d.prototype._onLoggingConfigChanged=function(h){this._worker&&this._worker.postMessage({cmd:"logging_config",param:h})},d.prototype._onWorkerMessage=function(h){var a=h.data,x=a.data;if(a.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(a.msg){case E.default.INIT_SEGMENT:case E.default.MEDIA_SEGMENT:this._emitter.emit(a.msg,x.type,x.data);break;case E.default.LOADING_COMPLETE:case E.default.RECOVERED_EARLY_EOF:this._emitter.emit(a.msg);break;case E.default.MEDIA_INFO:Object.setPrototypeOf(x,f.default.prototype),this._emitter.emit(a.msg,x);break;case E.default.METADATA_ARRIVED:case E.default.SCRIPTDATA_ARRIVED:case E.default.STATISTICS_INFO:this._emitter.emit(a.msg,x);break;case E.default.IO_ERROR:case E.default.DEMUX_ERROR:this._emitter.emit(a.msg,x.type,x.info);break;case E.default.RECOMMEND_SEEKPOINT:this._emitter.emit(a.msg,x);break;case"logcat_callback":v.default.emitter.emit("log",x.type,x.logcat);break}},d}();m.default=u},"./src/core/transmuxing-controller.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),l=p.n(g),o=p("./src/utils/logger.js"),s=p("./src/utils/browser.js"),v=p("./src/core/media-info.js"),c=p("./src/demux/flv-demuxer.js"),_=p("./src/remux/mp4-remuxer.js"),E=p("./src/demux/demux-errors.js"),f=p("./src/io/io-controller.js"),u=p("./src/core/transmuxing-events.js"),d=function(){function h(a,x){this.TAG="TransmuxingController",this._emitter=new(l()),this._config=x,a.segments||(a.segments=[{duration:a.duration,filesize:a.filesize,url:a.url}]),typeof a.cors!="boolean"&&(a.cors=!0),typeof a.withCredentials!="boolean"&&(a.withCredentials=!1),this._mediaDataSource=a,this._currentSegmentIndex=0;var C=0;this._mediaDataSource.segments.forEach(function(b){b.timestampBase=C,C+=b.duration,b.cors=a.cors,b.withCredentials=a.withCredentials,x.referrerPolicy&&(b.referrerPolicy=x.referrerPolicy)}),!isNaN(C)&&this._mediaDataSource.duration!==C&&(this._mediaDataSource.duration=C),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return h.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},h.prototype.on=function(a,x){this._emitter.addListener(a,x)},h.prototype.off=function(a,x){this._emitter.removeListener(a,x)},h.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},h.prototype._loadSegment=function(a,x){this._currentSegmentIndex=a;var C=this._mediaDataSource.segments[a],b=this._ioctl=new f.default(C,this._config,a);b.onError=this._onIOException.bind(this),b.onSeeked=this._onIOSeeked.bind(this),b.onComplete=this._onIOComplete.bind(this),b.onRedirect=this._onIORedirect.bind(this),b.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),x?this._demuxer.bindDataSource(this._ioctl):b.onDataArrival=this._onInitChunkArrival.bind(this),b.open(x)},h.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},h.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},h.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},h.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},h.prototype.seek=function(a){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var x=this._searchSegmentIndexContains(a);if(x===this._currentSegmentIndex){var C=this._mediaInfo.segments[x];if(C==null)this._pendingSeekTime=a;else{var b=C.getNearestKeyframe(a);this._remuxer.seek(b.milliseconds),this._ioctl.seek(b.fileposition),this._pendingResolveSeekPoint=b.milliseconds}}else{var L=this._mediaInfo.segments[x];if(L==null)this._pendingSeekTime=a,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(x);else{var b=L.getNearestKeyframe(a);this._internalAbort(),this._remuxer.seek(a),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[x].timestampBase,this._loadSegment(x,b.fileposition),this._pendingResolveSeekPoint=b.milliseconds,this._reportSegmentMediaInfo(x)}}this._enableStatisticsReporter()}},h.prototype._searchSegmentIndexContains=function(a){for(var x=this._mediaDataSource.segments,C=x.length-1,b=0;b<x.length;b++)if(a<x[b].timestampBase){C=b-1;break}return C},h.prototype._onInitChunkArrival=function(a,x){var C=this,b=null,L=0;if(x>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,L=this._demuxer.parseChunks(a,x);else if((b=c.default.probe(a)).match){this._demuxer=new c.default(b,this._config),this._remuxer||(this._remuxer=new _.default(this._config));var O=this._mediaDataSource;O.duration!=null&&!isNaN(O.duration)&&(this._demuxer.overridedDuration=O.duration),typeof O.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=O.hasAudio),typeof O.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=O.hasVideo),this._demuxer.timestampBase=O.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),L=this._demuxer.parseChunks(a,x)}else b=null,o.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){C._internalAbort()}),this._emitter.emit(u.default.DEMUX_ERROR,E.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),L=0;return L},h.prototype._onMediaInfo=function(a){var x=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},a),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,v.default.prototype));var C=Object.assign({},a);Object.setPrototypeOf(C,v.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=C,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var b=x._pendingSeekTime;x._pendingSeekTime=null,x.seek(b)})},h.prototype._onMetaDataArrived=function(a){this._emitter.emit(u.default.METADATA_ARRIVED,a)},h.prototype._onScriptDataArrived=function(a){this._emitter.emit(u.default.SCRIPTDATA_ARRIVED,a)},h.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},h.prototype._onIOComplete=function(a){var x=a,C=x+1;C<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(C)):(this._remuxer.flushStashedSamples(),this._emitter.emit(u.default.LOADING_COMPLETE),this._disableStatisticsReporter())},h.prototype._onIORedirect=function(a){var x=this._ioctl.extraData;this._mediaDataSource.segments[x].redirectedURL=a},h.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(u.default.RECOVERED_EARLY_EOF)},h.prototype._onIOException=function(a,x){o.default.e(this.TAG,"IOException: type = "+a+", code = "+x.code+", msg = "+x.msg),this._emitter.emit(u.default.IO_ERROR,a,x),this._disableStatisticsReporter()},h.prototype._onDemuxException=function(a,x){o.default.e(this.TAG,"DemuxException: type = "+a+", info = "+x),this._emitter.emit(u.default.DEMUX_ERROR,a,x)},h.prototype._onRemuxerInitSegmentArrival=function(a,x){this._emitter.emit(u.default.INIT_SEGMENT,a,x)},h.prototype._onRemuxerMediaSegmentArrival=function(a,x){if(this._pendingSeekTime==null&&(this._emitter.emit(u.default.MEDIA_SEGMENT,a,x),this._pendingResolveSeekPoint!=null&&a==="video")){var C=x.info.syncPoints,b=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,s.default.safari&&C.length>0&&C[0].originalDts===b&&(b=C[0].pts),this._emitter.emit(u.default.RECOMMEND_SEEKPOINT,b)}},h.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},h.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},h.prototype._reportSegmentMediaInfo=function(a){var x=this._mediaInfo.segments[a],C=Object.assign({},x);C.duration=this._mediaInfo.duration,C.segmentCount=this._mediaInfo.segmentCount,delete C.segments,delete C.keyframesIndex,this._emitter.emit(u.default.MEDIA_INFO,C)},h.prototype._reportStatisticsInfo=function(){var a={};a.url=this._ioctl.currentURL,a.hasRedirect=this._ioctl.hasRedirect,a.hasRedirect&&(a.redirectedURL=this._ioctl.currentRedirectedURL),a.speed=this._ioctl.currentSpeed,a.loaderType=this._ioctl.loaderType,a.currentSegmentIndex=this._currentSegmentIndex,a.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(u.default.STATISTICS_INFO,a)},h}();m.default=d},"./src/core/transmuxing-events.js":function(S,m,p){p.r(m);var g={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};m.default=g},"./src/core/transmuxing-worker.js":function(S,m,p){p.r(m);var g=p("./src/utils/logging-control.js"),l=p("./src/utils/polyfill.js"),o=p("./src/core/transmuxing-controller.js"),s=p("./src/core/transmuxing-events.js"),v=function(c){var _=null,E=R.bind(this);l.default.install(),c.addEventListener("message",function(T){switch(T.data.cmd){case"init":_=new o.default(T.data.param[0],T.data.param[1]),_.on(s.default.IO_ERROR,L.bind(this)),_.on(s.default.DEMUX_ERROR,O.bind(this)),_.on(s.default.INIT_SEGMENT,f.bind(this)),_.on(s.default.MEDIA_SEGMENT,u.bind(this)),_.on(s.default.LOADING_COMPLETE,d.bind(this)),_.on(s.default.RECOVERED_EARLY_EOF,h.bind(this)),_.on(s.default.MEDIA_INFO,a.bind(this)),_.on(s.default.METADATA_ARRIVED,x.bind(this)),_.on(s.default.SCRIPTDATA_ARRIVED,C.bind(this)),_.on(s.default.STATISTICS_INFO,b.bind(this)),_.on(s.default.RECOMMEND_SEEKPOINT,A.bind(this));break;case"destroy":_&&(_.destroy(),_=null),c.postMessage({msg:"destroyed"});break;case"start":_.start();break;case"stop":_.stop();break;case"seek":_.seek(T.data.param);break;case"pause":_.pause();break;case"resume":_.resume();break;case"logging_config":{var P=T.data.param;g.default.applyConfig(P),P.enableCallback===!0?g.default.addLogListener(E):g.default.removeLogListener(E);break}}});function f(T,P){var M={msg:s.default.INIT_SEGMENT,data:{type:T,data:P}};c.postMessage(M,[P.data])}function u(T,P){var M={msg:s.default.MEDIA_SEGMENT,data:{type:T,data:P}};c.postMessage(M,[P.data])}function d(){var T={msg:s.default.LOADING_COMPLETE};c.postMessage(T)}function h(){var T={msg:s.default.RECOVERED_EARLY_EOF};c.postMessage(T)}function a(T){var P={msg:s.default.MEDIA_INFO,data:T};c.postMessage(P)}function x(T){var P={msg:s.default.METADATA_ARRIVED,data:T};c.postMessage(P)}function C(T){var P={msg:s.default.SCRIPTDATA_ARRIVED,data:T};c.postMessage(P)}function b(T){var P={msg:s.default.STATISTICS_INFO,data:T};c.postMessage(P)}function L(T,P){c.postMessage({msg:s.default.IO_ERROR,data:{type:T,info:P}})}function O(T,P){c.postMessage({msg:s.default.DEMUX_ERROR,data:{type:T,info:P}})}function A(T){c.postMessage({msg:s.default.RECOMMEND_SEEKPOINT,data:T})}function R(T,P){c.postMessage({msg:"logcat_callback",data:{type:T,logcat:P}})}};m.default=v},"./src/demux/amf-parser.js":function(S,m,p){p.r(m);var g=p("./src/utils/logger.js"),l=p("./src/utils/utf8-conv.js"),o=p("./src/utils/exception.js"),s=function(){var c=new ArrayBuffer(2);return new DataView(c).setInt16(0,256,!0),new Int16Array(c)[0]===256}(),v=function(){function c(){}return c.parseScriptData=function(_,E,f){var u={};try{var d=c.parseValue(_,E,f),h=c.parseValue(_,E+d.size,f-d.size);u[d.data]=h.data}catch(a){g.default.e("AMF",a.toString())}return u},c.parseObject=function(_,E,f){if(f<3)throw new o.IllegalStateException("Data not enough when parse ScriptDataObject");var u=c.parseString(_,E,f),d=c.parseValue(_,E+u.size,f-u.size),h=d.objectEnd;return{data:{name:u.data,value:d.data},size:u.size+d.size,objectEnd:h}},c.parseVariable=function(_,E,f){return c.parseObject(_,E,f)},c.parseString=function(_,E,f){if(f<2)throw new o.IllegalStateException("Data not enough when parse String");var u=new DataView(_,E,f),d=u.getUint16(0,!s),h;return d>0?h=(0,l.default)(new Uint8Array(_,E+2,d)):h="",{data:h,size:2+d}},c.parseLongString=function(_,E,f){if(f<4)throw new o.IllegalStateException("Data not enough when parse LongString");var u=new DataView(_,E,f),d=u.getUint32(0,!s),h;return d>0?h=(0,l.default)(new Uint8Array(_,E+4,d)):h="",{data:h,size:4+d}},c.parseDate=function(_,E,f){if(f<10)throw new o.IllegalStateException("Data size invalid when parse Date");var u=new DataView(_,E,f),d=u.getFloat64(0,!s),h=u.getInt16(8,!s);return d+=h*60*1e3,{data:new Date(d),size:8+2}},c.parseValue=function(_,E,f){if(f<1)throw new o.IllegalStateException("Data not enough when parse Value");var u=new DataView(_,E,f),d=1,h=u.getUint8(0),a,x=!1;try{switch(h){case 0:a=u.getFloat64(1,!s),d+=8;break;case 1:{var C=u.getUint8(1);a=!!C,d+=1;break}case 2:{var b=c.parseString(_,E+1,f-1);a=b.data,d+=b.size;break}case 3:{a={};var L=0;for((u.getUint32(f-4,!s)&16777215)===9&&(L=3);d<f-4;){var O=c.parseObject(_,E+d,f-d-L);if(O.objectEnd)break;a[O.data.name]=O.data.value,d+=O.size}if(d<=f-3){var A=u.getUint32(d-1,!s)&16777215;A===9&&(d+=3)}break}case 8:{a={},d+=4;var L=0;for((u.getUint32(f-4,!s)&16777215)===9&&(L=3);d<f-8;){var R=c.parseVariable(_,E+d,f-d-L);if(R.objectEnd)break;a[R.data.name]=R.data.value,d+=R.size}if(d<=f-3){var A=u.getUint32(d-1,!s)&16777215;A===9&&(d+=3)}break}case 9:a=void 0,d=1,x=!0;break;case 10:{a=[];var T=u.getUint32(1,!s);d+=4;for(var P=0;P<T;P++){var M=c.parseValue(_,E+d,f-d);a.push(M.data),d+=M.size}break}case 11:{var D=c.parseDate(_,E+1,f-1);a=D.data,d+=D.size;break}case 12:{var I=c.parseString(_,E+1,f-1);a=I.data,d+=I.size;break}default:d=f,g.default.w("AMF","Unsupported AMF value type "+h)}}catch(Y){g.default.e("AMF",Y.toString())}return{data:a,size:d,objectEnd:x}},c}();m.default=v},"./src/demux/demux-errors.js":function(S,m,p){p.r(m);var g={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};m.default=g},"./src/demux/exp-golomb.js":function(S,m,p){p.r(m);var g=p("./src/utils/exception.js"),l=function(){function o(s){this.TAG="ExpGolomb",this._buffer=s,this._buffer_index=0,this._total_bytes=s.byteLength,this._total_bits=s.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return o.prototype.destroy=function(){this._buffer=null},o.prototype._fillCurrentWord=function(){var s=this._total_bytes-this._buffer_index;if(s<=0)throw new g.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var v=Math.min(4,s),c=new Uint8Array(4);c.set(this._buffer.subarray(this._buffer_index,this._buffer_index+v)),this._current_word=new DataView(c.buffer).getUint32(0,!1),this._buffer_index+=v,this._current_word_bits_left=v*8},o.prototype.readBits=function(s){if(s>32)throw new g.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(s<=this._current_word_bits_left){var v=this._current_word>>>32-s;return this._current_word<<=s,this._current_word_bits_left-=s,v}var c=this._current_word_bits_left?this._current_word:0;c=c>>>32-this._current_word_bits_left;var _=s-this._current_word_bits_left;this._fillCurrentWord();var E=Math.min(_,this._current_word_bits_left),f=this._current_word>>>32-E;return this._current_word<<=E,this._current_word_bits_left-=E,c=c<<E|f,c},o.prototype.readBool=function(){return this.readBits(1)===1},o.prototype.readByte=function(){return this.readBits(8)},o.prototype._skipLeadingZero=function(){var s;for(s=0;s<this._current_word_bits_left;s++)if(this._current_word&2147483648>>>s)return this._current_word<<=s,this._current_word_bits_left-=s,s;return this._fillCurrentWord(),s+this._skipLeadingZero()},o.prototype.readUEG=function(){var s=this._skipLeadingZero();return this.readBits(s+1)-1},o.prototype.readSEG=function(){var s=this.readUEG();return s&1?s+1>>>1:-1*(s>>>1)},o}();m.default=l},"./src/demux/flv-demuxer.js":function(S,m,p){p.r(m);var g=p("./src/utils/logger.js"),l=p("./src/demux/amf-parser.js"),o=p("./src/demux/sps-parser.js"),s=p("./src/demux/demux-errors.js"),v=p("./src/core/media-info.js"),c=p("./src/utils/exception.js");function _(f,u){return f[u]<<24|f[u+1]<<16|f[u+2]<<8|f[u+3]}var E=function(){function f(u,d){this.TAG="FLVDemuxer",this._config=d,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=u.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=u.hasAudioTrack,this._hasVideo=u.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new v.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var h=new ArrayBuffer(2);return new DataView(h).setInt16(0,256,!0),new Int16Array(h)[0]===256}()}return f.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},f.probe=function(u){var d=new Uint8Array(u),h={match:!1};if(d[0]!==70||d[1]!==76||d[2]!==86||d[3]!==1)return h;var a=(d[4]&4)>>>2!==0,x=(d[4]&1)!==0,C=_(d,5);return C<9?h:{match:!0,consumed:C,dataOffset:C,hasAudioTrack:a,hasVideoTrack:x}},f.prototype.bindDataSource=function(u){return u.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(f.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(u){this._onTrackMetadata=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(u){this._onMediaInfo=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(u){this._onMetaDataArrived=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(u){this._onScriptDataArrived=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onError",{get:function(){return this._onError},set:function(u){this._onError=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(u){this._onDataAvailable=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(u){this._timestampBase=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"overridedDuration",{get:function(){return this._duration},set:function(u){this._durationOverrided=!0,this._duration=u,this._mediaInfo.duration=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"overridedHasAudio",{set:function(u){this._hasAudioFlagOverrided=!0,this._hasAudio=u,this._mediaInfo.hasAudio=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"overridedHasVideo",{set:function(u){this._hasVideoFlagOverrided=!0,this._hasVideo=u,this._mediaInfo.hasVideo=u},enumerable:!1,configurable:!0}),f.prototype.resetMediaInfo=function(){this._mediaInfo=new v.default},f.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},f.prototype.parseChunks=function(u,d){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new c.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var h=0,a=this._littleEndian;if(d===0)if(u.byteLength>13){var x=f.probe(u);h=x.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,d+h!==this._dataOffset&&g.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var C=new DataView(u,h),b=C.getUint32(0,!a);b!==0&&g.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),h+=4}for(;h<u.byteLength;){this._dispatch=!0;var C=new DataView(u,h);if(h+11+4>u.byteLength)break;var L=C.getUint8(0),O=C.getUint32(0,!a)&16777215;if(h+11+O+4>u.byteLength)break;if(L!==8&&L!==9&&L!==18){g.default.w(this.TAG,"Unsupported tag type "+L+", skipped"),h+=11+O+4;continue}var A=C.getUint8(4),R=C.getUint8(5),T=C.getUint8(6),P=C.getUint8(7),M=T|R<<8|A<<16|P<<24,D=C.getUint32(7,!a)&16777215;D!==0&&g.default.w(this.TAG,"Meet tag which has StreamID != 0!");var I=h+11;switch(L){case 8:this._parseAudioData(u,I,O,M);break;case 9:this._parseVideoData(u,I,O,M,d+h);break;case 18:this._parseScriptData(u,I,O);break}var Y=C.getUint32(11+O,!a);Y!==11+O&&g.default.w(this.TAG,"Invalid PrevTagSize "+Y),h+=11+O+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),h},f.prototype._parseScriptData=function(u,d,h){var a=l.default.parseScriptData(u,d,h);if(a.hasOwnProperty("onMetaData")){if(a.onMetaData==null||typeof a.onMetaData!="object"){g.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&g.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=a;var x=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},x)),typeof x.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=x.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof x.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=x.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof x.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=x.audiodatarate),typeof x.videodatarate=="number"&&(this._mediaInfo.videoDataRate=x.videodatarate),typeof x.width=="number"&&(this._mediaInfo.width=x.width),typeof x.height=="number"&&(this._mediaInfo.height=x.height),typeof x.duration=="number"){if(!this._durationOverrided){var C=Math.floor(x.duration*this._timescale);this._duration=C,this._mediaInfo.duration=C}}else this._mediaInfo.duration=0;if(typeof x.framerate=="number"){var b=Math.floor(x.framerate*1e3);if(b>0){var L=b/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=L,this._referenceFrameRate.fps_num=b,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=L}}if(typeof x.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var O=x.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(O),x.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=x,g.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(a).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},a))},f.prototype._parseKeyframesIndex=function(u){for(var d=[],h=[],a=1;a<u.times.length;a++){var x=this._timestampBase+Math.floor(u.times[a]*1e3);d.push(x),h.push(u.filepositions[a])}return{times:d,filepositions:h}},f.prototype._parseAudioData=function(u,d,h,a){if(h<=1){g.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var x=new DataView(u,d,h),C=x.getUint8(0),b=C>>>4;if(b!==2&&b!==10){this._onError(s.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+b);return}var L=0,O=(C&12)>>>2;if(O>=0&&O<=4)L=this._flvSoundRateTable[O];else{this._onError(s.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+O);return}var A=C&1,R=this._audioMetadata,T=this._audioTrack;if(R||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),R=this._audioMetadata={},R.type="audio",R.id=T.id,R.timescale=this._timescale,R.duration=this._duration,R.audioSampleRate=L,R.channelCount=A===0?1:2),b===10){var P=this._parseAACAudioData(u,d+1,h-1);if(P==null)return;if(P.packetType===0){R.config&&g.default.w(this.TAG,"Found another AudioSpecificConfig!");var M=P.data;R.audioSampleRate=M.samplingRate,R.channelCount=M.channelCount,R.codec=M.codec,R.originalCodec=M.originalCodec,R.config=M.config,R.refSampleDuration=1024/R.audioSampleRate*R.timescale,g.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",R);var D=this._mediaInfo;D.audioCodec=R.originalCodec,D.audioSampleRate=R.audioSampleRate,D.audioChannelCount=R.channelCount,D.hasVideo?D.videoCodec!=null&&(D.mimeType='video/x-flv; codecs="'+D.videoCodec+","+D.audioCodec+'"'):D.mimeType='video/x-flv; codecs="'+D.audioCodec+'"',D.isComplete()&&this._onMediaInfo(D)}else if(P.packetType===1){var I=this._timestampBase+a,Y={unit:P.data,length:P.data.byteLength,dts:I,pts:I};T.samples.push(Y),T.length+=P.data.length}else g.default.e(this.TAG,"Flv: Unsupported AAC data type "+P.packetType)}else if(b===2){if(!R.codec){var M=this._parseMP3AudioData(u,d+1,h-1,!0);if(M==null)return;R.audioSampleRate=M.samplingRate,R.channelCount=M.channelCount,R.codec=M.codec,R.originalCodec=M.originalCodec,R.refSampleDuration=1152/R.audioSampleRate*R.timescale,g.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",R);var D=this._mediaInfo;D.audioCodec=R.codec,D.audioSampleRate=R.audioSampleRate,D.audioChannelCount=R.channelCount,D.audioDataRate=M.bitRate,D.hasVideo?D.videoCodec!=null&&(D.mimeType='video/x-flv; codecs="'+D.videoCodec+","+D.audioCodec+'"'):D.mimeType='video/x-flv; codecs="'+D.audioCodec+'"',D.isComplete()&&this._onMediaInfo(D)}var Q=this._parseMP3AudioData(u,d+1,h-1,!1);if(Q==null)return;var I=this._timestampBase+a,X={unit:Q,length:Q.byteLength,dts:I,pts:I};T.samples.push(X),T.length+=Q.length}}},f.prototype._parseAACAudioData=function(u,d,h){if(h<=1){g.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var a={},x=new Uint8Array(u,d,h);return a.packetType=x[0],x[0]===0?a.data=this._parseAACAudioSpecificConfig(u,d+1,h-1):a.data=x.subarray(1),a},f.prototype._parseAACAudioSpecificConfig=function(u,d,h){var a=new Uint8Array(u,d,h),x=null,C=0,b=0,L=0,O=null;if(C=b=a[0]>>>3,L=(a[0]&7)<<1|a[1]>>>7,L<0||L>=this._mpegSamplingRates.length){this._onError(s.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var A=this._mpegSamplingRates[L],R=(a[1]&120)>>>3;if(R<0||R>=8){this._onError(s.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}C===5&&(O=(a[1]&7)<<1|a[2]>>>7,(a[2]&124)>>>2);var T=self.navigator.userAgent.toLowerCase();return T.indexOf("firefox")!==-1?L>=6?(C=5,x=new Array(4),O=L-3):(C=2,x=new Array(2),O=L):T.indexOf("android")!==-1?(C=2,x=new Array(2),O=L):(C=5,O=L,x=new Array(4),L>=6?O=L-3:R===1&&(C=2,x=new Array(2),O=L)),x[0]=C<<3,x[0]|=(L&15)>>>1,x[1]=(L&15)<<7,x[1]|=(R&15)<<3,C===5&&(x[1]|=(O&15)>>>1,x[2]=(O&1)<<7,x[2]|=8,x[3]=0),{config:x,samplingRate:A,channelCount:R,codec:"mp4a.40."+C,originalCodec:"mp4a.40."+b}},f.prototype._parseMP3AudioData=function(u,d,h,a){if(h<4){g.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var x=new Uint8Array(u,d,h),C=null;if(a){if(x[0]!==255)return;var b=x[1]>>>3&3,L=(x[1]&6)>>1,O=(x[2]&240)>>>4,A=(x[2]&12)>>>2,R=x[3]>>>6&3,T=R!==3?2:1,P=0,M=0,D="mp3";switch(b){case 0:P=this._mpegAudioV25SampleRateTable[A];break;case 2:P=this._mpegAudioV20SampleRateTable[A];break;case 3:P=this._mpegAudioV10SampleRateTable[A];break}switch(L){case 1:O<this._mpegAudioL3BitRateTable.length&&(M=this._mpegAudioL3BitRateTable[O]);break;case 2:O<this._mpegAudioL2BitRateTable.length&&(M=this._mpegAudioL2BitRateTable[O]);break;case 3:O<this._mpegAudioL1BitRateTable.length&&(M=this._mpegAudioL1BitRateTable[O]);break}C={bitRate:M,samplingRate:P,channelCount:T,codec:D,originalCodec:D}}else C=x;return C},f.prototype._parseVideoData=function(u,d,h,a,x){if(h<=1){g.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var C=new Uint8Array(u,d,h)[0],b=(C&240)>>>4,L=C&15;if(L!==7){this._onError(s.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+L);return}this._parseAVCVideoPacket(u,d+1,h-1,a,x,b)}},f.prototype._parseAVCVideoPacket=function(u,d,h,a,x,C){if(h<4){g.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var b=this._littleEndian,L=new DataView(u,d,h),O=L.getUint8(0),A=L.getUint32(0,!b)&16777215,R=A<<8>>8;if(O===0)this._parseAVCDecoderConfigurationRecord(u,d+4,h-4);else if(O===1)this._parseAVCVideoData(u,d+4,h-4,a,x,C,R);else if(O!==2){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid video packet type "+O);return}},f.prototype._parseAVCDecoderConfigurationRecord=function(u,d,h){if(h<7){g.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var a=this._videoMetadata,x=this._videoTrack,C=this._littleEndian,b=new DataView(u,d,h);a?typeof a.avcc<"u"&&g.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),a=this._videoMetadata={},a.type="video",a.id=x.id,a.timescale=this._timescale,a.duration=this._duration);var L=b.getUint8(0),O=b.getUint8(1);if(b.getUint8(2),b.getUint8(3),L!==1||O===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(b.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(s.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var A=b.getUint8(5)&31;if(A===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else A>1&&g.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+A);for(var R=6,T=0;T<A;T++){var P=b.getUint16(R,!C);if(R+=2,P!==0){var M=new Uint8Array(u,d+R,P);R+=P;var D=o.default.parseSPS(M);if(T===0){a.codecWidth=D.codec_size.width,a.codecHeight=D.codec_size.height,a.presentWidth=D.present_size.width,a.presentHeight=D.present_size.height,a.profile=D.profile_string,a.level=D.level_string,a.bitDepth=D.bit_depth,a.chromaFormat=D.chroma_format,a.sarRatio=D.sar_ratio,a.frameRate=D.frame_rate,(D.frame_rate.fixed===!1||D.frame_rate.fps_num===0||D.frame_rate.fps_den===0)&&(a.frameRate=this._referenceFrameRate);var I=a.frameRate.fps_den,Y=a.frameRate.fps_num;a.refSampleDuration=a.timescale*(I/Y);for(var Q=M.subarray(1,4),X="avc1.",ne=0;ne<3;ne++){var ue=Q[ne].toString(16);ue.length<2&&(ue="0"+ue),X+=ue}a.codec=X;var H=this._mediaInfo;H.width=a.codecWidth,H.height=a.codecHeight,H.fps=a.frameRate.fps,H.profile=a.profile,H.level=a.level,H.refFrames=D.ref_frames,H.chromaFormat=D.chroma_format_string,H.sarNum=a.sarRatio.width,H.sarDen=a.sarRatio.height,H.videoCodec=X,H.hasAudio?H.audioCodec!=null&&(H.mimeType='video/x-flv; codecs="'+H.videoCodec+","+H.audioCodec+'"'):H.mimeType='video/x-flv; codecs="'+H.videoCodec+'"',H.isComplete()&&this._onMediaInfo(H)}}}var ie=b.getUint8(R);if(ie===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else ie>1&&g.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+ie);R++;for(var T=0;T<ie;T++){var P=b.getUint16(R,!C);R+=2,P!==0&&(R+=P)}a.avcc=new Uint8Array(h),a.avcc.set(new Uint8Array(u,d,h),0),g.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",a)},f.prototype._parseAVCVideoData=function(u,d,h,a,x,C,b){for(var L=this._littleEndian,O=new DataView(u,d,h),A=[],R=0,T=0,P=this._naluLengthSize,M=this._timestampBase+a,D=C===1;T<h;){if(T+4>=h){g.default.w(this.TAG,"Malformed Nalu near timestamp "+M+", offset = "+T+", dataSize = "+h);break}var I=O.getUint32(T,!L);if(P===3&&(I>>>=8),I>h-P){g.default.w(this.TAG,"Malformed Nalus near timestamp "+M+", NaluSize > DataSize!");return}var Y=O.getUint8(T+P)&31;Y===5&&(D=!0);var Q=new Uint8Array(u,d+T,P+I),X={type:Y,data:Q};A.push(X),R+=Q.byteLength,T+=P+I}if(A.length){var ne=this._videoTrack,ue={units:A,length:R,isKeyframe:D,dts:M,cts:b,pts:M+b};D&&(ue.fileposition=x),ne.samples.push(ue),ne.length+=R}},f}();m.default=E},"./src/demux/sps-parser.js":function(S,m,p){p.r(m);var g=p("./src/demux/exp-golomb.js"),l=function(){function o(){}return o._ebsp2rbsp=function(s){for(var v=s,c=v.byteLength,_=new Uint8Array(c),E=0,f=0;f<c;f++)f>=2&&v[f]===3&&v[f-1]===0&&v[f-2]===0||(_[E]=v[f],E++);return new Uint8Array(_.buffer,0,E)},o.parseSPS=function(s){var v=o._ebsp2rbsp(s),c=new g.default(v);c.readByte();var _=c.readByte();c.readByte();var E=c.readByte();c.readUEG();var f=o.getProfileString(_),u=o.getLevelString(E),d=1,h=420,a=[0,420,422,444],x=8;if((_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128||_===138||_===144)&&(d=c.readUEG(),d===3&&c.readBits(1),d<=3&&(h=a[d]),x=c.readUEG()+8,c.readUEG(),c.readBits(1),c.readBool()))for(var C=d!==3?8:12,b=0;b<C;b++)c.readBool()&&(b<6?o._skipScalingList(c,16):o._skipScalingList(c,64));c.readUEG();var L=c.readUEG();if(L===0)c.readUEG();else if(L===1){c.readBits(1),c.readSEG(),c.readSEG();for(var O=c.readUEG(),b=0;b<O;b++)c.readSEG()}var A=c.readUEG();c.readBits(1);var R=c.readUEG(),T=c.readUEG(),P=c.readBits(1);P===0&&c.readBits(1),c.readBits(1);var M=0,D=0,I=0,Y=0,Q=c.readBool();Q&&(M=c.readUEG(),D=c.readUEG(),I=c.readUEG(),Y=c.readUEG());var X=1,ne=1,ue=0,H=!0,ie=0,Re=0,ce=c.readBool();if(ce){if(c.readBool()){var fe=c.readByte(),Ce=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],ye=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];fe>0&&fe<16?(X=Ce[fe-1],ne=ye[fe-1]):fe===255&&(X=c.readByte()<<8|c.readByte(),ne=c.readByte()<<8|c.readByte())}if(c.readBool()&&c.readBool(),c.readBool()&&(c.readBits(4),c.readBool()&&c.readBits(24)),c.readBool()&&(c.readUEG(),c.readUEG()),c.readBool()){var xe=c.readBits(32),Te=c.readBits(32);H=c.readBool(),ie=Te,Re=xe*2,ue=ie/Re}}var de=1;(X!==1||ne!==1)&&(de=X/ne);var z=0,Se=0;if(d===0)z=1,Se=2-P;else{var Le=d===3?1:2,Ne=d===1?2:1;z=Le,Se=Ne*(2-P)}var ke=(R+1)*16,De=(2-P)*((T+1)*16);ke-=(M+D)*z,De-=(I+Y)*Se;var Ve=Math.ceil(ke*de);return c.destroy(),c=null,{profile_string:f,level_string:u,bit_depth:x,ref_frames:A,chroma_format:h,chroma_format_string:o.getChromaFormatString(h),frame_rate:{fixed:H,fps:ue,fps_den:Re,fps_num:ie},sar_ratio:{width:X,height:ne},codec_size:{width:ke,height:De},present_size:{width:Ve,height:De}}},o._skipScalingList=function(s,v){for(var c=8,_=8,E=0,f=0;f<v;f++)_!==0&&(E=s.readSEG(),_=(c+E+256)%256),c=_===0?c:_},o.getProfileString=function(s){switch(s){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},o.getLevelString=function(s){return(s/10).toFixed(1)},o.getChromaFormatString=function(s){switch(s){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},o}();m.default=l},"./src/flv.js":function(S,m,p){p.r(m);var g=p("./src/utils/polyfill.js"),l=p("./src/core/features.js"),o=p("./src/io/loader.js"),s=p("./src/player/flv-player.js"),v=p("./src/player/native-player.js"),c=p("./src/player/player-events.js"),_=p("./src/player/player-errors.js"),E=p("./src/utils/logging-control.js"),f=p("./src/utils/exception.js");g.default.install();function u(x,C){var b=x;if(b==null||typeof b!="object")throw new f.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!b.hasOwnProperty("type"))throw new f.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(b.type){case"flv":return new s.default(b,C);default:return new v.default(b,C)}}function d(){return l.default.supportMSEH264Playback()}function h(){return l.default.getFeatureList()}var a={};a.createPlayer=u,a.isSupported=d,a.getFeatureList=h,a.BaseLoader=o.BaseLoader,a.LoaderStatus=o.LoaderStatus,a.LoaderErrors=o.LoaderErrors,a.Events=c.default,a.ErrorTypes=_.ErrorTypes,a.ErrorDetails=_.ErrorDetails,a.FlvPlayer=s.default,a.NativePlayer=v.default,a.LoggingControl=E.default,Object.defineProperty(a,"version",{enumerable:!0,get:function(){return"1.6.2"}}),m.default=a},"./src/index.js":function(S,m,p){S.exports=p("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(S,m,p){p.r(m);var g=p("./src/utils/browser.js"),l=p("./src/io/loader.js"),o=p("./src/utils/exception.js"),s=function(){var c=function(_,E){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(f[d]=u[d])},c(_,E)};return function(_,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");c(_,E);function f(){this.constructor=_}_.prototype=E===null?Object.create(E):(f.prototype=E.prototype,new f)}}(),v=function(c){s(_,c);function _(E,f){var u=c.call(this,"fetch-stream-loader")||this;return u.TAG="FetchStreamLoader",u._seekHandler=E,u._config=f,u._needStash=!0,u._requestAbort=!1,u._contentLength=null,u._receivedLength=0,u}return _.isSupported=function(){try{var E=g.default.msedge&&g.default.version.minor>=15048,f=g.default.msedge?E:!0;return self.fetch&&self.ReadableStream&&f}catch{return!1}},_.prototype.destroy=function(){this.isWorking()&&this.abort(),c.prototype.destroy.call(this)},_.prototype.open=function(E,f){var u=this;this._dataSource=E,this._range=f;var d=E.url;this._config.reuseRedirectedURL&&E.redirectedURL!=null&&(d=E.redirectedURL);var h=this._seekHandler.getConfig(d,f),a=new self.Headers;if(typeof h.headers=="object"){var x=h.headers;for(var C in x)x.hasOwnProperty(C)&&a.append(C,x[C])}var b={method:"GET",headers:a,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var C in this._config.headers)a.append(C,this._config.headers[C]);E.cors===!1&&(b.mode="same-origin"),E.withCredentials&&(b.credentials="include"),E.referrerPolicy&&(b.referrerPolicy=E.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,b.signal=this._abortController.signal),this._status=l.LoaderStatus.kConnecting,self.fetch(h.url,b).then(function(L){if(u._requestAbort){u._status=l.LoaderStatus.kIdle,L.body.cancel();return}if(L.ok&&L.status>=200&&L.status<=299){if(L.url!==h.url&&u._onURLRedirect){var O=u._seekHandler.removeURLParameters(L.url);u._onURLRedirect(O)}var A=L.headers.get("Content-Length");return A!=null&&(u._contentLength=parseInt(A),u._contentLength!==0&&u._onContentLengthKnown&&u._onContentLengthKnown(u._contentLength)),u._pump.call(u,L.body.getReader())}else if(u._status=l.LoaderStatus.kError,u._onError)u._onError(l.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:L.status,msg:L.statusText});else throw new o.RuntimeException("FetchStreamLoader: Http code invalid, "+L.status+" "+L.statusText)}).catch(function(L){if(!(u._abortController&&u._abortController.signal.aborted))if(u._status=l.LoaderStatus.kError,u._onError)u._onError(l.LoaderErrors.EXCEPTION,{code:-1,msg:L.message});else throw L})},_.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==l.LoaderStatus.kBuffering||!g.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},_.prototype._pump=function(E){var f=this;return E.read().then(function(u){if(u.done)if(f._contentLength!==null&&f._receivedLength<f._contentLength){f._status=l.LoaderStatus.kError;var d=l.LoaderErrors.EARLY_EOF,h={code:-1,msg:"Fetch stream meet Early-EOF"};if(f._onError)f._onError(d,h);else throw new o.RuntimeException(h.msg)}else f._status=l.LoaderStatus.kComplete,f._onComplete&&f._onComplete(f._range.from,f._range.from+f._receivedLength-1);else{if(f._abortController&&f._abortController.signal.aborted){f._status=l.LoaderStatus.kComplete;return}else if(f._requestAbort===!0)return f._status=l.LoaderStatus.kComplete,E.cancel();f._status=l.LoaderStatus.kBuffering;var a=u.value.buffer,x=f._range.from+f._receivedLength;f._receivedLength+=a.byteLength,f._onDataArrival&&f._onDataArrival(a,x,f._receivedLength),f._pump(E)}}).catch(function(u){if(f._abortController&&f._abortController.signal.aborted){f._status=l.LoaderStatus.kComplete;return}if(!(u.code===11&&g.default.msedge)){f._status=l.LoaderStatus.kError;var d=0,h=null;if((u.code===19||u.message==="network error")&&(f._contentLength===null||f._contentLength!==null&&f._receivedLength<f._contentLength)?(d=l.LoaderErrors.EARLY_EOF,h={code:u.code,msg:"Fetch stream meet Early-EOF"}):(d=l.LoaderErrors.EXCEPTION,h={code:u.code,msg:u.message}),f._onError)f._onError(d,h);else throw new o.RuntimeException(h.msg)}})},_}(l.BaseLoader);m.default=v},"./src/io/io-controller.js":function(S,m,p){p.r(m);var g=p("./src/utils/logger.js"),l=p("./src/io/speed-sampler.js"),o=p("./src/io/loader.js"),s=p("./src/io/fetch-stream-loader.js"),v=p("./src/io/xhr-moz-chunked-loader.js"),c=p("./src/io/xhr-range-loader.js"),_=p("./src/io/websocket-loader.js"),E=p("./src/io/range-seek-handler.js"),f=p("./src/io/param-seek-handler.js"),u=p("./src/utils/exception.js"),d=function(){function h(a,x,C){this.TAG="IOController",this._config=x,this._extraData=C,this._stashInitialSize=1024*384,x.stashInitialSize!=null&&x.stashInitialSize>0&&(this._stashInitialSize=x.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,x.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=a,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(a.url),this._refTotalLength=a.filesize?a.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new l.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return h.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},h.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},h.prototype.isPaused=function(){return this._paused},Object.defineProperty(h.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"extraData",{get:function(){return this._extraData},set:function(a){this._extraData=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(a){this._onDataArrival=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(a){this._onSeeked=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onError",{get:function(){return this._onError},set:function(a){this._onError=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onComplete",{get:function(){return this._onComplete},set:function(a){this._onComplete=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(a){this._onRedirect=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(a){this._onRecoveredEarlyEof=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"currentSpeed",{get:function(){return this._loaderClass===c.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),h.prototype._selectSeekHandler=function(){var a=this._config;if(a.seekType==="range")this._seekHandler=new E.default(this._config.rangeLoadZeroStart);else if(a.seekType==="param"){var x=a.seekParamStart||"bstart",C=a.seekParamEnd||"bend";this._seekHandler=new f.default(x,C)}else if(a.seekType==="custom"){if(typeof a.customSeekHandler!="function")throw new u.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new a.customSeekHandler}else throw new u.InvalidArgumentException("Invalid seekType in config: "+a.seekType)},h.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=_.default;else if(s.default.isSupported())this._loaderClass=s.default;else if(v.default.isSupported())this._loaderClass=v.default;else if(c.default.isSupported())this._loaderClass=c.default;else throw new u.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},h.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},h.prototype.open=function(a){this._currentRange={from:0,to:-1},a&&(this._currentRange.from=a),this._speedSampler.reset(),a||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},h.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},h.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},h.prototype.resume=function(){if(this._paused){this._paused=!1;var a=this._resumeFrom;this._resumeFrom=0,this._internalSeek(a,!0)}},h.prototype.seek=function(a){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(a,!0)},h.prototype._internalSeek=function(a,x){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(x),this._loader.destroy(),this._loader=null;var C={from:a,to:-1};this._currentRange={from:C.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,C),this._onSeeked&&this._onSeeked()},h.prototype.updateUrl=function(a){if(!a||typeof a!="string"||a.length===0)throw new u.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=a},h.prototype._expandBuffer=function(a){for(var x=this._stashSize;x+1024*1024*1<a;)x*=2;if(x+=1024*1024*1,x!==this._bufferSize){var C=new ArrayBuffer(x);if(this._stashUsed>0){var b=new Uint8Array(this._stashBuffer,0,this._stashUsed),L=new Uint8Array(C,0,x);L.set(b,0)}this._stashBuffer=C,this._bufferSize=x}},h.prototype._normalizeSpeed=function(a){var x=this._speedNormalizeList,C=x.length-1,b=0,L=0,O=C;if(a<x[0])return x[0];for(;L<=O;){if(b=L+Math.floor((O-L)/2),b===C||a>=x[b]&&a<x[b+1])return x[b];x[b]<a?L=b+1:O=b-1}},h.prototype._adjustStashSize=function(a){var x=0;this._config.isLive||a<512?x=a:a>=512&&a<=1024?x=Math.floor(a*1.5):x=a*2,x>8192&&(x=8192);var C=x*1024+1024*1024*1;this._bufferSize<C&&this._expandBuffer(C),this._stashSize=x*1024},h.prototype._dispatchChunks=function(a,x){return this._currentRange.to=x+a.byteLength-1,this._onDataArrival(a,x)},h.prototype._onURLRedirect=function(a){this._redirectedURL=a,this._onRedirect&&this._onRedirect(a)},h.prototype._onContentLengthKnown=function(a){a&&this._fullRequestFlag&&(this._totalLength=a,this._fullRequestFlag=!1)},h.prototype._onLoaderChunkArrival=function(a,x,C){if(!this._onDataArrival)throw new u.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(a.byteLength);var b=this._speedSampler.lastSecondKBps;if(b!==0){var L=this._normalizeSpeed(b);this._speedNormalized!==L&&(this._speedNormalized=L,this._adjustStashSize(L))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=x),this._stashUsed+a.byteLength<=this._stashSize){var R=new Uint8Array(this._stashBuffer,0,this._stashSize);R.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength}else{var R=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var P=this._stashBuffer.slice(0,this._stashUsed),O=this._dispatchChunks(P,this._stashByteStart);if(O<P.byteLength){if(O>0){var T=new Uint8Array(P,O);R.set(T,0),this._stashUsed=T.byteLength,this._stashByteStart+=O}}else this._stashUsed=0,this._stashByteStart+=O;this._stashUsed+a.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+a.byteLength),R=new Uint8Array(this._stashBuffer,0,this._bufferSize)),R.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength}else{var O=this._dispatchChunks(a,x);if(O<a.byteLength){var A=a.byteLength-O;A>this._bufferSize&&(this._expandBuffer(A),R=new Uint8Array(this._stashBuffer,0,this._bufferSize)),R.set(new Uint8Array(a,O),0),this._stashUsed+=A,this._stashByteStart=x+O}}}else if(this._stashUsed===0){var O=this._dispatchChunks(a,x);if(O<a.byteLength){var A=a.byteLength-O;A>this._bufferSize&&this._expandBuffer(A);var R=new Uint8Array(this._stashBuffer,0,this._bufferSize);R.set(new Uint8Array(a,O),0),this._stashUsed+=A,this._stashByteStart=x+O}}else{this._stashUsed+a.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+a.byteLength);var R=new Uint8Array(this._stashBuffer,0,this._bufferSize);R.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength;var O=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(O<this._stashUsed&&O>0){var T=new Uint8Array(this._stashBuffer,O);R.set(T,0)}this._stashUsed-=O,this._stashByteStart+=O}}},h.prototype._flushStashBuffer=function(a){if(this._stashUsed>0){var x=this._stashBuffer.slice(0,this._stashUsed),C=this._dispatchChunks(x,this._stashByteStart),b=x.byteLength-C;if(C<x.byteLength)if(a)g.default.w(this.TAG,b+" bytes unconsumed data remain when flush buffer, dropped");else{if(C>0){var L=new Uint8Array(this._stashBuffer,0,this._bufferSize),O=new Uint8Array(x,C);L.set(O,0),this._stashUsed=O.byteLength,this._stashByteStart+=C}return 0}return this._stashUsed=0,this._stashByteStart=0,b}return 0},h.prototype._onLoaderComplete=function(a,x){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},h.prototype._onLoaderError=function(a,x){switch(g.default.e(this.TAG,"Loader error, code = "+x.code+", msg = "+x.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,a=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF),a){case o.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var C=this._currentRange.to+1;C<this._totalLength&&(g.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(C,!1));return}a=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case o.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case o.LoaderErrors.CONNECTING_TIMEOUT:case o.LoaderErrors.HTTP_STATUS_CODE_INVALID:case o.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(a,x);else throw new u.RuntimeException("IOException: "+x.msg)},h}();m.default=d},"./src/io/loader.js":function(S,m,p){p.r(m),p.d(m,{LoaderStatus:function(){return l},LoaderErrors:function(){return o},BaseLoader:function(){return s}});var g=p("./src/utils/exception.js"),l={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},o={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},s=function(){function v(c){this._type=c||"undefined",this._status=l.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return v.prototype.destroy=function(){this._status=l.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},v.prototype.isWorking=function(){return this._status===l.kConnecting||this._status===l.kBuffering},Object.defineProperty(v.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(c){this._onContentLengthKnown=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(c){this._onURLRedirect=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(c){this._onDataArrival=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onError",{get:function(){return this._onError},set:function(c){this._onError=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onComplete",{get:function(){return this._onComplete},set:function(c){this._onComplete=c},enumerable:!1,configurable:!0}),v.prototype.open=function(c,_){throw new g.NotImplementedException("Unimplemented abstract function!")},v.prototype.abort=function(){throw new g.NotImplementedException("Unimplemented abstract function!")},v}()},"./src/io/param-seek-handler.js":function(S,m,p){p.r(m);var g=function(){function l(o,s){this._startName=o,this._endName=s}return l.prototype.getConfig=function(o,s){var v=o;if(s.from!==0||s.to!==-1){var c=!0;v.indexOf("?")===-1&&(v+="?",c=!1),c&&(v+="&"),v+=this._startName+"="+s.from.toString(),s.to!==-1&&(v+="&"+this._endName+"="+s.to.toString())}return{url:v,headers:{}}},l.prototype.removeURLParameters=function(o){var s=o.split("?")[0],v=void 0,c=o.indexOf("?");c!==-1&&(v=o.substring(c+1));var _="";if(v!=null&&v.length>0)for(var E=v.split("&"),f=0;f<E.length;f++){var u=E[f].split("="),d=f>0;u[0]!==this._startName&&u[0]!==this._endName&&(d&&(_+="&"),_+=E[f])}return _.length===0?s:s+"?"+_},l}();m.default=g},"./src/io/range-seek-handler.js":function(S,m,p){p.r(m);var g=function(){function l(o){this._zeroStart=o||!1}return l.prototype.getConfig=function(o,s){var v={};if(s.from!==0||s.to!==-1){var c=void 0;s.to!==-1?c="bytes="+s.from.toString()+"-"+s.to.toString():c="bytes="+s.from.toString()+"-",v.Range=c}else this._zeroStart&&(v.Range="bytes=0-");return{url:o,headers:v}},l.prototype.removeURLParameters=function(o){return o},l}();m.default=g},"./src/io/speed-sampler.js":function(S,m,p){p.r(m);var g=function(){function l(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return l.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},l.prototype.addBytes=function(o){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=o,this._totalBytes+=o):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=o,this._totalBytes+=o):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=o,this._totalBytes+=o,this._lastCheckpoint=this._now())},Object.defineProperty(l.prototype,"currentKBps",{get:function(){this.addBytes(0);var o=(this._now()-this._lastCheckpoint)/1e3;return o==0&&(o=1),this._intervalBytes/o/1024},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"averageKBps",{get:function(){var o=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/o/1024},enumerable:!1,configurable:!0}),l}();m.default=g},"./src/io/websocket-loader.js":function(S,m,p){p.r(m);var g=p("./src/io/loader.js"),l=p("./src/utils/exception.js"),o=function(){var v=function(c,_){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,f){E.__proto__=f}||function(E,f){for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&(E[u]=f[u])},v(c,_)};return function(c,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");v(c,_);function E(){this.constructor=c}c.prototype=_===null?Object.create(_):(E.prototype=_.prototype,new E)}}(),s=function(v){o(c,v);function c(){var _=v.call(this,"websocket-loader")||this;return _.TAG="WebSocketLoader",_._needStash=!0,_._ws=null,_._requestAbort=!1,_._receivedLength=0,_}return c.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},c.prototype.destroy=function(){this._ws&&this.abort(),v.prototype.destroy.call(this)},c.prototype.open=function(_){try{var E=this._ws=new self.WebSocket(_.url);E.binaryType="arraybuffer",E.onopen=this._onWebSocketOpen.bind(this),E.onclose=this._onWebSocketClose.bind(this),E.onmessage=this._onWebSocketMessage.bind(this),E.onerror=this._onWebSocketError.bind(this),this._status=g.LoaderStatus.kConnecting}catch(u){this._status=g.LoaderStatus.kError;var f={code:u.code,msg:u.message};if(this._onError)this._onError(g.LoaderErrors.EXCEPTION,f);else throw new l.RuntimeException(f.msg)}},c.prototype.abort=function(){var _=this._ws;_&&(_.readyState===0||_.readyState===1)&&(this._requestAbort=!0,_.close()),this._ws=null,this._status=g.LoaderStatus.kComplete},c.prototype._onWebSocketOpen=function(_){this._status=g.LoaderStatus.kBuffering},c.prototype._onWebSocketClose=function(_){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=g.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},c.prototype._onWebSocketMessage=function(_){var E=this;if(_.data instanceof ArrayBuffer)this._dispatchArrayBuffer(_.data);else if(_.data instanceof Blob){var f=new FileReader;f.onload=function(){E._dispatchArrayBuffer(f.result)},f.readAsArrayBuffer(_.data)}else{this._status=g.LoaderStatus.kError;var u={code:-1,msg:"Unsupported WebSocket message type: "+_.data.constructor.name};if(this._onError)this._onError(g.LoaderErrors.EXCEPTION,u);else throw new l.RuntimeException(u.msg)}},c.prototype._dispatchArrayBuffer=function(_){var E=_,f=this._receivedLength;this._receivedLength+=E.byteLength,this._onDataArrival&&this._onDataArrival(E,f,this._receivedLength)},c.prototype._onWebSocketError=function(_){this._status=g.LoaderStatus.kError;var E={code:_.code,msg:_.message};if(this._onError)this._onError(g.LoaderErrors.EXCEPTION,E);else throw new l.RuntimeException(E.msg)},c}(g.BaseLoader);m.default=s},"./src/io/xhr-moz-chunked-loader.js":function(S,m,p){p.r(m);var g=p("./src/utils/logger.js"),l=p("./src/io/loader.js"),o=p("./src/utils/exception.js"),s=function(){var c=function(_,E){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(f[d]=u[d])},c(_,E)};return function(_,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");c(_,E);function f(){this.constructor=_}_.prototype=E===null?Object.create(E):(f.prototype=E.prototype,new f)}}(),v=function(c){s(_,c);function _(E,f){var u=c.call(this,"xhr-moz-chunked-loader")||this;return u.TAG="MozChunkedLoader",u._seekHandler=E,u._config=f,u._needStash=!0,u._xhr=null,u._requestAbort=!1,u._contentLength=null,u._receivedLength=0,u}return _.isSupported=function(){try{var E=new XMLHttpRequest;return E.open("GET","https://example.com",!0),E.responseType="moz-chunked-arraybuffer",E.responseType==="moz-chunked-arraybuffer"}catch(f){return g.default.w("MozChunkedLoader",f.message),!1}},_.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),c.prototype.destroy.call(this)},_.prototype.open=function(E,f){this._dataSource=E,this._range=f;var u=E.url;this._config.reuseRedirectedURL&&E.redirectedURL!=null&&(u=E.redirectedURL);var d=this._seekHandler.getConfig(u,f);this._requestURL=d.url;var h=this._xhr=new XMLHttpRequest;if(h.open("GET",d.url,!0),h.responseType="moz-chunked-arraybuffer",h.onreadystatechange=this._onReadyStateChange.bind(this),h.onprogress=this._onProgress.bind(this),h.onloadend=this._onLoadEnd.bind(this),h.onerror=this._onXhrError.bind(this),E.withCredentials&&(h.withCredentials=!0),typeof d.headers=="object"){var a=d.headers;for(var x in a)a.hasOwnProperty(x)&&h.setRequestHeader(x,a[x])}if(typeof this._config.headers=="object"){var a=this._config.headers;for(var x in a)a.hasOwnProperty(x)&&h.setRequestHeader(x,a[x])}this._status=l.LoaderStatus.kConnecting,h.send()},_.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=l.LoaderStatus.kComplete},_.prototype._onReadyStateChange=function(E){var f=E.target;if(f.readyState===2){if(f.responseURL!=null&&f.responseURL!==this._requestURL&&this._onURLRedirect){var u=this._seekHandler.removeURLParameters(f.responseURL);this._onURLRedirect(u)}if(f.status!==0&&(f.status<200||f.status>299))if(this._status=l.LoaderStatus.kError,this._onError)this._onError(l.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:f.status,msg:f.statusText});else throw new o.RuntimeException("MozChunkedLoader: Http code invalid, "+f.status+" "+f.statusText);else this._status=l.LoaderStatus.kBuffering}},_.prototype._onProgress=function(E){if(this._status!==l.LoaderStatus.kError){this._contentLength===null&&E.total!==null&&E.total!==0&&(this._contentLength=E.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var f=E.target.response,u=this._range.from+this._receivedLength;this._receivedLength+=f.byteLength,this._onDataArrival&&this._onDataArrival(f,u,this._receivedLength)}},_.prototype._onLoadEnd=function(E){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===l.LoaderStatus.kError)return;this._status=l.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},_.prototype._onXhrError=function(E){this._status=l.LoaderStatus.kError;var f=0,u=null;if(this._contentLength&&E.loaded<this._contentLength?(f=l.LoaderErrors.EARLY_EOF,u={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(f=l.LoaderErrors.EXCEPTION,u={code:-1,msg:E.constructor.name+" "+E.type}),this._onError)this._onError(f,u);else throw new o.RuntimeException(u.msg)},_}(l.BaseLoader);m.default=v},"./src/io/xhr-range-loader.js":function(S,m,p){p.r(m);var g=p("./src/utils/logger.js"),l=p("./src/io/speed-sampler.js"),o=p("./src/io/loader.js"),s=p("./src/utils/exception.js"),v=function(){var _=function(E,f){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(u[h]=d[h])},_(E,f)};return function(E,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");_(E,f);function u(){this.constructor=E}E.prototype=f===null?Object.create(f):(u.prototype=f.prototype,new u)}}(),c=function(_){v(E,_);function E(f,u){var d=_.call(this,"xhr-range-loader")||this;return d.TAG="RangeLoader",d._seekHandler=f,d._config=u,d._needStash=!1,d._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],d._currentChunkSizeKB=384,d._currentSpeedNormalized=0,d._zeroSpeedChunkCount=0,d._xhr=null,d._speedSampler=new l.default,d._requestAbort=!1,d._waitForTotalLength=!1,d._totalLengthReceived=!1,d._currentRequestURL=null,d._currentRedirectedURL=null,d._currentRequestRange=null,d._totalLength=null,d._contentLength=null,d._receivedLength=0,d._lastTimeLoaded=0,d}return E.isSupported=function(){try{var f=new XMLHttpRequest;return f.open("GET","https://example.com",!0),f.responseType="arraybuffer",f.responseType==="arraybuffer"}catch(u){return g.default.w("RangeLoader",u.message),!1}},E.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),_.prototype.destroy.call(this)},Object.defineProperty(E.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),E.prototype.open=function(f,u){this._dataSource=f,this._range=u,this._status=o.LoaderStatus.kConnecting;var d=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(d=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!d?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},E.prototype._openSubRange=function(){var f=this._currentChunkSizeKB*1024,u=this._range.from+this._receivedLength,d=u+f;this._contentLength!=null&&d-this._range.from>=this._contentLength&&(d=this._range.from+this._contentLength-1),this._currentRequestRange={from:u,to:d},this._internalOpen(this._dataSource,this._currentRequestRange)},E.prototype._internalOpen=function(f,u){this._lastTimeLoaded=0;var d=f.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?d=this._currentRedirectedURL:f.redirectedURL!=null&&(d=f.redirectedURL));var h=this._seekHandler.getConfig(d,u);this._currentRequestURL=h.url;var a=this._xhr=new XMLHttpRequest;if(a.open("GET",h.url,!0),a.responseType="arraybuffer",a.onreadystatechange=this._onReadyStateChange.bind(this),a.onprogress=this._onProgress.bind(this),a.onload=this._onLoad.bind(this),a.onerror=this._onXhrError.bind(this),f.withCredentials&&(a.withCredentials=!0),typeof h.headers=="object"){var x=h.headers;for(var C in x)x.hasOwnProperty(C)&&a.setRequestHeader(C,x[C])}if(typeof this._config.headers=="object"){var x=this._config.headers;for(var C in x)x.hasOwnProperty(C)&&a.setRequestHeader(C,x[C])}a.send()},E.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=o.LoaderStatus.kComplete},E.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},E.prototype._onReadyStateChange=function(f){var u=f.target;if(u.readyState===2){if(u.responseURL!=null){var d=this._seekHandler.removeURLParameters(u.responseURL);u.responseURL!==this._currentRequestURL&&d!==this._currentRedirectedURL&&(this._currentRedirectedURL=d,this._onURLRedirect&&this._onURLRedirect(d))}if(u.status>=200&&u.status<=299){if(this._waitForTotalLength)return;this._status=o.LoaderStatus.kBuffering}else if(this._status=o.LoaderStatus.kError,this._onError)this._onError(o.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:u.status,msg:u.statusText});else throw new s.RuntimeException("RangeLoader: Http code invalid, "+u.status+" "+u.statusText)}},E.prototype._onProgress=function(f){if(this._status!==o.LoaderStatus.kError){if(this._contentLength===null){var u=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,u=!0;var d=f.total;this._internalAbort(),d!=null&d!==0&&(this._totalLength=d)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,u){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var h=f.loaded-this._lastTimeLoaded;this._lastTimeLoaded=f.loaded,this._speedSampler.addBytes(h)}},E.prototype._normalizeSpeed=function(f){var u=this._chunkSizeKBList,d=u.length-1,h=0,a=0,x=d;if(f<u[0])return u[0];for(;a<=x;){if(h=a+Math.floor((x-a)/2),h===d||f>=u[h]&&f<u[h+1])return u[h];u[h]<f?a=h+1:x=h-1}},E.prototype._onLoad=function(f){if(this._status!==o.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var u=this._speedSampler.lastSecondKBps;if(u===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(u=this._speedSampler.currentKBps)),u!==0){var d=this._normalizeSpeed(u);this._currentSpeedNormalized!==d&&(this._currentSpeedNormalized=d,this._currentChunkSizeKB=d)}var h=f.target.response,a=this._range.from+this._receivedLength;this._receivedLength+=h.byteLength;var x=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():x=!0,this._onDataArrival&&this._onDataArrival(h,a,this._receivedLength),x&&(this._status=o.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},E.prototype._onXhrError=function(f){this._status=o.LoaderStatus.kError;var u=0,d=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(u=o.LoaderErrors.EARLY_EOF,d={code:-1,msg:"RangeLoader meet Early-Eof"}):(u=o.LoaderErrors.EXCEPTION,d={code:-1,msg:f.constructor.name+" "+f.type}),this._onError)this._onError(u,d);else throw new s.RuntimeException(d.msg)},E}(o.BaseLoader);m.default=c},"./src/player/flv-player.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),l=p.n(g),o=p("./src/utils/logger.js"),s=p("./src/utils/browser.js"),v=p("./src/player/player-events.js"),c=p("./src/core/transmuxer.js"),_=p("./src/core/transmuxing-events.js"),E=p("./src/core/mse-controller.js"),f=p("./src/core/mse-events.js"),u=p("./src/player/player-errors.js"),d=p("./src/config.js"),h=p("./src/utils/exception.js"),a=function(){function x(C,b){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(l()),this._config=(0,d.createDefaultConfig)(),typeof b=="object"&&Object.assign(this._config,b),C.type.toLowerCase()!=="flv")throw new h.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");C.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=C,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var L=s.default.chrome&&(s.default.version.major<50||s.default.version.major===50&&s.default.version.build<2661);this._alwaysSeekKeyframe=!!(L||s.default.msedge||s.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return x.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},x.prototype.on=function(C,b){var L=this;C===v.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){L._emitter.emit(v.default.MEDIA_INFO,L.mediaInfo)}):C===v.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){L._emitter.emit(v.default.STATISTICS_INFO,L.statisticsInfo)}),this._emitter.addListener(C,b)},x.prototype.off=function(C,b){this._emitter.removeListener(C,b)},x.prototype.attachMediaElement=function(C){var b=this;if(this._mediaElement=C,C.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),C.addEventListener("seeking",this.e.onvSeeking),C.addEventListener("canplay",this.e.onvCanPlay),C.addEventListener("stalled",this.e.onvStalled),C.addEventListener("progress",this.e.onvProgress),this._msectl=new E.default(this._config),this._msectl.on(f.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(f.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(f.default.SOURCE_OPEN,function(){b._mseSourceOpened=!0,b._hasPendingLoad&&(b._hasPendingLoad=!1,b.load())}),this._msectl.on(f.default.ERROR,function(L){b._emitter.emit(v.default.ERROR,u.ErrorTypes.MEDIA_ERROR,u.ErrorDetails.MEDIA_MSE_ERROR,L)}),this._msectl.attachMediaElement(C),this._pendingSeekTime!=null)try{C.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},x.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},x.prototype.load=function(){var C=this;if(!this._mediaElement)throw new h.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new h.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new c.default(this._mediaDataSource,this._config),this._transmuxer.on(_.default.INIT_SEGMENT,function(b,L){C._msectl.appendInitSegment(L)}),this._transmuxer.on(_.default.MEDIA_SEGMENT,function(b,L){if(C._msectl.appendMediaSegment(L),C._config.lazyLoad&&!C._config.isLive){var O=C._mediaElement.currentTime;L.info.endDts>=(O+C._config.lazyLoadMaxDuration)*1e3&&C._progressChecker==null&&(o.default.v(C.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),C._suspendTransmuxer())}}),this._transmuxer.on(_.default.LOADING_COMPLETE,function(){C._msectl.endOfStream(),C._emitter.emit(v.default.LOADING_COMPLETE)}),this._transmuxer.on(_.default.RECOVERED_EARLY_EOF,function(){C._emitter.emit(v.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(_.default.IO_ERROR,function(b,L){C._emitter.emit(v.default.ERROR,u.ErrorTypes.NETWORK_ERROR,b,L)}),this._transmuxer.on(_.default.DEMUX_ERROR,function(b,L){C._emitter.emit(v.default.ERROR,u.ErrorTypes.MEDIA_ERROR,b,{code:-1,msg:L})}),this._transmuxer.on(_.default.MEDIA_INFO,function(b){C._mediaInfo=b,C._emitter.emit(v.default.MEDIA_INFO,Object.assign({},b))}),this._transmuxer.on(_.default.METADATA_ARRIVED,function(b){C._emitter.emit(v.default.METADATA_ARRIVED,b)}),this._transmuxer.on(_.default.SCRIPTDATA_ARRIVED,function(b){C._emitter.emit(v.default.SCRIPTDATA_ARRIVED,b)}),this._transmuxer.on(_.default.STATISTICS_INFO,function(b){C._statisticsInfo=C._fillStatisticsInfo(b),C._emitter.emit(v.default.STATISTICS_INFO,Object.assign({},C._statisticsInfo))}),this._transmuxer.on(_.default.RECOMMEND_SEEKPOINT,function(b){C._mediaElement&&!C._config.accurateSeek&&(C._requestSetTime=!0,C._mediaElement.currentTime=b/1e3)}),this._transmuxer.open()}},x.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},x.prototype.play=function(){return this._mediaElement.play()},x.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(x.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(C){this._mediaElement.volume=C},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(C){this._mediaElement.muted=C},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(C){this._mediaElement?this._internalSeek(C):this._pendingSeekTime=C},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),x.prototype._fillStatisticsInfo=function(C){if(C.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return C;var b=!0,L=0,O=0;if(this._mediaElement.getVideoPlaybackQuality){var A=this._mediaElement.getVideoPlaybackQuality();L=A.totalVideoFrames,O=A.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(L=this._mediaElement.webkitDecodedFrameCount,O=this._mediaElement.webkitDroppedFrameCount):b=!1;return b&&(C.decodedFrames=L,C.droppedFrames=O),C},x.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var C=this._mediaElement.buffered,b=this._mediaElement.currentTime,L=0,O=0;O<C.length;O++){var A=C.start(O),R=C.end(O);if(A<=b&&b<R){L=R;break}}L>=b+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(o.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},x.prototype._onmseBufferFull=function(){o.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},x.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},x.prototype._checkProgressAndResume=function(){for(var C=this._mediaElement.currentTime,b=this._mediaElement.buffered,L=!1,O=0;O<b.length;O++){var A=b.start(O),R=b.end(O);if(C>=A&&C<R){C>=R-this._config.lazyLoadRecoverDuration&&(L=!0);break}}L&&(window.clearInterval(this._progressChecker),this._progressChecker=null,L&&(o.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},x.prototype._isTimepointBuffered=function(C){for(var b=this._mediaElement.buffered,L=0;L<b.length;L++){var O=b.start(L),A=b.end(L);if(C>=O&&C<A)return!0}return!1},x.prototype._internalSeek=function(C){var b=this._isTimepointBuffered(C),L=!1,O=0;if(C<1&&this._mediaElement.buffered.length>0){var A=this._mediaElement.buffered.start(0);(A<1&&C<A||s.default.safari)&&(L=!0,O=s.default.safari?.1:A)}if(L)this._requestSetTime=!0,this._mediaElement.currentTime=O;else if(b){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=C;else{var R=this._msectl.getNearestKeyframe(Math.floor(C*1e3));this._requestSetTime=!0,R!=null?this._mediaElement.currentTime=R.dts/1e3:this._mediaElement.currentTime=C}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(C),this._transmuxer.seek(Math.floor(C*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=C)},x.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var C=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(C)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(C),this._transmuxer.seek(Math.floor(C*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=C))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},x.prototype._checkAndResumeStuckPlayback=function(C){var b=this._mediaElement;if(C||!this._receivedCanPlay||b.readyState<2){var L=b.buffered;L.length>0&&b.currentTime<L.start(0)&&(o.default.w(this.TAG,"Playback seems stuck at "+b.currentTime+", seek to "+L.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=L.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},x.prototype._onvLoadedMetadata=function(C){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},x.prototype._onvSeeking=function(C){var b=this._mediaElement.currentTime,L=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(b<1&&L.length>0){var O=L.start(0);if(O<1&&b<O||s.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=s.default.safari?.1:O;return}}if(this._isTimepointBuffered(b)){if(this._alwaysSeekKeyframe){var A=this._msectl.getNearestKeyframe(Math.floor(b*1e3));A!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=A.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:b,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},x.prototype._onvCanPlay=function(C){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},x.prototype._onvStalled=function(C){this._checkAndResumeStuckPlayback(!0)},x.prototype._onvProgress=function(C){this._checkAndResumeStuckPlayback()},x}();m.default=a},"./src/player/native-player.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),l=p.n(g),o=p("./src/player/player-events.js"),s=p("./src/config.js"),v=p("./src/utils/exception.js"),c=function(){function _(E,f){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(l()),this._config=(0,s.createDefaultConfig)(),typeof f=="object"&&Object.assign(this._config,f),E.type.toLowerCase()==="flv")throw new v.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(E.hasOwnProperty("segments"))throw new v.InvalidArgumentException("NativePlayer("+E.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=E,this._mediaElement=null}return _.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},_.prototype.on=function(E,f){var u=this;E===o.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){u._emitter.emit(o.default.MEDIA_INFO,u.mediaInfo)}):E===o.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){u._emitter.emit(o.default.STATISTICS_INFO,u.statisticsInfo)}),this._emitter.addListener(E,f)},_.prototype.off=function(E,f){this._emitter.removeListener(E,f)},_.prototype.attachMediaElement=function(E){if(this._mediaElement=E,E.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{E.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},_.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},_.prototype.load=function(){if(!this._mediaElement)throw new v.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},_.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},_.prototype.play=function(){return this._mediaElement.play()},_.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(_.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(E){this._mediaElement.volume=E},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(E){this._mediaElement.muted=E},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(E){this._mediaElement?this._mediaElement.currentTime=E:this._pendingSeekTime=E},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"mediaInfo",{get:function(){var E=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",f={mimeType:E+this._mediaDataSource.type};return this._mediaElement&&(f.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(f.width=this._mediaElement.videoWidth,f.height=this._mediaElement.videoHeight)),f},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"statisticsInfo",{get:function(){var E={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return E;var f=!0,u=0,d=0;if(this._mediaElement.getVideoPlaybackQuality){var h=this._mediaElement.getVideoPlaybackQuality();u=h.totalVideoFrames,d=h.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(u=this._mediaElement.webkitDecodedFrameCount,d=this._mediaElement.webkitDroppedFrameCount):f=!1;return f&&(E.decodedFrames=u,E.droppedFrames=d),E},enumerable:!1,configurable:!0}),_.prototype._onvLoadedMetadata=function(E){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(o.default.MEDIA_INFO,this.mediaInfo)},_.prototype._reportStatisticsInfo=function(){this._emitter.emit(o.default.STATISTICS_INFO,this.statisticsInfo)},_}();m.default=c},"./src/player/player-errors.js":function(S,m,p){p.r(m),p.d(m,{ErrorTypes:function(){return o},ErrorDetails:function(){return s}});var g=p("./src/io/loader.js"),l=p("./src/demux/demux-errors.js"),o={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},s={NETWORK_EXCEPTION:g.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:g.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:g.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:g.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:l.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:l.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:l.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(S,m,p){p.r(m);var g={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};m.default=g},"./src/remux/aac-silent.js":function(S,m,p){p.r(m);var g=function(){function l(){}return l.getSilentFrame=function(o,s){if(o==="mp4a.40.2"){if(s===1)return new Uint8Array([0,200,0,128,35,128]);if(s===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(s===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(s===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(s===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(s===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(s===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},l}();m.default=g},"./src/remux/mp4-generator.js":function(S,m,p){p.r(m);var g=function(){function l(){}return l.init=function(){l.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var o in l.types)l.types.hasOwnProperty(o)&&(l.types[o]=[o.charCodeAt(0),o.charCodeAt(1),o.charCodeAt(2),o.charCodeAt(3)]);var s=l.constants={};s.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),s.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),s.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),s.STSC=s.STCO=s.STTS,s.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),s.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),s.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),s.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},l.box=function(o){for(var s=8,v=null,c=Array.prototype.slice.call(arguments,1),_=c.length,E=0;E<_;E++)s+=c[E].byteLength;v=new Uint8Array(s),v[0]=s>>>24&255,v[1]=s>>>16&255,v[2]=s>>>8&255,v[3]=s&255,v.set(o,4);for(var f=8,E=0;E<_;E++)v.set(c[E],f),f+=c[E].byteLength;return v},l.generateInitSegment=function(o){var s=l.box(l.types.ftyp,l.constants.FTYP),v=l.moov(o),c=new Uint8Array(s.byteLength+v.byteLength);return c.set(s,0),c.set(v,s.byteLength),c},l.moov=function(o){var s=l.mvhd(o.timescale,o.duration),v=l.trak(o),c=l.mvex(o);return l.box(l.types.moov,s,v,c)},l.mvhd=function(o,s){return l.box(l.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},l.trak=function(o){return l.box(l.types.trak,l.tkhd(o),l.mdia(o))},l.tkhd=function(o){var s=o.id,v=o.duration,c=o.presentWidth,_=o.presentHeight;return l.box(l.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,v&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,c>>>8&255,c&255,0,0,_>>>8&255,_&255,0,0]))},l.mdia=function(o){return l.box(l.types.mdia,l.mdhd(o),l.hdlr(o),l.minf(o))},l.mdhd=function(o){var s=o.timescale,v=o.duration;return l.box(l.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,v>>>24&255,v>>>16&255,v>>>8&255,v&255,85,196,0,0]))},l.hdlr=function(o){var s=null;return o.type==="audio"?s=l.constants.HDLR_AUDIO:s=l.constants.HDLR_VIDEO,l.box(l.types.hdlr,s)},l.minf=function(o){var s=null;return o.type==="audio"?s=l.box(l.types.smhd,l.constants.SMHD):s=l.box(l.types.vmhd,l.constants.VMHD),l.box(l.types.minf,s,l.dinf(),l.stbl(o))},l.dinf=function(){var o=l.box(l.types.dinf,l.box(l.types.dref,l.constants.DREF));return o},l.stbl=function(o){var s=l.box(l.types.stbl,l.stsd(o),l.box(l.types.stts,l.constants.STTS),l.box(l.types.stsc,l.constants.STSC),l.box(l.types.stsz,l.constants.STSZ),l.box(l.types.stco,l.constants.STCO));return s},l.stsd=function(o){return o.type==="audio"?o.codec==="mp3"?l.box(l.types.stsd,l.constants.STSD_PREFIX,l.mp3(o)):l.box(l.types.stsd,l.constants.STSD_PREFIX,l.mp4a(o)):l.box(l.types.stsd,l.constants.STSD_PREFIX,l.avc1(o))},l.mp3=function(o){var s=o.channelCount,v=o.audioSampleRate,c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,v>>>8&255,v&255,0,0]);return l.box(l.types[".mp3"],c)},l.mp4a=function(o){var s=o.channelCount,v=o.audioSampleRate,c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,v>>>8&255,v&255,0,0]);return l.box(l.types.mp4a,c,l.esds(o))},l.esds=function(o){var s=o.config||[],v=s.length,c=new Uint8Array([0,0,0,0,3,23+v,0,1,0,4,15+v,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([v]).concat(s).concat([6,1,2]));return l.box(l.types.esds,c)},l.avc1=function(o){var s=o.avcc,v=o.codecWidth,c=o.codecHeight,_=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,v>>>8&255,v&255,c>>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return l.box(l.types.avc1,_,l.box(l.types.avcC,s))},l.mvex=function(o){return l.box(l.types.mvex,l.trex(o))},l.trex=function(o){var s=o.id,v=new Uint8Array([0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return l.box(l.types.trex,v)},l.moof=function(o,s){return l.box(l.types.moof,l.mfhd(o.sequenceNumber),l.traf(o,s))},l.mfhd=function(o){var s=new Uint8Array([0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255]);return l.box(l.types.mfhd,s)},l.traf=function(o,s){var v=o.id,c=l.box(l.types.tfhd,new Uint8Array([0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,v&255])),_=l.box(l.types.tfdt,new Uint8Array([0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255])),E=l.sdtp(o),f=l.trun(o,E.byteLength+16+16+8+16+8+8);return l.box(l.types.traf,c,_,f,E)},l.sdtp=function(o){for(var s=o.samples||[],v=s.length,c=new Uint8Array(4+v),_=0;_<v;_++){var E=s[_].flags;c[_+4]=E.isLeading<<6|E.dependsOn<<4|E.isDependedOn<<2|E.hasRedundancy}return l.box(l.types.sdtp,c)},l.trun=function(o,s){var v=o.samples||[],c=v.length,_=12+16*c,E=new Uint8Array(_);s+=8+_,E.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,c&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255],0);for(var f=0;f<c;f++){var u=v[f].duration,d=v[f].size,h=v[f].flags,a=v[f].cts;E.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.isNonSync,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255],12+16*f)}return l.box(l.types.trun,E)},l.mdat=function(o){return l.box(l.types.mdat,o)},l}();g.init(),m.default=g},"./src/remux/mp4-remuxer.js":function(S,m,p){p.r(m);var g=p("./src/utils/logger.js"),l=p("./src/remux/mp4-generator.js"),o=p("./src/remux/aac-silent.js"),s=p("./src/utils/browser.js"),v=p("./src/core/media-segment-info.js"),c=p("./src/utils/exception.js"),_=function(){function E(f){this.TAG="MP4Remuxer",this._config=f,this._isLive=f.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new v.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new v.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(s.default.chrome&&(s.default.version.major<50||s.default.version.major===50&&s.default.version.build<2661)),this._fillSilentAfterSeek=s.default.msedge||s.default.msie,this._mp3UseMpegAudio=!s.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return E.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},E.prototype.bindDataSource=function(f){return f.onDataAvailable=this.remux.bind(this),f.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(E.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(f){this._onInitSegment=f},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(f){this._onMediaSegment=f},enumerable:!1,configurable:!0}),E.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},E.prototype.seek=function(f){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},E.prototype.remux=function(f,u){if(!this._onMediaSegment)throw new c.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(f,u),this._remuxVideo(u),this._remuxAudio(f)},E.prototype._onTrackMetadataReceived=function(f,u){var d=null,h="mp4",a=u.codec;if(f==="audio")this._audioMeta=u,u.codec==="mp3"&&this._mp3UseMpegAudio?(h="mpeg",a="",d=new Uint8Array):d=l.default.generateInitSegment(u);else if(f==="video")this._videoMeta=u,d=l.default.generateInitSegment(u);else return;if(!this._onInitSegment)throw new c.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(f,{type:f,data:d.buffer,codec:a,container:f+"/"+h,mediaDuration:u.duration})},E.prototype._calculateDtsBase=function(f,u){this._dtsBaseInited||(f.samples&&f.samples.length&&(this._audioDtsBase=f.samples[0].dts),u.samples&&u.samples.length&&(this._videoDtsBase=u.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},E.prototype.flushStashedSamples=function(){var f=this._videoStashedLastSample,u=this._audioStashedLastSample,d={type:"video",id:1,sequenceNumber:0,samples:[],length:0};f!=null&&(d.samples.push(f),d.length=f.length);var h={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};u!=null&&(h.samples.push(u),h.length=u.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(d,!0),this._remuxAudio(h,!0)},E.prototype._remuxAudio=function(f,u){if(this._audioMeta!=null){var d=f,h=d.samples,a=void 0,x=-1,C=-1,b=this._audioMeta.refSampleDuration,L=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,O=this._dtsBaseInited&&this._audioNextDts===void 0,A=!1;if(!(!h||h.length===0)&&!(h.length===1&&!u)){var R=0,T=null,P=0;L?(R=0,P=d.length):(R=8,P=8+d.length);var M=null;if(h.length>1&&(M=h.pop(),P-=M.length),this._audioStashedLastSample!=null){var D=this._audioStashedLastSample;this._audioStashedLastSample=null,h.unshift(D),P+=D.length}M!=null&&(this._audioStashedLastSample=M);var I=h[0].dts-this._dtsBase;if(this._audioNextDts)a=I-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())a=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(A=!0);else{var Y=this._audioSegmentInfoList.getLastSampleBefore(I);if(Y!=null){var Q=I-(Y.originalDts+Y.duration);Q<=3&&(Q=0);var X=Y.dts+Y.duration+Q;a=I-X}else a=0}if(A){var ne=I-a,ue=this._videoSegmentInfoList.getLastSegmentBefore(I);if(ue!=null&&ue.beginDts<ne){var H=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(H){var ie=ue.beginDts,Re=ne-ue.beginDts;g.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+ie+", duration: "+Re),h.unshift({unit:H,dts:ie,pts:ie}),P+=H.byteLength}}else A=!1}for(var ce=[],fe=0;fe<h.length;fe++){var D=h[fe],Ce=D.unit,ye=D.dts-this._dtsBase,ie=ye,xe=!1,Te=null,de=0;if(!(ye<-.001)){if(this._audioMeta.codec!=="mp3"){var z=ye,Se=3;if(this._audioNextDts&&(z=this._audioNextDts),a=ye-z,a<=-Se*b){g.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+ye+" ms ,curRefDts: "+z+" ms)  due to dtsCorrection: "+a+" ms overlap.");continue}else if(a>=Se*b&&this._fillAudioTimestampGap&&!s.default.safari){xe=!0;var Le=Math.floor(a/b);g.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+ye+" ms, curRefDts: "+z+" ms, ")+("dtsCorrection: "+Math.round(a)+" ms, generate: "+Le+" frames")),ie=Math.floor(z),de=Math.floor(z+b)-ie;var H=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);H==null&&(g.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),H=Ce),Te=[];for(var Ne=0;Ne<Le;Ne++){z=z+b;var ke=Math.floor(z),De=Math.floor(z+b)-ke,Ve={dts:ke,pts:ke,cts:0,unit:H,size:H.byteLength,duration:De,originalDts:ye,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};Te.push(Ve),P+=Ve.size}this._audioNextDts=z+b}else ie=Math.floor(z),de=Math.floor(z+b)-ie,this._audioNextDts=z+b}else{if(ie=ye-a,fe!==h.length-1){var Ke=h[fe+1].dts-this._dtsBase-a;de=Ke-ie}else if(M!=null){var Ke=M.dts-this._dtsBase-a;de=Ke-ie}else ce.length>=1?de=ce[ce.length-1].duration:de=Math.floor(b);this._audioNextDts=ie+de}x===-1&&(x=ie),ce.push({dts:ie,pts:ie,cts:0,unit:D.unit,size:D.unit.byteLength,duration:de,originalDts:ye,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),xe&&ce.push.apply(ce,Te)}}if(ce.length===0){d.samples=[],d.length=0;return}L?T=new Uint8Array(P):(T=new Uint8Array(P),T[0]=P>>>24&255,T[1]=P>>>16&255,T[2]=P>>>8&255,T[3]=P&255,T.set(l.default.types.mdat,4));for(var fe=0;fe<ce.length;fe++){var Ce=ce[fe].unit;T.set(Ce,R),R+=Ce.byteLength}var j=ce[ce.length-1];C=j.dts+j.duration;var B=new v.MediaSegmentInfo;B.beginDts=x,B.endDts=C,B.beginPts=x,B.endPts=C,B.originalBeginDts=ce[0].originalDts,B.originalEndDts=j.originalDts+j.duration,B.firstSample=new v.SampleInfo(ce[0].dts,ce[0].pts,ce[0].duration,ce[0].originalDts,!1),B.lastSample=new v.SampleInfo(j.dts,j.pts,j.duration,j.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(B),d.samples=ce,d.sequenceNumber++;var U=null;L?U=new Uint8Array:U=l.default.moof(d,x),d.samples=[],d.length=0;var K={type:"audio",data:this._mergeBoxes(U,T).buffer,sampleCount:ce.length,info:B};L&&O&&(K.timestampOffset=x),this._onMediaSegment("audio",K)}}},E.prototype._remuxVideo=function(f,u){if(this._videoMeta!=null){var d=f,h=d.samples,a=void 0,x=-1,C=-1,b=-1,L=-1;if(!(!h||h.length===0)&&!(h.length===1&&!u)){var O=8,A=null,R=8+f.length,T=null;if(h.length>1&&(T=h.pop(),R-=T.length),this._videoStashedLastSample!=null){var P=this._videoStashedLastSample;this._videoStashedLastSample=null,h.unshift(P),R+=P.length}T!=null&&(this._videoStashedLastSample=T);var M=h[0].dts-this._dtsBase;if(this._videoNextDts)a=M-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())a=0;else{var D=this._videoSegmentInfoList.getLastSampleBefore(M);if(D!=null){var I=M-(D.originalDts+D.duration);I<=3&&(I=0);var Y=D.dts+D.duration+I;a=M-Y}else a=0}for(var Q=new v.MediaSegmentInfo,X=[],ne=0;ne<h.length;ne++){var P=h[ne],ue=P.dts-this._dtsBase,H=P.isKeyframe,ie=ue-a,Re=P.cts,ce=ie+Re;x===-1&&(x=ie,b=ce);var fe=0;if(ne!==h.length-1){var Ce=h[ne+1].dts-this._dtsBase-a;fe=Ce-ie}else if(T!=null){var Ce=T.dts-this._dtsBase-a;fe=Ce-ie}else X.length>=1?fe=X[X.length-1].duration:fe=Math.floor(this._videoMeta.refSampleDuration);if(H){var ye=new v.SampleInfo(ie,ce,fe,P.dts,!0);ye.fileposition=P.fileposition,Q.appendSyncPoint(ye)}X.push({dts:ie,pts:ce,cts:Re,units:P.units,size:P.length,isKeyframe:H,duration:fe,originalDts:ue,flags:{isLeading:0,dependsOn:H?2:1,isDependedOn:H?1:0,hasRedundancy:0,isNonSync:H?0:1}})}A=new Uint8Array(R),A[0]=R>>>24&255,A[1]=R>>>16&255,A[2]=R>>>8&255,A[3]=R&255,A.set(l.default.types.mdat,4);for(var ne=0;ne<X.length;ne++)for(var xe=X[ne].units;xe.length;){var Te=xe.shift(),de=Te.data;A.set(de,O),O+=de.byteLength}var z=X[X.length-1];if(C=z.dts+z.duration,L=z.pts+z.duration,this._videoNextDts=C,Q.beginDts=x,Q.endDts=C,Q.beginPts=b,Q.endPts=L,Q.originalBeginDts=X[0].originalDts,Q.originalEndDts=z.originalDts+z.duration,Q.firstSample=new v.SampleInfo(X[0].dts,X[0].pts,X[0].duration,X[0].originalDts,X[0].isKeyframe),Q.lastSample=new v.SampleInfo(z.dts,z.pts,z.duration,z.originalDts,z.isKeyframe),this._isLive||this._videoSegmentInfoList.append(Q),d.samples=X,d.sequenceNumber++,this._forceFirstIDR){var Se=X[0].flags;Se.dependsOn=2,Se.isNonSync=0}var Le=l.default.moof(d,x);d.samples=[],d.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(Le,A).buffer,sampleCount:X.length,info:Q})}}},E.prototype._mergeBoxes=function(f,u){var d=new Uint8Array(f.byteLength+u.byteLength);return d.set(f,0),d.set(u,f.byteLength),d},E}();m.default=_},"./src/utils/browser.js":function(S,m,p){p.r(m);var g={};function l(){var o=self.navigator.userAgent.toLowerCase(),s=/(edge)\/([\w.]+)/.exec(o)||/(opr)[\/]([\w.]+)/.exec(o)||/(chrome)[ \/]([\w.]+)/.exec(o)||/(iemobile)[\/]([\w.]+)/.exec(o)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+)/.exec(o)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(o)||/(msie) ([\w.]+)/.exec(o)||o.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(o)||o.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(o)||[],v=/(ipad)/.exec(o)||/(ipod)/.exec(o)||/(windows phone)/.exec(o)||/(iphone)/.exec(o)||/(kindle)/.exec(o)||/(android)/.exec(o)||/(windows)/.exec(o)||/(mac)/.exec(o)||/(linux)/.exec(o)||/(cros)/.exec(o)||[],c={browser:s[5]||s[3]||s[1]||"",version:s[2]||s[4]||"0",majorVersion:s[4]||s[2]||"0",platform:v[0]||""},_={};if(c.browser){_[c.browser]=!0;var E=c.majorVersion.split(".");_.version={major:parseInt(c.majorVersion,10),string:c.version},E.length>1&&(_.version.minor=parseInt(E[1],10)),E.length>2&&(_.version.build=parseInt(E[2],10))}if(c.platform&&(_[c.platform]=!0),(_.chrome||_.opr||_.safari)&&(_.webkit=!0),_.rv||_.iemobile){_.rv&&delete _.rv;var f="msie";c.browser=f,_[f]=!0}if(_.edge){delete _.edge;var u="msedge";c.browser=u,_[u]=!0}if(_.opr){var d="opera";c.browser=d,_[d]=!0}if(_.safari&&_.android){var h="android";c.browser=h,_[h]=!0}_.name=c.browser,_.platform=c.platform;for(var a in g)g.hasOwnProperty(a)&&delete g[a];Object.assign(g,_)}l(),m.default=g},"./src/utils/exception.js":function(S,m,p){p.r(m),p.d(m,{RuntimeException:function(){return l},IllegalStateException:function(){return o},InvalidArgumentException:function(){return s},NotImplementedException:function(){return v}});var g=function(){var c=function(_,E){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(f[d]=u[d])},c(_,E)};return function(_,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");c(_,E);function f(){this.constructor=_}_.prototype=E===null?Object.create(E):(f.prototype=E.prototype,new f)}}(),l=function(){function c(_){this._message=_}return Object.defineProperty(c.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),c.prototype.toString=function(){return this.name+": "+this.message},c}(),o=function(c){g(_,c);function _(E){return c.call(this,E)||this}return Object.defineProperty(_.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),_}(l),s=function(c){g(_,c);function _(E){return c.call(this,E)||this}return Object.defineProperty(_.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),_}(l),v=function(c){g(_,c);function _(E){return c.call(this,E)||this}return Object.defineProperty(_.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),_}(l)},"./src/utils/logger.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),l=p.n(g),o=function(){function s(){}return s.e=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var _="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","error",_),s.ENABLE_ERROR&&(console.error?console.error(_):console.warn?console.warn(_):console.log(_))},s.i=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var _="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","info",_),s.ENABLE_INFO&&(console.info?console.info(_):console.log(_))},s.w=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var _="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","warn",_),s.ENABLE_WARN&&(console.warn?console.warn(_):console.log(_))},s.d=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var _="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","debug",_),s.ENABLE_DEBUG&&(console.debug?console.debug(_):console.log(_))},s.v=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var _="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","verbose",_),s.ENABLE_VERBOSE&&console.log(_)},s}();o.GLOBAL_TAG="flv.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new(l()),m.default=o},"./src/utils/logging-control.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),l=p.n(g),o=p("./src/utils/logger.js"),s=function(){function v(){}return Object.defineProperty(v,"forceGlobalTag",{get:function(){return o.default.FORCE_GLOBAL_TAG},set:function(c){o.default.FORCE_GLOBAL_TAG=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"globalTag",{get:function(){return o.default.GLOBAL_TAG},set:function(c){o.default.GLOBAL_TAG=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableAll",{get:function(){return o.default.ENABLE_VERBOSE&&o.default.ENABLE_DEBUG&&o.default.ENABLE_INFO&&o.default.ENABLE_WARN&&o.default.ENABLE_ERROR},set:function(c){o.default.ENABLE_VERBOSE=c,o.default.ENABLE_DEBUG=c,o.default.ENABLE_INFO=c,o.default.ENABLE_WARN=c,o.default.ENABLE_ERROR=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableDebug",{get:function(){return o.default.ENABLE_DEBUG},set:function(c){o.default.ENABLE_DEBUG=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableVerbose",{get:function(){return o.default.ENABLE_VERBOSE},set:function(c){o.default.ENABLE_VERBOSE=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableInfo",{get:function(){return o.default.ENABLE_INFO},set:function(c){o.default.ENABLE_INFO=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableWarn",{get:function(){return o.default.ENABLE_WARN},set:function(c){o.default.ENABLE_WARN=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableError",{get:function(){return o.default.ENABLE_ERROR},set:function(c){o.default.ENABLE_ERROR=c,v._notifyChange()},enumerable:!1,configurable:!0}),v.getConfig=function(){return{globalTag:o.default.GLOBAL_TAG,forceGlobalTag:o.default.FORCE_GLOBAL_TAG,enableVerbose:o.default.ENABLE_VERBOSE,enableDebug:o.default.ENABLE_DEBUG,enableInfo:o.default.ENABLE_INFO,enableWarn:o.default.ENABLE_WARN,enableError:o.default.ENABLE_ERROR,enableCallback:o.default.ENABLE_CALLBACK}},v.applyConfig=function(c){o.default.GLOBAL_TAG=c.globalTag,o.default.FORCE_GLOBAL_TAG=c.forceGlobalTag,o.default.ENABLE_VERBOSE=c.enableVerbose,o.default.ENABLE_DEBUG=c.enableDebug,o.default.ENABLE_INFO=c.enableInfo,o.default.ENABLE_WARN=c.enableWarn,o.default.ENABLE_ERROR=c.enableError,o.default.ENABLE_CALLBACK=c.enableCallback},v._notifyChange=function(){var c=v.emitter;if(c.listenerCount("change")>0){var _=v.getConfig();c.emit("change",_)}},v.registerListener=function(c){v.emitter.addListener("change",c)},v.removeListener=function(c){v.emitter.removeListener("change",c)},v.addLogListener=function(c){o.default.emitter.addListener("log",c),o.default.emitter.listenerCount("log")>0&&(o.default.ENABLE_CALLBACK=!0,v._notifyChange())},v.removeLogListener=function(c){o.default.emitter.removeListener("log",c),o.default.emitter.listenerCount("log")===0&&(o.default.ENABLE_CALLBACK=!1,v._notifyChange())},v}();s.emitter=new(l()),m.default=s},"./src/utils/polyfill.js":function(S,m,p){p.r(m);var g=function(){function l(){}return l.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(o,s){return o.__proto__=s,o},Object.assign=Object.assign||function(o){if(o==null)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(o),v=1;v<arguments.length;v++){var c=arguments[v];if(c!=null)for(var _ in c)c.hasOwnProperty(_)&&(s[_]=c[_])}return s},typeof self.Promise!="function"&&p("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},l}();g.install(),m.default=g},"./src/utils/utf8-conv.js":function(S,m,p){p.r(m);function g(o,s,v){var c=o;if(s+v<c.length){for(;v--;)if((c[++s]&192)!==128)return!1;return!0}else return!1}function l(o){for(var s=[],v=o,c=0,_=o.length;c<_;){if(v[c]<128){s.push(String.fromCharCode(v[c])),++c;continue}else if(!(v[c]<192)){if(v[c]<224){if(g(v,c,1)){var E=(v[c]&31)<<6|v[c+1]&63;if(E>=128){s.push(String.fromCharCode(E&65535)),c+=2;continue}}}else if(v[c]<240){if(g(v,c,2)){var E=(v[c]&15)<<12|(v[c+1]&63)<<6|v[c+2]&63;if(E>=2048&&(E&63488)!==55296){s.push(String.fromCharCode(E&65535)),c+=3;continue}}}else if(v[c]<248&&g(v,c,3)){var E=(v[c]&7)<<18|(v[c+1]&63)<<12|(v[c+2]&63)<<6|v[c+3]&63;if(E>65536&&E<1114112){E-=65536,s.push(String.fromCharCode(E>>>10|55296)),s.push(String.fromCharCode(E&1023|56320)),c+=4;continue}}}s.push(String.fromCharCode(65533)),++c}return s.join("")}m.default=l}},r={};function i(S){var m=r[S];if(m!==void 0)return m.exports;var p=r[S]={exports:{}};return n[S].call(p.exports,p,p.exports,i),p.exports}i.m=n,function(){i.n=function(S){var m=S&&S.__esModule?function(){return S.default}:function(){return S};return i.d(m,{a:m}),m}}(),function(){i.d=function(S,m){for(var p in m)i.o(m,p)&&!i.o(S,p)&&Object.defineProperty(S,p,{enumerable:!0,get:m[p]})}}(),function(){i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){i.o=function(S,m){return Object.prototype.hasOwnProperty.call(S,m)}}(),function(){i.r=function(S){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(S,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(S,"__esModule",{value:!0})}}();var y=i("./src/index.js");return y}()})})(qr);var Mo=qr.exports;const Io=qn(Mo);const Bo={class:"video-container"},Fo={key:1,class:"controls"},wo={class:"left"},Uo={class:"right"},jo={name:"Video"},No=Object.assign(jo,{props:{flv:{type:Boolean,default:!1},url:{type:String,default:""},id:{type:String,default:""},abbr:{type:Boolean,default:!1}},emits:"full",setup(e,{expose:t,emit:n}){const r=e,i=q(null),y=q(null);let S=q(!1),m=q(!0),p=q(!1),g=null;const l=()=>{g=Io.createPlayer({type:"flv",isLive:!0,url:r.url}),g.attachMediaElement(i==null?void 0:i.value),g.load(),g.play()};Ci(()=>{r.flv&&r.url&&l()});const o=(f,u,d)=>{f&&(i.value.srcObject=f,i.value.play().catch(()=>{}),p.value=d)},s=f=>{f.requestFullscreen?f.requestFullscreen():ele.mozRequestFullScreen?f.mozRequestFullScreen():ele.webkitRequestFullScreen&&f.webkitRequestFullScreen()};function v(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}const c=()=>{S.value?(v(),S.value=!1):(s(y==null?void 0:y.value),S.value=!0)},_=f=>{m.value=f,i.value.muted=f},E=()=>{_(!i.value.muted)};return t({setStream:o,setMuted:_,id:r.id}),(f,u)=>{const d=fn;return N(),oe("div",{class:ee(["live-video",{"is-full":V(S)}]),ref_key:"videoContainerRef",ref:y},[$("div",Bo,[$("video",{class:"video",ref_key:"videoRef",ref:i,muted:"",autoplay:"",playsinline:"",oncontextmenu:"return false"},null,512),Be(f.$slots,"default",{},void 0,!0),r.abbr?(N(),ae(d,{key:0,class:"full-center","icon-name":"full","icon-size":"28",color:"#cfcfcf",onClick:u[0]||(u[0]=Fe(h=>n("full"),["stop"]))})):re("",!0),V(p)?(N(),oe("div",Fo,[$("div",wo,[W(d,{"icon-name":V(m)?"sound-close":"sound","icon-size":"24",color:"#cfcfcf",onClick:Fe(E,["stop"])},null,8,["icon-name","onClick"])]),$("div",Uo,[W(d,{"icon-name":"full","icon-size":"20",color:"#cfcfcf",onClick:Fe(c,["stop"])},null,8,["onClick"])])])):re("",!0)])],2)}}}),ft=at(No,[["__scopeId","data-v-03335188"]]);const Vo={class:"user-video-control"},Go={__name:"control",props:{id:{type:String,default:""},layout:{type:Array,default:()=>["video","audio"]},state:{type:Object,required:!0}},emits:"control",setup(e,{emit:t}){const n=e,i=Qn()?18:20,y=S=>{t("control",{state:n.state[S],type:S,id:n.id})};return(S,m)=>{const p=fn;return N(),oe("div",Vo,[n.layout.includes("video")?(N(),ae(p,{key:0,"icon-name":"shipin-"+n.state.video,"icon-size":V(i),onClick:m[0]||(m[0]=g=>y("video")),color:"#ffffff"},null,8,["icon-name","icon-size"])):re("",!0),n.layout.includes("audio")?(N(),ae(p,{key:1,"icon-name":"yuyin-"+n.state.audio,"icon-size":V(i),onClick:m[1]||(m[1]=g=>y("audio")),color:"#ffffff"},null,8,["icon-name","icon-size"])):re("",!0),n.layout.includes("sound")?(N(),ae(p,{key:2,"icon-name":"sound"+(n.state.sound===1?"":"-close"),"icon-size":V(i),onClick:m[2]||(m[2]=g=>y("sound")),color:"#ffffff"},null,8,["icon-name","icon-size"])):re("",!0)])}}},$t=at(Go,[["__scopeId","data-v-738daade"]]);const Ko={class:"user-video-header"},zo=["title"],Wo={__name:"header",props:{homeowner:{type:Boolean,default:!1},name:{type:String,default:""}},setup(e){const t=e,n=Qn();return(r,i)=>{const y=Xi;return N(),oe("div",Ko,[t.homeowner?(N(),ae(y,{key:0,round:"",size:V(n)?"small":""},{default:J(()=>[ge("房主")]),_:1},8,["size"])):re("",!0),$("div",{class:"video-username",title:t.name},me(t.name),9,zo)])}}},Et=at(Wo,[["__scopeId","data-v-c5788485"]]),$o={class:"dialog-footer"},Ho={name:"SetRoomPassDialog"},Yo=Object.assign(Ho,{props:{id:{type:String,default:""}},setup(e,{expose:t}){const n=e,r=q(),i=q(!1),y=q(""),S=()=>{i.value=!1},m=()=>{y.value.trim().length===6||y.value.length===0?Zn({method:"POST",url:"room/update",data:{id:n.id,password:y.value}}).then(()=>{i.value=!1,y.value.length===0?Ge.success("密码已设置为空！"):Ge.success("密码设置成功！")}):Ge.warning("密码输入格式错误！")};return t({show:()=>i.value=!0,hide:()=>i.value=!1}),(p,g)=>{const l=jt,o=Qe,s=dn;return N(),ae(s,{ref_key:"dialogRef",ref:r,modelValue:i.value,"onUpdate:modelValue":g[1]||(g[1]=v=>i.value=v),title:"设置密码",width:"400px","show-close":!1,"close-on-click-modal":!1},{footer:J(()=>[$("div",$o,[W(o,{onClick:S},{default:J(()=>[ge("取消")]),_:1}),W(o,{type:"primary",onClick:m},{default:J(()=>[ge(" 确定 ")]),_:1})])]),default:J(()=>[W(l,{modelValue:y.value,"onUpdate:modelValue":g[0]||(g[0]=v=>y.value=v),modelModifiers:{trim:!0},placeholder:"请输入6位密码"},null,8,["modelValue"])]),_:1},8,["modelValue"])}}}),Xo={class:"dialog-footer"},Jo={name:"EnterRoomPassDialog"},qo=Object.assign(Jo,{props:{id:{type:String,default:""}},emits:["onTrue","onFalse","onCancel"],setup(e,{expose:t,emit:n}){const r=e,i=q(),y=q(),S=()=>{n("onCancel"),y.value=!1},m=()=>{Zn({method:"POST",url:"/room/checkPassword",data:{id:r.id,password:i.value}}).then(p=>{p.data?(n("onTrue"),y.value=!1):(n("onFalse"),Ge.warning("密码错误！"))})};return t({show:()=>y.value=!0,hide:()=>y.value=!1}),(p,g)=>{const l=jt,o=Qe,s=dn;return N(),ae(s,{ref:"dialogRef",modelValue:y.value,"onUpdate:modelValue":g[1]||(g[1]=v=>y.value=v),title:"设置密码",width:"400px","show-close":!1,"close-on-click-modal":!1},{footer:J(()=>[$("div",Xo,[W(o,{onClick:S},{default:J(()=>[ge("取消")]),_:1}),W(o,{type:"primary",onClick:m},{default:J(()=>[ge(" 确定 ")]),_:1})])]),default:J(()=>[W(l,{modelValue:i.value,"onUpdate:modelValue":g[0]||(g[0]=v=>i.value=v),modelModifiers:{trim:!0},placeholder:"请输入6位密码"},null,8,["modelValue"])]),_:1},8,["modelValue"])}}});const gn=bi("room",()=>{const e=q({}),t=q([]),n=q([]);return{info:e,peoples:t,chatList:n,GET_INFO:async(m,p)=>{var l,o;const g=await Ri({id:m}).catch(()=>{typeof p=="function"&&p()});e.value=((l=g==null?void 0:g.data)==null?void 0:l.info)||{},t.value=((o=g==null?void 0:g.data)==null?void 0:o.peoples)||[]},ADD_PEOPLE:m=>{t.value.findIndex(p=>p.id===m.id)===-1&&t.value.push(m)},ADD_CHAT:(...m)=>{n.value.push(...m)},REMOVE_PEOPLE:m=>{t.value=t.value.filter(p=>p.id!==m)}}}),Qo=["😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","😘","😗","😙","😚","😋","😛","😝","😜","🤪","🤨","🧐","🤓","😎","🤩","😏","😒","😞","😔","😟","😕","🙁","😣","😖","😫","😩","😢","😭","😮","💨","😤","😠","😡","🤬","🤯","😳","😱","😨","😰","😥","😓","🤗","🤔","🤭","🤫","🤥","😶","🌫️","😐","😑","😬","🙄","😯","😦","😧","😮","😲","😴","🤤","😪","😵","😵","💫","🤐","🤢","🤮","🤧","😷","🤒","🤕","🤑","🤠","😈","👿","👹","👺","🤡","💩","👻","💀","👽","👾","🤖","🎃","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🐶"];const Zo=e=>(Li("data-v-19e71906"),e=e(),Ai(),e),ea={key:0,class:"unread-dot"},ta={class:"user-name"},na={class:"chat-content"},ra=Zo(()=>$("div",{class:"chat-textarea-placeholder"},null,-1)),ia={class:"chat-textarea"},sa={class:"emoji-container"},oa=["onClick"],aa={name:"ChatButton"},la=Object.assign(aa,{emits:"enter",setup(e,{emit:t}){const n=q(!1),r=q(""),i=q(),y=q(),S=gn(),{chatList:m}=Yt(S),{info:p}=Yt(hn());Nt(()=>{c()});const g=_=>{if(!_.shiftKey&&_.keyCode===13){if(r.value.trim()==="")return;const E=r.value;r.value="";const f={info:{id:p.value.id,name:p.value.username},time:Date.now(),content:E};S.ADD_CHAT({...f,unread:!1}),t("enter",f),_.preventDefault()}},l=_=>{r.value+=_,y.value.focus()},o=()=>{for(let _=0;_<m.value.length;_++)m.value[_].unread=!1};Dt(n,async()=>{n.value&&(await Pe(),y.value.focus())},{flush:"post"});const s=async()=>{n.value=!0,o(),await Pe(),c()};Dt(m,()=>{c(),n.value&&o()},{flush:"post",deep:!0});const v=_e(()=>{let _=0;if(n.value)return _;for(let E of m.value)E.unread&&_++;return _}),c=async()=>{await Pe(),i.value&&(i.value.scrollTop=i.value.scrollHeight)};return(_,E)=>{const f=Qe,u=fn,d=Ti,h=jt,a=ss;return N(),oe(we,null,[W(f,{class:"drawer-button",onClick:s},{default:J(()=>[Be(_.$slots,"default",{},void 0,!0),V(v)?(N(),oe("span",ea,"("+me(V(v))+")",1)):re("",!0)]),_:3}),W(a,{class:"chat-container","append-to-body":"",size:300,modelValue:n.value,"onUpdate:modelValue":E[1]||(E[1]=x=>n.value=x),title:"聊天室"},{default:J(()=>[$("div",{class:"chat-list",ref_key:"chatListRef",ref:i},[(N(!0),oe(we,null,Bt(V(m),x=>(N(),oe("div",{class:"chat-item",key:x.info.id+"_"+x.time},[$("div",ta,me(x.info.id===V(p).id?"我":x.info.name),1),$("div",na,me(x.content),1)]))),128)),ra],512),$("div",ia,[W(d,{placement:"top-start",width:250,trigger:"click"},{reference:J(()=>[W(u,{iconName:"expression",iconSize:"30",color:"#999"})]),default:J(()=>[$("div",sa,[(N(!0),oe(we,null,Bt(V(Qo),x=>(N(),oe("div",{class:"emoji-item",onClick:C=>l(x),key:x},me(x),9,oa))),128))])]),_:1}),W(h,{ref_key:"contentRef",ref:y,type:"textarea",modelValue:r.value,"onUpdate:modelValue":E[0]||(E[0]=x=>r.value=x),placeholder:"请输入",rows:1,onKeydown:g,resize:"none"},null,8,["modelValue"])])]),_:1},8,["modelValue"])],64)}}}),ua=at(la,[["__scopeId","data-v-19e71906"]]);const ca={class:"link"},fa={key:0,class:"pwd"},da={class:"btn-group"},ha={__name:"index",props:{id:{type:String,required:!0}},setup(e){const t=e,n=q(!1),r=location.href,i=q("");Oi({id:t.id}).then(S=>{i.value=S.data});const y=()=>{Pi(`房间链接：${r}`+(i.value?`  房间密码：${i.value}`:"")),Ge.success("复制成功！"),n.value=!1};return(S,m)=>{const p=Qe,g=dn;return N(),oe(we,null,[W(p,{onClick:m[0]||(m[0]=l=>n.value=!0)},{default:J(()=>[Be(S.$slots,"default",{},void 0,!0)]),_:3}),W(g,{modelValue:n.value,"onUpdate:modelValue":m[1]||(m[1]=l=>n.value=l),width:"500",title:"分享房间"},{default:J(()=>[$("div",ca,"房间链接："+me(V(r)),1),i.value?(N(),oe("div",fa,"密码："+me(i.value),1)):re("",!0),$("div",da,[W(p,{type:"primary",onClick:y},{default:J(()=>[ge("复制")]),_:1})])]),_:1},8,["modelValue"])],64)}}},pa=at(ha,[["__scopeId","data-v-54382612"]]),_a={class:"file-name"},ma={class:"notice-group"},ga={__name:"progress",props:{type:{type:Number,default:1},percentage:{type:Number,default:0},name:{type:String,default:""},buffer:{type:Array,default:[]}},setup(e){const t=e,n=()=>{ki({data:t.buffer,name:t.name})};return(r,i)=>{const y=Qe;return N(),oe(we,null,[$("div",_a,me(t.name),1),$("div",ma,[t.percentage.value!=100?(N(),oe(we,{key:0},[ge(" 文件"+me(t.type===1?"发送":"接收")+"中... "+me(t.percentage)+"% ",1)],64)):(N(),oe(we,{key:1},[ge(" 文件"+me(t.type===1?"发送":"接收")+"成功... ",1)],64)),t.percentage.value==100&&t.type===2?(N(),ae(y,{key:2,onClick:n,type:"primary",link:""},{default:J(()=>[ge(" 下载 ")]),_:1})):re("",!0)])],64)}}},Vn=(e,t)=>{const n=_e(()=>Math.floor(t.value.receiveSize/t.value.maxSize*100));ks({title:e===1?"发送文件":"接收文件",duration:0,"custom-class":"progress-notice",message:Di(ga,{type:e,percentage:n,name:t.value.name,buffer:t.value.buffer})})},Xe=gn(),Gn=hn();q(null);const Kn=(e,t)=>{const n=JSON.parse(JSON.stringify(e));return n.name=t.name,n.maxSize=t.size,n.receiveSize=0,n.start=!0,n},va=()=>{const e=_e(()=>Xe.peoples.find(n=>n.id===Gn.info.id)),t=_e(()=>Xe.peoples.filter(n=>n.id!==Gn.info.id));return[e,t]},ya=()=>_e(()=>Xe.info.name?Xe.info.name+" ("+Xe.peoples.length+(Xe.info.max?"/"+Xe.info.max:"")+")":""),Ea=async()=>{let e=null;try{const t={video:{width:{min:640},height:{min:360},frameRate:{ideal:30,max:60}},audio:{noiseSuppression:!0,echoCancellation:!0}};return navigator.mediaDevices.getUserMedia?e=await navigator.mediaDevices.getUserMedia(t):navigator.webkitGetUserMedia?e=await navigator.webkitGetUserMedia(t):navigator.mozGetUserMedia?e=await navagator.mozGetUserMedia(t):navigator.getUserMedia?e=await navigator.getUserMedia(t):Ge.warning("你的浏览器不支持访问用户媒体设备！"),e.getTracks().forEach(n=>{n.enabled=!1}),Promise.resolve(e)}catch{return Ge.warning("没有打开摄像头和语音权限！"),Promise.reject()}},xa=e=>{const t=q(e);return[t,r=>t.value=r]},Sa=async e=>{try{const t=await navigator.mediaDevices.getDisplayMedia({video:{width:960,height:540}});return t.oninactive=e,t}catch{console.log("取消投屏！")}},Ca=e=>{var t=e.getSenders();t.forEach(n=>{if(n&&n.track.kind==="video"){let r=n.getParameters();r.encodings[0].maxBitrate=1e3*1e3,n.setParameters(r)}})},zn=()=>{const e=ht(new Map);return{list:e,set:(i,y)=>e.set(i,y),get:(i,y)=>{const S=e.get(i);S&&typeof y=="function"&&y(S)},del:i=>e.delete(i)}};const ba={key:0,class:"container"},Ra={class:"live-name"},Ta={key:0,class:"video-main"},La={class:"people-video-group"},Aa={class:"people-video"},Oa={key:1,class:"video-metting-main"},Pa={class:"screen-video"},ka={class:"people-video-group"},Da={class:"people-video"},Ma={class:"btn-group"},Ia={key:0,class:"btn-group-public"},Ba={class:"btn-group-right"},Fa={name:"Room"},wa=Object.assign(Fa,{setup(e){const t=Mi(),n=Ii(),r=gn(),i=hn(),{info:y}=Yt(r),S=t.query.id,m=ya();let p=!1,g=null;const l=q(),o=q(),s=q(),v=q(),c=q(),_=q(),E=q(!1),f=q(!1),u=q(!1),d=zn(),h=zn(),a=ht(new Map),[x,C]=xa(1),b=q(!1),L=ht({video:2,audio:2}),O=ht(new Map),[A,R]=va();let T=q(null),P=q(null);const M={start:!1,maxSize:0,receiveSize:0,name:"",buffer:[]},D=q(M),I=q(M);let Y=[];const Q=()=>{le.on("initSuccessed",()=>{le.emit("join")}),le.on("joined",async function(j){let B=JSON.parse(j.info);if(r.ADD_PEOPLE(B),i.info.id!==B.id){const U=z("video",B.id);d.set(B.id,U),U.addTrack(T.value),Ca(U.conn),U.createOffer(K=>{le.emit("offer",{offer:K,type:"video",to:B.id,from:i.info.id})})}if(P.value){const U=z("display",B.id);h.set(B.id,U),U.addTrack(P.value),U.createOffer(K=>{le.emit("offer",{offer:K,type:"display",to:B.id,from:i.info.id})})}}),le.on("leave",function(j){j.id===y.user_id&&(g=null),d.del(j.id),h.del(j.id),a.delete(j.id),r.REMOVE_PEOPLE(j.id),s.value.forEach(B=>{B.id===j.id&&B.setStream(null)})}),le.on("offer",function({offer:j,type:B,from:U}){B==="video"?d.get(U,K=>{K.addTrack(T.value),K.setRemoteDescription(j),K.createAnswer(Ae=>{le.emit("answer",{answer:Ae,type:B,to:U,from:i.info.id})})}):(g=z(B,U),g.setRemoteDescription(j),g.createAnswer(K=>{le.emit("answer",{answer:K,type:B,to:U,from:i.info.id})}))}),le.on("answer",function({answer:j,type:B,from:U}){B==="video"?d.get(U,K=>{K.setRemoteDescription(j)}):h.get(U,K=>{K.setRemoteDescription(j)})}),le.on("candidate",({candidate:j,type:B,from:U})=>{B==="video"?d.get(U,K=>{K.setCandidate(j)}):g?g.setCandidate(j):h.get(U,K=>{K.setCandidate(j)})}),le.on("noLogin",()=>{i.SET_TOKEN(""),i.SET_LOGIN(!0,1)}),le.on("fulled",()=>{f.value=!0,Ye.alert("当前房间已经满人！").then(()=>{n.go(-1)}),le.close(),le.disconnect()}),le.on("closed",()=>{p=!0,Ye.alert("当前房间已经关闭！").then(()=>{n.replace("/"),i.SET_ROOM("")})}),le.on("rejectConn",()=>{Ye.alert("对方拒绝了你的连接申请！")}),le.on("typeChange",async j=>{C(j),await Pe(),De(),P.value&&l.value.setStream(P.value,!1,!0)}),le.on("displayMediaEnd",async()=>{l.value.setStream(null,!0,!1),C(1),await Pe(),await Ve(1)})},X=async()=>{(await Ui({id:S})).data?(f.value=!0,Ye.alert("已在其他页面打开，请不要重复打开！","温馨提醒").then(()=>{n.go(-1)})):(Ea().then(B=>{T.value=B}).catch(()=>{}),o.value.setStream(T.value,!0),await xo({query:{id:S}}),Q())},ne=()=>{le.disconnect(),le.close()},ue=j=>{j&&j.getTracks().forEach(B=>{B.stop()})},H=async()=>{C(r.info.type),r.peoples.forEach(j=>{const B=z("video",j.id);d.set(j.id,B)}),await X(),u.value=!!y.value.is_public},ie=()=>{H()},Re=()=>{n.go(-1),p=!0},ce=j=>{d.list.forEach(B=>{var U;(U=B.dataChannel)==null||U.send(JSON.stringify({type:"chat",data:j}))})},fe=(j,B)=>{let U=null;switch(j){case 1:U=T.value;break;case 2:U=a.get(B);break}b.value=!0,l.value.setStream(U)},Ce=()=>{l.value.setStream(P.value),b.value=!1};Nt(async()=>{if(i.token){await r.GET_INFO(S,()=>{p=!0,f.value=!0,n.push("/")});const{data:j}=await Bi({id:S});j?c.value.show():H()}}),Fi(async(j,B,U)=>{try{p||!i.token?(ne(),ue(T.value),U()):(await Ye.confirm("此操作将会退出当前房间！","温馨提醒").then(()=>{ne(),ue(T.value)}),U())}catch{U(!1)}});const ye=()=>{v.value.show()},xe=async(j,B)=>{d.list.forEach(async U=>{U.conn.getSenders().forEach(K=>{K.tarck&&K.track.kind===j&&(K.track.enabled=B)})}),T.value&&T.value.getTracks().forEach(U=>{U.kind===j&&(U.enabled=B)})},Te=({state:j,type:B})=>{try{if(!T.value)return;j===2?(xe(B,!0),o.value.setStream(T.value,!0),L[B]=1):(xe(B,!1),L[B]=2)}catch(U){console.log("error：",U)}},de=({state:j,id:B})=>{for(let U of s.value)U.id===B&&(U.setMuted(j!==2),O.get(B)&&(O.get(B).sound=j===2?1:2))},z=(j,B)=>new Do({async onTarck(U){const[K]=U.streams;if(j==="video"){let Ae=s.value.find(be=>be.id==B);Ae&&Ae.setStream(K,!1),a.set(B,K),O.set(B,{sound:2})}else l.value?l.value.setStream(K,!1,!0):P.value=K},onCandidate(U){U&&le.emit("candidate",{candidate:U,type:j,to:B,from:i.info.id})},onMessage(U){let K=U.data;typeof K=="string"?(K=JSON.parse(K),K.type==="file-start"?(D.value=Kn(D.value,{size:K.size,name:K.name}),Vn(2,D)):K.type==="file-end"?D.value.start=!1:K.type==="chat"&&r.ADD_CHAT({...K.data,unread:!0})):(D.value.receiveSize+=K.size,D.value.buffer.push(K))}}),Se=async j=>{await Sn({is_public:j?1:0,id:S})},Le=()=>{Ye.confirm("确认关闭房间？").then(()=>{le.emit("closeHouse")})},Ne=()=>{d.list.size?I.value.start?Ge.warning("正在分享中..."):_.value.click():Ge.warning("当前房间不存在其他人...")},ke=j=>{const B=j.target.files[0];if(B){const U=new FileReader;let K=1024,Ae=Math.ceil(B.size/K),be=1;const He=()=>{U.readAsArrayBuffer(B.slice((be-1)*K,be*K)),be++};U.onload=()=>{Y.forEach(pe=>{d.get(pe,he=>{var k;(k=he.dataChannel)==null||k.send(U.result)})}),I.value.receiveSize+=U.result.byteLength,be<=Ae?He():(Y.forEach(pe=>{d.get(pe,he=>{var k;(k=he.dataChannel)==null||k.send(JSON.stringify({type:"file-end",size:B.size,name:B.name}))})}),I.value.start=!1)},Y=[...d.list.keys()],Y.forEach(pe=>{d.get(pe,he=>{var k;(k=he.dataChannel)==null||k.send(JSON.stringify({type:"file-start",size:B.size,name:B.name}))})}),I.value=Kn(I.value,{size:B.size,name:B.name}),Vn(1,I),He()}},De=async()=>{var j;await Pe(),o.value.setStream(T.value),(j=s==null?void 0:s.value)==null||j.forEach(B=>{const U=a.get(B.id);U&&B.setStream(U)})},Ve=async j=>{Sn({id:S,type:j}).then(()=>{y.user_id!==(A==null?void 0:A.id)&&(P.value=null),le.emit("typeChange",j),De()})},Ke=async()=>{P.value?ue(P.value):Sa(()=>{le.emit("displayMediaEnd"),P.value=null,h.list.clear()}).then(async B=>{B&&(P.value=B,C(2),await Pe(),await Ve(2),l.value.setStream(B,!1,!0),r.peoples.forEach(U=>{h.set(U.id,z("display",U.id))}),h.list.forEach((U,K)=>{U.addTrack(B),U.createOffer(Ae=>{le.emit("offer",{offer:Ae,type:"display",to:K,from:i.info.id})})}))})};return(j,B)=>{var He,pe;const U=Ie("ArrowLeft"),K=qe,Ae=wi,be=Qe;return N(),oe(we,null,[f.value?re("",!0):(N(),oe("div",ba,[$("div",Ra,me(V(m)),1),V(x)===1?(N(),oe("div",Ta,[$("div",La,[$("div",Aa,[W(ft,{ref_key:"videoRef",ref:o},null,512),V(A)?(N(),ae(Et,{key:0,homeowner:((He=V(A))==null?void 0:He.id)===V(y).user_id,name:(pe=V(A))==null?void 0:pe.username},null,8,["homeowner","name"])):re("",!0),W($t,{state:L,onControl:Te},null,8,["state"])]),(N(!0),oe(we,null,Bt(V(R),he=>(N(),oe("div",{class:"people-video",key:he.id},[W($t,{id:he.id,state:O.get(he.id),onControl:de,layout:O.get(he.id)?["sound"]:[]},null,8,["id","state","layout"]),W(Et,{homeowner:(he==null?void 0:he.id)===V(y).user_id,name:he==null?void 0:he.username},null,8,["homeowner","name"]),W(ft,{id:he.id,ref_for:!0,ref_key:"remoteVideoRef",ref:s},null,8,["id"])]))),128))])])):re("",!0),V(x)===2?(N(),oe("div",Oa,[$("div",Pa,[W(ft,{ref_key:"mainVideoRef",ref:l},{default:J(()=>{var he;return[We($("div",{class:ee(["back-main",{move:E.value}]),onClick:Ce},[W(K,{size:"16"},{default:J(()=>[W(U)]),_:1}),ge(" 返回投屏 ")],2),[[$e,b.value]]),$("div",{class:ee(["people-video-box",{collapse:E.value}])},[$("div",{class:"people-video-slider",onClick:B[0]||(B[0]=k=>E.value=!E.value)},[W(K,{size:20,color:"rgba(255, 255, 255, 0.5)"},{default:J(()=>[(N(),ae(nt(E.value?"DArrowRight":"DArrowLeft")))]),_:1})]),$("div",ka,[$("div",Da,[W(ft,{abbr:V(T),ref_key:"videoRef",ref:o,onFull:B[1]||(B[1]=k=>fe(1))},null,8,["abbr"]),V(A)?(N(),ae(Et,{key:0,homeowner:V(y).homeowner,name:(he=V(A))==null?void 0:he.username},null,8,["homeowner","name"])):re("",!0),W($t,{state:L,onControl:Te},null,8,["state"])]),(N(!0),oe(we,null,Bt(V(R),k=>(N(),oe("div",{class:"people-video",key:k.id},[W(Et,{homeowner:(k==null?void 0:k.id)===V(y).user_id,name:k==null?void 0:k.username},null,8,["homeowner","name"]),W(ft,{abbr:a.get(k.id),id:k.id,ref_for:!0,ref_key:"remoteVideoRef",ref:s,layout:["sound"],onFull:F=>fe(2,k.id)},null,8,["abbr","id","onFull"])]))),128))])],2)]}),_:1},512)])])):re("",!0),$("div",Ma,[V(y).homeowner?(N(),oe("div",Ia,[ge(" 公开 "),W(Ae,{modelValue:u.value,"onUpdate:modelValue":B[2]||(B[2]=he=>u.value=he),onChange:Se},null,8,["modelValue"])])):re("",!0),V(y).homeowner?(N(),ae(be,{key:1,onClick:ye},{default:J(()=>[ge(" 设置密码 ")]),_:1})):re("",!0),V(y).homeowner?(N(),ae(be,{key:2,onClick:Ke},{default:J(()=>[ge(me(V(P)?"停止共享":"共享屏幕"),1)]),_:1})):re("",!0),$("div",Ba,[W(be,{onClick:Ne},{default:J(()=>[ge(" 分享文件 ")]),_:1}),V(y).homeowner?(N(),ae(pa,{key:0,id:V(S)},{default:J(()=>[ge(" 分享房间 ")]),_:1},8,["id"])):re("",!0),W(ua,{onEnter:ce},{default:J(()=>[ge("聊天室")]),_:1}),V(y).homeowner?(N(),ae(be,{key:1,onClick:Le},{default:J(()=>[ge(" 关闭房间 ")]),_:1})):re("",!0)])])])),W(Yo,{ref_key:"setRoomPassDialogRef",ref:v,id:V(S)},null,8,["id"]),W(qo,{ref_key:"enterRoomPassDialogRef",ref:c,id:V(S),onOnTrue:ie,onOnCancel:Re},null,8,["id"]),We($("input",{type:"file",ref_key:"fileRef",ref:_,onChange:ke},null,544),[[$e,!1]])],64)}}}),Na=at(wa,[["__scopeId","data-v-e4937cbd"]]);export{Na as default};

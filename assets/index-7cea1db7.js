var Hr=Object.defineProperty;var $r=(e,t,n)=>t in e?Hr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Kt=(e,t,n)=>($r(e,typeof t!="symbol"?t+"":t,n),n);import{D as ke,G as Et,f as an,H as Yr,d as We,I as Xr,u as ln,h as me,o as V,c as oe,b as z,r as Me,n as te,e as G,y as ce,v as J,j as X,J as Wt,K as ze,L as Ye,l as se,k as nt,T as ht,_ as pt,w as Un,M as jn,N as Jr,O as qr,P as Qr,Q as Nn,R as Vn,S as _n,s as ee,g as Zr,i as ei,U as ti,V as Ie,W as Ve,t as he,X as Ge,Y as ni,A as it,E as Ut,Z as ri,$ as ii,a0 as Gn,a1 as xt,a2 as Dt,a as mn,a3 as It,a4 as si,a5 as jt,a6 as oi,a7 as ai,a8 as li,a9 as ui,aa as ut,ab as gt,B as _e,ac as Kn,ad as un,ae as ft,af as Mt,ag as gn,ah as ci,ai as fi,aj as vn,ak as Bt,al as di,am as zt,an as hi,F as we,ao as pi,ap as _i,aq as mi,ar as zn,m as cn,as as gi,at as fn,z as et,C as Ze,au as Wn,av as vi,aw as Ht,p as Hn,x as Ft,ax as yi,ay as Ei,az as xi,aA as Si,aB as Ci,q as bi,aC as Ri,aD as Ti}from"./index-dbe454b4.js";function Li(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in e)){const x=Object.getOwnPropertyDescriptor(r,i);x&&Object.defineProperty(e,i,x.get?x:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}const Ai='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',Oi=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,yn=e=>Array.from(e.querySelectorAll(Ai)).filter(t=>Pi(t)&&Oi(t)),Pi=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},$t="_trap-focus-children",$e=[],En=e=>{if($e.length===0)return;const t=$e[$e.length-1][$t];if(t.length>0&&e.code===Et.tab){if(t.length===1){e.preventDefault(),document.activeElement!==t[0]&&t[0].focus();return}const n=e.shiftKey,r=e.target===t[0],i=e.target===t[t.length-1];r&&n&&(e.preventDefault(),t[t.length-1].focus()),i&&!n&&(e.preventDefault(),t[0].focus())}},ki={beforeMount(e){e[$t]=yn(e),$e.push(e),$e.length<=1&&document.addEventListener("keydown",En)},updated(e){ke(()=>{e[$t]=yn(e)})},unmounted(){$e.shift(),$e.length===0&&document.removeEventListener("keydown",En)}},Di=an({type:{type:String,values:["success","info","warning","danger",""],default:""},closable:Boolean,disableTransitions:Boolean,hit:Boolean,color:{type:String,default:""},size:{type:String,values:Yr,default:""},effect:{type:String,values:["dark","light","plain"],default:"light"},round:Boolean}),Ii={close:e=>e instanceof MouseEvent,click:e=>e instanceof MouseEvent},Mi=We({name:"ElTag"}),Bi=We({...Mi,props:Di,emits:Ii,setup(e,{emit:t}){const n=e,r=Xr(),i=ln("tag"),x=me(()=>{const{type:_,hit:g,effect:u,closable:o,round:s}=n;return[i.b(),i.is("closable",o),i.m(_),i.m(r.value),i.m(u),i.is("hit",g),i.is("round",s)]}),S=_=>{t("close",_)},m=_=>{t("click",_)};return(_,g)=>_.disableTransitions?(V(),oe("span",{key:0,class:te(G(x)),style:nt({backgroundColor:_.color}),onClick:m},[z("span",{class:te(G(i).e("content"))},[Me(_.$slots,"default")],2),_.closable?(V(),ce(G(Ye),{key:0,class:te(G(i).e("close")),onClick:ze(S,["stop"])},{default:J(()=>[X(G(Wt))]),_:1},8,["class","onClick"])):se("v-if",!0)],6)):(V(),ce(ht,{key:1,name:`${G(i).namespace.value}-zoom-in-center`,appear:""},{default:J(()=>[z("span",{class:te(G(x)),style:nt({backgroundColor:_.color}),onClick:m},[z("span",{class:te(G(i).e("content"))},[Me(_.$slots,"default")],2),_.closable?(V(),ce(G(Ye),{key:0,class:te(G(i).e("close")),onClick:ze(S,["stop"])},{default:J(()=>[X(G(Wt))]),_:1},8,["class","onClick"])):se("v-if",!0)],6)]),_:3},8,["name"]))}});var Fi=pt(Bi,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tag/src/tag.vue"]]);const wi=Un(Fi),Ui=We({name:"ElCollapseTransition"}),ji=We({...Ui,setup(e){const t=ln("collapse-transition"),n={beforeEnter(r){r.dataset||(r.dataset={}),r.dataset.oldPaddingTop=r.style.paddingTop,r.dataset.oldPaddingBottom=r.style.paddingBottom,r.style.maxHeight=0,r.style.paddingTop=0,r.style.paddingBottom=0},enter(r){r.dataset.oldOverflow=r.style.overflow,r.scrollHeight!==0?(r.style.maxHeight=`${r.scrollHeight}px`,r.style.paddingTop=r.dataset.oldPaddingTop,r.style.paddingBottom=r.dataset.oldPaddingBottom):(r.style.maxHeight=0,r.style.paddingTop=r.dataset.oldPaddingTop,r.style.paddingBottom=r.dataset.oldPaddingBottom),r.style.overflow="hidden"},afterEnter(r){r.style.maxHeight="",r.style.overflow=r.dataset.oldOverflow},beforeLeave(r){r.dataset||(r.dataset={}),r.dataset.oldPaddingTop=r.style.paddingTop,r.dataset.oldPaddingBottom=r.style.paddingBottom,r.dataset.oldOverflow=r.style.overflow,r.style.maxHeight=`${r.scrollHeight}px`,r.style.overflow="hidden"},leave(r){r.scrollHeight!==0&&(r.style.maxHeight=0,r.style.paddingTop=0,r.style.paddingBottom=0)},afterLeave(r){r.style.maxHeight="",r.style.overflow=r.dataset.oldOverflow,r.style.paddingTop=r.dataset.oldPaddingTop,r.style.paddingBottom=r.dataset.oldPaddingBottom}};return(r,i)=>(V(),ce(ht,jn({name:G(t).b()},Jr(n)),{default:J(()=>[Me(r.$slots,"default")]),_:3},16,["name"]))}});var St=pt(ji,[["__file","/home/runner/work/element-plus/element-plus/packages/components/collapse-transition/src/collapse-transition.vue"]]);St.install=e=>{e.component(St.name,St)};const Ni=St,Vi=Ni,Gi=an({...qr,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0}}),Ki=Qr,zi=We({name:"ElDrawer",components:{ElOverlay:Nn,ElFocusTrap:Vn,ElIcon:Ye,Close:Wt},inheritAttrs:!1,props:Gi,emits:Ki,setup(e,{slots:t}){_n({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},me(()=>!!t.title)),_n({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},me(()=>!!e.customClass));const n=ee(),r=ee(),i=ln("drawer"),{t:x}=Zr(),S=me(()=>e.direction==="rtl"||e.direction==="ltr"),m=me(()=>ei(e.size));return{...ti(e,n),drawerRef:n,focusStartRef:r,isHorizontal:S,drawerSize:m,ns:i,t:x}}}),Wi=["aria-label","aria-labelledby","aria-describedby"],Hi=["id"],$i=["aria-label"],Yi=["id"];function Xi(e,t,n,r,i,x){const S=Ie("close"),m=Ie("el-icon"),_=Ie("el-focus-trap"),g=Ie("el-overlay");return V(),ce(ni,{to:"body",disabled:!e.appendToBody},[X(ht,{name:e.ns.b("fade"),onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,onBeforeLeave:e.beforeLeave,persisted:""},{default:J(()=>[Ve(X(g,{mask:e.modal,"overlay-class":e.modalClass,"z-index":e.zIndex,onClick:e.onModalClick},{default:J(()=>[X(_,{loop:"",trapped:e.visible,"focus-trap-el":e.drawerRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:J(()=>[z("div",jn({ref:"drawerRef","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:e.titleId,"aria-describedby":e.bodyId},e.$attrs,{class:[e.ns.b(),e.direction,e.visible&&"open",e.customClass],style:e.isHorizontal?"width: "+e.drawerSize:"height: "+e.drawerSize,role:"dialog",onClick:t[1]||(t[1]=ze(()=>{},["stop"]))}),[z("span",{ref:"focusStartRef",class:te(e.ns.e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?(V(),oe("header",{key:0,class:te(e.ns.e("header"))},[e.$slots.title?Me(e.$slots,"title",{key:1},()=>[se(" DEPRECATED SLOT ")]):Me(e.$slots,"header",{key:0,close:e.handleClose,titleId:e.titleId,titleClass:e.ns.e("title")},()=>[e.$slots.title?se("v-if",!0):(V(),oe("span",{key:0,id:e.titleId,role:"heading",class:te(e.ns.e("title"))},he(e.title),11,Hi))]),e.showClose?(V(),oe("button",{key:2,"aria-label":e.t("el.drawer.close"),class:te(e.ns.e("close-btn")),type:"button",onClick:t[0]||(t[0]=(...u)=>e.handleClose&&e.handleClose(...u))},[X(m,{class:te(e.ns.e("close"))},{default:J(()=>[X(S)]),_:1},8,["class"])],10,$i)):se("v-if",!0)],2)):se("v-if",!0),e.rendered?(V(),oe("div",{key:1,id:e.bodyId,class:te(e.ns.e("body"))},[Me(e.$slots,"default")],10,Yi)):se("v-if",!0),e.$slots.footer?(V(),oe("div",{key:2,class:te(e.ns.e("footer"))},[Me(e.$slots,"footer")],2)):se("v-if",!0)],16,Wi)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[Ge,e.visible]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}var Ji=pt(zi,[["render",Xi],["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const qi=Un(Ji),Qi=We({name:"ElMessageBox",directives:{TrapFocus:ki},components:{ElButton:it,ElFocusTrap:Vn,ElInput:Ut,ElOverlay:Nn,ElIcon:Ye,...ri},inheritAttrs:!1,props:{buttonSize:{type:String,validator:ii},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,roundButton:{default:!1,type:Boolean},container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(e,{emit:t}){const{locale:n,zIndex:r,ns:i,size:x}=Gn("message-box",me(()=>e.buttonSize)),{t:S}=n,{nextZIndex:m}=r,_=ee(!1),g=xt({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:null,inputValidator:null,inputErrorMessage:"",message:null,modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:m()}),u=me(()=>{const k=g.type;return{[i.bm("icon",k)]:k&&Dt[k]}}),o=mn(),s=mn(),v=me(()=>g.icon||Dt[g.type]||""),c=me(()=>!!g.message),p=ee(),y=ee(),f=ee(),l=ee(),h=ee(),d=me(()=>g.confirmButtonClass);It(()=>g.inputValue,async k=>{await ke(),e.boxType==="prompt"&&k!==null&&O()},{immediate:!0}),It(()=>_.value,k=>{var I,F;k&&(e.boxType!=="prompt"&&(g.autofocus?f.value=(F=(I=h.value)==null?void 0:I.$el)!=null?F:p.value:f.value=p.value),g.zIndex=m()),e.boxType==="prompt"&&(k?ke().then(()=>{var q;l.value&&l.value.$el&&(g.autofocus?f.value=(q=R())!=null?q:p.value:f.value=p.value)}):(g.editorErrorMessage="",g.validateError=!1))});const a=me(()=>e.draggable);si(p,y,a),jt(async()=>{await ke(),e.closeOnHashChange&&window.addEventListener("hashchange",E)}),oi(()=>{e.closeOnHashChange&&window.removeEventListener("hashchange",E)});function E(){_.value&&(_.value=!1,ke(()=>{g.action&&t("action",g.action)}))}const C=()=>{e.closeOnClickModal&&T(g.distinguishCancelAndClose?"close":"cancel")},b=ui(C),A=k=>{if(g.inputType!=="textarea")return k.preventDefault(),T("confirm")},T=k=>{var I;e.boxType==="prompt"&&k==="confirm"&&!O()||(g.action=k,g.beforeClose?(I=g.beforeClose)==null||I.call(g,k,g,E):E())},O=()=>{if(e.boxType==="prompt"){const k=g.inputPattern;if(k&&!k.test(g.inputValue||""))return g.editorErrorMessage=g.inputErrorMessage||S("el.messagebox.error"),g.validateError=!0,!1;const I=g.inputValidator;if(typeof I=="function"){const F=I(g.inputValue);if(F===!1)return g.editorErrorMessage=g.inputErrorMessage||S("el.messagebox.error"),g.validateError=!0,!1;if(typeof F=="string")return g.editorErrorMessage=F,g.validateError=!0,!1}}return g.editorErrorMessage="",g.validateError=!1,!0},R=()=>{const k=l.value.$refs;return k.input||k.textarea},L=()=>{T("close")},P=()=>{e.closeOnPressEscape&&L()};return e.lockScroll&&ai(_),{...li(g),ns:i,overlayEvent:b,visible:_,hasMessage:c,typeClass:u,contentId:o,inputId:s,btnSize:x,iconComponent:v,confirmButtonClasses:d,rootRef:p,focusStartRef:f,headerRef:y,inputRef:l,confirmRef:h,doClose:E,handleClose:L,onCloseRequested:P,handleWrapperClick:C,handleInputEnter:A,handleAction:T,t:S}}}),Zi=["aria-label","aria-describedby"],es=["aria-label"],ts=["id"];function ns(e,t,n,r,i,x){const S=Ie("el-icon"),m=Ie("close"),_=Ie("el-input"),g=Ie("el-button"),u=Ie("el-focus-trap"),o=Ie("el-overlay");return V(),ce(ht,{name:"fade-in-linear",onAfterLeave:t[11]||(t[11]=s=>e.$emit("vanish")),persisted:""},{default:J(()=>[Ve(X(o,{"z-index":e.zIndex,"overlay-class":[e.ns.is("message-box"),e.modalClass],mask:e.modal},{default:J(()=>[z("div",{role:"dialog","aria-label":e.title,"aria-modal":"true","aria-describedby":e.showInput?void 0:e.contentId,class:te(`${e.ns.namespace.value}-overlay-message-box`),onClick:t[8]||(t[8]=(...s)=>e.overlayEvent.onClick&&e.overlayEvent.onClick(...s)),onMousedown:t[9]||(t[9]=(...s)=>e.overlayEvent.onMousedown&&e.overlayEvent.onMousedown(...s)),onMouseup:t[10]||(t[10]=(...s)=>e.overlayEvent.onMouseup&&e.overlayEvent.onMouseup(...s))},[X(u,{loop:"",trapped:e.visible,"focus-trap-el":e.rootRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:J(()=>[z("div",{ref:"rootRef",class:te([e.ns.b(),e.customClass,e.ns.is("draggable",e.draggable),{[e.ns.m("center")]:e.center}]),style:nt(e.customStyle),tabindex:"-1",onClick:t[7]||(t[7]=ze(()=>{},["stop"]))},[e.title!==null&&e.title!==void 0?(V(),oe("div",{key:0,ref:"headerRef",class:te(e.ns.e("header"))},[z("div",{class:te(e.ns.e("title"))},[e.iconComponent&&e.center?(V(),ce(S,{key:0,class:te([e.ns.e("status"),e.typeClass])},{default:J(()=>[(V(),ce(ut(e.iconComponent)))]),_:1},8,["class"])):se("v-if",!0),z("span",null,he(e.title),1)],2),e.showClose?(V(),oe("button",{key:0,type:"button",class:te(e.ns.e("headerbtn")),"aria-label":e.t("el.messagebox.close"),onClick:t[0]||(t[0]=s=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel")),onKeydown:t[1]||(t[1]=gt(ze(s=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),["prevent"]),["enter"]))},[X(S,{class:te(e.ns.e("close"))},{default:J(()=>[X(m)]),_:1},8,["class"])],42,es)):se("v-if",!0)],2)):se("v-if",!0),z("div",{id:e.contentId,class:te(e.ns.e("content"))},[z("div",{class:te(e.ns.e("container"))},[e.iconComponent&&!e.center&&e.hasMessage?(V(),ce(S,{key:0,class:te([e.ns.e("status"),e.typeClass])},{default:J(()=>[(V(),ce(ut(e.iconComponent)))]),_:1},8,["class"])):se("v-if",!0),e.hasMessage?(V(),oe("div",{key:1,class:te(e.ns.e("message"))},[Me(e.$slots,"default",{},()=>[e.dangerouslyUseHTMLString?(V(),ce(ut(e.showInput?"label":"p"),{key:1,for:e.showInput?e.inputId:void 0,innerHTML:e.message},null,8,["for","innerHTML"])):(V(),ce(ut(e.showInput?"label":"p"),{key:0,for:e.showInput?e.inputId:void 0},{default:J(()=>[_e(he(e.dangerouslyUseHTMLString?"":e.message),1)]),_:1},8,["for"]))])],2)):se("v-if",!0)],2),Ve(z("div",{class:te(e.ns.e("input"))},[X(_,{id:e.inputId,ref:"inputRef",modelValue:e.inputValue,"onUpdate:modelValue":t[2]||(t[2]=s=>e.inputValue=s),type:e.inputType,placeholder:e.inputPlaceholder,"aria-invalid":e.validateError,class:te({invalid:e.validateError}),onKeydown:gt(e.handleInputEnter,["enter"])},null,8,["id","modelValue","type","placeholder","aria-invalid","class","onKeydown"]),z("div",{class:te(e.ns.e("errormsg")),style:nt({visibility:e.editorErrorMessage?"visible":"hidden"})},he(e.editorErrorMessage),7)],2),[[Ge,e.showInput]])],10,ts),z("div",{class:te(e.ns.e("btns"))},[e.showCancelButton?(V(),ce(g,{key:0,loading:e.cancelButtonLoading,class:te([e.cancelButtonClass]),round:e.roundButton,size:e.btnSize,onClick:t[3]||(t[3]=s=>e.handleAction("cancel")),onKeydown:t[4]||(t[4]=gt(ze(s=>e.handleAction("cancel"),["prevent"]),["enter"]))},{default:J(()=>[_e(he(e.cancelButtonText||e.t("el.messagebox.cancel")),1)]),_:1},8,["loading","class","round","size"])):se("v-if",!0),Ve(X(g,{ref:"confirmRef",type:"primary",loading:e.confirmButtonLoading,class:te([e.confirmButtonClasses]),round:e.roundButton,disabled:e.confirmButtonDisabled,size:e.btnSize,onClick:t[5]||(t[5]=s=>e.handleAction("confirm")),onKeydown:t[6]||(t[6]=gt(ze(s=>e.handleAction("confirm"),["prevent"]),["enter"]))},{default:J(()=>[_e(he(e.confirmButtonText||e.t("el.messagebox.confirm")),1)]),_:1},8,["loading","class","round","disabled","size"]),[[Ge,e.showConfirmButton]])],2)],6)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,Zi)]),_:3},8,["z-index","overlay-class","mask"]),[[Ge,e.visible]])]),_:3})}var rs=pt(Qi,[["render",ns],["__file","/home/runner/work/element-plus/element-plus/packages/components/message-box/src/index.vue"]]);const dt=new Map,is=e=>{let t=document.body;return e.appendTo&&(un(e.appendTo)&&(t=document.querySelector(e.appendTo)),Bt(e.appendTo)&&(t=e.appendTo),Bt(t)||(t=document.body)),t},ss=(e,t,n=null)=>{const r=X(rs,e,vn(e.message)||ft(e.message)?{default:vn(e.message)?e.message:()=>e.message}:null);return r.appContext=n,Mt(r,t),is(e).appendChild(t.firstElementChild),r.component},os=()=>document.createElement("div"),as=(e,t)=>{const n=os();e.onVanish=()=>{Mt(null,n),dt.delete(i)},e.onAction=x=>{const S=dt.get(i);let m;e.showInput?m={value:i.inputValue,action:x}:m=x,e.callback?e.callback(m,r.proxy):x==="cancel"||x==="close"?e.distinguishCancelAndClose&&x!=="cancel"?S.reject("close"):S.reject("cancel"):S.resolve(m)};const r=ss(e,n,t),i=r.proxy;for(const x in e)gn(e,x)&&!gn(i.$props,x)&&(i[x]=e[x]);return i.visible=!0,i};function st(e,t=null){if(!Kn)return Promise.reject();let n;return un(e)||ft(e)?e={message:e}:n=e.callback,new Promise((r,i)=>{const x=as(e,t??st._context);dt.set(x,{options:e,callback:n,resolve:r,reject:i})})}const ls=["alert","confirm","prompt"],us={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};ls.forEach(e=>{st[e]=cs(e)});function cs(e){return(t,n,r,i)=>{let x="";return ci(n)?(r=n,x=""):fi(n)?x="":x=n,st(Object.assign({title:x,message:t,type:"",...us[e]},r,{boxType:e}),i)}}st.close=()=>{dt.forEach((e,t)=>{t.doClose()}),dt.clear()};st._context=null;const Ke=st;Ke.install=e=>{Ke._context=e._context,e.config.globalProperties.$msgbox=Ke,e.config.globalProperties.$messageBox=Ke,e.config.globalProperties.$alert=Ke.alert,e.config.globalProperties.$confirm=Ke.confirm,e.config.globalProperties.$prompt=Ke.prompt};const He=Ke,$n=["success","info","warning","error"],fs=an({customClass:{type:String,default:""},dangerouslyUseHTMLString:{type:Boolean,default:!1},duration:{type:Number,default:4500},icon:{type:di},id:{type:String,default:""},message:{type:zt([String,Object]),default:""},offset:{type:Number,default:0},onClick:{type:zt(Function),default:()=>{}},onClose:{type:zt(Function),required:!0},position:{type:String,values:["top-right","top-left","bottom-right","bottom-left"],default:"top-right"},showClose:{type:Boolean,default:!0},title:{type:String,default:""},type:{type:String,values:[...$n,""],default:""},zIndex:Number}),ds={destroy:()=>!0},hs=["id"],ps=["textContent"],_s={key:0},ms=["innerHTML"],gs=We({name:"ElNotification"}),vs=We({...gs,props:fs,emits:ds,setup(e,{expose:t}){const n=e,{ns:r,zIndex:i}=Gn("notification"),{nextZIndex:x,currentZIndex:S}=i,{Close:m}=pi,_=ee(!1);let g;const u=me(()=>{const h=n.type;return h&&Dt[n.type]?r.m(h):""}),o=me(()=>n.type&&Dt[n.type]||n.icon),s=me(()=>n.position.endsWith("right")?"right":"left"),v=me(()=>n.position.startsWith("top")?"top":"bottom"),c=me(()=>{var h;return{[v.value]:`${n.offset}px`,zIndex:(h=n.zIndex)!=null?h:S.value}});function p(){n.duration>0&&({stop:g}=_i(()=>{_.value&&f()},n.duration))}function y(){g==null||g()}function f(){_.value=!1}function l({code:h}){h===Et.delete||h===Et.backspace?y():h===Et.esc?_.value&&f():p()}return jt(()=>{p(),x(),_.value=!0}),hi(document,"keydown",l),t({visible:_,close:f}),(h,d)=>(V(),ce(ht,{name:G(r).b("fade"),onBeforeLeave:h.onClose,onAfterLeave:d[1]||(d[1]=a=>h.$emit("destroy")),persisted:""},{default:J(()=>[Ve(z("div",{id:h.id,class:te([G(r).b(),h.customClass,G(s)]),style:nt(G(c)),role:"alert",onMouseenter:y,onMouseleave:p,onClick:d[0]||(d[0]=(...a)=>h.onClick&&h.onClick(...a))},[G(o)?(V(),ce(G(Ye),{key:0,class:te([G(r).e("icon"),G(u)])},{default:J(()=>[(V(),ce(ut(G(o))))]),_:1},8,["class"])):se("v-if",!0),z("div",{class:te(G(r).e("group"))},[z("h2",{class:te(G(r).e("title")),textContent:he(h.title)},null,10,ps),Ve(z("div",{class:te(G(r).e("content")),style:nt(h.title?void 0:{margin:0})},[Me(h.$slots,"default",{},()=>[h.dangerouslyUseHTMLString?(V(),oe(we,{key:1},[se(" Caution here, message could've been compromised, never use user's input as message "),z("p",{innerHTML:h.message},null,8,ms)],2112)):(V(),oe("p",_s,he(h.message),1))])],6),[[Ge,h.message]]),h.showClose?(V(),ce(G(Ye),{key:0,class:te(G(r).e("closeBtn")),onClick:ze(f,["stop"])},{default:J(()=>[X(G(m))]),_:1},8,["class","onClick"])):se("v-if",!0)],2)],46,hs),[[Ge,_.value]])]),_:3},8,["name","onBeforeLeave"]))}});var ys=pt(vs,[["__file","/home/runner/work/element-plus/element-plus/packages/components/notification/src/notification.vue"]]);const wt={"top-left":[],"top-right":[],"bottom-left":[],"bottom-right":[]},Yt=16;let Es=1;const rt=function(e={},t=null){if(!Kn)return{close:()=>{}};(typeof e=="string"||ft(e))&&(e={message:e});const n=e.position||"top-right";let r=e.offset||0;wt[n].forEach(({vm:u})=>{var o;r+=(((o=u.el)==null?void 0:o.offsetHeight)||0)+Yt}),r+=Yt;const i=`notification_${Es++}`,x=e.onClose,S={...e,offset:r,id:i,onClose:()=>{xs(i,n,x)}};let m=document.body;Bt(e.appendTo)?m=e.appendTo:un(e.appendTo)&&(m=document.querySelector(e.appendTo)),Bt(m)||(m=document.body);const _=document.createElement("div"),g=X(ys,S,ft(S.message)?{default:()=>S.message}:null);return g.appContext=t??rt._context,g.props.onDestroy=()=>{Mt(null,_)},Mt(g,_),wt[n].push({vm:g}),m.appendChild(_.firstElementChild),{close:()=>{g.component.exposed.visible.value=!1}}};$n.forEach(e=>{rt[e]=(t={})=>((typeof t=="string"||ft(t))&&(t={message:t}),rt({...t,type:e}))});function xs(e,t,n){const r=wt[t],i=r.findIndex(({vm:g})=>{var u;return((u=g.component)==null?void 0:u.props.id)===e});if(i===-1)return;const{vm:x}=r[i];if(!x)return;n==null||n(x);const S=x.el.offsetHeight,m=t.split("-")[0];r.splice(i,1);const _=r.length;if(!(_<1))for(let g=i;g<_;g++){const{el:u,component:o}=r[g].vm,s=Number.parseInt(u.style[m],10)-S-Yt;o.props.offset=s}}function Ss(){for(const e of Object.values(wt))e.forEach(({vm:t})=>{t.component.exposed.visible.value=!1})}rt.closeAll=Ss;rt._context=null;const Cs=mi(rt,"$notify");const je=Object.create(null);je.open="0";je.close="1";je.ping="2";je.pong="3";je.message="4";je.upgrade="5";je.noop="6";const Ct=Object.create(null);Object.keys(je).forEach(e=>{Ct[je[e]]=e});const bs={type:"error",data:"parser error"},Rs=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Ts=typeof ArrayBuffer=="function",Ls=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Yn=({type:e,data:t},n,r)=>Rs&&t instanceof Blob?n?r(t):xn(t,r):Ts&&(t instanceof ArrayBuffer||Ls(t))?n?r(t):xn(new Blob([t]),r):r(je[e]+(t||"")),xn=(e,t)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];t("b"+(r||""))},n.readAsDataURL(e)},Sn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ct=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<Sn.length;e++)ct[Sn.charCodeAt(e)]=e;const As=e=>{let t=e.length*.75,n=e.length,r,i=0,x,S,m,_;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const g=new ArrayBuffer(t),u=new Uint8Array(g);for(r=0;r<n;r+=4)x=ct[e.charCodeAt(r)],S=ct[e.charCodeAt(r+1)],m=ct[e.charCodeAt(r+2)],_=ct[e.charCodeAt(r+3)],u[i++]=x<<2|S>>4,u[i++]=(S&15)<<4|m>>2,u[i++]=(m&3)<<6|_&63;return g},Os=typeof ArrayBuffer=="function",Xn=(e,t)=>{if(typeof e!="string")return{type:"message",data:Jn(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:Ps(e.substring(1),t)}:Ct[n]?e.length>1?{type:Ct[n],data:e.substring(1)}:{type:Ct[n]}:bs},Ps=(e,t)=>{if(Os){const n=As(e);return Jn(n,t)}else return{base64:!0,data:e}},Jn=(e,t)=>{switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}},qn=String.fromCharCode(30),ks=(e,t)=>{const n=e.length,r=new Array(n);let i=0;e.forEach((x,S)=>{Yn(x,!1,m=>{r[S]=m,++i===n&&t(r.join(qn))})})},Ds=(e,t)=>{const n=e.split(qn),r=[];for(let i=0;i<n.length;i++){const x=Xn(n[i],t);if(r.push(x),x.type==="error")break}return r},Qn=4;function ge(e){if(e)return Is(e)}function Is(e){for(var t in ge.prototype)e[t]=ge.prototype[t];return e}ge.prototype.on=ge.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};ge.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};ge.prototype.off=ge.prototype.removeListener=ge.prototype.removeAllListeners=ge.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+e],this};ge.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this};ge.prototype.emitReserved=ge.prototype.emit;ge.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};ge.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Pe=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Zn(e,...t){return t.reduce((n,r)=>(e.hasOwnProperty(r)&&(n[r]=e[r]),n),{})}const Ms=Pe.setTimeout,Bs=Pe.clearTimeout;function Nt(e,t){t.useNativeTimers?(e.setTimeoutFn=Ms.bind(Pe),e.clearTimeoutFn=Bs.bind(Pe)):(e.setTimeoutFn=Pe.setTimeout.bind(Pe),e.clearTimeoutFn=Pe.clearTimeout.bind(Pe))}const Fs=1.33;function ws(e){return typeof e=="string"?Us(e):Math.ceil((e.byteLength||e.size)*Fs)}function Us(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}class js extends Error{constructor(t,n,r){super(t),this.description=n,this.context=r,this.type="TransportError"}}class er extends ge{constructor(t){super(),this.writable=!1,Nt(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,n,r){return super.emitReserved("error",new js(t,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=Xn(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}}const tr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Xt=64,Ns={};let Cn=0,vt=0,bn;function Rn(e){let t="";do t=tr[e%Xt]+t,e=Math.floor(e/Xt);while(e>0);return t}function nr(){const e=Rn(+new Date);return e!==bn?(Cn=0,bn=e):e+"."+Rn(Cn++)}for(;vt<Xt;vt++)Ns[tr[vt]]=vt;function rr(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function Vs(e){let t={},n=e.split("&");for(let r=0,i=n.length;r<i;r++){let x=n[r].split("=");t[decodeURIComponent(x[0])]=decodeURIComponent(x[1])}return t}let ir=!1;try{ir=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Gs=ir;function sr(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Gs))return new XMLHttpRequest}catch{}if(!t)try{return new Pe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Ks(){}const zs=function(){return new sr({xdomain:!1}).responseType!=null}();class Ws extends er{constructor(t){if(super(t),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||i!==t.port,this.xs=t.secure!==r}const n=t&&t.forceBase64;this.supportsBinary=zs&&!n}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};Ds(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,ks(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.query||{};const n=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=nr()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.opts.port&&(n==="https"&&Number(this.opts.port)!==443||n==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=rr(t),x=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(x?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Ue(this.uri(),t)}doWrite(t,n){const r=this.request({method:"POST",data:t});r.on("success",n),r.on("error",(i,x)=>{this.onError("xhr post error",i,x)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=t}}class Ue extends ge{constructor(t,n){super(),Nt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=t,this.async=n.async!==!1,this.data=n.data!==void 0?n.data:null,this.create()}create(){const t=Zn(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const n=this.xhr=new sr(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=Ue.requestsCount++,Ue.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Ks,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Ue.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Ue.requestsCount=0;Ue.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Tn);else if(typeof addEventListener=="function"){const e="onpagehide"in Pe?"pagehide":"unload";addEventListener(e,Tn,!1)}}function Tn(){for(let e in Ue.requests)Ue.requests.hasOwnProperty(e)&&Ue.requests[e].abort()}const or=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0))(),yt=Pe.WebSocket||Pe.MozWebSocket,Ln=!0,Hs="arraybuffer",An=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class $s extends er{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),n=this.opts.protocols,r=An?{}:Zn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Ln&&!An?n?new yt(t,n):new yt(t):new yt(t,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||Hs,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const r=t[n],i=n===t.length-1;Yn(r,this.supportsBinary,x=>{const S={};try{Ln&&this.ws.send(x)}catch{}i&&or(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const n=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(n==="wss"&&Number(this.opts.port)!==443||n==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=nr()),this.supportsBinary||(t.b64=1);const i=rr(t),x=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(x?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!yt}}const Ys={websocket:$s,polling:Ws},Xs=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Js=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Jt(e){const t=e,n=e.indexOf("["),r=e.indexOf("]");n!=-1&&r!=-1&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let i=Xs.exec(e||""),x={},S=14;for(;S--;)x[Js[S]]=i[S]||"";return n!=-1&&r!=-1&&(x.source=t,x.host=x.host.substring(1,x.host.length-1).replace(/;/g,":"),x.authority=x.authority.replace("[","").replace("]","").replace(/;/g,":"),x.ipv6uri=!0),x.pathNames=qs(x,x.path),x.queryKey=Qs(x,x.query),x}function qs(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&r.splice(0,1),t.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Qs(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,x){i&&(n[i]=x)}),n}let ar=class Qe extends ge{constructor(t,n={}){super(),this.writeBuffer=[],t&&typeof t=="object"&&(n=t,t=null),t?(t=Jt(t),n.hostname=t.host,n.secure=t.protocol==="https"||t.protocol==="wss",n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=Jt(n.host).host),Nt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Vs(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=Qn,n.transport=t,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts.transportOptions[t],this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Ys[t](r)}open(){let t;if(this.opts.rememberUpgrade&&Qe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch{this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(t){let n=this.createTransport(t),r=!1;Qe.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",o=>{if(!r)if(o.type==="pong"&&o.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Qe.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const s=new Error("probe error");s.transport=n.name,this.emitReserved("upgradeError",s)}}))};function x(){r||(r=!0,u(),n.close(),n=null)}const S=o=>{const s=new Error("probe error: "+o);s.transport=n.name,x(),this.emitReserved("upgradeError",s)};function m(){S("transport closed")}function _(){S("socket closed")}function g(o){n&&o.name!==n.name&&x()}const u=()=>{n.removeListener("open",i),n.removeListener("error",S),n.removeListener("close",m),this.off("close",_),this.off("upgrading",g)};n.once("open",i),n.once("error",S),n.once("close",m),this.once("close",_),this.once("upgrading",g),n.open()}onOpen(){if(this.readyState="open",Qe.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let t=0;const n=this.upgrades.length;for(;t<n;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=t.data,this.onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=ws(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(t,n,r){return this.sendPacket("message",t,n,r),this}send(t,n,r){return this.sendPacket("message",t,n,r),this}sendPacket(t,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const x={type:t,data:n,options:r};this.emitReserved("packetCreate",x),this.writeBuffer.push(x),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():t()}):this.upgrading?r():t()),this}onError(t){Qe.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const n=[];let r=0;const i=t.length;for(;r<i;r++)~this.transports.indexOf(t[r])&&n.push(t[r]);return n}};ar.protocol=Qn;function Zs(e,t="",n){let r=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),r=Jt(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const x=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+x+":"+r.port+t,r.href=r.protocol+"://"+x+(n&&n.port===r.port?"":":"+r.port),r}const eo=typeof ArrayBuffer=="function",to=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,lr=Object.prototype.toString,no=typeof Blob=="function"||typeof Blob<"u"&&lr.call(Blob)==="[object BlobConstructor]",ro=typeof File=="function"||typeof File<"u"&&lr.call(File)==="[object FileConstructor]";function dn(e){return eo&&(e instanceof ArrayBuffer||to(e))||no&&e instanceof Blob||ro&&e instanceof File}function bt(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,r=e.length;n<r;n++)if(bt(e[n]))return!0;return!1}if(dn(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return bt(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&bt(e[n]))return!0;return!1}function io(e){const t=[],n=e.data,r=e;return r.data=qt(n,t),r.attachments=t.length,{packet:r,buffers:t}}function qt(e,t){if(!e)return e;if(dn(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=qt(e[r],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=qt(e[r],t));return n}return e}function so(e,t){return e.data=Qt(e.data,t),delete e.attachments,e}function Qt(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Qt(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Qt(e[n],t));return e}const oo=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ao=5;var ie;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(ie||(ie={}));class lo{constructor(t){this.replacer=t}encode(t){return(t.type===ie.EVENT||t.type===ie.ACK)&&bt(t)?this.encodeAsBinary({type:t.type===ie.EVENT?ie.BINARY_EVENT:ie.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===ie.BINARY_EVENT||t.type===ie.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=io(t),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}function On(e){return Object.prototype.toString.call(e)==="[object Object]"}class hn extends ge{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const r=n.type===ie.BINARY_EVENT;r||n.type===ie.BINARY_ACK?(n.type=r?ie.EVENT:ie.ACK,this.reconstructor=new uo(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(dn(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const r={type:Number(t.charAt(0))};if(ie[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===ie.BINARY_EVENT||r.type===ie.BINARY_ACK){const x=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const S=t.substring(x,n);if(S!=Number(S)||t.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(S)}if(t.charAt(n+1)==="/"){const x=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););r.nsp=t.substring(x,n)}else r.nsp="/";const i=t.charAt(n+1);if(i!==""&&Number(i)==i){const x=n+1;for(;++n;){const S=t.charAt(n);if(S==null||Number(S)!=S){--n;break}if(n===t.length)break}r.id=Number(t.substring(x,n+1))}if(t.charAt(++n)){const x=this.tryParse(t.substr(n));if(hn.isPayloadValid(r.type,x))r.data=x;else throw new Error("invalid payload")}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case ie.CONNECT:return On(n);case ie.DISCONNECT:return n===void 0;case ie.CONNECT_ERROR:return typeof n=="string"||On(n);case ie.EVENT:case ie.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&oo.indexOf(n[0])===-1);case ie.ACK:case ie.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class uo{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=so(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const co=Object.freeze(Object.defineProperty({__proto__:null,Decoder:hn,Encoder:lo,get PacketType(){return ie},protocol:ao},Symbol.toStringTag,{value:"Module"}));function De(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const fo=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ur extends ge{constructor(t,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[De(t,"open",this.onopen.bind(this)),De(t,"packet",this.onpacket.bind(this)),De(t,"error",this.onerror.bind(this)),De(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){if(fo.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const r={type:ie.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const S=this.ids++,m=n.pop();this._registerAckCallback(S,m),r.id=S}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(t,n){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[t]=n;return}const x=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let S=0;S<this.sendBuffer.length;S++)this.sendBuffer[S].id===t&&this.sendBuffer.splice(S,1);n.call(this,new Error("operation has timed out"))},i);this.acks[t]=(...S)=>{this.io.clearTimeoutFn(x),n.apply(this,[null,...S])}}emitWithAck(t,...n){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,x)=>{n.push((S,m)=>r?S?x(S):i(m):i(S)),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...x)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...x)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:ie.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case ie.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ie.EVENT:case ie.BINARY_EVENT:this.onevent(t);break;case ie.ACK:case ie.BINARY_ACK:this.onack(t);break;case ie.DISCONNECT:this.ondisconnect();break;case ie.CONNECT_ERROR:this.destroy();const r=new Error(t.data.message);r.data=t.data.data,this.emitReserved("connect_error",r);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:ie.ACK,id:t,data:i}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(n.apply(this,t.data),delete this.acks[t.id])}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ie.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,t.data)}}}function ot(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}ot.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0};ot.prototype.reset=function(){this.attempts=0};ot.prototype.setMin=function(e){this.ms=e};ot.prototype.setMax=function(e){this.max=e};ot.prototype.setJitter=function(e){this.jitter=e};class Zt extends ge{constructor(t,n){var r;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Nt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new ot({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||co;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new ar(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=De(n,"open",function(){r.onopen(),t&&t()}),x=De(n,"error",S=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",S),t?t(S):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const S=this._timeout;S===0&&i();const m=this.setTimeoutFn(()=>{i(),n.close(),n.emit("error",new Error("timeout"))},S);this.opts.autoUnref&&m.unref(),this.subs.push(function(){clearTimeout(m)})}return this.subs.push(i),this.subs.push(x),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(De(t,"ping",this.onping.bind(this)),De(t,"data",this.ondata.bind(this)),De(t,"error",this.onerror.bind(this)),De(t,"close",this.onclose.bind(this)),De(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){or(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let r=this.nsps[t];return r?this._autoConnect&&!r.active&&r.connect():(r=new ur(this,t,n),this.nsps[t]=r),r}_destroy(t){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let r=0;r<n.length;r++)this.engine.write(n[r],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const at={};function Rt(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=Zs(e,t.path||"/socket.io"),r=n.source,i=n.id,x=n.path,S=at[i]&&x in at[i].nsps,m=t.forceNew||t["force new connection"]||t.multiplex===!1||S;let _;return m?_=new Zt(r,t):(at[i]||(at[i]=new Zt(r,t)),_=at[i]),n.query&&!t.query&&(t.query=n.queryKey),_.socket(n.path,t)}Object.assign(Rt,{Manager:Zt,Socket:ur,io:Rt,connect:Rt});let ae=null;const ho=({query:e})=>new Promise(t=>{ae=Rt("wss://121.36.99.231:3000",{reconnection:!0,forceNew:!0,transports:["websocket"],query:e,auth:{token:"Bearer "+localStorage.getItem("live_token")}}),ae.on("connect",()=>{t(),console.log(ae.id,"监听客户端连接成功-connect")})});let cr=!0,fr=!0;function Tt(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Xe(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(S,m){if(S!==t)return i.apply(this,arguments);const _=g=>{const u=n(g);u&&(m.handleEvent?m.handleEvent(u):m(u))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(m,_),i.apply(this,[S,_])};const x=r.removeEventListener;r.removeEventListener=function(S,m){if(S!==t||!this._eventMap||!this._eventMap[t])return x.apply(this,arguments);if(!this._eventMap[t].has(m))return x.apply(this,arguments);const _=this._eventMap[t].get(m);return this._eventMap[t].delete(m),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,x.apply(this,[S,_])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(S){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),S&&this.addEventListener(t,this["_on"+t]=S)},enumerable:!0,configurable:!0})}function po(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(cr=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function _o(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(fr=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function dr(){if(typeof window=="object"){if(cr)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function pn(e,t){fr&&console.warn(e+" is deprecated, please use "+t+" instead.")}function mo(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Tt(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Tt(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=Tt(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function Pn(e){return Object.prototype.toString.call(e)==="[object Object]"}function hr(e){return Pn(e)?Object.keys(e).reduce(function(t,n){const r=Pn(e[n]),i=r?hr(e[n]):e[n],x=r&&!Object.keys(i).length;return i===void 0||x?t:Object.assign(t,{[n]:i})},{}):e}function en(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?en(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{en(e,e.get(i),n)})}))}function kn(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const x=[];return e.forEach(S=>{S.type==="track"&&S.trackIdentifier===t.id&&x.push(S)}),x.forEach(S=>{e.forEach(m=>{m.type===r&&m.trackId===S.id&&en(e,m,i)})}),i}const Dn=dr;function pr(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(m){if(typeof m!="object"||m.mandatory||m.optional)return m;const _={};return Object.keys(m).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const u=typeof m[g]=="object"?m[g]:{ideal:m[g]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const o=function(s,v){return s?s+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(u.ideal!==void 0){_.optional=_.optional||[];let s={};typeof u.ideal=="number"?(s[o("min",g)]=u.ideal,_.optional.push(s),s={},s[o("max",g)]=u.ideal,_.optional.push(s)):(s[o("",g)]=u.ideal,_.optional.push(s))}u.exact!==void 0&&typeof u.exact!="number"?(_.mandatory=_.mandatory||{},_.mandatory[o("",g)]=u.exact):["min","max"].forEach(s=>{u[s]!==void 0&&(_.mandatory=_.mandatory||{},_.mandatory[o(s,g)]=u[s])})}),m.advanced&&(_.optional=(_.optional||[]).concat(m.advanced)),_},i=function(m,_){if(t.version>=61)return _(m);if(m=JSON.parse(JSON.stringify(m)),m&&typeof m.audio=="object"){const g=function(u,o,s){o in u&&!(s in u)&&(u[s]=u[o],delete u[o])};m=JSON.parse(JSON.stringify(m)),g(m.audio,"autoGainControl","googAutoGainControl"),g(m.audio,"noiseSuppression","googNoiseSuppression"),m.audio=r(m.audio)}if(m&&typeof m.video=="object"){let g=m.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const u=t.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete m.video.facingMode;let o;if(g.exact==="environment"||g.ideal==="environment"?o=["back","rear"]:(g.exact==="user"||g.ideal==="user")&&(o=["front"]),o)return n.mediaDevices.enumerateDevices().then(s=>{s=s.filter(c=>c.kind==="videoinput");let v=s.find(c=>o.some(p=>c.label.toLowerCase().includes(p)));return!v&&s.length&&o.includes("back")&&(v=s[s.length-1]),v&&(m.video.deviceId=g.exact?{exact:v.deviceId}:{ideal:v.deviceId}),m.video=r(m.video),Dn("chrome: "+JSON.stringify(m)),_(m)})}m.video=r(m.video)}return Dn("chrome: "+JSON.stringify(m)),_(m)},x=function(m){return t.version>=64?m:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[m.name]||m.name,message:m.message,constraint:m.constraint||m.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},S=function(m,_,g){i(m,u=>{n.webkitGetUserMedia(u,_,o=>{g&&g(x(o))})})};if(n.getUserMedia=S.bind(n),n.mediaDevices.getUserMedia){const m=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(_){return i(_,g=>m(g).then(u=>{if(g.audio&&!u.getAudioTracks().length||g.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(o=>{o.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(x(u))))}}}function go(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(i=>{const x=r.video&&r.video.width,S=r.video&&r.video.height,m=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:m||3}},x&&(r.video.mandatory.maxWidth=x),S&&(r.video.mandatory.maxHeight=S),e.navigator.mediaDevices.getUserMedia(r)})}}}function _r(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function mr(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let x;e.RTCPeerConnection.prototype.getReceivers?x=this.getReceivers().find(m=>m.track&&m.track.id===i.track.id):x={track:i.track};const S=new Event("track");S.track=i.track,S.receiver=x,S.transceiver={receiver:x},S.streams=[r.stream],this.dispatchEvent(S)}),r.stream.getTracks().forEach(i=>{let x;e.RTCPeerConnection.prototype.getReceivers?x=this.getReceivers().find(m=>m.track&&m.track.id===i.id):x={track:i};const S=new Event("track");S.track=i,S.receiver=x,S.transceiver={receiver:x},S.streams=[r.stream],this.dispatchEvent(S)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Xe(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function gr(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,x){return{track:x,get dtmf(){return this._dtmf===void 0&&(x.kind==="audio"?this._dtmf=i.createDTMFSender(x):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(m,_){let g=i.apply(this,arguments);return g||(g=t(this,m),this._senders.push(g)),g};const x=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(m){x.apply(this,arguments);const _=this._senders.indexOf(m);_!==-1&&this._senders.splice(_,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(x){this._senders=this._senders||[],n.apply(this,[x]),x.getTracks().forEach(S=>{this._senders.push(t(this,S))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(x){this._senders=this._senders||[],r.apply(this,[x]),x.getTracks().forEach(S=>{const m=this._senders.find(_=>_.track===S);m&&this._senders.splice(this._senders.indexOf(m),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function vr(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,i,x]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const S=function(_){const g={};return _.result().forEach(o=>{const s={id:o.id,timestamp:o.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[o.type]||o.type};o.names().forEach(v=>{s[v]=o.stat(v)}),g[s.id]=s}),g},m=function(_){return new Map(Object.keys(_).map(g=>[g,_[g]]))};if(arguments.length>=2){const _=function(g){i(m(S(g)))};return t.apply(this,[_,r])}return new Promise((_,g)=>{t.apply(this,[function(u){_(m(S(u)))},g])}).then(i,x)}}function yr(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const x=n.apply(this,[]);return x.forEach(S=>S._pc=this),x});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const x=r.apply(this,arguments);return x._pc=this,x}),e.RTCRtpSender.prototype.getStats=function(){const x=this;return this._pc.getStats().then(S=>kn(S,x.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(x=>x._pc=this),i}),Xe(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(x=>kn(x,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let i,x,S;return this.getSenders().forEach(m=>{m.track===r&&(i?S=!0:i=m)}),this.getReceivers().forEach(m=>(m.track===r&&(x?S=!0:x=m),m.track===r)),S||i&&x?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():x?x.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Er(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(S=>this._shimmedLocalStreams[S][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(S,m){if(!m)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const _=t.apply(this,arguments);return this._shimmedLocalStreams[m.id]?this._shimmedLocalStreams[m.id].indexOf(_)===-1&&this._shimmedLocalStreams[m.id].push(_):this._shimmedLocalStreams[m.id]=[m,_],_};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(S){this._shimmedLocalStreams=this._shimmedLocalStreams||{},S.getTracks().forEach(g=>{if(this.getSenders().find(o=>o.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const m=this.getSenders();n.apply(this,arguments);const _=this.getSenders().filter(g=>m.indexOf(g)===-1);this._shimmedLocalStreams[S.id]=[S].concat(_)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[S.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},S&&Object.keys(this._shimmedLocalStreams).forEach(m=>{const _=this._shimmedLocalStreams[m].indexOf(S);_!==-1&&this._shimmedLocalStreams[m].splice(_,1),this._shimmedLocalStreams[m].length===1&&delete this._shimmedLocalStreams[m]}),i.apply(this,arguments)}}function xr(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Er(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(o=>this._reverseStreams[o.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(o=>{if(this.getSenders().find(v=>v.track===o))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const o=new e.MediaStream(u.getTracks());this._streams[u.id]=o,this._reverseStreams[o.id]=u,u=o}r.apply(this,[u])};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},e.RTCPeerConnection.prototype.addTrack=function(u,o){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const s=[].slice.call(arguments,1);if(s.length!==1||!s[0].getTracks().find(p=>p===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const c=this._streams[o.id];if(c)c.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new e.MediaStream([u]);this._streams[o.id]=p,this._reverseStreams[p.id]=o,this.addStream(p)}return this.getSenders().find(p=>p.track===u)};function x(g,u){let o=u.sdp;return Object.keys(g._reverseStreams||[]).forEach(s=>{const v=g._reverseStreams[s],c=g._streams[v.id];o=o.replace(new RegExp(c.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:o})}function S(g,u){let o=u.sdp;return Object.keys(g._reverseStreams||[]).forEach(s=>{const v=g._reverseStreams[s],c=g._streams[v.id];o=o.replace(new RegExp(v.id,"g"),c.id)}),new RTCSessionDescription({type:u.type,sdp:o})}["createOffer","createAnswer"].forEach(function(g){const u=e.RTCPeerConnection.prototype[g],o={[g](){const s=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[c=>{const p=x(this,c);s[0].apply(null,[p])},c=>{s[1]&&s[1].apply(null,c)},arguments[2]]):u.apply(this,arguments).then(c=>x(this,c))}};e.RTCPeerConnection.prototype[g]=o[g]});const m=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?m.apply(this,arguments):(arguments[0]=S(this,arguments[0]),m.apply(this,arguments))};const _=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const g=_.get.apply(this);return g.type===""?g:x(this,g)}}),e.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let s;Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(p=>u.track===p)&&(s=this._streams[v])}),s&&(s.getTracks().length===1?this.removeStream(this._reverseStreams[s.id]):s.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function tn(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function Sr(e,t){Xe(e,"negotiationneeded",n=>{const r=n.target;if(!((t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const In=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Sr,shimAddTrackRemoveTrack:xr,shimAddTrackRemoveTrackWithNative:Er,shimGetDisplayMedia:go,shimGetSendersWithDtmf:gr,shimGetStats:vr,shimGetUserMedia:pr,shimMediaStream:_r,shimOnTrack:mr,shimPeerConnection:tn,shimSenderReceiverGetStats:yr},Symbol.toStringTag,{value:"Module"}));function Cr(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,x,S){pn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(x,S)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(S,m,_){m in S&&!(_ in S)&&(S[_]=S[m],delete S[m])},x=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(S){return typeof S=="object"&&typeof S.audio=="object"&&(S=JSON.parse(JSON.stringify(S)),i(S.audio,"autoGainControl","mozAutoGainControl"),i(S.audio,"noiseSuppression","mozNoiseSuppression")),x(S)},r&&r.prototype.getSettings){const S=r.prototype.getSettings;r.prototype.getSettings=function(){const m=S.apply(this,arguments);return i(m,"mozAutoGainControl","autoGainControl"),i(m,"mozNoiseSuppression","noiseSuppression"),m}}if(r&&r.prototype.applyConstraints){const S=r.prototype.applyConstraints;r.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),i(m,"autoGainControl","mozAutoGainControl"),i(m,"noiseSuppression","mozNoiseSuppression")),S.apply(this,[m])}}}}function vo(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function br(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function nn(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const x=e.RTCPeerConnection.prototype[i],S={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),x.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=S[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[x,S,m]=arguments;return r.apply(this,[x||null]).then(_=>{if(t.version<53&&!S)try{_.forEach(g=>{g.type=n[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;_.forEach((u,o)=>{_.set(o,Object.assign({},u,{type:n[u.type]||u.type}))})}return _}).then(S,m)}}function Rr(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(x=>x._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Tr(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Xe(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Lr(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){pn("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Ar(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Or(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(S=>{if("rid"in S&&!/^[a-z0-9]{0,16}$/i.test(S.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in S&&!(parseFloat(S.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in S&&!(parseFloat(S.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const x=t.apply(this,arguments);if(i){const{sender:S}=x,m=S.getParameters();(!("encodings"in m)||m.encodings.length===1&&Object.keys(m.encodings[0]).length===0)&&(m.encodings=r,S.sendEncodings=r,this.setParametersPromises.push(S.setParameters(m).then(()=>{delete S.sendEncodings}).catch(()=>{delete S.sendEncodings})))}return x})}function Pr(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function kr(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Dr(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const Mn=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Or,shimCreateAnswer:Dr,shimCreateOffer:kr,shimGetDisplayMedia:vo,shimGetParameters:Pr,shimGetUserMedia:Cr,shimOnTrack:br,shimPeerConnection:nn,shimRTCDataChannel:Ar,shimReceiverGetStats:Tr,shimRemoveStream:Lr,shimSenderGetStats:Rr},Symbol.toStringTag,{value:"Module"}));function Ir(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>t.call(this,i,r)),r.getVideoTracks().forEach(i=>t.call(this,i,r))},e.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(x=>{this._localStreams?this._localStreams.includes(x)||this._localStreams.push(x):this._localStreams=[x]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(x=>{i.includes(x.track)&&this.removeTrack(x)})})}}function Mr(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const x=new Event("addstream");x.stream=i,this.dispatchEvent(x)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(x=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(x)>=0)return;r._remoteStreams.push(x);const S=new Event("addstream");S.stream=x,r.dispatchEvent(S)})}),t.apply(r,arguments)}}}function Br(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,x=t.setRemoteDescription,S=t.addIceCandidate;t.createOffer=function(g,u){const o=arguments.length>=2?arguments[2]:arguments[0],s=n.apply(this,[o]);return u?(s.then(g,u),Promise.resolve()):s},t.createAnswer=function(g,u){const o=arguments.length>=2?arguments[2]:arguments[0],s=r.apply(this,[o]);return u?(s.then(g,u),Promise.resolve()):s};let m=function(_,g,u){const o=i.apply(this,[_]);return u?(o.then(g,u),Promise.resolve()):o};t.setLocalDescription=m,m=function(_,g,u){const o=x.apply(this,[_]);return u?(o.then(g,u),Promise.resolve()):o},t.setRemoteDescription=m,m=function(_,g,u){const o=S.apply(this,[_]);return u?(o.then(g,u),Promise.resolve()):o},t.addIceCandidate=m}function Fr(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(wr(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(r,i,x){t.mediaDevices.getUserMedia(r).then(i,x)}.bind(t))}function wr(e){return e&&e.video!==void 0?Object.assign({},e,{video:hr(e.video)}):e}function Ur(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const x=[];for(let S=0;S<r.iceServers.length;S++){let m=r.iceServers[S];m.urls===void 0&&m.url?(pn("RTCIceServer.url","RTCIceServer.urls"),m=JSON.parse(JSON.stringify(m)),m.urls=m.url,delete m.url,x.push(m)):x.push(r.iceServers[S])}r.iceServers=x}return new t(r,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function jr(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Nr(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(S=>S.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const x=this.getTransceivers().find(S=>S.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&x?x.direction==="sendrecv"?x.setDirection?x.setDirection("sendonly"):x.direction="sendonly":x.direction==="recvonly"&&(x.setDirection?x.setDirection("inactive"):x.direction="inactive"):r.offerToReceiveVideo===!0&&!x&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Vr(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const Bn=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Vr,shimCallbacksAPI:Br,shimConstraints:wr,shimCreateOfferLegacy:Nr,shimGetUserMedia:Fr,shimLocalStreamsAPI:Ir,shimRTCIceServerUrls:Ur,shimRemoteStreamsAPI:Mr,shimTrackEventTransceiver:jr},Symbol.toStringTag,{value:"Module"}));var Gr={exports:{}};(function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,x)=>(x>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let x=8;x<r.length;x+=2)switch(r[x]){case"raddr":i.relatedAddress=r[x+1];break;case"rport":i.relatedPort=parseInt(r[x+1],10);break;case"tcptype":i.tcpType=r[x+1];break;case"ufrag":i.ufrag=r[x+1],i.usernameFragment=r[x+1];break;default:i[r[x]]===void 0&&(i[r[x]]=r[x+1]);break}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const x=n.type;return r.push("typ"),r.push(x),x!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const x=n.substring(n.indexOf(" ")+1).split(";");for(let S=0;S<x.length;S++)i=x[S].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const x=[];Object.keys(n.parameters).forEach(S=>{n.parameters[S]!==void 0?x.push(S+"="+n.parameters[S]):x.push(S)}),r+="a=fmtp:"+i+" "+x.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(x=>{r+="a=rtcp-fb:"+i+" "+x.type+(x.parameter&&x.parameter.length?" "+x.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},x=n.indexOf(":",r);return x>-1?(i.attribute=n.substring(r+1,x),i.value=n.substring(x+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(x=>{i+="a=fingerprint:"+x.algorithm+" "+x.value+`\r
`}),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],x=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&x?{usernameFragment:i.substring(12),password:x.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},x=t.splitLines(n)[0].split(" ");r.profile=x[2];for(let m=3;m<x.length;m++){const _=x[m],g=t.matchPrefix(n,"a=rtpmap:"+_+" ")[0];if(g){const u=t.parseRtpMap(g),o=t.matchPrefix(n,"a=fmtp:"+_+" ");switch(u.parameters=o.length?t.parseFmtp(o[0]):{},u.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+_+" ").map(t.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}t.matchPrefix(n,"a=extmap:").forEach(m=>{r.headerExtensions.push(t.parseExtmap(m))});const S=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(m=>{S.forEach(_=>{m.rtcpFeedback.find(u=>u.type===_.type&&u.parameter===_.parameter)||m.rtcpFeedback.push(_)})}),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(S=>S.preferredPayloadType!==void 0?S.preferredPayloadType:S.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(S=>{i+=t.writeRtpMap(S),i+=t.writeFmtp(S),i+=t.writeRtcpFb(S)});let x=0;return r.codecs.forEach(S=>{S.maxptime>x&&(x=S.maxptime)}),x>0&&(i+="a=maxptime:"+x+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(S=>{i+=t.writeExtmap(S)}),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),x=i.fecMechanisms.indexOf("RED")!==-1,S=i.fecMechanisms.indexOf("ULPFEC")!==-1,m=t.matchPrefix(n,"a=ssrc:").map(s=>t.parseSsrcMedia(s)).filter(s=>s.attribute==="cname"),_=m.length>0&&m[0].ssrc;let g;const u=t.matchPrefix(n,"a=ssrc-group:FID").map(s=>s.substring(17).split(" ").map(c=>parseInt(c,10)));u.length>0&&u[0].length>1&&u[0][0]===_&&(g=u[0][1]),i.codecs.forEach(s=>{if(s.name.toUpperCase()==="RTX"&&s.parameters.apt){let v={ssrc:_,codecPayloadType:parseInt(s.parameters.apt,10)};_&&g&&(v.rtx={ssrc:g}),r.push(v),x&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:_,mechanism:S?"red+ulpfec":"red"},r.push(v))}}),r.length===0&&_&&r.push({ssrc:_});let o=t.matchPrefix(n,"b=");return o.length&&(o[0].indexOf("b=TIAS:")===0?o=parseInt(o[0].substring(7),10):o[0].indexOf("b=AS:")===0?o=parseInt(o[0].substring(5),10)*1e3*.95-50*40*8:o=void 0,r.forEach(s=>{s.maxBitrate=o})),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map(m=>t.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const x=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=x.length>0,r.compound=x.length===0;const S=t.matchPrefix(n,"a=rtcp-mux");return r.mux=S.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const x=t.matchPrefix(n,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="msid");if(x.length>0)return r=x[0].value.split(" "),{stream:r[0],track:r[1]}},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let x;i.length>0&&(x=parseInt(i[0].substring(19),10)),isNaN(x)&&(x=65536);const S=t.matchPrefix(n,"a=sctp-port:");if(S.length>0)return{port:parseInt(S[0].substring(12),10),protocol:r.fmt,maxMessageSize:x};const m=t.matchPrefix(n,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:x}}},t.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let x;const S=r!==void 0?r:2;return n?x=n:x=t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+x+" "+S+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let x=0;x<i.length;x++)switch(i[x]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[x].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(Gr);var Kr=Gr.exports;const tt=zn(Kr),yo=Li({__proto__:null,default:tt},[Kr]);function Lt(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new t(r),x=tt.parseCandidate(r.candidate);for(const S in x)S in i||Object.defineProperty(i,S,{value:x[S]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,Xe(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function rn(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Xe(e,"icecandidate",t=>{if(t.candidate){const n=tt.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function At(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(m){if(!m||!m.sdp)return!1;const _=tt.splitSections(m.sdp);return _.shift(),_.some(g=>{const u=tt.parseMLine(g);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const g=parseInt(_[1],10);return g!==g?-1:g},i=function(m){let _=65536;return t.browser==="firefox"&&(t.version<57?m===-1?_=16384:_=2147483637:t.version<60?_=t.version===57?65535:65536:_=2147483637),_},x=function(m,_){let g=65536;t.browser==="firefox"&&t.version===57&&(g=65535);const u=tt.matchPrefix(m.sdp,"a=max-message-size:");return u.length>0?g=parseInt(u[0].substring(19),10):t.browser==="firefox"&&_!==-1&&(g=2147483637),g},S=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:_}=this.getConfiguration();_==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const _=r(arguments[0]),g=i(_),u=x(arguments[0],_);let o;g===0&&u===0?o=Number.POSITIVE_INFINITY:g===0||u===0?o=Math.max(g,u):o=Math.min(g,u);const s={};Object.defineProperty(s,"maxMessageSize",{get(){return o}}),this._sctp=s}return S.apply(this,arguments)}}function Ot(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const x=r.send;r.send=function(){const m=arguments[0],_=m.length||m.size||m.byteLength;if(r.readyState==="open"&&i.sctp&&_>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return x.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},Xe(e,"datachannel",r=>(t(r.channel,r.target),r))}function sn(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const x=i.target;if(x._lastConnectionState!==x.connectionState){x._lastConnectionState=x.connectionState;const S=new Event("connectionstatechange",i);x.dispatchEvent(S)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function on(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const x=i.sdp.split(`
`).filter(S=>S.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:x}):i.sdp=x}return n.apply(this,arguments)}}function Pt(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function kt(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(S=>n.apply(this,[S]))})}const Eo=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:on,shimAddIceCandidateNullOrEmpty:Pt,shimConnectionState:sn,shimMaxMessageSize:At,shimParameterlessSetLocalDescription:kt,shimRTCIceCandidate:Lt,shimRTCIceCandidateRelayProtocol:rn,shimSendThrowTypeError:Ot},Symbol.toStringTag,{value:"Module"}));function xo({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=dr,r=mo(e),i={browserDetails:r,commonShim:Eo,extractVersion:Tt,disableLog:po,disableWarnings:_o,sdp:yo};switch(r.browser){case"chrome":if(!In||!tn||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=In,Pt(e,r),kt(e),pr(e,r),_r(e),tn(e,r),mr(e),xr(e,r),gr(e),vr(e),yr(e),Sr(e,r),Lt(e),rn(e),sn(e),At(e,r),Ot(e),on(e,r);break;case"firefox":if(!Mn||!nn||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Mn,Pt(e,r),kt(e),Cr(e,r),nn(e,r),br(e),Lr(e),Rr(e),Tr(e),Ar(e),Or(e),Pr(e),kr(e),Dr(e),Lt(e),sn(e),At(e,r),Ot(e);break;case"safari":if(!Bn||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=Bn,Pt(e,r),kt(e),Ur(e),Nr(e),Br(e),Ir(e),Mr(e),jr(e),Fr(e),Vr(e),Lt(e),rn(e),At(e,r),Ot(e),on(e,r);break;default:n("Unsupported browser!");break}return i}xo({window:typeof window>"u"?void 0:window});class So{constructor(t,{onTarck:n,onCandidate:r,onMessage:i}){Kt(this,"conn",null);Kt(this,"dataChannel",null);var x=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;x||He.alert("当前浏览器不支持RTCPeerConnection！"),this.conn=new x(t),this.conn.addEventListener("icecandidate",S=>{S.candidate&&r(S.candidate)}),this.conn.addEventListener("track",n),this.conn.addEventListener("connectionstatechange",()=>{this.conn.connectionState==="connected"&&console.log("对等连接成功！")}),this.createDataChannel({onMessage:i})}createOffer(t){this.conn&&this.conn.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(n=>{this.conn.setLocalDescription(n),t(n)}).catch(()=>{console.log("创建offer失败")})}createAnswer(t){this.conn&&this.conn.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(n=>{this.conn&&this.conn.setLocalDescription(n),t(n)}).catch(()=>{console.log("创建answer失败")})}setRemoteDescription(t){var n;(n=this.conn)==null||n.setRemoteDescription(new RTCSessionDescription(t))}setCandidate(t){this.conn&&t&&this.conn.addIceCandidate(new RTCIceCandidate(t)).catch(n=>{console.log(n)})}addTrack(t){this.conn&&t&&t.getTracks().forEach(n=>{this.conn.addTrack(n,t)})}createDataChannel({onMessage:t}){if(this.dataChannel)return!1;this.dataChannel=this.conn.createDataChannel("channel",{ordered:!0,maxRetransmits:5}),this.onDataChannel({onMessage:t})}onDataChannel({onMessage:t}){this.conn.ondatachannel=n=>{var r=n.channel;r.onmessage=function(i){typeof t=="function"&&t(i)},r.onopen=function(){console.log("dataChannel open")},r.onclose=function(){console.log("dataChannel close")}}}}var zr={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(self,function(){return function(){var n={"./node_modules/es6-promise/dist/es6-promise.js":function(S,m,_){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(g,u){S.exports=u()})(this,function(){function g(D){var B=typeof D;return D!==null&&(B==="object"||B==="function")}function u(D){return typeof D=="function"}var o=void 0;Array.isArray?o=Array.isArray:o=function(D){return Object.prototype.toString.call(D)==="[object Array]"};var s=o,v=0,c=void 0,p=void 0,y=function(B,M){L[v]=B,L[v+1]=M,v+=2,v===2&&(p?p(P):I())};function f(D){p=D}function l(D){y=D}var h=typeof window<"u"?window:void 0,d=h||{},a=d.MutationObserver||d.WebKitMutationObserver,E=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",C=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function b(){return function(){return process.nextTick(P)}}function A(){return typeof c<"u"?function(){c(P)}:R()}function T(){var D=0,B=new a(P),M=document.createTextNode("");return B.observe(M,{characterData:!0}),function(){M.data=D=++D%2}}function O(){var D=new MessageChannel;return D.port1.onmessage=P,function(){return D.port2.postMessage(0)}}function R(){var D=setTimeout;return function(){return D(P,1)}}var L=new Array(1e3);function P(){for(var D=0;D<v;D+=2){var B=L[D],M=L[D+1];B(M),L[D]=void 0,L[D+1]=void 0}v=0}function k(){try{var D=Function("return this")().require("vertx");return c=D.runOnLoop||D.runOnContext,A()}catch{return R()}}var I=void 0;E?I=b():a?I=T():C?I=O():h===void 0?I=k():I=R();function F(D,B){var M=this,K=new this.constructor($);K[Z]===void 0&&N(K);var Q=M._state;if(Q){var W=arguments[Q-1];y(function(){return Be(Q,K,W,M._result)})}else Ce(M,K,D,B);return K}function q(D){var B=this;if(D&&typeof D=="object"&&D.constructor===B)return D;var M=new B($);return Ee(M,D),M}var Z=Math.random().toString(36).substring(2);function $(){}var ne=void 0,fe=1,Y=2;function re(){return new TypeError("You cannot resolve a promise with itself")}function Le(){return new TypeError("A promises callback cannot return that same promise.")}function le(D,B,M,K){try{D.call(B,M,K)}catch(Q){return Q}}function ue(D,B,M){y(function(K){var Q=!1,W=le(M,B,function(ve){Q||(Q=!0,B!==ve?Ee(K,ve):de(K,ve))},function(ve){Q||(Q=!0,H(K,ve))},"Settle: "+(K._label||" unknown promise"));!Q&&W&&(Q=!0,H(K,W))},D)}function xe(D,B){B._state===fe?de(D,B._result):B._state===Y?H(D,B._result):Ce(B,void 0,function(M){return Ee(D,M)},function(M){return H(D,M)})}function pe(D,B,M){B.constructor===D.constructor&&M===F&&B.constructor.resolve===q?xe(D,B):M===void 0?de(D,B):u(M)?ue(D,B,M):de(D,B)}function Ee(D,B){if(D===B)H(D,re());else if(g(B)){var M=void 0;try{M=B.then}catch(K){H(D,K);return}pe(D,B,M)}else de(D,B)}function Se(D){D._onerror&&D._onerror(D._result),Ae(D)}function de(D,B){D._state===ne&&(D._result=B,D._state=fe,D._subscribers.length!==0&&y(Ae,D))}function H(D,B){D._state===ne&&(D._state=Y,D._result=B,y(Se,D))}function Ce(D,B,M,K){var Q=D._subscribers,W=Q.length;D._onerror=null,Q[W]=B,Q[W+fe]=M,Q[W+Y]=K,W===0&&D._state&&y(Ae,D)}function Ae(D){var B=D._subscribers,M=D._state;if(B.length!==0){for(var K=void 0,Q=void 0,W=D._result,ve=0;ve<B.length;ve+=3)K=B[ve],Q=B[ve+M],K?Be(M,K,Q,W):Q(W);D._subscribers.length=0}}function Be(D,B,M,K){var Q=u(M),W=void 0,ve=void 0,qe=!0;if(Q){try{W=M(K)}catch(mt){qe=!1,ve=mt}if(B===W){H(B,Le());return}}else W=K;B._state!==ne||(Q&&qe?Ee(B,W):qe===!1?H(B,ve):D===fe?de(B,W):D===Y&&H(B,W))}function Oe(D,B){try{B(function(K){Ee(D,K)},function(K){H(D,K)})}catch(M){H(D,M)}}var Fe=0;function w(){return Fe++}function N(D){D[Z]=Fe++,D._state=void 0,D._result=void 0,D._subscribers=[]}function U(){return new Error("Array Methods must be provided an Array")}var j=function(){function D(B,M){this._instanceConstructor=B,this.promise=new B($),this.promise[Z]||N(this.promise),s(M)?(this.length=M.length,this._remaining=M.length,this._result=new Array(this.length),this.length===0?de(this.promise,this._result):(this.length=this.length||0,this._enumerate(M),this._remaining===0&&de(this.promise,this._result))):H(this.promise,U())}return D.prototype._enumerate=function(M){for(var K=0;this._state===ne&&K<M.length;K++)this._eachEntry(M[K],K)},D.prototype._eachEntry=function(M,K){var Q=this._instanceConstructor,W=Q.resolve;if(W===q){var ve=void 0,qe=void 0,mt=!1;try{ve=M.then}catch(Gt){mt=!0,qe=Gt}if(ve===F&&M._state!==ne)this._settledAt(M._state,K,M._result);else if(typeof ve!="function")this._remaining--,this._result[K]=M;else if(Q===ye){var Vt=new Q($);mt?H(Vt,qe):pe(Vt,M,ve),this._willSettleAt(Vt,K)}else this._willSettleAt(new Q(function(Gt){return Gt(M)}),K)}else this._willSettleAt(W(M),K)},D.prototype._settledAt=function(M,K,Q){var W=this.promise;W._state===ne&&(this._remaining--,M===Y?H(W,Q):this._result[K]=Q),this._remaining===0&&de(W,this._result)},D.prototype._willSettleAt=function(M,K){var Q=this;Ce(M,void 0,function(W){return Q._settledAt(fe,K,W)},function(W){return Q._settledAt(Y,K,W)})},D}();function Re(D){return new j(this,D).promise}function Te(D){var B=this;return s(D)?new B(function(M,K){for(var Q=D.length,W=0;W<Q;W++)B.resolve(D[W]).then(M,K)}):new B(function(M,K){return K(new TypeError("You must pass an array to race."))})}function Je(D){var B=this,M=new B($);return H(M,D),M}function Ne(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function be(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ye=function(){function D(B){this[Z]=w(),this._result=this._state=void 0,this._subscribers=[],$!==B&&(typeof B!="function"&&Ne(),this instanceof D?Oe(this,B):be())}return D.prototype.catch=function(M){return this.then(null,M)},D.prototype.finally=function(M){var K=this,Q=K.constructor;return u(M)?K.then(function(W){return Q.resolve(M()).then(function(){return W})},function(W){return Q.resolve(M()).then(function(){throw W})}):K.then(M,M)},D}();ye.prototype.then=F,ye.all=Re,ye.race=Te,ye.resolve=q,ye.reject=Je,ye._setScheduler=f,ye._setAsap=l,ye._asap=y;function _t(){var D=void 0;if(typeof _.g<"u")D=_.g;else if(typeof self<"u")D=self;else try{D=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var B=D.Promise;if(B){var M=null;try{M=Object.prototype.toString.call(B.resolve())}catch{}if(M==="[object Promise]"&&!B.cast)return}D.Promise=ye}return ye.polyfill=_t,ye.Promise=ye,ye})},"./node_modules/events/events.js":function(S){var m=typeof Reflect=="object"?Reflect:null,_=m&&typeof m.apply=="function"?m.apply:function(R,L,P){return Function.prototype.apply.call(R,L,P)},g;m&&typeof m.ownKeys=="function"?g=m.ownKeys:Object.getOwnPropertySymbols?g=function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:g=function(R){return Object.getOwnPropertyNames(R)};function u(O){console&&console.warn&&console.warn(O)}var o=Number.isNaN||function(R){return R!==R};function s(){s.init.call(this)}S.exports=s,S.exports.once=b,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var v=10;function c(O){if(typeof O!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof O)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return v},set:function(O){if(typeof O!="number"||O<0||o(O))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+O+".");v=O}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(R){if(typeof R!="number"||R<0||o(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this};function p(O){return O._maxListeners===void 0?s.defaultMaxListeners:O._maxListeners}s.prototype.getMaxListeners=function(){return p(this)},s.prototype.emit=function(R){for(var L=[],P=1;P<arguments.length;P++)L.push(arguments[P]);var k=R==="error",I=this._events;if(I!==void 0)k=k&&I.error===void 0;else if(!k)return!1;if(k){var F;if(L.length>0&&(F=L[0]),F instanceof Error)throw F;var q=new Error("Unhandled error."+(F?" ("+F.message+")":""));throw q.context=F,q}var Z=I[R];if(Z===void 0)return!1;if(typeof Z=="function")_(Z,this,L);else for(var $=Z.length,ne=a(Z,$),P=0;P<$;++P)_(ne[P],this,L);return!0};function y(O,R,L,P){var k,I,F;if(c(L),I=O._events,I===void 0?(I=O._events=Object.create(null),O._eventsCount=0):(I.newListener!==void 0&&(O.emit("newListener",R,L.listener?L.listener:L),I=O._events),F=I[R]),F===void 0)F=I[R]=L,++O._eventsCount;else if(typeof F=="function"?F=I[R]=P?[L,F]:[F,L]:P?F.unshift(L):F.push(L),k=p(O),k>0&&F.length>k&&!F.warned){F.warned=!0;var q=new Error("Possible EventEmitter memory leak detected. "+F.length+" "+String(R)+" listeners added. Use emitter.setMaxListeners() to increase limit");q.name="MaxListenersExceededWarning",q.emitter=O,q.type=R,q.count=F.length,u(q)}return O}s.prototype.addListener=function(R,L){return y(this,R,L,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(R,L){return y(this,R,L,!0)};function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(O,R,L){var P={fired:!1,wrapFn:void 0,target:O,type:R,listener:L},k=f.bind(P);return k.listener=L,P.wrapFn=k,k}s.prototype.once=function(R,L){return c(L),this.on(R,l(this,R,L)),this},s.prototype.prependOnceListener=function(R,L){return c(L),this.prependListener(R,l(this,R,L)),this},s.prototype.removeListener=function(R,L){var P,k,I,F,q;if(c(L),k=this._events,k===void 0)return this;if(P=k[R],P===void 0)return this;if(P===L||P.listener===L)--this._eventsCount===0?this._events=Object.create(null):(delete k[R],k.removeListener&&this.emit("removeListener",R,P.listener||L));else if(typeof P!="function"){for(I=-1,F=P.length-1;F>=0;F--)if(P[F]===L||P[F].listener===L){q=P[F].listener,I=F;break}if(I<0)return this;I===0?P.shift():E(P,I),P.length===1&&(k[R]=P[0]),k.removeListener!==void 0&&this.emit("removeListener",R,q||L)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(R){var L,P,k;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[R]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[R]),this;if(arguments.length===0){var I=Object.keys(P),F;for(k=0;k<I.length;++k)F=I[k],F!=="removeListener"&&this.removeAllListeners(F);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(L=P[R],typeof L=="function")this.removeListener(R,L);else if(L!==void 0)for(k=L.length-1;k>=0;k--)this.removeListener(R,L[k]);return this};function h(O,R,L){var P=O._events;if(P===void 0)return[];var k=P[R];return k===void 0?[]:typeof k=="function"?L?[k.listener||k]:[k]:L?C(k):a(k,k.length)}s.prototype.listeners=function(R){return h(this,R,!0)},s.prototype.rawListeners=function(R){return h(this,R,!1)},s.listenerCount=function(O,R){return typeof O.listenerCount=="function"?O.listenerCount(R):d.call(O,R)},s.prototype.listenerCount=d;function d(O){var R=this._events;if(R!==void 0){var L=R[O];if(typeof L=="function")return 1;if(L!==void 0)return L.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?g(this._events):[]};function a(O,R){for(var L=new Array(R),P=0;P<R;++P)L[P]=O[P];return L}function E(O,R){for(;R+1<O.length;R++)O[R]=O[R+1];O.pop()}function C(O){for(var R=new Array(O.length),L=0;L<R.length;++L)R[L]=O[L].listener||O[L];return R}function b(O,R){return new Promise(function(L,P){function k(F){O.removeListener(R,I),P(F)}function I(){typeof O.removeListener=="function"&&O.removeListener("error",k),L([].slice.call(arguments))}T(O,R,I,{once:!0}),R!=="error"&&A(O,k,{once:!0})})}function A(O,R,L){typeof O.on=="function"&&T(O,"error",R,L)}function T(O,R,L,P){if(typeof O.on=="function")P.once?O.once(R,L):O.on(R,L);else if(typeof O.addEventListener=="function")O.addEventListener(R,function k(I){P.once&&O.removeEventListener(R,k),L(I)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof O)}},"./node_modules/webworkify-webpack/index.js":function(S,m,_){function g(f){var l={};function h(a){if(l[a])return l[a].exports;var E=l[a]={i:a,l:!1,exports:{}};return f[a].call(E.exports,E,E.exports,h),E.l=!0,E.exports}h.m=f,h.c=l,h.i=function(a){return a},h.d=function(a,E,C){h.o(a,E)||Object.defineProperty(a,E,{configurable:!1,enumerable:!0,get:C})},h.r=function(a){Object.defineProperty(a,"__esModule",{value:!0})},h.n=function(a){var E=a&&a.__esModule?function(){return a.default}:function(){return a};return h.d(E,"a",E),E},h.o=function(a,E){return Object.prototype.hasOwnProperty.call(a,E)},h.p="/",h.oe=function(a){throw console.error(a),a};var d=h(h.s=ENTRY_MODULE);return d.default||d}var u="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+u+").*?\\)";function s(f){return(f+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function v(f){return!isNaN(1*f)}function c(f,l,h){var d={};d[h]=[];var a=l.toString(),E=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!E)return d;for(var C=E[1],b=new RegExp("(\\\\n|\\W)"+s(C)+o,"g"),A;A=b.exec(a);)A[3]!=="dll-reference"&&d[h].push(A[3]);for(b=new RegExp("\\("+s(C)+'\\("(dll-reference\\s('+u+'))"\\)\\)'+o,"g");A=b.exec(a);)f[A[2]]||(d[h].push(A[1]),f[A[2]]=_(A[1]).m),d[A[2]]=d[A[2]]||[],d[A[2]].push(A[4]);for(var T=Object.keys(d),O=0;O<T.length;O++)for(var R=0;R<d[T[O]].length;R++)v(d[T[O]][R])&&(d[T[O]][R]=1*d[T[O]][R]);return d}function p(f){var l=Object.keys(f);return l.reduce(function(h,d){return h||f[d].length>0},!1)}function y(f,l){for(var h={main:[l]},d={main:[]},a={main:{}};p(h);)for(var E=Object.keys(h),C=0;C<E.length;C++){var b=E[C],A=h[b],T=A.pop();if(a[b]=a[b]||{},!(a[b][T]||!f[b][T])){a[b][T]=!0,d[b]=d[b]||[],d[b].push(T);for(var O=c(f,f[b][T],b),R=Object.keys(O),L=0;L<R.length;L++)h[R[L]]=h[R[L]]||[],h[R[L]]=h[R[L]].concat(O[R[L]])}}return d}S.exports=function(f,l){l=l||{};var h={main:_.m},d=l.all?{main:Object.keys(h.main)}:y(h,f),a="";Object.keys(d).filter(function(T){return T!=="main"}).forEach(function(T){for(var O=0;d[T][O];)O++;d[T].push(O),h[T][O]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+T+" = ("+g.toString().replace("ENTRY_MODULE",JSON.stringify(O))+")({"+d[T].map(function(R){return""+JSON.stringify(R)+": "+h[T][R].toString()}).join(",")+`});
`}),a=a+"new (("+g.toString().replace("ENTRY_MODULE",JSON.stringify(f))+")({"+d.main.map(function(T){return""+JSON.stringify(T)+": "+h.main[T].toString()}).join(",")+"}))(self);";var E=new window.Blob([a],{type:"text/javascript"});if(l.bare)return E;var C=window.URL||window.webkitURL||window.mozURL||window.msURL,b=C.createObjectURL(E),A=new window.Worker(b);return A.objectURL=b,A}},"./src/config.js":function(S,m,_){_.r(m),_.d(m,{defaultConfig:function(){return g},createDefaultConfig:function(){return u}});var g={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function u(){return Object.assign({},g)}},"./src/core/features.js":function(S,m,_){_.r(m);var g=_("./src/io/io-controller.js"),u=_("./src/config.js"),o=function(){function s(){}return s.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},s.supportNetworkStreamIO=function(){var v=new g.default({},(0,u.createDefaultConfig)()),c=v.loaderType;return v.destroy(),c=="fetch-stream-loader"||c=="xhr-moz-chunked-loader"},s.getNetworkLoaderTypeName=function(){var v=new g.default({},(0,u.createDefaultConfig)()),c=v.loaderType;return v.destroy(),c},s.supportNativeMediaPlayback=function(v){s.videoElement==null&&(s.videoElement=window.document.createElement("video"));var c=s.videoElement.canPlayType(v);return c==="probably"||c=="maybe"},s.getFeatureList=function(){var v={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return v.mseFlvPlayback=s.supportMSEH264Playback(),v.networkStreamIO=s.supportNetworkStreamIO(),v.networkLoaderName=s.getNetworkLoaderTypeName(),v.mseLiveFlvPlayback=v.mseFlvPlayback&&v.networkStreamIO,v.nativeMP4H264Playback=s.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),v.nativeWebmVP8Playback=s.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),v.nativeWebmVP9Playback=s.supportNativeMediaPlayback('video/webm; codecs="vp9"'),v},s}();m.default=o},"./src/core/media-info.js":function(S,m,_){_.r(m);var g=function(){function u(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return u.prototype.isComplete=function(){var o=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,s=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&o&&s},u.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},u.prototype.getNearestKeyframe=function(o){if(this.keyframesIndex==null)return null;var s=this.keyframesIndex,v=this._search(s.times,o);return{index:v,milliseconds:s.times[v],fileposition:s.filepositions[v]}},u.prototype._search=function(o,s){var v=0,c=o.length-1,p=0,y=0,f=c;for(s<o[0]&&(v=0,y=f+1);y<=f;)if(p=y+Math.floor((f-y)/2),p===c||s>=o[p]&&s<o[p+1]){v=p;break}else o[p]<s?y=p+1:f=p-1;return v},u}();m.default=g},"./src/core/media-segment-info.js":function(S,m,_){_.r(m),_.d(m,{SampleInfo:function(){return g},MediaSegmentInfo:function(){return u},IDRSampleList:function(){return o},MediaSegmentInfoList:function(){return s}});var g=function(){function v(c,p,y,f,l){this.dts=c,this.pts=p,this.duration=y,this.originalDts=f,this.isSyncPoint=l,this.fileposition=null}return v}(),u=function(){function v(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return v.prototype.appendSyncPoint=function(c){c.isSyncPoint=!0,this.syncPoints.push(c)},v}(),o=function(){function v(){this._list=[]}return v.prototype.clear=function(){this._list=[]},v.prototype.appendArray=function(c){var p=this._list;c.length!==0&&(p.length>0&&c[0].originalDts<p[p.length-1].originalDts&&this.clear(),Array.prototype.push.apply(p,c))},v.prototype.getLastSyncPointBeforeDts=function(c){if(this._list.length==0)return null;var p=this._list,y=0,f=p.length-1,l=0,h=0,d=f;for(c<p[0].dts&&(y=0,h=d+1);h<=d;)if(l=h+Math.floor((d-h)/2),l===f||c>=p[l].dts&&c<p[l+1].dts){y=l;break}else p[l].dts<c?h=l+1:d=l-1;return this._list[y]},v}(),s=function(){function v(c){this._type=c,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(v.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),v.prototype.isEmpty=function(){return this._list.length===0},v.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},v.prototype._searchNearestSegmentBefore=function(c){var p=this._list;if(p.length===0)return-2;var y=p.length-1,f=0,l=0,h=y,d=0;if(c<p[0].originalBeginDts)return d=-1,d;for(;l<=h;)if(f=l+Math.floor((h-l)/2),f===y||c>p[f].lastSample.originalDts&&c<p[f+1].originalBeginDts){d=f;break}else p[f].originalBeginDts<c?l=f+1:h=f-1;return d},v.prototype._searchNearestSegmentAfter=function(c){return this._searchNearestSegmentBefore(c)+1},v.prototype.append=function(c){var p=this._list,y=c,f=this._lastAppendLocation,l=0;f!==-1&&f<p.length&&y.originalBeginDts>=p[f].lastSample.originalDts&&(f===p.length-1||f<p.length-1&&y.originalBeginDts<p[f+1].originalBeginDts)?l=f+1:p.length>0&&(l=this._searchNearestSegmentBefore(y.originalBeginDts)+1),this._lastAppendLocation=l,this._list.splice(l,0,y)},v.prototype.getLastSegmentBefore=function(c){var p=this._searchNearestSegmentBefore(c);return p>=0?this._list[p]:null},v.prototype.getLastSampleBefore=function(c){var p=this.getLastSegmentBefore(c);return p!=null?p.lastSample:null},v.prototype.getLastSyncPointBefore=function(c){for(var p=this._searchNearestSegmentBefore(c),y=this._list[p].syncPoints;y.length===0&&p>0;)p--,y=this._list[p].syncPoints;return y.length>0?y[y.length-1]:null},v}()},"./src/core/mse-controller.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),u=_.n(g),o=_("./src/utils/logger.js"),s=_("./src/utils/browser.js"),v=_("./src/core/mse-events.js"),c=_("./src/core/media-segment-info.js"),p=_("./src/utils/exception.js"),y=function(){function f(l){this.TAG="MSEController",this._config=l,this._emitter=new(u()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new c.IDRSampleList}return f.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},f.prototype.on=function(l,h){this._emitter.addListener(l,h)},f.prototype.off=function(l,h){this._emitter.removeListener(l,h)},f.prototype.attachMediaElement=function(l){if(this._mediaSource)throw new p.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var h=this._mediaSource=new window.MediaSource;h.addEventListener("sourceopen",this.e.onSourceOpen),h.addEventListener("sourceended",this.e.onSourceEnded),h.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=l,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),l.src=this._mediaSourceObjectURL},f.prototype.detachMediaElement=function(){if(this._mediaSource){var l=this._mediaSource;for(var h in this._sourceBuffers){var d=this._pendingSegments[h];d.splice(0,d.length),this._pendingSegments[h]=null,this._pendingRemoveRanges[h]=null,this._lastInitSegments[h]=null;var a=this._sourceBuffers[h];if(a){if(l.readyState!=="closed"){try{l.removeSourceBuffer(a)}catch(E){o.default.e(this.TAG,E.message)}a.removeEventListener("error",this.e.onSourceBufferError),a.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[h]=null,this._sourceBuffers[h]=null}}if(l.readyState==="open")try{l.endOfStream()}catch(E){o.default.e(this.TAG,E.message)}l.removeEventListener("sourceopen",this.e.onSourceOpen),l.removeEventListener("sourceended",this.e.onSourceEnded),l.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},f.prototype.appendInitSegment=function(l,h){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(l),this._pendingSegments[l.type].push(l);return}var d=l,a=""+d.container;d.codec&&d.codec.length>0&&(a+=";codecs="+d.codec);var E=!1;if(o.default.v(this.TAG,"Received Initialization Segment, mimeType: "+a),this._lastInitSegments[d.type]=d,a!==this._mimeTypes[d.type]){if(this._mimeTypes[d.type])o.default.v(this.TAG,"Notice: "+d.type+" mimeType changed, origin: "+this._mimeTypes[d.type]+", target: "+a);else{E=!0;try{var C=this._sourceBuffers[d.type]=this._mediaSource.addSourceBuffer(a);C.addEventListener("error",this.e.onSourceBufferError),C.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(b){o.default.e(this.TAG,b.message),this._emitter.emit(v.default.ERROR,{code:b.code,msg:b.message});return}}this._mimeTypes[d.type]=a}h||this._pendingSegments[d.type].push(d),E||this._sourceBuffers[d.type]&&!this._sourceBuffers[d.type].updating&&this._doAppendSegments(),s.default.safari&&d.container==="audio/mpeg"&&d.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=d.mediaDuration/1e3,this._updateMediaSourceDuration())},f.prototype.appendMediaSegment=function(l){var h=l;this._pendingSegments[h.type].push(h),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var d=this._sourceBuffers[h.type];d&&!d.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},f.prototype.seek=function(l){for(var h in this._sourceBuffers)if(this._sourceBuffers[h]){var d=this._sourceBuffers[h];if(this._mediaSource.readyState==="open")try{d.abort()}catch(T){o.default.e(this.TAG,T.message)}this._idrList.clear();var a=this._pendingSegments[h];if(a.splice(0,a.length),this._mediaSource.readyState!=="closed"){for(var E=0;E<d.buffered.length;E++){var C=d.buffered.start(E),b=d.buffered.end(E);this._pendingRemoveRanges[h].push({start:C,end:b})}if(d.updating||this._doRemoveRanges(),s.default.safari){var A=this._lastInitSegments[h];A&&(this._pendingSegments[h].push(A),d.updating||this._doAppendSegments())}}}},f.prototype.endOfStream=function(){var l=this._mediaSource,h=this._sourceBuffers;if(!l||l.readyState!=="open"){l&&l.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}h.video&&h.video.updating||h.audio&&h.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,l.endOfStream())},f.prototype.getNearestKeyframe=function(l){return this._idrList.getLastSyncPointBeforeDts(l)},f.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var l=this._mediaElement.currentTime;for(var h in this._sourceBuffers){var d=this._sourceBuffers[h];if(d){var a=d.buffered;if(a.length>=1&&l-a.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},f.prototype._doCleanupSourceBuffer=function(){var l=this._mediaElement.currentTime;for(var h in this._sourceBuffers){var d=this._sourceBuffers[h];if(d){for(var a=d.buffered,E=!1,C=0;C<a.length;C++){var b=a.start(C),A=a.end(C);if(b<=l&&l<A+3){if(l-b>=this._config.autoCleanupMaxBackwardDuration){E=!0;var T=l-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[h].push({start:b,end:T})}}else A<l&&(E=!0,this._pendingRemoveRanges[h].push({start:b,end:A}))}E&&!d.updating&&this._doRemoveRanges()}}},f.prototype._updateMediaSourceDuration=function(){var l=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(l.video&&l.video.updating||l.audio&&l.audio.updating)){var h=this._mediaSource.duration,d=this._pendingMediaDuration;d>0&&(isNaN(h)||d>h)&&(o.default.v(this.TAG,"Update MediaSource duration from "+h+" to "+d),this._mediaSource.duration=d),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},f.prototype._doRemoveRanges=function(){for(var l in this._pendingRemoveRanges)if(!(!this._sourceBuffers[l]||this._sourceBuffers[l].updating))for(var h=this._sourceBuffers[l],d=this._pendingRemoveRanges[l];d.length&&!h.updating;){var a=d.shift();h.remove(a.start,a.end)}},f.prototype._doAppendSegments=function(){var l=this._pendingSegments;for(var h in l)if(!(!this._sourceBuffers[h]||this._sourceBuffers[h].updating)&&l[h].length>0){var d=l[h].shift();if(d.timestampOffset){var a=this._sourceBuffers[h].timestampOffset,E=d.timestampOffset/1e3,C=Math.abs(a-E);C>.1&&(o.default.v(this.TAG,"Update MPEG audio timestampOffset from "+a+" to "+E),this._sourceBuffers[h].timestampOffset=E),delete d.timestampOffset}if(!d.data||d.data.byteLength===0)continue;try{this._sourceBuffers[h].appendBuffer(d.data),this._isBufferFull=!1,h==="video"&&d.hasOwnProperty("info")&&this._idrList.appendArray(d.info.syncPoints)}catch(b){this._pendingSegments[h].unshift(d),b.code===22?(this._isBufferFull||this._emitter.emit(v.default.BUFFER_FULL),this._isBufferFull=!0):(o.default.e(this.TAG,b.message),this._emitter.emit(v.default.ERROR,{code:b.code,msg:b.message}))}}},f.prototype._onSourceOpen=function(){if(o.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var l=this._pendingSourceBufferInit;l.length;){var h=l.shift();this.appendInitSegment(h,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(v.default.SOURCE_OPEN)},f.prototype._onSourceEnded=function(){o.default.v(this.TAG,"MediaSource onSourceEnded")},f.prototype._onSourceClose=function(){o.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},f.prototype._hasPendingSegments=function(){var l=this._pendingSegments;return l.video.length>0||l.audio.length>0},f.prototype._hasPendingRemoveRanges=function(){var l=this._pendingRemoveRanges;return l.video.length>0||l.audio.length>0},f.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(v.default.UPDATE_END)},f.prototype._onSourceBufferError=function(l){o.default.e(this.TAG,"SourceBuffer Error: "+l)},f}();m.default=y},"./src/core/mse-events.js":function(S,m,_){_.r(m);var g={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};m.default=g},"./src/core/transmuxer.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),u=_.n(g),o=_("./node_modules/webworkify-webpack/index.js"),s=_.n(o),v=_("./src/utils/logger.js"),c=_("./src/utils/logging-control.js"),p=_("./src/core/transmuxing-controller.js"),y=_("./src/core/transmuxing-events.js"),f=_("./src/core/media-info.js"),l=function(){function h(d,a){if(this.TAG="Transmuxer",this._emitter=new(u()),a.enableWorker&&typeof Worker<"u")try{this._worker=s()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[d,a]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},c.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:c.default.getConfig()})}catch{v.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new p.default(d,a)}else this._controller=new p.default(d,a);if(this._controller){var E=this._controller;E.on(y.default.IO_ERROR,this._onIOError.bind(this)),E.on(y.default.DEMUX_ERROR,this._onDemuxError.bind(this)),E.on(y.default.INIT_SEGMENT,this._onInitSegment.bind(this)),E.on(y.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),E.on(y.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),E.on(y.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),E.on(y.default.MEDIA_INFO,this._onMediaInfo.bind(this)),E.on(y.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),E.on(y.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),E.on(y.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),E.on(y.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return h.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),c.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},h.prototype.on=function(d,a){this._emitter.addListener(d,a)},h.prototype.off=function(d,a){this._emitter.removeListener(d,a)},h.prototype.hasWorker=function(){return this._worker!=null},h.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},h.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},h.prototype.seek=function(d){this._worker?this._worker.postMessage({cmd:"seek",param:d}):this._controller.seek(d)},h.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},h.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},h.prototype._onInitSegment=function(d,a){var E=this;Promise.resolve().then(function(){E._emitter.emit(y.default.INIT_SEGMENT,d,a)})},h.prototype._onMediaSegment=function(d,a){var E=this;Promise.resolve().then(function(){E._emitter.emit(y.default.MEDIA_SEGMENT,d,a)})},h.prototype._onLoadingComplete=function(){var d=this;Promise.resolve().then(function(){d._emitter.emit(y.default.LOADING_COMPLETE)})},h.prototype._onRecoveredEarlyEof=function(){var d=this;Promise.resolve().then(function(){d._emitter.emit(y.default.RECOVERED_EARLY_EOF)})},h.prototype._onMediaInfo=function(d){var a=this;Promise.resolve().then(function(){a._emitter.emit(y.default.MEDIA_INFO,d)})},h.prototype._onMetaDataArrived=function(d){var a=this;Promise.resolve().then(function(){a._emitter.emit(y.default.METADATA_ARRIVED,d)})},h.prototype._onScriptDataArrived=function(d){var a=this;Promise.resolve().then(function(){a._emitter.emit(y.default.SCRIPTDATA_ARRIVED,d)})},h.prototype._onStatisticsInfo=function(d){var a=this;Promise.resolve().then(function(){a._emitter.emit(y.default.STATISTICS_INFO,d)})},h.prototype._onIOError=function(d,a){var E=this;Promise.resolve().then(function(){E._emitter.emit(y.default.IO_ERROR,d,a)})},h.prototype._onDemuxError=function(d,a){var E=this;Promise.resolve().then(function(){E._emitter.emit(y.default.DEMUX_ERROR,d,a)})},h.prototype._onRecommendSeekpoint=function(d){var a=this;Promise.resolve().then(function(){a._emitter.emit(y.default.RECOMMEND_SEEKPOINT,d)})},h.prototype._onLoggingConfigChanged=function(d){this._worker&&this._worker.postMessage({cmd:"logging_config",param:d})},h.prototype._onWorkerMessage=function(d){var a=d.data,E=a.data;if(a.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(a.msg){case y.default.INIT_SEGMENT:case y.default.MEDIA_SEGMENT:this._emitter.emit(a.msg,E.type,E.data);break;case y.default.LOADING_COMPLETE:case y.default.RECOVERED_EARLY_EOF:this._emitter.emit(a.msg);break;case y.default.MEDIA_INFO:Object.setPrototypeOf(E,f.default.prototype),this._emitter.emit(a.msg,E);break;case y.default.METADATA_ARRIVED:case y.default.SCRIPTDATA_ARRIVED:case y.default.STATISTICS_INFO:this._emitter.emit(a.msg,E);break;case y.default.IO_ERROR:case y.default.DEMUX_ERROR:this._emitter.emit(a.msg,E.type,E.info);break;case y.default.RECOMMEND_SEEKPOINT:this._emitter.emit(a.msg,E);break;case"logcat_callback":v.default.emitter.emit("log",E.type,E.logcat);break}},h}();m.default=l},"./src/core/transmuxing-controller.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),u=_.n(g),o=_("./src/utils/logger.js"),s=_("./src/utils/browser.js"),v=_("./src/core/media-info.js"),c=_("./src/demux/flv-demuxer.js"),p=_("./src/remux/mp4-remuxer.js"),y=_("./src/demux/demux-errors.js"),f=_("./src/io/io-controller.js"),l=_("./src/core/transmuxing-events.js"),h=function(){function d(a,E){this.TAG="TransmuxingController",this._emitter=new(u()),this._config=E,a.segments||(a.segments=[{duration:a.duration,filesize:a.filesize,url:a.url}]),typeof a.cors!="boolean"&&(a.cors=!0),typeof a.withCredentials!="boolean"&&(a.withCredentials=!1),this._mediaDataSource=a,this._currentSegmentIndex=0;var C=0;this._mediaDataSource.segments.forEach(function(b){b.timestampBase=C,C+=b.duration,b.cors=a.cors,b.withCredentials=a.withCredentials,E.referrerPolicy&&(b.referrerPolicy=E.referrerPolicy)}),!isNaN(C)&&this._mediaDataSource.duration!==C&&(this._mediaDataSource.duration=C),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return d.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},d.prototype.on=function(a,E){this._emitter.addListener(a,E)},d.prototype.off=function(a,E){this._emitter.removeListener(a,E)},d.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},d.prototype._loadSegment=function(a,E){this._currentSegmentIndex=a;var C=this._mediaDataSource.segments[a],b=this._ioctl=new f.default(C,this._config,a);b.onError=this._onIOException.bind(this),b.onSeeked=this._onIOSeeked.bind(this),b.onComplete=this._onIOComplete.bind(this),b.onRedirect=this._onIORedirect.bind(this),b.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),E?this._demuxer.bindDataSource(this._ioctl):b.onDataArrival=this._onInitChunkArrival.bind(this),b.open(E)},d.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},d.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},d.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},d.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},d.prototype.seek=function(a){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var E=this._searchSegmentIndexContains(a);if(E===this._currentSegmentIndex){var C=this._mediaInfo.segments[E];if(C==null)this._pendingSeekTime=a;else{var b=C.getNearestKeyframe(a);this._remuxer.seek(b.milliseconds),this._ioctl.seek(b.fileposition),this._pendingResolveSeekPoint=b.milliseconds}}else{var A=this._mediaInfo.segments[E];if(A==null)this._pendingSeekTime=a,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(E);else{var b=A.getNearestKeyframe(a);this._internalAbort(),this._remuxer.seek(a),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[E].timestampBase,this._loadSegment(E,b.fileposition),this._pendingResolveSeekPoint=b.milliseconds,this._reportSegmentMediaInfo(E)}}this._enableStatisticsReporter()}},d.prototype._searchSegmentIndexContains=function(a){for(var E=this._mediaDataSource.segments,C=E.length-1,b=0;b<E.length;b++)if(a<E[b].timestampBase){C=b-1;break}return C},d.prototype._onInitChunkArrival=function(a,E){var C=this,b=null,A=0;if(E>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,A=this._demuxer.parseChunks(a,E);else if((b=c.default.probe(a)).match){this._demuxer=new c.default(b,this._config),this._remuxer||(this._remuxer=new p.default(this._config));var T=this._mediaDataSource;T.duration!=null&&!isNaN(T.duration)&&(this._demuxer.overridedDuration=T.duration),typeof T.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=T.hasAudio),typeof T.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=T.hasVideo),this._demuxer.timestampBase=T.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),A=this._demuxer.parseChunks(a,E)}else b=null,o.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){C._internalAbort()}),this._emitter.emit(l.default.DEMUX_ERROR,y.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),A=0;return A},d.prototype._onMediaInfo=function(a){var E=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},a),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,v.default.prototype));var C=Object.assign({},a);Object.setPrototypeOf(C,v.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=C,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var b=E._pendingSeekTime;E._pendingSeekTime=null,E.seek(b)})},d.prototype._onMetaDataArrived=function(a){this._emitter.emit(l.default.METADATA_ARRIVED,a)},d.prototype._onScriptDataArrived=function(a){this._emitter.emit(l.default.SCRIPTDATA_ARRIVED,a)},d.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},d.prototype._onIOComplete=function(a){var E=a,C=E+1;C<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(C)):(this._remuxer.flushStashedSamples(),this._emitter.emit(l.default.LOADING_COMPLETE),this._disableStatisticsReporter())},d.prototype._onIORedirect=function(a){var E=this._ioctl.extraData;this._mediaDataSource.segments[E].redirectedURL=a},d.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(l.default.RECOVERED_EARLY_EOF)},d.prototype._onIOException=function(a,E){o.default.e(this.TAG,"IOException: type = "+a+", code = "+E.code+", msg = "+E.msg),this._emitter.emit(l.default.IO_ERROR,a,E),this._disableStatisticsReporter()},d.prototype._onDemuxException=function(a,E){o.default.e(this.TAG,"DemuxException: type = "+a+", info = "+E),this._emitter.emit(l.default.DEMUX_ERROR,a,E)},d.prototype._onRemuxerInitSegmentArrival=function(a,E){this._emitter.emit(l.default.INIT_SEGMENT,a,E)},d.prototype._onRemuxerMediaSegmentArrival=function(a,E){if(this._pendingSeekTime==null&&(this._emitter.emit(l.default.MEDIA_SEGMENT,a,E),this._pendingResolveSeekPoint!=null&&a==="video")){var C=E.info.syncPoints,b=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,s.default.safari&&C.length>0&&C[0].originalDts===b&&(b=C[0].pts),this._emitter.emit(l.default.RECOMMEND_SEEKPOINT,b)}},d.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},d.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},d.prototype._reportSegmentMediaInfo=function(a){var E=this._mediaInfo.segments[a],C=Object.assign({},E);C.duration=this._mediaInfo.duration,C.segmentCount=this._mediaInfo.segmentCount,delete C.segments,delete C.keyframesIndex,this._emitter.emit(l.default.MEDIA_INFO,C)},d.prototype._reportStatisticsInfo=function(){var a={};a.url=this._ioctl.currentURL,a.hasRedirect=this._ioctl.hasRedirect,a.hasRedirect&&(a.redirectedURL=this._ioctl.currentRedirectedURL),a.speed=this._ioctl.currentSpeed,a.loaderType=this._ioctl.loaderType,a.currentSegmentIndex=this._currentSegmentIndex,a.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(l.default.STATISTICS_INFO,a)},d}();m.default=h},"./src/core/transmuxing-events.js":function(S,m,_){_.r(m);var g={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};m.default=g},"./src/core/transmuxing-worker.js":function(S,m,_){_.r(m);var g=_("./src/utils/logging-control.js"),u=_("./src/utils/polyfill.js"),o=_("./src/core/transmuxing-controller.js"),s=_("./src/core/transmuxing-events.js"),v=function(c){var p=null,y=R.bind(this);u.default.install(),c.addEventListener("message",function(L){switch(L.data.cmd){case"init":p=new o.default(L.data.param[0],L.data.param[1]),p.on(s.default.IO_ERROR,A.bind(this)),p.on(s.default.DEMUX_ERROR,T.bind(this)),p.on(s.default.INIT_SEGMENT,f.bind(this)),p.on(s.default.MEDIA_SEGMENT,l.bind(this)),p.on(s.default.LOADING_COMPLETE,h.bind(this)),p.on(s.default.RECOVERED_EARLY_EOF,d.bind(this)),p.on(s.default.MEDIA_INFO,a.bind(this)),p.on(s.default.METADATA_ARRIVED,E.bind(this)),p.on(s.default.SCRIPTDATA_ARRIVED,C.bind(this)),p.on(s.default.STATISTICS_INFO,b.bind(this)),p.on(s.default.RECOMMEND_SEEKPOINT,O.bind(this));break;case"destroy":p&&(p.destroy(),p=null),c.postMessage({msg:"destroyed"});break;case"start":p.start();break;case"stop":p.stop();break;case"seek":p.seek(L.data.param);break;case"pause":p.pause();break;case"resume":p.resume();break;case"logging_config":{var P=L.data.param;g.default.applyConfig(P),P.enableCallback===!0?g.default.addLogListener(y):g.default.removeLogListener(y);break}}});function f(L,P){var k={msg:s.default.INIT_SEGMENT,data:{type:L,data:P}};c.postMessage(k,[P.data])}function l(L,P){var k={msg:s.default.MEDIA_SEGMENT,data:{type:L,data:P}};c.postMessage(k,[P.data])}function h(){var L={msg:s.default.LOADING_COMPLETE};c.postMessage(L)}function d(){var L={msg:s.default.RECOVERED_EARLY_EOF};c.postMessage(L)}function a(L){var P={msg:s.default.MEDIA_INFO,data:L};c.postMessage(P)}function E(L){var P={msg:s.default.METADATA_ARRIVED,data:L};c.postMessage(P)}function C(L){var P={msg:s.default.SCRIPTDATA_ARRIVED,data:L};c.postMessage(P)}function b(L){var P={msg:s.default.STATISTICS_INFO,data:L};c.postMessage(P)}function A(L,P){c.postMessage({msg:s.default.IO_ERROR,data:{type:L,info:P}})}function T(L,P){c.postMessage({msg:s.default.DEMUX_ERROR,data:{type:L,info:P}})}function O(L){c.postMessage({msg:s.default.RECOMMEND_SEEKPOINT,data:L})}function R(L,P){c.postMessage({msg:"logcat_callback",data:{type:L,logcat:P}})}};m.default=v},"./src/demux/amf-parser.js":function(S,m,_){_.r(m);var g=_("./src/utils/logger.js"),u=_("./src/utils/utf8-conv.js"),o=_("./src/utils/exception.js"),s=function(){var c=new ArrayBuffer(2);return new DataView(c).setInt16(0,256,!0),new Int16Array(c)[0]===256}(),v=function(){function c(){}return c.parseScriptData=function(p,y,f){var l={};try{var h=c.parseValue(p,y,f),d=c.parseValue(p,y+h.size,f-h.size);l[h.data]=d.data}catch(a){g.default.e("AMF",a.toString())}return l},c.parseObject=function(p,y,f){if(f<3)throw new o.IllegalStateException("Data not enough when parse ScriptDataObject");var l=c.parseString(p,y,f),h=c.parseValue(p,y+l.size,f-l.size),d=h.objectEnd;return{data:{name:l.data,value:h.data},size:l.size+h.size,objectEnd:d}},c.parseVariable=function(p,y,f){return c.parseObject(p,y,f)},c.parseString=function(p,y,f){if(f<2)throw new o.IllegalStateException("Data not enough when parse String");var l=new DataView(p,y,f),h=l.getUint16(0,!s),d;return h>0?d=(0,u.default)(new Uint8Array(p,y+2,h)):d="",{data:d,size:2+h}},c.parseLongString=function(p,y,f){if(f<4)throw new o.IllegalStateException("Data not enough when parse LongString");var l=new DataView(p,y,f),h=l.getUint32(0,!s),d;return h>0?d=(0,u.default)(new Uint8Array(p,y+4,h)):d="",{data:d,size:4+h}},c.parseDate=function(p,y,f){if(f<10)throw new o.IllegalStateException("Data size invalid when parse Date");var l=new DataView(p,y,f),h=l.getFloat64(0,!s),d=l.getInt16(8,!s);return h+=d*60*1e3,{data:new Date(h),size:8+2}},c.parseValue=function(p,y,f){if(f<1)throw new o.IllegalStateException("Data not enough when parse Value");var l=new DataView(p,y,f),h=1,d=l.getUint8(0),a,E=!1;try{switch(d){case 0:a=l.getFloat64(1,!s),h+=8;break;case 1:{var C=l.getUint8(1);a=!!C,h+=1;break}case 2:{var b=c.parseString(p,y+1,f-1);a=b.data,h+=b.size;break}case 3:{a={};var A=0;for((l.getUint32(f-4,!s)&16777215)===9&&(A=3);h<f-4;){var T=c.parseObject(p,y+h,f-h-A);if(T.objectEnd)break;a[T.data.name]=T.data.value,h+=T.size}if(h<=f-3){var O=l.getUint32(h-1,!s)&16777215;O===9&&(h+=3)}break}case 8:{a={},h+=4;var A=0;for((l.getUint32(f-4,!s)&16777215)===9&&(A=3);h<f-8;){var R=c.parseVariable(p,y+h,f-h-A);if(R.objectEnd)break;a[R.data.name]=R.data.value,h+=R.size}if(h<=f-3){var O=l.getUint32(h-1,!s)&16777215;O===9&&(h+=3)}break}case 9:a=void 0,h=1,E=!0;break;case 10:{a=[];var L=l.getUint32(1,!s);h+=4;for(var P=0;P<L;P++){var k=c.parseValue(p,y+h,f-h);a.push(k.data),h+=k.size}break}case 11:{var I=c.parseDate(p,y+1,f-1);a=I.data,h+=I.size;break}case 12:{var F=c.parseString(p,y+1,f-1);a=F.data,h+=F.size;break}default:h=f,g.default.w("AMF","Unsupported AMF value type "+d)}}catch(q){g.default.e("AMF",q.toString())}return{data:a,size:h,objectEnd:E}},c}();m.default=v},"./src/demux/demux-errors.js":function(S,m,_){_.r(m);var g={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};m.default=g},"./src/demux/exp-golomb.js":function(S,m,_){_.r(m);var g=_("./src/utils/exception.js"),u=function(){function o(s){this.TAG="ExpGolomb",this._buffer=s,this._buffer_index=0,this._total_bytes=s.byteLength,this._total_bits=s.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return o.prototype.destroy=function(){this._buffer=null},o.prototype._fillCurrentWord=function(){var s=this._total_bytes-this._buffer_index;if(s<=0)throw new g.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var v=Math.min(4,s),c=new Uint8Array(4);c.set(this._buffer.subarray(this._buffer_index,this._buffer_index+v)),this._current_word=new DataView(c.buffer).getUint32(0,!1),this._buffer_index+=v,this._current_word_bits_left=v*8},o.prototype.readBits=function(s){if(s>32)throw new g.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(s<=this._current_word_bits_left){var v=this._current_word>>>32-s;return this._current_word<<=s,this._current_word_bits_left-=s,v}var c=this._current_word_bits_left?this._current_word:0;c=c>>>32-this._current_word_bits_left;var p=s-this._current_word_bits_left;this._fillCurrentWord();var y=Math.min(p,this._current_word_bits_left),f=this._current_word>>>32-y;return this._current_word<<=y,this._current_word_bits_left-=y,c=c<<y|f,c},o.prototype.readBool=function(){return this.readBits(1)===1},o.prototype.readByte=function(){return this.readBits(8)},o.prototype._skipLeadingZero=function(){var s;for(s=0;s<this._current_word_bits_left;s++)if(this._current_word&2147483648>>>s)return this._current_word<<=s,this._current_word_bits_left-=s,s;return this._fillCurrentWord(),s+this._skipLeadingZero()},o.prototype.readUEG=function(){var s=this._skipLeadingZero();return this.readBits(s+1)-1},o.prototype.readSEG=function(){var s=this.readUEG();return s&1?s+1>>>1:-1*(s>>>1)},o}();m.default=u},"./src/demux/flv-demuxer.js":function(S,m,_){_.r(m);var g=_("./src/utils/logger.js"),u=_("./src/demux/amf-parser.js"),o=_("./src/demux/sps-parser.js"),s=_("./src/demux/demux-errors.js"),v=_("./src/core/media-info.js"),c=_("./src/utils/exception.js");function p(f,l){return f[l]<<24|f[l+1]<<16|f[l+2]<<8|f[l+3]}var y=function(){function f(l,h){this.TAG="FLVDemuxer",this._config=h,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=l.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=l.hasAudioTrack,this._hasVideo=l.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new v.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var d=new ArrayBuffer(2);return new DataView(d).setInt16(0,256,!0),new Int16Array(d)[0]===256}()}return f.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},f.probe=function(l){var h=new Uint8Array(l),d={match:!1};if(h[0]!==70||h[1]!==76||h[2]!==86||h[3]!==1)return d;var a=(h[4]&4)>>>2!==0,E=(h[4]&1)!==0,C=p(h,5);return C<9?d:{match:!0,consumed:C,dataOffset:C,hasAudioTrack:a,hasVideoTrack:E}},f.prototype.bindDataSource=function(l){return l.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(f.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(l){this._onTrackMetadata=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(l){this._onMediaInfo=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(l){this._onMetaDataArrived=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(l){this._onScriptDataArrived=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onError",{get:function(){return this._onError},set:function(l){this._onError=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(l){this._onDataAvailable=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(l){this._timestampBase=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"overridedDuration",{get:function(){return this._duration},set:function(l){this._durationOverrided=!0,this._duration=l,this._mediaInfo.duration=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"overridedHasAudio",{set:function(l){this._hasAudioFlagOverrided=!0,this._hasAudio=l,this._mediaInfo.hasAudio=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"overridedHasVideo",{set:function(l){this._hasVideoFlagOverrided=!0,this._hasVideo=l,this._mediaInfo.hasVideo=l},enumerable:!1,configurable:!0}),f.prototype.resetMediaInfo=function(){this._mediaInfo=new v.default},f.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},f.prototype.parseChunks=function(l,h){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new c.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var d=0,a=this._littleEndian;if(h===0)if(l.byteLength>13){var E=f.probe(l);d=E.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,h+d!==this._dataOffset&&g.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var C=new DataView(l,d),b=C.getUint32(0,!a);b!==0&&g.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),d+=4}for(;d<l.byteLength;){this._dispatch=!0;var C=new DataView(l,d);if(d+11+4>l.byteLength)break;var A=C.getUint8(0),T=C.getUint32(0,!a)&16777215;if(d+11+T+4>l.byteLength)break;if(A!==8&&A!==9&&A!==18){g.default.w(this.TAG,"Unsupported tag type "+A+", skipped"),d+=11+T+4;continue}var O=C.getUint8(4),R=C.getUint8(5),L=C.getUint8(6),P=C.getUint8(7),k=L|R<<8|O<<16|P<<24,I=C.getUint32(7,!a)&16777215;I!==0&&g.default.w(this.TAG,"Meet tag which has StreamID != 0!");var F=d+11;switch(A){case 8:this._parseAudioData(l,F,T,k);break;case 9:this._parseVideoData(l,F,T,k,h+d);break;case 18:this._parseScriptData(l,F,T);break}var q=C.getUint32(11+T,!a);q!==11+T&&g.default.w(this.TAG,"Invalid PrevTagSize "+q),d+=11+T+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),d},f.prototype._parseScriptData=function(l,h,d){var a=u.default.parseScriptData(l,h,d);if(a.hasOwnProperty("onMetaData")){if(a.onMetaData==null||typeof a.onMetaData!="object"){g.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&g.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=a;var E=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},E)),typeof E.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=E.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof E.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=E.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof E.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=E.audiodatarate),typeof E.videodatarate=="number"&&(this._mediaInfo.videoDataRate=E.videodatarate),typeof E.width=="number"&&(this._mediaInfo.width=E.width),typeof E.height=="number"&&(this._mediaInfo.height=E.height),typeof E.duration=="number"){if(!this._durationOverrided){var C=Math.floor(E.duration*this._timescale);this._duration=C,this._mediaInfo.duration=C}}else this._mediaInfo.duration=0;if(typeof E.framerate=="number"){var b=Math.floor(E.framerate*1e3);if(b>0){var A=b/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=A,this._referenceFrameRate.fps_num=b,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=A}}if(typeof E.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var T=E.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(T),E.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=E,g.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(a).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},a))},f.prototype._parseKeyframesIndex=function(l){for(var h=[],d=[],a=1;a<l.times.length;a++){var E=this._timestampBase+Math.floor(l.times[a]*1e3);h.push(E),d.push(l.filepositions[a])}return{times:h,filepositions:d}},f.prototype._parseAudioData=function(l,h,d,a){if(d<=1){g.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var E=new DataView(l,h,d),C=E.getUint8(0),b=C>>>4;if(b!==2&&b!==10){this._onError(s.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+b);return}var A=0,T=(C&12)>>>2;if(T>=0&&T<=4)A=this._flvSoundRateTable[T];else{this._onError(s.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+T);return}var O=C&1,R=this._audioMetadata,L=this._audioTrack;if(R||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),R=this._audioMetadata={},R.type="audio",R.id=L.id,R.timescale=this._timescale,R.duration=this._duration,R.audioSampleRate=A,R.channelCount=O===0?1:2),b===10){var P=this._parseAACAudioData(l,h+1,d-1);if(P==null)return;if(P.packetType===0){R.config&&g.default.w(this.TAG,"Found another AudioSpecificConfig!");var k=P.data;R.audioSampleRate=k.samplingRate,R.channelCount=k.channelCount,R.codec=k.codec,R.originalCodec=k.originalCodec,R.config=k.config,R.refSampleDuration=1024/R.audioSampleRate*R.timescale,g.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",R);var I=this._mediaInfo;I.audioCodec=R.originalCodec,I.audioSampleRate=R.audioSampleRate,I.audioChannelCount=R.channelCount,I.hasVideo?I.videoCodec!=null&&(I.mimeType='video/x-flv; codecs="'+I.videoCodec+","+I.audioCodec+'"'):I.mimeType='video/x-flv; codecs="'+I.audioCodec+'"',I.isComplete()&&this._onMediaInfo(I)}else if(P.packetType===1){var F=this._timestampBase+a,q={unit:P.data,length:P.data.byteLength,dts:F,pts:F};L.samples.push(q),L.length+=P.data.length}else g.default.e(this.TAG,"Flv: Unsupported AAC data type "+P.packetType)}else if(b===2){if(!R.codec){var k=this._parseMP3AudioData(l,h+1,d-1,!0);if(k==null)return;R.audioSampleRate=k.samplingRate,R.channelCount=k.channelCount,R.codec=k.codec,R.originalCodec=k.originalCodec,R.refSampleDuration=1152/R.audioSampleRate*R.timescale,g.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",R);var I=this._mediaInfo;I.audioCodec=R.codec,I.audioSampleRate=R.audioSampleRate,I.audioChannelCount=R.channelCount,I.audioDataRate=k.bitRate,I.hasVideo?I.videoCodec!=null&&(I.mimeType='video/x-flv; codecs="'+I.videoCodec+","+I.audioCodec+'"'):I.mimeType='video/x-flv; codecs="'+I.audioCodec+'"',I.isComplete()&&this._onMediaInfo(I)}var Z=this._parseMP3AudioData(l,h+1,d-1,!1);if(Z==null)return;var F=this._timestampBase+a,$={unit:Z,length:Z.byteLength,dts:F,pts:F};L.samples.push($),L.length+=Z.length}}},f.prototype._parseAACAudioData=function(l,h,d){if(d<=1){g.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var a={},E=new Uint8Array(l,h,d);return a.packetType=E[0],E[0]===0?a.data=this._parseAACAudioSpecificConfig(l,h+1,d-1):a.data=E.subarray(1),a},f.prototype._parseAACAudioSpecificConfig=function(l,h,d){var a=new Uint8Array(l,h,d),E=null,C=0,b=0,A=0,T=null;if(C=b=a[0]>>>3,A=(a[0]&7)<<1|a[1]>>>7,A<0||A>=this._mpegSamplingRates.length){this._onError(s.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var O=this._mpegSamplingRates[A],R=(a[1]&120)>>>3;if(R<0||R>=8){this._onError(s.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}C===5&&(T=(a[1]&7)<<1|a[2]>>>7,(a[2]&124)>>>2);var L=self.navigator.userAgent.toLowerCase();return L.indexOf("firefox")!==-1?A>=6?(C=5,E=new Array(4),T=A-3):(C=2,E=new Array(2),T=A):L.indexOf("android")!==-1?(C=2,E=new Array(2),T=A):(C=5,T=A,E=new Array(4),A>=6?T=A-3:R===1&&(C=2,E=new Array(2),T=A)),E[0]=C<<3,E[0]|=(A&15)>>>1,E[1]=(A&15)<<7,E[1]|=(R&15)<<3,C===5&&(E[1]|=(T&15)>>>1,E[2]=(T&1)<<7,E[2]|=8,E[3]=0),{config:E,samplingRate:O,channelCount:R,codec:"mp4a.40."+C,originalCodec:"mp4a.40."+b}},f.prototype._parseMP3AudioData=function(l,h,d,a){if(d<4){g.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var E=new Uint8Array(l,h,d),C=null;if(a){if(E[0]!==255)return;var b=E[1]>>>3&3,A=(E[1]&6)>>1,T=(E[2]&240)>>>4,O=(E[2]&12)>>>2,R=E[3]>>>6&3,L=R!==3?2:1,P=0,k=0,I="mp3";switch(b){case 0:P=this._mpegAudioV25SampleRateTable[O];break;case 2:P=this._mpegAudioV20SampleRateTable[O];break;case 3:P=this._mpegAudioV10SampleRateTable[O];break}switch(A){case 1:T<this._mpegAudioL3BitRateTable.length&&(k=this._mpegAudioL3BitRateTable[T]);break;case 2:T<this._mpegAudioL2BitRateTable.length&&(k=this._mpegAudioL2BitRateTable[T]);break;case 3:T<this._mpegAudioL1BitRateTable.length&&(k=this._mpegAudioL1BitRateTable[T]);break}C={bitRate:k,samplingRate:P,channelCount:L,codec:I,originalCodec:I}}else C=E;return C},f.prototype._parseVideoData=function(l,h,d,a,E){if(d<=1){g.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var C=new Uint8Array(l,h,d)[0],b=(C&240)>>>4,A=C&15;if(A!==7){this._onError(s.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+A);return}this._parseAVCVideoPacket(l,h+1,d-1,a,E,b)}},f.prototype._parseAVCVideoPacket=function(l,h,d,a,E,C){if(d<4){g.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var b=this._littleEndian,A=new DataView(l,h,d),T=A.getUint8(0),O=A.getUint32(0,!b)&16777215,R=O<<8>>8;if(T===0)this._parseAVCDecoderConfigurationRecord(l,h+4,d-4);else if(T===1)this._parseAVCVideoData(l,h+4,d-4,a,E,C,R);else if(T!==2){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid video packet type "+T);return}},f.prototype._parseAVCDecoderConfigurationRecord=function(l,h,d){if(d<7){g.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var a=this._videoMetadata,E=this._videoTrack,C=this._littleEndian,b=new DataView(l,h,d);a?typeof a.avcc<"u"&&g.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),a=this._videoMetadata={},a.type="video",a.id=E.id,a.timescale=this._timescale,a.duration=this._duration);var A=b.getUint8(0),T=b.getUint8(1);if(b.getUint8(2),b.getUint8(3),A!==1||T===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(b.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(s.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var O=b.getUint8(5)&31;if(O===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else O>1&&g.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+O);for(var R=6,L=0;L<O;L++){var P=b.getUint16(R,!C);if(R+=2,P!==0){var k=new Uint8Array(l,h+R,P);R+=P;var I=o.default.parseSPS(k);if(L===0){a.codecWidth=I.codec_size.width,a.codecHeight=I.codec_size.height,a.presentWidth=I.present_size.width,a.presentHeight=I.present_size.height,a.profile=I.profile_string,a.level=I.level_string,a.bitDepth=I.bit_depth,a.chromaFormat=I.chroma_format,a.sarRatio=I.sar_ratio,a.frameRate=I.frame_rate,(I.frame_rate.fixed===!1||I.frame_rate.fps_num===0||I.frame_rate.fps_den===0)&&(a.frameRate=this._referenceFrameRate);var F=a.frameRate.fps_den,q=a.frameRate.fps_num;a.refSampleDuration=a.timescale*(F/q);for(var Z=k.subarray(1,4),$="avc1.",ne=0;ne<3;ne++){var fe=Z[ne].toString(16);fe.length<2&&(fe="0"+fe),$+=fe}a.codec=$;var Y=this._mediaInfo;Y.width=a.codecWidth,Y.height=a.codecHeight,Y.fps=a.frameRate.fps,Y.profile=a.profile,Y.level=a.level,Y.refFrames=I.ref_frames,Y.chromaFormat=I.chroma_format_string,Y.sarNum=a.sarRatio.width,Y.sarDen=a.sarRatio.height,Y.videoCodec=$,Y.hasAudio?Y.audioCodec!=null&&(Y.mimeType='video/x-flv; codecs="'+Y.videoCodec+","+Y.audioCodec+'"'):Y.mimeType='video/x-flv; codecs="'+Y.videoCodec+'"',Y.isComplete()&&this._onMediaInfo(Y)}}}var re=b.getUint8(R);if(re===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else re>1&&g.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+re);R++;for(var L=0;L<re;L++){var P=b.getUint16(R,!C);R+=2,P!==0&&(R+=P)}a.avcc=new Uint8Array(d),a.avcc.set(new Uint8Array(l,h,d),0),g.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",a)},f.prototype._parseAVCVideoData=function(l,h,d,a,E,C,b){for(var A=this._littleEndian,T=new DataView(l,h,d),O=[],R=0,L=0,P=this._naluLengthSize,k=this._timestampBase+a,I=C===1;L<d;){if(L+4>=d){g.default.w(this.TAG,"Malformed Nalu near timestamp "+k+", offset = "+L+", dataSize = "+d);break}var F=T.getUint32(L,!A);if(P===3&&(F>>>=8),F>d-P){g.default.w(this.TAG,"Malformed Nalus near timestamp "+k+", NaluSize > DataSize!");return}var q=T.getUint8(L+P)&31;q===5&&(I=!0);var Z=new Uint8Array(l,h+L,P+F),$={type:q,data:Z};O.push($),R+=Z.byteLength,L+=P+F}if(O.length){var ne=this._videoTrack,fe={units:O,length:R,isKeyframe:I,dts:k,cts:b,pts:k+b};I&&(fe.fileposition=E),ne.samples.push(fe),ne.length+=R}},f}();m.default=y},"./src/demux/sps-parser.js":function(S,m,_){_.r(m);var g=_("./src/demux/exp-golomb.js"),u=function(){function o(){}return o._ebsp2rbsp=function(s){for(var v=s,c=v.byteLength,p=new Uint8Array(c),y=0,f=0;f<c;f++)f>=2&&v[f]===3&&v[f-1]===0&&v[f-2]===0||(p[y]=v[f],y++);return new Uint8Array(p.buffer,0,y)},o.parseSPS=function(s){var v=o._ebsp2rbsp(s),c=new g.default(v);c.readByte();var p=c.readByte();c.readByte();var y=c.readByte();c.readUEG();var f=o.getProfileString(p),l=o.getLevelString(y),h=1,d=420,a=[0,420,422,444],E=8;if((p===100||p===110||p===122||p===244||p===44||p===83||p===86||p===118||p===128||p===138||p===144)&&(h=c.readUEG(),h===3&&c.readBits(1),h<=3&&(d=a[h]),E=c.readUEG()+8,c.readUEG(),c.readBits(1),c.readBool()))for(var C=h!==3?8:12,b=0;b<C;b++)c.readBool()&&(b<6?o._skipScalingList(c,16):o._skipScalingList(c,64));c.readUEG();var A=c.readUEG();if(A===0)c.readUEG();else if(A===1){c.readBits(1),c.readSEG(),c.readSEG();for(var T=c.readUEG(),b=0;b<T;b++)c.readSEG()}var O=c.readUEG();c.readBits(1);var R=c.readUEG(),L=c.readUEG(),P=c.readBits(1);P===0&&c.readBits(1),c.readBits(1);var k=0,I=0,F=0,q=0,Z=c.readBool();Z&&(k=c.readUEG(),I=c.readUEG(),F=c.readUEG(),q=c.readUEG());var $=1,ne=1,fe=0,Y=!0,re=0,Le=0,le=c.readBool();if(le){if(c.readBool()){var ue=c.readByte(),xe=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],pe=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];ue>0&&ue<16?($=xe[ue-1],ne=pe[ue-1]):ue===255&&($=c.readByte()<<8|c.readByte(),ne=c.readByte()<<8|c.readByte())}if(c.readBool()&&c.readBool(),c.readBool()&&(c.readBits(4),c.readBool()&&c.readBits(24)),c.readBool()&&(c.readUEG(),c.readUEG()),c.readBool()){var Ee=c.readBits(32),Se=c.readBits(32);Y=c.readBool(),re=Se,Le=Ee*2,fe=re/Le}}var de=1;($!==1||ne!==1)&&(de=$/ne);var H=0,Ce=0;if(h===0)H=1,Ce=2-P;else{var Ae=h===3?1:2,Be=h===1?2:1;H=Ae,Ce=Be*(2-P)}var Oe=(R+1)*16,Fe=(2-P)*((L+1)*16);Oe-=(k+I)*H,Fe-=(F+q)*Ce;var w=Math.ceil(Oe*de);return c.destroy(),c=null,{profile_string:f,level_string:l,bit_depth:E,ref_frames:O,chroma_format:d,chroma_format_string:o.getChromaFormatString(d),frame_rate:{fixed:Y,fps:fe,fps_den:Le,fps_num:re},sar_ratio:{width:$,height:ne},codec_size:{width:Oe,height:Fe},present_size:{width:w,height:Fe}}},o._skipScalingList=function(s,v){for(var c=8,p=8,y=0,f=0;f<v;f++)p!==0&&(y=s.readSEG(),p=(c+y+256)%256),c=p===0?c:p},o.getProfileString=function(s){switch(s){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},o.getLevelString=function(s){return(s/10).toFixed(1)},o.getChromaFormatString=function(s){switch(s){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},o}();m.default=u},"./src/flv.js":function(S,m,_){_.r(m);var g=_("./src/utils/polyfill.js"),u=_("./src/core/features.js"),o=_("./src/io/loader.js"),s=_("./src/player/flv-player.js"),v=_("./src/player/native-player.js"),c=_("./src/player/player-events.js"),p=_("./src/player/player-errors.js"),y=_("./src/utils/logging-control.js"),f=_("./src/utils/exception.js");g.default.install();function l(E,C){var b=E;if(b==null||typeof b!="object")throw new f.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!b.hasOwnProperty("type"))throw new f.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(b.type){case"flv":return new s.default(b,C);default:return new v.default(b,C)}}function h(){return u.default.supportMSEH264Playback()}function d(){return u.default.getFeatureList()}var a={};a.createPlayer=l,a.isSupported=h,a.getFeatureList=d,a.BaseLoader=o.BaseLoader,a.LoaderStatus=o.LoaderStatus,a.LoaderErrors=o.LoaderErrors,a.Events=c.default,a.ErrorTypes=p.ErrorTypes,a.ErrorDetails=p.ErrorDetails,a.FlvPlayer=s.default,a.NativePlayer=v.default,a.LoggingControl=y.default,Object.defineProperty(a,"version",{enumerable:!0,get:function(){return"1.6.2"}}),m.default=a},"./src/index.js":function(S,m,_){S.exports=_("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(S,m,_){_.r(m);var g=_("./src/utils/browser.js"),u=_("./src/io/loader.js"),o=_("./src/utils/exception.js"),s=function(){var c=function(p,y){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,l){f.__proto__=l}||function(f,l){for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(f[h]=l[h])},c(p,y)};return function(p,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");c(p,y);function f(){this.constructor=p}p.prototype=y===null?Object.create(y):(f.prototype=y.prototype,new f)}}(),v=function(c){s(p,c);function p(y,f){var l=c.call(this,"fetch-stream-loader")||this;return l.TAG="FetchStreamLoader",l._seekHandler=y,l._config=f,l._needStash=!0,l._requestAbort=!1,l._contentLength=null,l._receivedLength=0,l}return p.isSupported=function(){try{var y=g.default.msedge&&g.default.version.minor>=15048,f=g.default.msedge?y:!0;return self.fetch&&self.ReadableStream&&f}catch{return!1}},p.prototype.destroy=function(){this.isWorking()&&this.abort(),c.prototype.destroy.call(this)},p.prototype.open=function(y,f){var l=this;this._dataSource=y,this._range=f;var h=y.url;this._config.reuseRedirectedURL&&y.redirectedURL!=null&&(h=y.redirectedURL);var d=this._seekHandler.getConfig(h,f),a=new self.Headers;if(typeof d.headers=="object"){var E=d.headers;for(var C in E)E.hasOwnProperty(C)&&a.append(C,E[C])}var b={method:"GET",headers:a,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var C in this._config.headers)a.append(C,this._config.headers[C]);y.cors===!1&&(b.mode="same-origin"),y.withCredentials&&(b.credentials="include"),y.referrerPolicy&&(b.referrerPolicy=y.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,b.signal=this._abortController.signal),this._status=u.LoaderStatus.kConnecting,self.fetch(d.url,b).then(function(A){if(l._requestAbort){l._status=u.LoaderStatus.kIdle,A.body.cancel();return}if(A.ok&&A.status>=200&&A.status<=299){if(A.url!==d.url&&l._onURLRedirect){var T=l._seekHandler.removeURLParameters(A.url);l._onURLRedirect(T)}var O=A.headers.get("Content-Length");return O!=null&&(l._contentLength=parseInt(O),l._contentLength!==0&&l._onContentLengthKnown&&l._onContentLengthKnown(l._contentLength)),l._pump.call(l,A.body.getReader())}else if(l._status=u.LoaderStatus.kError,l._onError)l._onError(u.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:A.status,msg:A.statusText});else throw new o.RuntimeException("FetchStreamLoader: Http code invalid, "+A.status+" "+A.statusText)}).catch(function(A){if(!(l._abortController&&l._abortController.signal.aborted))if(l._status=u.LoaderStatus.kError,l._onError)l._onError(u.LoaderErrors.EXCEPTION,{code:-1,msg:A.message});else throw A})},p.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==u.LoaderStatus.kBuffering||!g.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},p.prototype._pump=function(y){var f=this;return y.read().then(function(l){if(l.done)if(f._contentLength!==null&&f._receivedLength<f._contentLength){f._status=u.LoaderStatus.kError;var h=u.LoaderErrors.EARLY_EOF,d={code:-1,msg:"Fetch stream meet Early-EOF"};if(f._onError)f._onError(h,d);else throw new o.RuntimeException(d.msg)}else f._status=u.LoaderStatus.kComplete,f._onComplete&&f._onComplete(f._range.from,f._range.from+f._receivedLength-1);else{if(f._abortController&&f._abortController.signal.aborted){f._status=u.LoaderStatus.kComplete;return}else if(f._requestAbort===!0)return f._status=u.LoaderStatus.kComplete,y.cancel();f._status=u.LoaderStatus.kBuffering;var a=l.value.buffer,E=f._range.from+f._receivedLength;f._receivedLength+=a.byteLength,f._onDataArrival&&f._onDataArrival(a,E,f._receivedLength),f._pump(y)}}).catch(function(l){if(f._abortController&&f._abortController.signal.aborted){f._status=u.LoaderStatus.kComplete;return}if(!(l.code===11&&g.default.msedge)){f._status=u.LoaderStatus.kError;var h=0,d=null;if((l.code===19||l.message==="network error")&&(f._contentLength===null||f._contentLength!==null&&f._receivedLength<f._contentLength)?(h=u.LoaderErrors.EARLY_EOF,d={code:l.code,msg:"Fetch stream meet Early-EOF"}):(h=u.LoaderErrors.EXCEPTION,d={code:l.code,msg:l.message}),f._onError)f._onError(h,d);else throw new o.RuntimeException(d.msg)}})},p}(u.BaseLoader);m.default=v},"./src/io/io-controller.js":function(S,m,_){_.r(m);var g=_("./src/utils/logger.js"),u=_("./src/io/speed-sampler.js"),o=_("./src/io/loader.js"),s=_("./src/io/fetch-stream-loader.js"),v=_("./src/io/xhr-moz-chunked-loader.js"),c=_("./src/io/xhr-range-loader.js"),p=_("./src/io/websocket-loader.js"),y=_("./src/io/range-seek-handler.js"),f=_("./src/io/param-seek-handler.js"),l=_("./src/utils/exception.js"),h=function(){function d(a,E,C){this.TAG="IOController",this._config=E,this._extraData=C,this._stashInitialSize=1024*384,E.stashInitialSize!=null&&E.stashInitialSize>0&&(this._stashInitialSize=E.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,E.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=a,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(a.url),this._refTotalLength=a.filesize?a.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new u.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return d.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},d.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},d.prototype.isPaused=function(){return this._paused},Object.defineProperty(d.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"extraData",{get:function(){return this._extraData},set:function(a){this._extraData=a},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(a){this._onDataArrival=a},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(a){this._onSeeked=a},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onError",{get:function(){return this._onError},set:function(a){this._onError=a},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onComplete",{get:function(){return this._onComplete},set:function(a){this._onComplete=a},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(a){this._onRedirect=a},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(a){this._onRecoveredEarlyEof=a},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"currentSpeed",{get:function(){return this._loaderClass===c.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),d.prototype._selectSeekHandler=function(){var a=this._config;if(a.seekType==="range")this._seekHandler=new y.default(this._config.rangeLoadZeroStart);else if(a.seekType==="param"){var E=a.seekParamStart||"bstart",C=a.seekParamEnd||"bend";this._seekHandler=new f.default(E,C)}else if(a.seekType==="custom"){if(typeof a.customSeekHandler!="function")throw new l.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new a.customSeekHandler}else throw new l.InvalidArgumentException("Invalid seekType in config: "+a.seekType)},d.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=p.default;else if(s.default.isSupported())this._loaderClass=s.default;else if(v.default.isSupported())this._loaderClass=v.default;else if(c.default.isSupported())this._loaderClass=c.default;else throw new l.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},d.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},d.prototype.open=function(a){this._currentRange={from:0,to:-1},a&&(this._currentRange.from=a),this._speedSampler.reset(),a||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},d.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},d.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},d.prototype.resume=function(){if(this._paused){this._paused=!1;var a=this._resumeFrom;this._resumeFrom=0,this._internalSeek(a,!0)}},d.prototype.seek=function(a){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(a,!0)},d.prototype._internalSeek=function(a,E){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(E),this._loader.destroy(),this._loader=null;var C={from:a,to:-1};this._currentRange={from:C.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,C),this._onSeeked&&this._onSeeked()},d.prototype.updateUrl=function(a){if(!a||typeof a!="string"||a.length===0)throw new l.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=a},d.prototype._expandBuffer=function(a){for(var E=this._stashSize;E+1024*1024*1<a;)E*=2;if(E+=1024*1024*1,E!==this._bufferSize){var C=new ArrayBuffer(E);if(this._stashUsed>0){var b=new Uint8Array(this._stashBuffer,0,this._stashUsed),A=new Uint8Array(C,0,E);A.set(b,0)}this._stashBuffer=C,this._bufferSize=E}},d.prototype._normalizeSpeed=function(a){var E=this._speedNormalizeList,C=E.length-1,b=0,A=0,T=C;if(a<E[0])return E[0];for(;A<=T;){if(b=A+Math.floor((T-A)/2),b===C||a>=E[b]&&a<E[b+1])return E[b];E[b]<a?A=b+1:T=b-1}},d.prototype._adjustStashSize=function(a){var E=0;this._config.isLive||a<512?E=a:a>=512&&a<=1024?E=Math.floor(a*1.5):E=a*2,E>8192&&(E=8192);var C=E*1024+1024*1024*1;this._bufferSize<C&&this._expandBuffer(C),this._stashSize=E*1024},d.prototype._dispatchChunks=function(a,E){return this._currentRange.to=E+a.byteLength-1,this._onDataArrival(a,E)},d.prototype._onURLRedirect=function(a){this._redirectedURL=a,this._onRedirect&&this._onRedirect(a)},d.prototype._onContentLengthKnown=function(a){a&&this._fullRequestFlag&&(this._totalLength=a,this._fullRequestFlag=!1)},d.prototype._onLoaderChunkArrival=function(a,E,C){if(!this._onDataArrival)throw new l.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(a.byteLength);var b=this._speedSampler.lastSecondKBps;if(b!==0){var A=this._normalizeSpeed(b);this._speedNormalized!==A&&(this._speedNormalized=A,this._adjustStashSize(A))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=E),this._stashUsed+a.byteLength<=this._stashSize){var R=new Uint8Array(this._stashBuffer,0,this._stashSize);R.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength}else{var R=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var P=this._stashBuffer.slice(0,this._stashUsed),T=this._dispatchChunks(P,this._stashByteStart);if(T<P.byteLength){if(T>0){var L=new Uint8Array(P,T);R.set(L,0),this._stashUsed=L.byteLength,this._stashByteStart+=T}}else this._stashUsed=0,this._stashByteStart+=T;this._stashUsed+a.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+a.byteLength),R=new Uint8Array(this._stashBuffer,0,this._bufferSize)),R.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength}else{var T=this._dispatchChunks(a,E);if(T<a.byteLength){var O=a.byteLength-T;O>this._bufferSize&&(this._expandBuffer(O),R=new Uint8Array(this._stashBuffer,0,this._bufferSize)),R.set(new Uint8Array(a,T),0),this._stashUsed+=O,this._stashByteStart=E+T}}}else if(this._stashUsed===0){var T=this._dispatchChunks(a,E);if(T<a.byteLength){var O=a.byteLength-T;O>this._bufferSize&&this._expandBuffer(O);var R=new Uint8Array(this._stashBuffer,0,this._bufferSize);R.set(new Uint8Array(a,T),0),this._stashUsed+=O,this._stashByteStart=E+T}}else{this._stashUsed+a.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+a.byteLength);var R=new Uint8Array(this._stashBuffer,0,this._bufferSize);R.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength;var T=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(T<this._stashUsed&&T>0){var L=new Uint8Array(this._stashBuffer,T);R.set(L,0)}this._stashUsed-=T,this._stashByteStart+=T}}},d.prototype._flushStashBuffer=function(a){if(this._stashUsed>0){var E=this._stashBuffer.slice(0,this._stashUsed),C=this._dispatchChunks(E,this._stashByteStart),b=E.byteLength-C;if(C<E.byteLength)if(a)g.default.w(this.TAG,b+" bytes unconsumed data remain when flush buffer, dropped");else{if(C>0){var A=new Uint8Array(this._stashBuffer,0,this._bufferSize),T=new Uint8Array(E,C);A.set(T,0),this._stashUsed=T.byteLength,this._stashByteStart+=C}return 0}return this._stashUsed=0,this._stashByteStart=0,b}return 0},d.prototype._onLoaderComplete=function(a,E){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},d.prototype._onLoaderError=function(a,E){switch(g.default.e(this.TAG,"Loader error, code = "+E.code+", msg = "+E.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,a=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF),a){case o.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var C=this._currentRange.to+1;C<this._totalLength&&(g.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(C,!1));return}a=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case o.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case o.LoaderErrors.CONNECTING_TIMEOUT:case o.LoaderErrors.HTTP_STATUS_CODE_INVALID:case o.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(a,E);else throw new l.RuntimeException("IOException: "+E.msg)},d}();m.default=h},"./src/io/loader.js":function(S,m,_){_.r(m),_.d(m,{LoaderStatus:function(){return u},LoaderErrors:function(){return o},BaseLoader:function(){return s}});var g=_("./src/utils/exception.js"),u={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},o={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},s=function(){function v(c){this._type=c||"undefined",this._status=u.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return v.prototype.destroy=function(){this._status=u.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},v.prototype.isWorking=function(){return this._status===u.kConnecting||this._status===u.kBuffering},Object.defineProperty(v.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(c){this._onContentLengthKnown=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(c){this._onURLRedirect=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(c){this._onDataArrival=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onError",{get:function(){return this._onError},set:function(c){this._onError=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onComplete",{get:function(){return this._onComplete},set:function(c){this._onComplete=c},enumerable:!1,configurable:!0}),v.prototype.open=function(c,p){throw new g.NotImplementedException("Unimplemented abstract function!")},v.prototype.abort=function(){throw new g.NotImplementedException("Unimplemented abstract function!")},v}()},"./src/io/param-seek-handler.js":function(S,m,_){_.r(m);var g=function(){function u(o,s){this._startName=o,this._endName=s}return u.prototype.getConfig=function(o,s){var v=o;if(s.from!==0||s.to!==-1){var c=!0;v.indexOf("?")===-1&&(v+="?",c=!1),c&&(v+="&"),v+=this._startName+"="+s.from.toString(),s.to!==-1&&(v+="&"+this._endName+"="+s.to.toString())}return{url:v,headers:{}}},u.prototype.removeURLParameters=function(o){var s=o.split("?")[0],v=void 0,c=o.indexOf("?");c!==-1&&(v=o.substring(c+1));var p="";if(v!=null&&v.length>0)for(var y=v.split("&"),f=0;f<y.length;f++){var l=y[f].split("="),h=f>0;l[0]!==this._startName&&l[0]!==this._endName&&(h&&(p+="&"),p+=y[f])}return p.length===0?s:s+"?"+p},u}();m.default=g},"./src/io/range-seek-handler.js":function(S,m,_){_.r(m);var g=function(){function u(o){this._zeroStart=o||!1}return u.prototype.getConfig=function(o,s){var v={};if(s.from!==0||s.to!==-1){var c=void 0;s.to!==-1?c="bytes="+s.from.toString()+"-"+s.to.toString():c="bytes="+s.from.toString()+"-",v.Range=c}else this._zeroStart&&(v.Range="bytes=0-");return{url:o,headers:v}},u.prototype.removeURLParameters=function(o){return o},u}();m.default=g},"./src/io/speed-sampler.js":function(S,m,_){_.r(m);var g=function(){function u(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return u.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},u.prototype.addBytes=function(o){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=o,this._totalBytes+=o):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=o,this._totalBytes+=o):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=o,this._totalBytes+=o,this._lastCheckpoint=this._now())},Object.defineProperty(u.prototype,"currentKBps",{get:function(){this.addBytes(0);var o=(this._now()-this._lastCheckpoint)/1e3;return o==0&&(o=1),this._intervalBytes/o/1024},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"averageKBps",{get:function(){var o=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/o/1024},enumerable:!1,configurable:!0}),u}();m.default=g},"./src/io/websocket-loader.js":function(S,m,_){_.r(m);var g=_("./src/io/loader.js"),u=_("./src/utils/exception.js"),o=function(){var v=function(c,p){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,f){y.__proto__=f}||function(y,f){for(var l in f)Object.prototype.hasOwnProperty.call(f,l)&&(y[l]=f[l])},v(c,p)};return function(c,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");v(c,p);function y(){this.constructor=c}c.prototype=p===null?Object.create(p):(y.prototype=p.prototype,new y)}}(),s=function(v){o(c,v);function c(){var p=v.call(this,"websocket-loader")||this;return p.TAG="WebSocketLoader",p._needStash=!0,p._ws=null,p._requestAbort=!1,p._receivedLength=0,p}return c.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},c.prototype.destroy=function(){this._ws&&this.abort(),v.prototype.destroy.call(this)},c.prototype.open=function(p){try{var y=this._ws=new self.WebSocket(p.url);y.binaryType="arraybuffer",y.onopen=this._onWebSocketOpen.bind(this),y.onclose=this._onWebSocketClose.bind(this),y.onmessage=this._onWebSocketMessage.bind(this),y.onerror=this._onWebSocketError.bind(this),this._status=g.LoaderStatus.kConnecting}catch(l){this._status=g.LoaderStatus.kError;var f={code:l.code,msg:l.message};if(this._onError)this._onError(g.LoaderErrors.EXCEPTION,f);else throw new u.RuntimeException(f.msg)}},c.prototype.abort=function(){var p=this._ws;p&&(p.readyState===0||p.readyState===1)&&(this._requestAbort=!0,p.close()),this._ws=null,this._status=g.LoaderStatus.kComplete},c.prototype._onWebSocketOpen=function(p){this._status=g.LoaderStatus.kBuffering},c.prototype._onWebSocketClose=function(p){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=g.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},c.prototype._onWebSocketMessage=function(p){var y=this;if(p.data instanceof ArrayBuffer)this._dispatchArrayBuffer(p.data);else if(p.data instanceof Blob){var f=new FileReader;f.onload=function(){y._dispatchArrayBuffer(f.result)},f.readAsArrayBuffer(p.data)}else{this._status=g.LoaderStatus.kError;var l={code:-1,msg:"Unsupported WebSocket message type: "+p.data.constructor.name};if(this._onError)this._onError(g.LoaderErrors.EXCEPTION,l);else throw new u.RuntimeException(l.msg)}},c.prototype._dispatchArrayBuffer=function(p){var y=p,f=this._receivedLength;this._receivedLength+=y.byteLength,this._onDataArrival&&this._onDataArrival(y,f,this._receivedLength)},c.prototype._onWebSocketError=function(p){this._status=g.LoaderStatus.kError;var y={code:p.code,msg:p.message};if(this._onError)this._onError(g.LoaderErrors.EXCEPTION,y);else throw new u.RuntimeException(y.msg)},c}(g.BaseLoader);m.default=s},"./src/io/xhr-moz-chunked-loader.js":function(S,m,_){_.r(m);var g=_("./src/utils/logger.js"),u=_("./src/io/loader.js"),o=_("./src/utils/exception.js"),s=function(){var c=function(p,y){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,l){f.__proto__=l}||function(f,l){for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(f[h]=l[h])},c(p,y)};return function(p,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");c(p,y);function f(){this.constructor=p}p.prototype=y===null?Object.create(y):(f.prototype=y.prototype,new f)}}(),v=function(c){s(p,c);function p(y,f){var l=c.call(this,"xhr-moz-chunked-loader")||this;return l.TAG="MozChunkedLoader",l._seekHandler=y,l._config=f,l._needStash=!0,l._xhr=null,l._requestAbort=!1,l._contentLength=null,l._receivedLength=0,l}return p.isSupported=function(){try{var y=new XMLHttpRequest;return y.open("GET","https://example.com",!0),y.responseType="moz-chunked-arraybuffer",y.responseType==="moz-chunked-arraybuffer"}catch(f){return g.default.w("MozChunkedLoader",f.message),!1}},p.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),c.prototype.destroy.call(this)},p.prototype.open=function(y,f){this._dataSource=y,this._range=f;var l=y.url;this._config.reuseRedirectedURL&&y.redirectedURL!=null&&(l=y.redirectedURL);var h=this._seekHandler.getConfig(l,f);this._requestURL=h.url;var d=this._xhr=new XMLHttpRequest;if(d.open("GET",h.url,!0),d.responseType="moz-chunked-arraybuffer",d.onreadystatechange=this._onReadyStateChange.bind(this),d.onprogress=this._onProgress.bind(this),d.onloadend=this._onLoadEnd.bind(this),d.onerror=this._onXhrError.bind(this),y.withCredentials&&(d.withCredentials=!0),typeof h.headers=="object"){var a=h.headers;for(var E in a)a.hasOwnProperty(E)&&d.setRequestHeader(E,a[E])}if(typeof this._config.headers=="object"){var a=this._config.headers;for(var E in a)a.hasOwnProperty(E)&&d.setRequestHeader(E,a[E])}this._status=u.LoaderStatus.kConnecting,d.send()},p.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=u.LoaderStatus.kComplete},p.prototype._onReadyStateChange=function(y){var f=y.target;if(f.readyState===2){if(f.responseURL!=null&&f.responseURL!==this._requestURL&&this._onURLRedirect){var l=this._seekHandler.removeURLParameters(f.responseURL);this._onURLRedirect(l)}if(f.status!==0&&(f.status<200||f.status>299))if(this._status=u.LoaderStatus.kError,this._onError)this._onError(u.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:f.status,msg:f.statusText});else throw new o.RuntimeException("MozChunkedLoader: Http code invalid, "+f.status+" "+f.statusText);else this._status=u.LoaderStatus.kBuffering}},p.prototype._onProgress=function(y){if(this._status!==u.LoaderStatus.kError){this._contentLength===null&&y.total!==null&&y.total!==0&&(this._contentLength=y.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var f=y.target.response,l=this._range.from+this._receivedLength;this._receivedLength+=f.byteLength,this._onDataArrival&&this._onDataArrival(f,l,this._receivedLength)}},p.prototype._onLoadEnd=function(y){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===u.LoaderStatus.kError)return;this._status=u.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},p.prototype._onXhrError=function(y){this._status=u.LoaderStatus.kError;var f=0,l=null;if(this._contentLength&&y.loaded<this._contentLength?(f=u.LoaderErrors.EARLY_EOF,l={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(f=u.LoaderErrors.EXCEPTION,l={code:-1,msg:y.constructor.name+" "+y.type}),this._onError)this._onError(f,l);else throw new o.RuntimeException(l.msg)},p}(u.BaseLoader);m.default=v},"./src/io/xhr-range-loader.js":function(S,m,_){_.r(m);var g=_("./src/utils/logger.js"),u=_("./src/io/speed-sampler.js"),o=_("./src/io/loader.js"),s=_("./src/utils/exception.js"),v=function(){var p=function(y,f){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var d in h)Object.prototype.hasOwnProperty.call(h,d)&&(l[d]=h[d])},p(y,f)};return function(y,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");p(y,f);function l(){this.constructor=y}y.prototype=f===null?Object.create(f):(l.prototype=f.prototype,new l)}}(),c=function(p){v(y,p);function y(f,l){var h=p.call(this,"xhr-range-loader")||this;return h.TAG="RangeLoader",h._seekHandler=f,h._config=l,h._needStash=!1,h._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],h._currentChunkSizeKB=384,h._currentSpeedNormalized=0,h._zeroSpeedChunkCount=0,h._xhr=null,h._speedSampler=new u.default,h._requestAbort=!1,h._waitForTotalLength=!1,h._totalLengthReceived=!1,h._currentRequestURL=null,h._currentRedirectedURL=null,h._currentRequestRange=null,h._totalLength=null,h._contentLength=null,h._receivedLength=0,h._lastTimeLoaded=0,h}return y.isSupported=function(){try{var f=new XMLHttpRequest;return f.open("GET","https://example.com",!0),f.responseType="arraybuffer",f.responseType==="arraybuffer"}catch(l){return g.default.w("RangeLoader",l.message),!1}},y.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),p.prototype.destroy.call(this)},Object.defineProperty(y.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),y.prototype.open=function(f,l){this._dataSource=f,this._range=l,this._status=o.LoaderStatus.kConnecting;var h=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(h=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!h?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},y.prototype._openSubRange=function(){var f=this._currentChunkSizeKB*1024,l=this._range.from+this._receivedLength,h=l+f;this._contentLength!=null&&h-this._range.from>=this._contentLength&&(h=this._range.from+this._contentLength-1),this._currentRequestRange={from:l,to:h},this._internalOpen(this._dataSource,this._currentRequestRange)},y.prototype._internalOpen=function(f,l){this._lastTimeLoaded=0;var h=f.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?h=this._currentRedirectedURL:f.redirectedURL!=null&&(h=f.redirectedURL));var d=this._seekHandler.getConfig(h,l);this._currentRequestURL=d.url;var a=this._xhr=new XMLHttpRequest;if(a.open("GET",d.url,!0),a.responseType="arraybuffer",a.onreadystatechange=this._onReadyStateChange.bind(this),a.onprogress=this._onProgress.bind(this),a.onload=this._onLoad.bind(this),a.onerror=this._onXhrError.bind(this),f.withCredentials&&(a.withCredentials=!0),typeof d.headers=="object"){var E=d.headers;for(var C in E)E.hasOwnProperty(C)&&a.setRequestHeader(C,E[C])}if(typeof this._config.headers=="object"){var E=this._config.headers;for(var C in E)E.hasOwnProperty(C)&&a.setRequestHeader(C,E[C])}a.send()},y.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=o.LoaderStatus.kComplete},y.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},y.prototype._onReadyStateChange=function(f){var l=f.target;if(l.readyState===2){if(l.responseURL!=null){var h=this._seekHandler.removeURLParameters(l.responseURL);l.responseURL!==this._currentRequestURL&&h!==this._currentRedirectedURL&&(this._currentRedirectedURL=h,this._onURLRedirect&&this._onURLRedirect(h))}if(l.status>=200&&l.status<=299){if(this._waitForTotalLength)return;this._status=o.LoaderStatus.kBuffering}else if(this._status=o.LoaderStatus.kError,this._onError)this._onError(o.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:l.status,msg:l.statusText});else throw new s.RuntimeException("RangeLoader: Http code invalid, "+l.status+" "+l.statusText)}},y.prototype._onProgress=function(f){if(this._status!==o.LoaderStatus.kError){if(this._contentLength===null){var l=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,l=!0;var h=f.total;this._internalAbort(),h!=null&h!==0&&(this._totalLength=h)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,l){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var d=f.loaded-this._lastTimeLoaded;this._lastTimeLoaded=f.loaded,this._speedSampler.addBytes(d)}},y.prototype._normalizeSpeed=function(f){var l=this._chunkSizeKBList,h=l.length-1,d=0,a=0,E=h;if(f<l[0])return l[0];for(;a<=E;){if(d=a+Math.floor((E-a)/2),d===h||f>=l[d]&&f<l[d+1])return l[d];l[d]<f?a=d+1:E=d-1}},y.prototype._onLoad=function(f){if(this._status!==o.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var l=this._speedSampler.lastSecondKBps;if(l===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(l=this._speedSampler.currentKBps)),l!==0){var h=this._normalizeSpeed(l);this._currentSpeedNormalized!==h&&(this._currentSpeedNormalized=h,this._currentChunkSizeKB=h)}var d=f.target.response,a=this._range.from+this._receivedLength;this._receivedLength+=d.byteLength;var E=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():E=!0,this._onDataArrival&&this._onDataArrival(d,a,this._receivedLength),E&&(this._status=o.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},y.prototype._onXhrError=function(f){this._status=o.LoaderStatus.kError;var l=0,h=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(l=o.LoaderErrors.EARLY_EOF,h={code:-1,msg:"RangeLoader meet Early-Eof"}):(l=o.LoaderErrors.EXCEPTION,h={code:-1,msg:f.constructor.name+" "+f.type}),this._onError)this._onError(l,h);else throw new s.RuntimeException(h.msg)},y}(o.BaseLoader);m.default=c},"./src/player/flv-player.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),u=_.n(g),o=_("./src/utils/logger.js"),s=_("./src/utils/browser.js"),v=_("./src/player/player-events.js"),c=_("./src/core/transmuxer.js"),p=_("./src/core/transmuxing-events.js"),y=_("./src/core/mse-controller.js"),f=_("./src/core/mse-events.js"),l=_("./src/player/player-errors.js"),h=_("./src/config.js"),d=_("./src/utils/exception.js"),a=function(){function E(C,b){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(u()),this._config=(0,h.createDefaultConfig)(),typeof b=="object"&&Object.assign(this._config,b),C.type.toLowerCase()!=="flv")throw new d.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");C.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=C,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var A=s.default.chrome&&(s.default.version.major<50||s.default.version.major===50&&s.default.version.build<2661);this._alwaysSeekKeyframe=!!(A||s.default.msedge||s.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return E.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},E.prototype.on=function(C,b){var A=this;C===v.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){A._emitter.emit(v.default.MEDIA_INFO,A.mediaInfo)}):C===v.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){A._emitter.emit(v.default.STATISTICS_INFO,A.statisticsInfo)}),this._emitter.addListener(C,b)},E.prototype.off=function(C,b){this._emitter.removeListener(C,b)},E.prototype.attachMediaElement=function(C){var b=this;if(this._mediaElement=C,C.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),C.addEventListener("seeking",this.e.onvSeeking),C.addEventListener("canplay",this.e.onvCanPlay),C.addEventListener("stalled",this.e.onvStalled),C.addEventListener("progress",this.e.onvProgress),this._msectl=new y.default(this._config),this._msectl.on(f.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(f.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(f.default.SOURCE_OPEN,function(){b._mseSourceOpened=!0,b._hasPendingLoad&&(b._hasPendingLoad=!1,b.load())}),this._msectl.on(f.default.ERROR,function(A){b._emitter.emit(v.default.ERROR,l.ErrorTypes.MEDIA_ERROR,l.ErrorDetails.MEDIA_MSE_ERROR,A)}),this._msectl.attachMediaElement(C),this._pendingSeekTime!=null)try{C.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},E.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},E.prototype.load=function(){var C=this;if(!this._mediaElement)throw new d.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new d.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new c.default(this._mediaDataSource,this._config),this._transmuxer.on(p.default.INIT_SEGMENT,function(b,A){C._msectl.appendInitSegment(A)}),this._transmuxer.on(p.default.MEDIA_SEGMENT,function(b,A){if(C._msectl.appendMediaSegment(A),C._config.lazyLoad&&!C._config.isLive){var T=C._mediaElement.currentTime;A.info.endDts>=(T+C._config.lazyLoadMaxDuration)*1e3&&C._progressChecker==null&&(o.default.v(C.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),C._suspendTransmuxer())}}),this._transmuxer.on(p.default.LOADING_COMPLETE,function(){C._msectl.endOfStream(),C._emitter.emit(v.default.LOADING_COMPLETE)}),this._transmuxer.on(p.default.RECOVERED_EARLY_EOF,function(){C._emitter.emit(v.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(p.default.IO_ERROR,function(b,A){C._emitter.emit(v.default.ERROR,l.ErrorTypes.NETWORK_ERROR,b,A)}),this._transmuxer.on(p.default.DEMUX_ERROR,function(b,A){C._emitter.emit(v.default.ERROR,l.ErrorTypes.MEDIA_ERROR,b,{code:-1,msg:A})}),this._transmuxer.on(p.default.MEDIA_INFO,function(b){C._mediaInfo=b,C._emitter.emit(v.default.MEDIA_INFO,Object.assign({},b))}),this._transmuxer.on(p.default.METADATA_ARRIVED,function(b){C._emitter.emit(v.default.METADATA_ARRIVED,b)}),this._transmuxer.on(p.default.SCRIPTDATA_ARRIVED,function(b){C._emitter.emit(v.default.SCRIPTDATA_ARRIVED,b)}),this._transmuxer.on(p.default.STATISTICS_INFO,function(b){C._statisticsInfo=C._fillStatisticsInfo(b),C._emitter.emit(v.default.STATISTICS_INFO,Object.assign({},C._statisticsInfo))}),this._transmuxer.on(p.default.RECOMMEND_SEEKPOINT,function(b){C._mediaElement&&!C._config.accurateSeek&&(C._requestSetTime=!0,C._mediaElement.currentTime=b/1e3)}),this._transmuxer.open()}},E.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},E.prototype.play=function(){return this._mediaElement.play()},E.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(E.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(C){this._mediaElement.volume=C},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(C){this._mediaElement.muted=C},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(C){this._mediaElement?this._internalSeek(C):this._pendingSeekTime=C},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),E.prototype._fillStatisticsInfo=function(C){if(C.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return C;var b=!0,A=0,T=0;if(this._mediaElement.getVideoPlaybackQuality){var O=this._mediaElement.getVideoPlaybackQuality();A=O.totalVideoFrames,T=O.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(A=this._mediaElement.webkitDecodedFrameCount,T=this._mediaElement.webkitDroppedFrameCount):b=!1;return b&&(C.decodedFrames=A,C.droppedFrames=T),C},E.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var C=this._mediaElement.buffered,b=this._mediaElement.currentTime,A=0,T=0;T<C.length;T++){var O=C.start(T),R=C.end(T);if(O<=b&&b<R){A=R;break}}A>=b+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(o.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},E.prototype._onmseBufferFull=function(){o.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},E.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},E.prototype._checkProgressAndResume=function(){for(var C=this._mediaElement.currentTime,b=this._mediaElement.buffered,A=!1,T=0;T<b.length;T++){var O=b.start(T),R=b.end(T);if(C>=O&&C<R){C>=R-this._config.lazyLoadRecoverDuration&&(A=!0);break}}A&&(window.clearInterval(this._progressChecker),this._progressChecker=null,A&&(o.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},E.prototype._isTimepointBuffered=function(C){for(var b=this._mediaElement.buffered,A=0;A<b.length;A++){var T=b.start(A),O=b.end(A);if(C>=T&&C<O)return!0}return!1},E.prototype._internalSeek=function(C){var b=this._isTimepointBuffered(C),A=!1,T=0;if(C<1&&this._mediaElement.buffered.length>0){var O=this._mediaElement.buffered.start(0);(O<1&&C<O||s.default.safari)&&(A=!0,T=s.default.safari?.1:O)}if(A)this._requestSetTime=!0,this._mediaElement.currentTime=T;else if(b){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=C;else{var R=this._msectl.getNearestKeyframe(Math.floor(C*1e3));this._requestSetTime=!0,R!=null?this._mediaElement.currentTime=R.dts/1e3:this._mediaElement.currentTime=C}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(C),this._transmuxer.seek(Math.floor(C*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=C)},E.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var C=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(C)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(C),this._transmuxer.seek(Math.floor(C*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=C))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},E.prototype._checkAndResumeStuckPlayback=function(C){var b=this._mediaElement;if(C||!this._receivedCanPlay||b.readyState<2){var A=b.buffered;A.length>0&&b.currentTime<A.start(0)&&(o.default.w(this.TAG,"Playback seems stuck at "+b.currentTime+", seek to "+A.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=A.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},E.prototype._onvLoadedMetadata=function(C){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},E.prototype._onvSeeking=function(C){var b=this._mediaElement.currentTime,A=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(b<1&&A.length>0){var T=A.start(0);if(T<1&&b<T||s.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=s.default.safari?.1:T;return}}if(this._isTimepointBuffered(b)){if(this._alwaysSeekKeyframe){var O=this._msectl.getNearestKeyframe(Math.floor(b*1e3));O!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=O.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:b,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},E.prototype._onvCanPlay=function(C){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},E.prototype._onvStalled=function(C){this._checkAndResumeStuckPlayback(!0)},E.prototype._onvProgress=function(C){this._checkAndResumeStuckPlayback()},E}();m.default=a},"./src/player/native-player.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),u=_.n(g),o=_("./src/player/player-events.js"),s=_("./src/config.js"),v=_("./src/utils/exception.js"),c=function(){function p(y,f){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(u()),this._config=(0,s.createDefaultConfig)(),typeof f=="object"&&Object.assign(this._config,f),y.type.toLowerCase()==="flv")throw new v.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(y.hasOwnProperty("segments"))throw new v.InvalidArgumentException("NativePlayer("+y.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=y,this._mediaElement=null}return p.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},p.prototype.on=function(y,f){var l=this;y===o.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){l._emitter.emit(o.default.MEDIA_INFO,l.mediaInfo)}):y===o.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){l._emitter.emit(o.default.STATISTICS_INFO,l.statisticsInfo)}),this._emitter.addListener(y,f)},p.prototype.off=function(y,f){this._emitter.removeListener(y,f)},p.prototype.attachMediaElement=function(y){if(this._mediaElement=y,y.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{y.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},p.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},p.prototype.load=function(){if(!this._mediaElement)throw new v.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},p.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},p.prototype.play=function(){return this._mediaElement.play()},p.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(p.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(y){this._mediaElement.volume=y},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(y){this._mediaElement.muted=y},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(y){this._mediaElement?this._mediaElement.currentTime=y:this._pendingSeekTime=y},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"mediaInfo",{get:function(){var y=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",f={mimeType:y+this._mediaDataSource.type};return this._mediaElement&&(f.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(f.width=this._mediaElement.videoWidth,f.height=this._mediaElement.videoHeight)),f},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"statisticsInfo",{get:function(){var y={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return y;var f=!0,l=0,h=0;if(this._mediaElement.getVideoPlaybackQuality){var d=this._mediaElement.getVideoPlaybackQuality();l=d.totalVideoFrames,h=d.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(l=this._mediaElement.webkitDecodedFrameCount,h=this._mediaElement.webkitDroppedFrameCount):f=!1;return f&&(y.decodedFrames=l,y.droppedFrames=h),y},enumerable:!1,configurable:!0}),p.prototype._onvLoadedMetadata=function(y){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(o.default.MEDIA_INFO,this.mediaInfo)},p.prototype._reportStatisticsInfo=function(){this._emitter.emit(o.default.STATISTICS_INFO,this.statisticsInfo)},p}();m.default=c},"./src/player/player-errors.js":function(S,m,_){_.r(m),_.d(m,{ErrorTypes:function(){return o},ErrorDetails:function(){return s}});var g=_("./src/io/loader.js"),u=_("./src/demux/demux-errors.js"),o={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},s={NETWORK_EXCEPTION:g.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:g.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:g.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:g.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:u.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:u.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:u.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(S,m,_){_.r(m);var g={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};m.default=g},"./src/remux/aac-silent.js":function(S,m,_){_.r(m);var g=function(){function u(){}return u.getSilentFrame=function(o,s){if(o==="mp4a.40.2"){if(s===1)return new Uint8Array([0,200,0,128,35,128]);if(s===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(s===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(s===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(s===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(s===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(s===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},u}();m.default=g},"./src/remux/mp4-generator.js":function(S,m,_){_.r(m);var g=function(){function u(){}return u.init=function(){u.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var o in u.types)u.types.hasOwnProperty(o)&&(u.types[o]=[o.charCodeAt(0),o.charCodeAt(1),o.charCodeAt(2),o.charCodeAt(3)]);var s=u.constants={};s.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),s.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),s.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),s.STSC=s.STCO=s.STTS,s.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),s.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),s.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),s.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},u.box=function(o){for(var s=8,v=null,c=Array.prototype.slice.call(arguments,1),p=c.length,y=0;y<p;y++)s+=c[y].byteLength;v=new Uint8Array(s),v[0]=s>>>24&255,v[1]=s>>>16&255,v[2]=s>>>8&255,v[3]=s&255,v.set(o,4);for(var f=8,y=0;y<p;y++)v.set(c[y],f),f+=c[y].byteLength;return v},u.generateInitSegment=function(o){var s=u.box(u.types.ftyp,u.constants.FTYP),v=u.moov(o),c=new Uint8Array(s.byteLength+v.byteLength);return c.set(s,0),c.set(v,s.byteLength),c},u.moov=function(o){var s=u.mvhd(o.timescale,o.duration),v=u.trak(o),c=u.mvex(o);return u.box(u.types.moov,s,v,c)},u.mvhd=function(o,s){return u.box(u.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},u.trak=function(o){return u.box(u.types.trak,u.tkhd(o),u.mdia(o))},u.tkhd=function(o){var s=o.id,v=o.duration,c=o.presentWidth,p=o.presentHeight;return u.box(u.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,v&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,c>>>8&255,c&255,0,0,p>>>8&255,p&255,0,0]))},u.mdia=function(o){return u.box(u.types.mdia,u.mdhd(o),u.hdlr(o),u.minf(o))},u.mdhd=function(o){var s=o.timescale,v=o.duration;return u.box(u.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,v>>>24&255,v>>>16&255,v>>>8&255,v&255,85,196,0,0]))},u.hdlr=function(o){var s=null;return o.type==="audio"?s=u.constants.HDLR_AUDIO:s=u.constants.HDLR_VIDEO,u.box(u.types.hdlr,s)},u.minf=function(o){var s=null;return o.type==="audio"?s=u.box(u.types.smhd,u.constants.SMHD):s=u.box(u.types.vmhd,u.constants.VMHD),u.box(u.types.minf,s,u.dinf(),u.stbl(o))},u.dinf=function(){var o=u.box(u.types.dinf,u.box(u.types.dref,u.constants.DREF));return o},u.stbl=function(o){var s=u.box(u.types.stbl,u.stsd(o),u.box(u.types.stts,u.constants.STTS),u.box(u.types.stsc,u.constants.STSC),u.box(u.types.stsz,u.constants.STSZ),u.box(u.types.stco,u.constants.STCO));return s},u.stsd=function(o){return o.type==="audio"?o.codec==="mp3"?u.box(u.types.stsd,u.constants.STSD_PREFIX,u.mp3(o)):u.box(u.types.stsd,u.constants.STSD_PREFIX,u.mp4a(o)):u.box(u.types.stsd,u.constants.STSD_PREFIX,u.avc1(o))},u.mp3=function(o){var s=o.channelCount,v=o.audioSampleRate,c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,v>>>8&255,v&255,0,0]);return u.box(u.types[".mp3"],c)},u.mp4a=function(o){var s=o.channelCount,v=o.audioSampleRate,c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,v>>>8&255,v&255,0,0]);return u.box(u.types.mp4a,c,u.esds(o))},u.esds=function(o){var s=o.config||[],v=s.length,c=new Uint8Array([0,0,0,0,3,23+v,0,1,0,4,15+v,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([v]).concat(s).concat([6,1,2]));return u.box(u.types.esds,c)},u.avc1=function(o){var s=o.avcc,v=o.codecWidth,c=o.codecHeight,p=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,v>>>8&255,v&255,c>>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return u.box(u.types.avc1,p,u.box(u.types.avcC,s))},u.mvex=function(o){return u.box(u.types.mvex,u.trex(o))},u.trex=function(o){var s=o.id,v=new Uint8Array([0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return u.box(u.types.trex,v)},u.moof=function(o,s){return u.box(u.types.moof,u.mfhd(o.sequenceNumber),u.traf(o,s))},u.mfhd=function(o){var s=new Uint8Array([0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255]);return u.box(u.types.mfhd,s)},u.traf=function(o,s){var v=o.id,c=u.box(u.types.tfhd,new Uint8Array([0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,v&255])),p=u.box(u.types.tfdt,new Uint8Array([0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255])),y=u.sdtp(o),f=u.trun(o,y.byteLength+16+16+8+16+8+8);return u.box(u.types.traf,c,p,f,y)},u.sdtp=function(o){for(var s=o.samples||[],v=s.length,c=new Uint8Array(4+v),p=0;p<v;p++){var y=s[p].flags;c[p+4]=y.isLeading<<6|y.dependsOn<<4|y.isDependedOn<<2|y.hasRedundancy}return u.box(u.types.sdtp,c)},u.trun=function(o,s){var v=o.samples||[],c=v.length,p=12+16*c,y=new Uint8Array(p);s+=8+p,y.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,c&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255],0);for(var f=0;f<c;f++){var l=v[f].duration,h=v[f].size,d=v[f].flags,a=v[f].cts;y.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.isNonSync,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255],12+16*f)}return u.box(u.types.trun,y)},u.mdat=function(o){return u.box(u.types.mdat,o)},u}();g.init(),m.default=g},"./src/remux/mp4-remuxer.js":function(S,m,_){_.r(m);var g=_("./src/utils/logger.js"),u=_("./src/remux/mp4-generator.js"),o=_("./src/remux/aac-silent.js"),s=_("./src/utils/browser.js"),v=_("./src/core/media-segment-info.js"),c=_("./src/utils/exception.js"),p=function(){function y(f){this.TAG="MP4Remuxer",this._config=f,this._isLive=f.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new v.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new v.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(s.default.chrome&&(s.default.version.major<50||s.default.version.major===50&&s.default.version.build<2661)),this._fillSilentAfterSeek=s.default.msedge||s.default.msie,this._mp3UseMpegAudio=!s.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return y.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},y.prototype.bindDataSource=function(f){return f.onDataAvailable=this.remux.bind(this),f.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(y.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(f){this._onInitSegment=f},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(f){this._onMediaSegment=f},enumerable:!1,configurable:!0}),y.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},y.prototype.seek=function(f){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},y.prototype.remux=function(f,l){if(!this._onMediaSegment)throw new c.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(f,l),this._remuxVideo(l),this._remuxAudio(f)},y.prototype._onTrackMetadataReceived=function(f,l){var h=null,d="mp4",a=l.codec;if(f==="audio")this._audioMeta=l,l.codec==="mp3"&&this._mp3UseMpegAudio?(d="mpeg",a="",h=new Uint8Array):h=u.default.generateInitSegment(l);else if(f==="video")this._videoMeta=l,h=u.default.generateInitSegment(l);else return;if(!this._onInitSegment)throw new c.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(f,{type:f,data:h.buffer,codec:a,container:f+"/"+d,mediaDuration:l.duration})},y.prototype._calculateDtsBase=function(f,l){this._dtsBaseInited||(f.samples&&f.samples.length&&(this._audioDtsBase=f.samples[0].dts),l.samples&&l.samples.length&&(this._videoDtsBase=l.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},y.prototype.flushStashedSamples=function(){var f=this._videoStashedLastSample,l=this._audioStashedLastSample,h={type:"video",id:1,sequenceNumber:0,samples:[],length:0};f!=null&&(h.samples.push(f),h.length=f.length);var d={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};l!=null&&(d.samples.push(l),d.length=l.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(h,!0),this._remuxAudio(d,!0)},y.prototype._remuxAudio=function(f,l){if(this._audioMeta!=null){var h=f,d=h.samples,a=void 0,E=-1,C=-1,b=this._audioMeta.refSampleDuration,A=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,T=this._dtsBaseInited&&this._audioNextDts===void 0,O=!1;if(!(!d||d.length===0)&&!(d.length===1&&!l)){var R=0,L=null,P=0;A?(R=0,P=h.length):(R=8,P=8+h.length);var k=null;if(d.length>1&&(k=d.pop(),P-=k.length),this._audioStashedLastSample!=null){var I=this._audioStashedLastSample;this._audioStashedLastSample=null,d.unshift(I),P+=I.length}k!=null&&(this._audioStashedLastSample=k);var F=d[0].dts-this._dtsBase;if(this._audioNextDts)a=F-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())a=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(O=!0);else{var q=this._audioSegmentInfoList.getLastSampleBefore(F);if(q!=null){var Z=F-(q.originalDts+q.duration);Z<=3&&(Z=0);var $=q.dts+q.duration+Z;a=F-$}else a=0}if(O){var ne=F-a,fe=this._videoSegmentInfoList.getLastSegmentBefore(F);if(fe!=null&&fe.beginDts<ne){var Y=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(Y){var re=fe.beginDts,Le=ne-fe.beginDts;g.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+re+", duration: "+Le),d.unshift({unit:Y,dts:re,pts:re}),P+=Y.byteLength}}else O=!1}for(var le=[],ue=0;ue<d.length;ue++){var I=d[ue],xe=I.unit,pe=I.dts-this._dtsBase,re=pe,Ee=!1,Se=null,de=0;if(!(pe<-.001)){if(this._audioMeta.codec!=="mp3"){var H=pe,Ce=3;if(this._audioNextDts&&(H=this._audioNextDts),a=pe-H,a<=-Ce*b){g.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+pe+" ms ,curRefDts: "+H+" ms)  due to dtsCorrection: "+a+" ms overlap.");continue}else if(a>=Ce*b&&this._fillAudioTimestampGap&&!s.default.safari){Ee=!0;var Ae=Math.floor(a/b);g.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+pe+" ms, curRefDts: "+H+" ms, ")+("dtsCorrection: "+Math.round(a)+" ms, generate: "+Ae+" frames")),re=Math.floor(H),de=Math.floor(H+b)-re;var Y=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);Y==null&&(g.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),Y=xe),Se=[];for(var Be=0;Be<Ae;Be++){H=H+b;var Oe=Math.floor(H),Fe=Math.floor(H+b)-Oe,w={dts:Oe,pts:Oe,cts:0,unit:Y,size:Y.byteLength,duration:Fe,originalDts:pe,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};Se.push(w),P+=w.size}this._audioNextDts=H+b}else re=Math.floor(H),de=Math.floor(H+b)-re,this._audioNextDts=H+b}else{if(re=pe-a,ue!==d.length-1){var N=d[ue+1].dts-this._dtsBase-a;de=N-re}else if(k!=null){var N=k.dts-this._dtsBase-a;de=N-re}else le.length>=1?de=le[le.length-1].duration:de=Math.floor(b);this._audioNextDts=re+de}E===-1&&(E=re),le.push({dts:re,pts:re,cts:0,unit:I.unit,size:I.unit.byteLength,duration:de,originalDts:pe,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Ee&&le.push.apply(le,Se)}}if(le.length===0){h.samples=[],h.length=0;return}A?L=new Uint8Array(P):(L=new Uint8Array(P),L[0]=P>>>24&255,L[1]=P>>>16&255,L[2]=P>>>8&255,L[3]=P&255,L.set(u.default.types.mdat,4));for(var ue=0;ue<le.length;ue++){var xe=le[ue].unit;L.set(xe,R),R+=xe.byteLength}var U=le[le.length-1];C=U.dts+U.duration;var j=new v.MediaSegmentInfo;j.beginDts=E,j.endDts=C,j.beginPts=E,j.endPts=C,j.originalBeginDts=le[0].originalDts,j.originalEndDts=U.originalDts+U.duration,j.firstSample=new v.SampleInfo(le[0].dts,le[0].pts,le[0].duration,le[0].originalDts,!1),j.lastSample=new v.SampleInfo(U.dts,U.pts,U.duration,U.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(j),h.samples=le,h.sequenceNumber++;var Re=null;A?Re=new Uint8Array:Re=u.default.moof(h,E),h.samples=[],h.length=0;var Te={type:"audio",data:this._mergeBoxes(Re,L).buffer,sampleCount:le.length,info:j};A&&T&&(Te.timestampOffset=E),this._onMediaSegment("audio",Te)}}},y.prototype._remuxVideo=function(f,l){if(this._videoMeta!=null){var h=f,d=h.samples,a=void 0,E=-1,C=-1,b=-1,A=-1;if(!(!d||d.length===0)&&!(d.length===1&&!l)){var T=8,O=null,R=8+f.length,L=null;if(d.length>1&&(L=d.pop(),R-=L.length),this._videoStashedLastSample!=null){var P=this._videoStashedLastSample;this._videoStashedLastSample=null,d.unshift(P),R+=P.length}L!=null&&(this._videoStashedLastSample=L);var k=d[0].dts-this._dtsBase;if(this._videoNextDts)a=k-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())a=0;else{var I=this._videoSegmentInfoList.getLastSampleBefore(k);if(I!=null){var F=k-(I.originalDts+I.duration);F<=3&&(F=0);var q=I.dts+I.duration+F;a=k-q}else a=0}for(var Z=new v.MediaSegmentInfo,$=[],ne=0;ne<d.length;ne++){var P=d[ne],fe=P.dts-this._dtsBase,Y=P.isKeyframe,re=fe-a,Le=P.cts,le=re+Le;E===-1&&(E=re,b=le);var ue=0;if(ne!==d.length-1){var xe=d[ne+1].dts-this._dtsBase-a;ue=xe-re}else if(L!=null){var xe=L.dts-this._dtsBase-a;ue=xe-re}else $.length>=1?ue=$[$.length-1].duration:ue=Math.floor(this._videoMeta.refSampleDuration);if(Y){var pe=new v.SampleInfo(re,le,ue,P.dts,!0);pe.fileposition=P.fileposition,Z.appendSyncPoint(pe)}$.push({dts:re,pts:le,cts:Le,units:P.units,size:P.length,isKeyframe:Y,duration:ue,originalDts:fe,flags:{isLeading:0,dependsOn:Y?2:1,isDependedOn:Y?1:0,hasRedundancy:0,isNonSync:Y?0:1}})}O=new Uint8Array(R),O[0]=R>>>24&255,O[1]=R>>>16&255,O[2]=R>>>8&255,O[3]=R&255,O.set(u.default.types.mdat,4);for(var ne=0;ne<$.length;ne++)for(var Ee=$[ne].units;Ee.length;){var Se=Ee.shift(),de=Se.data;O.set(de,T),T+=de.byteLength}var H=$[$.length-1];if(C=H.dts+H.duration,A=H.pts+H.duration,this._videoNextDts=C,Z.beginDts=E,Z.endDts=C,Z.beginPts=b,Z.endPts=A,Z.originalBeginDts=$[0].originalDts,Z.originalEndDts=H.originalDts+H.duration,Z.firstSample=new v.SampleInfo($[0].dts,$[0].pts,$[0].duration,$[0].originalDts,$[0].isKeyframe),Z.lastSample=new v.SampleInfo(H.dts,H.pts,H.duration,H.originalDts,H.isKeyframe),this._isLive||this._videoSegmentInfoList.append(Z),h.samples=$,h.sequenceNumber++,this._forceFirstIDR){var Ce=$[0].flags;Ce.dependsOn=2,Ce.isNonSync=0}var Ae=u.default.moof(h,E);h.samples=[],h.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(Ae,O).buffer,sampleCount:$.length,info:Z})}}},y.prototype._mergeBoxes=function(f,l){var h=new Uint8Array(f.byteLength+l.byteLength);return h.set(f,0),h.set(l,f.byteLength),h},y}();m.default=p},"./src/utils/browser.js":function(S,m,_){_.r(m);var g={};function u(){var o=self.navigator.userAgent.toLowerCase(),s=/(edge)\/([\w.]+)/.exec(o)||/(opr)[\/]([\w.]+)/.exec(o)||/(chrome)[ \/]([\w.]+)/.exec(o)||/(iemobile)[\/]([\w.]+)/.exec(o)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+)/.exec(o)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(o)||/(msie) ([\w.]+)/.exec(o)||o.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(o)||o.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(o)||[],v=/(ipad)/.exec(o)||/(ipod)/.exec(o)||/(windows phone)/.exec(o)||/(iphone)/.exec(o)||/(kindle)/.exec(o)||/(android)/.exec(o)||/(windows)/.exec(o)||/(mac)/.exec(o)||/(linux)/.exec(o)||/(cros)/.exec(o)||[],c={browser:s[5]||s[3]||s[1]||"",version:s[2]||s[4]||"0",majorVersion:s[4]||s[2]||"0",platform:v[0]||""},p={};if(c.browser){p[c.browser]=!0;var y=c.majorVersion.split(".");p.version={major:parseInt(c.majorVersion,10),string:c.version},y.length>1&&(p.version.minor=parseInt(y[1],10)),y.length>2&&(p.version.build=parseInt(y[2],10))}if(c.platform&&(p[c.platform]=!0),(p.chrome||p.opr||p.safari)&&(p.webkit=!0),p.rv||p.iemobile){p.rv&&delete p.rv;var f="msie";c.browser=f,p[f]=!0}if(p.edge){delete p.edge;var l="msedge";c.browser=l,p[l]=!0}if(p.opr){var h="opera";c.browser=h,p[h]=!0}if(p.safari&&p.android){var d="android";c.browser=d,p[d]=!0}p.name=c.browser,p.platform=c.platform;for(var a in g)g.hasOwnProperty(a)&&delete g[a];Object.assign(g,p)}u(),m.default=g},"./src/utils/exception.js":function(S,m,_){_.r(m),_.d(m,{RuntimeException:function(){return u},IllegalStateException:function(){return o},InvalidArgumentException:function(){return s},NotImplementedException:function(){return v}});var g=function(){var c=function(p,y){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,l){f.__proto__=l}||function(f,l){for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(f[h]=l[h])},c(p,y)};return function(p,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");c(p,y);function f(){this.constructor=p}p.prototype=y===null?Object.create(y):(f.prototype=y.prototype,new f)}}(),u=function(){function c(p){this._message=p}return Object.defineProperty(c.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),c.prototype.toString=function(){return this.name+": "+this.message},c}(),o=function(c){g(p,c);function p(y){return c.call(this,y)||this}return Object.defineProperty(p.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),p}(u),s=function(c){g(p,c);function p(y){return c.call(this,y)||this}return Object.defineProperty(p.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),p}(u),v=function(c){g(p,c);function p(y){return c.call(this,y)||this}return Object.defineProperty(p.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),p}(u)},"./src/utils/logger.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),u=_.n(g),o=function(){function s(){}return s.e=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var p="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","error",p),s.ENABLE_ERROR&&(console.error?console.error(p):console.warn?console.warn(p):console.log(p))},s.i=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var p="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","info",p),s.ENABLE_INFO&&(console.info?console.info(p):console.log(p))},s.w=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var p="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","warn",p),s.ENABLE_WARN&&(console.warn?console.warn(p):console.log(p))},s.d=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var p="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","debug",p),s.ENABLE_DEBUG&&(console.debug?console.debug(p):console.log(p))},s.v=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var p="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","verbose",p),s.ENABLE_VERBOSE&&console.log(p)},s}();o.GLOBAL_TAG="flv.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new(u()),m.default=o},"./src/utils/logging-control.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),u=_.n(g),o=_("./src/utils/logger.js"),s=function(){function v(){}return Object.defineProperty(v,"forceGlobalTag",{get:function(){return o.default.FORCE_GLOBAL_TAG},set:function(c){o.default.FORCE_GLOBAL_TAG=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"globalTag",{get:function(){return o.default.GLOBAL_TAG},set:function(c){o.default.GLOBAL_TAG=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableAll",{get:function(){return o.default.ENABLE_VERBOSE&&o.default.ENABLE_DEBUG&&o.default.ENABLE_INFO&&o.default.ENABLE_WARN&&o.default.ENABLE_ERROR},set:function(c){o.default.ENABLE_VERBOSE=c,o.default.ENABLE_DEBUG=c,o.default.ENABLE_INFO=c,o.default.ENABLE_WARN=c,o.default.ENABLE_ERROR=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableDebug",{get:function(){return o.default.ENABLE_DEBUG},set:function(c){o.default.ENABLE_DEBUG=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableVerbose",{get:function(){return o.default.ENABLE_VERBOSE},set:function(c){o.default.ENABLE_VERBOSE=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableInfo",{get:function(){return o.default.ENABLE_INFO},set:function(c){o.default.ENABLE_INFO=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableWarn",{get:function(){return o.default.ENABLE_WARN},set:function(c){o.default.ENABLE_WARN=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableError",{get:function(){return o.default.ENABLE_ERROR},set:function(c){o.default.ENABLE_ERROR=c,v._notifyChange()},enumerable:!1,configurable:!0}),v.getConfig=function(){return{globalTag:o.default.GLOBAL_TAG,forceGlobalTag:o.default.FORCE_GLOBAL_TAG,enableVerbose:o.default.ENABLE_VERBOSE,enableDebug:o.default.ENABLE_DEBUG,enableInfo:o.default.ENABLE_INFO,enableWarn:o.default.ENABLE_WARN,enableError:o.default.ENABLE_ERROR,enableCallback:o.default.ENABLE_CALLBACK}},v.applyConfig=function(c){o.default.GLOBAL_TAG=c.globalTag,o.default.FORCE_GLOBAL_TAG=c.forceGlobalTag,o.default.ENABLE_VERBOSE=c.enableVerbose,o.default.ENABLE_DEBUG=c.enableDebug,o.default.ENABLE_INFO=c.enableInfo,o.default.ENABLE_WARN=c.enableWarn,o.default.ENABLE_ERROR=c.enableError,o.default.ENABLE_CALLBACK=c.enableCallback},v._notifyChange=function(){var c=v.emitter;if(c.listenerCount("change")>0){var p=v.getConfig();c.emit("change",p)}},v.registerListener=function(c){v.emitter.addListener("change",c)},v.removeListener=function(c){v.emitter.removeListener("change",c)},v.addLogListener=function(c){o.default.emitter.addListener("log",c),o.default.emitter.listenerCount("log")>0&&(o.default.ENABLE_CALLBACK=!0,v._notifyChange())},v.removeLogListener=function(c){o.default.emitter.removeListener("log",c),o.default.emitter.listenerCount("log")===0&&(o.default.ENABLE_CALLBACK=!1,v._notifyChange())},v}();s.emitter=new(u()),m.default=s},"./src/utils/polyfill.js":function(S,m,_){_.r(m);var g=function(){function u(){}return u.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(o,s){return o.__proto__=s,o},Object.assign=Object.assign||function(o){if(o==null)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(o),v=1;v<arguments.length;v++){var c=arguments[v];if(c!=null)for(var p in c)c.hasOwnProperty(p)&&(s[p]=c[p])}return s},typeof self.Promise!="function"&&_("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},u}();g.install(),m.default=g},"./src/utils/utf8-conv.js":function(S,m,_){_.r(m);function g(o,s,v){var c=o;if(s+v<c.length){for(;v--;)if((c[++s]&192)!==128)return!1;return!0}else return!1}function u(o){for(var s=[],v=o,c=0,p=o.length;c<p;){if(v[c]<128){s.push(String.fromCharCode(v[c])),++c;continue}else if(!(v[c]<192)){if(v[c]<224){if(g(v,c,1)){var y=(v[c]&31)<<6|v[c+1]&63;if(y>=128){s.push(String.fromCharCode(y&65535)),c+=2;continue}}}else if(v[c]<240){if(g(v,c,2)){var y=(v[c]&15)<<12|(v[c+1]&63)<<6|v[c+2]&63;if(y>=2048&&(y&63488)!==55296){s.push(String.fromCharCode(y&65535)),c+=3;continue}}}else if(v[c]<248&&g(v,c,3)){var y=(v[c]&7)<<18|(v[c+1]&63)<<12|(v[c+2]&63)<<6|v[c+3]&63;if(y>65536&&y<1114112){y-=65536,s.push(String.fromCharCode(y>>>10|55296)),s.push(String.fromCharCode(y&1023|56320)),c+=4;continue}}}s.push(String.fromCharCode(65533)),++c}return s.join("")}m.default=u}},r={};function i(S){var m=r[S];if(m!==void 0)return m.exports;var _=r[S]={exports:{}};return n[S].call(_.exports,_,_.exports,i),_.exports}i.m=n,function(){i.n=function(S){var m=S&&S.__esModule?function(){return S.default}:function(){return S};return i.d(m,{a:m}),m}}(),function(){i.d=function(S,m){for(var _ in m)i.o(m,_)&&!i.o(S,_)&&Object.defineProperty(S,_,{enumerable:!0,get:m[_]})}}(),function(){i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){i.o=function(S,m){return Object.prototype.hasOwnProperty.call(S,m)}}(),function(){i.r=function(S){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(S,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(S,"__esModule",{value:!0})}}();var x=i("./src/index.js");return x}()})})(zr);var Co=zr.exports;const bo=zn(Co);const Ro={key:0,class:"controls"},To={class:"left"},Lo={class:"right"},Ao={name:"Video"},Oo=Object.assign(Ao,{props:{flv:{type:Boolean,default:!1},url:{type:String,default:""},id:{type:String,default:""}},setup(e,{expose:t}){const n=e,r=ee(null),i=ee(null);let x=ee(!1),S=ee(!0),m=ee(!1),_=null;const g=()=>{_=bo.createPlayer({type:"flv",isLive:!0,url:n.url}),_.attachMediaElement(r==null?void 0:r.value),_.load(),_.play()};gi(()=>{n.flv&&n.url&&g()});const u=(p,y,f)=>{r.value.srcObject=p,r.value.muted=y,S.value=y,m.value=f},o=p=>{p.requestFullscreen?p.requestFullscreen():ele.mozRequestFullScreen?p.mozRequestFullScreen():ele.webkitRequestFullScreen&&p.webkitRequestFullScreen()};function s(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}const v=()=>{x.value?(s(),x.value=!1):(o(i==null?void 0:i.value),x.value=!0)},c=()=>{let p=!r.value.muted;S.value=p,r.value.muted=p};return t({setStream:u,id:n.id}),(p,y)=>{const f=fn;return V(),oe("div",{class:te(["live-video",{"is-full":G(x)}]),ref_key:"videoContainerRef",ref:i},[z("video",{class:"video",ref_key:"videoRef",ref:r,muted:"",autoplay:"",disablePictureInPicture:"","x-webkit-airplay":"allow","x5-video-player-type":"h5","x5-video-player-fullscreen":"true",oncontextmenu:"return false"},null,512),Me(p.$slots,"default",{},void 0,!0),G(m)?(V(),oe("div",Ro,[z("div",To,[X(f,{"icon-name":G(S)?"sound-close":"sound","icon-size":"24",color:"#cfcfcf",onClick:c},null,8,["icon-name"])]),z("div",Lo,[X(f,{"icon-name":"full","icon-size":"20",color:"#cfcfcf",onClick:v})])])):se("",!0)],2)}}}),lt=cn(Oo,[["__scopeId","data-v-bc9b3042"]]),Po={class:"dialog-footer"},ko={name:"SetRoomPassDialog"},Do=Object.assign(ko,{props:{id:{type:String,default:""}},setup(e,{expose:t}){const n=e,r=ee(),i=ee(!1),x=ee(""),S=()=>{i.value=!1},m=()=>{x.value.trim().length===6?et({method:"POST",url:"room/update",data:{id:n.id,password:x.value}}).then(()=>{i.value=!1}):Ze.warning("密码输入格式错误！")};return t({show:()=>i.value=!0,hide:()=>i.value=!1}),(_,g)=>{const u=Ut,o=it,s=Wn;return V(),ce(s,{ref_key:"dialogRef",ref:r,modelValue:i.value,"onUpdate:modelValue":g[1]||(g[1]=v=>i.value=v),title:"设置密码",width:"400px","show-close":!1,"close-on-click-modal":!1},{footer:J(()=>[z("div",Po,[X(o,{onClick:S},{default:J(()=>[_e("取消")]),_:1}),X(o,{type:"primary",onClick:m},{default:J(()=>[_e(" 确定 ")]),_:1})])]),default:J(()=>[X(u,{modelValue:x.value,"onUpdate:modelValue":g[0]||(g[0]=v=>x.value=v),modelModifiers:{trim:!0},placeholder:"请输入6位密码"},null,8,["modelValue"])]),_:1},8,["modelValue"])}}}),Io={class:"dialog-footer"},Mo={name:"EnterRoomPassDialog"},Bo=Object.assign(Mo,{props:{id:{type:String,default:""}},emits:["onTrue","onFalse","onCancel"],setup(e,{expose:t,emit:n}){const r=e,i=ee(),x=ee(),S=()=>{n("onCancel"),x.value=!1},m=()=>{et({method:"POST",url:"/room/checkPassword",data:{id:r.id,password:i.value}}).then(_=>{_.data?(n("onTrue"),x.value=!1):(n("onFalse"),Ze.warning("密码错误！"))})};return t({show:()=>x.value=!0,hide:()=>x.value=!1}),(_,g)=>{const u=Ut,o=it,s=Wn;return V(),ce(s,{ref:"dialogRef",modelValue:x.value,"onUpdate:modelValue":g[1]||(g[1]=v=>x.value=v),title:"设置密码",width:"400px","show-close":!1,"close-on-click-modal":!1},{footer:J(()=>[z("div",Io,[X(o,{onClick:S},{default:J(()=>[_e("取消")]),_:1}),X(o,{type:"primary",onClick:m},{default:J(()=>[_e(" 确定 ")]),_:1})])]),default:J(()=>[X(u,{modelValue:i.value,"onUpdate:modelValue":g[0]||(g[0]=v=>i.value=v),modelModifiers:{trim:!0},placeholder:"请输入6位密码"},null,8,["modelValue"])]),_:1},8,["modelValue"])}}});const Wr=vi("room",()=>{const e=ee({}),t=ee([]),n=ee([]);return{info:e,peoples:t,chatList:n,GET_INFO:async(m,_)=>{var u,o;const g=await et({method:"GET",url:"/room/info",params:{id:m}}).catch(()=>{typeof _=="function"&&_()});e.value=((u=g==null?void 0:g.data)==null?void 0:u.info)||{},t.value=((o=g==null?void 0:g.data)==null?void 0:o.peoples)||[]},ADD_PEOPLE:m=>{t.value.findIndex(_=>_.id===m.id)===-1&&t.value.push(m)},ADD_CHAT:(...m)=>{n.value.push(...m)},REMOVE_PEOPLE:m=>{t.value=t.value.filter(_=>_.id!==m)}}}),Fo=["😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","😘","😗","😙","😚","😋","😛","😝","😜","🤪","🤨","🧐","🤓","😎","🤩","😏","😒","😞","😔","😟","😕","🙁","😣","😖","😫","😩","😢","😭","😮","💨","😤","😠","😡","🤬","🤯","😳","😱","😨","😰","😥","😓","🤗","🤔","🤭","🤫","🤥","😶","🌫️","😐","😑","😬","🙄","😯","😦","😧","😮","😲","😴","🤤","😪","😵","😵","💫","🤐","🤢","🤮","🤧","😷","🤒","🤕","🤑","🤠","😈","👿","👹","👺","🤡","💩","👻","💀","👽","👾","🤖","🎃","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🐶"];const wo=e=>(Ei("data-v-7328f5c9"),e=e(),xi(),e),Uo={key:0,class:"unread-dot"},jo={class:"user-name"},No={class:"chat-content"},Vo=wo(()=>z("div",{class:"chat-textarea-placeholder"},null,-1)),Go={class:"chat-textarea"},Ko={class:"emoji-container"},zo=["onClick"],Wo={name:"ChatButton"},Ho=Object.assign(Wo,{emits:"enter",setup(e,{emit:t}){const n=ee(!1),r=ee(""),i=ee(),x=ee(),S=Wr(),{chatList:m}=Ht(S),{info:_}=Ht(Hn());jt(()=>{c()});const g=p=>{if(!p.shiftKey&&p.keyCode===13){if(r.value.trim()==="")return;const y=r.value;r.value="";const f={info:{id:_.value.id,name:_.value.username},time:Date.now(),content:y};S.ADD_CHAT({...f,unread:!1}),t("enter",f),p.preventDefault()}},u=p=>{r.value+=p,x.value.focus()},o=()=>{for(let p=0;p<m.value.length;p++)m.value[p].unread=!1};It(n,async()=>{n.value&&(await ke(),x.value.focus())},{flush:"post"});const s=async()=>{n.value=!0,o(),await ke(),c()};It(m,()=>{c(),n.value&&o()},{flush:"post",deep:!0});const v=me(()=>{let p=0;if(n.value)return p;for(let y of m.value)y.unread&&p++;return p}),c=async()=>{await ke(),i.value&&(i.value.scrollTop=i.value.scrollHeight)};return(p,y)=>{const f=it,l=fn,h=yi,d=Ut,a=qi;return V(),oe(we,null,[X(f,{onClick:s},{default:J(()=>[Me(p.$slots,"default",{},void 0,!0),G(v)?(V(),oe("span",Uo,"("+he(G(v))+")",1)):se("",!0)]),_:3}),X(a,{class:"chat-container","append-to-body":"",size:300,modelValue:n.value,"onUpdate:modelValue":y[1]||(y[1]=E=>n.value=E),title:"聊天室"},{default:J(()=>[z("div",{class:"chat-list",ref_key:"chatListRef",ref:i},[(V(!0),oe(we,null,Ft(G(m),E=>(V(),oe("div",{class:"chat-item",key:E.info.id+"_"+E.time},[z("div",jo,he(E.info.id===G(_).id?"我":E.info.name),1),z("div",No,he(E.content),1)]))),128)),Vo],512),z("div",Go,[X(h,{placement:"top-start",width:250,trigger:"click"},{reference:J(()=>[X(l,{iconName:"expression",iconSize:"30",color:"#999"})]),default:J(()=>[z("div",Ko,[(V(!0),oe(we,null,Ft(G(Fo),E=>(V(),oe("div",{class:"emoji-item",onClick:C=>u(E),key:E},he(E),9,zo))),128))])]),_:1}),X(d,{ref_key:"contentRef",ref:x,type:"textarea",modelValue:r.value,"onUpdate:modelValue":y[0]||(y[0]=E=>r.value=E),placeholder:"请输入",rows:1,onKeydown:g,resize:"none"},null,8,["modelValue"])])]),_:1},8,["modelValue"])],64)}}}),$o=cn(Ho,[["__scopeId","data-v-7328f5c9"]]);function Yo({data:e,name:t}){const n=new Blob(e),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download=t,r.click()}const Xo={class:"file-name"},Jo={class:"notice-group"},qo={__name:"progress",props:{type:{type:Number,default:1},percentage:{type:Number,default:0},name:{type:String,default:""},buffer:{type:Array,default:[]}},setup(e){const t=e,n=()=>{Yo({data:t.buffer,name:t.name})};return(r,i)=>{const x=it;return V(),oe(we,null,[z("div",Xo,he(t.name),1),z("div",Jo,[t.percentage.value!=100?(V(),oe(we,{key:0},[_e(" 文件"+he(t.type===1?"发送":"接收")+"中... "+he(t.percentage)+"% ",1)],64)):(V(),oe(we,{key:1},[_e(" 文件"+he(t.type===1?"发送":"接收")+"成功... ",1)],64)),t.percentage.value==100&&t.type===2?(V(),ce(x,{key:2,onClick:n,type:"primary",link:""},{default:J(()=>[_e(" 下载 ")]),_:1})):se("",!0)])],64)}}},Fn=(e,t)=>{const n=me(()=>Math.floor(t.value.receiveSize/t.value.maxSize*100));Cs({title:e===1?"发送文件":"接收文件",duration:0,"custom-class":"progress-notice",message:Si(qo,{type:e,percentage:n,name:t.value.name,buffer:t.value.buffer})})},wn=(e,t)=>{const n=JSON.parse(JSON.stringify(e));return n.name=t.name,n.maxSize=t.size,n.receiveSize=0,n.start=!0,n};const Qo={key:0,class:"container"},Zo={class:"live-name"},ea={key:0,class:"video-main"},ta={class:"people-video-group"},na={class:"people-video"},ra={key:0,class:"video-header"},ia=["title"],sa={class:"video-tools"},oa={class:"video-header"},aa=["title"],la={key:1,class:"video-metting-main"},ua={class:"screen-video"},ca={class:"people-video-box"},fa={class:"people-video-group"},da={class:"people-video"},ha={key:0,class:"video-header"},pa=["title"],_a={class:"video-tools"},ma={class:"video-header"},ga=["title"],va={class:"btn-group"},ya={key:0,class:"btn-group-public"},Ea={class:"btn-group-right"},xa={name:"Live"},Sa=Object.assign(xa,{setup(e){const t=Ci(),n=bi(),r=Wr(),i=Hn(),{info:x}=Ht(r),S=t.query.id,m={bundlePolicy:"balanced",iceTransportPolicy:"all",rtcpMuxPolicy:"negotiate",iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:121.36.99.231:3478",username:"ruan8",credential:"123456"}]};let _=!1,g=null;const u=ee(),o=ee(),s=ee(),v=ee(),c=ee(),p=ee(),y=ee(!0),f=ee(),l=ee(!1),h=ee(!1),d=xt(new Map),a=xt(new Map),E=xt(new Map),C=ee(1),b=ee(2),A=ee(2);let T=null,O=null,R=ee({start:!1,maxSize:0,receiveSize:0,name:"",buffer:[]}),L=ee({start:!1,maxSize:0,receiveSize:0,name:"",buffer:[]}),P=[];const k=me(()=>r.peoples.find(w=>w.id===i.info.id)),I=me(()=>r.peoples.filter(w=>w.id!==i.info.id)),F=()=>{ae.on("initSuccessed",()=>{ae.emit("join")}),ae.on("joined",async function(w){let N=JSON.parse(w.info);if(r.ADD_PEOPLE(N),i.info.id!==N.id){const U=Se("video",N.id);d.set(N.id,U),T&&U.addTrack(T),U.createOffer(j=>{ae.emit("offer",{offer:j,type:"video",to:N.id,from:i.info.id})})}if(O){const U=Se("display",N.id);a.set(N.id,U),U.addTrack(O),U.createOffer(j=>{ae.emit("offer",{offer:j,type:"display",to:N.id,from:i.info.id})})}}),ae.on("leave",function(w){w.id===x.user_id&&(g=null),d.delete(w.id),a.delete(w.id),E.delete(w.id),r.REMOVE_PEOPLE(w.id),s.value.forEach(N=>{N.id===w.id&&N.setStream(null)})}),ae.on("offer",function({offer:w,type:N,from:U}){if(N==="video"){const j=d.get(U);j&&(j.addTrack(T),j.setRemoteDescription(w),j.createAnswer(Re=>{ae.emit("answer",{answer:Re,type:N,to:U,from:i.info.id})}))}else g=Se(N,U),g.setRemoteDescription(w),g.createAnswer(j=>{ae.emit("answer",{answer:j,type:N,to:U,from:i.info.id})})}),ae.on("answer",function({answer:w,type:N,from:U}){if(N==="video"){const j=d.get(U);j&&j.setRemoteDescription(w)}else{const j=a.get(U);j&&j.setRemoteDescription(w)}}),ae.on("candidate",({candidate:w,type:N,from:U})=>{if(N==="video"){const j=d.get(U);j&&j.setCandidate(w)}else if(g)g.setCandidate(w);else{const j=a.get(U);j&&j.setCandidate(w)}}),ae.on("noLogin",()=>{i.SET_TOKEN(""),i.SET_LOGIN(!0,1)}),ae.on("fulled",()=>{l.value=!0,He.alert("当前房间已经满人！").then(()=>{n.go(-1)}),ae.close(),ae.disconnect()}),ae.on("closed",()=>{_=!0,He.alert("当前房间已经关闭！").then(()=>{n.replace("/"),i.SET_ROOM("")})}),ae.on("rejectConn",()=>{He.alert("对方拒绝了你的连接申请！")}),ae.on("played",w=>{f.value=w}),ae.on("typeChange",async w=>{C.value=w,await ke(),Be()}),ae.on("displayMediaEnd",async()=>{u.value.setStream(null,!0,!1),C.value=1,await ke(),await Oe(1)})},q=async()=>{(await et({method:"GET",url:"/room/isOffsite",params:{id:S}})).data?(l.value=!0,He.alert("已在其他页面打开，请不要重复打开！","温馨提醒").then(()=>{n.go(-1)})):(await Le(),T&&o.value.setStream(T,!0),await ho({query:{id:S}}),F())},Z=()=>{ae.disconnect(),ae.close()},$=async()=>{f.value=x.value.flv_url,C.value=r.info.type,r.peoples.forEach(w=>{const N=Se("video",w.id);d.set(w.id,N)}),await q(),h.value=!!x.value.is_public},ne=()=>{$()},fe=()=>{n.go(-1),_=!0},Y=w=>{d.forEach(N=>{var U;(U=N.dataChannel)==null||U.send(JSON.stringify({type:"chat",data:w}))})};jt(async()=>{i.token&&(await r.GET_INFO(S,()=>{_=!0,l.value=!0,n.push("/")}),r.info.password&&r.info.user_id!==i.info.id?c.value.show():$())}),Ri(async(w,N,U)=>{try{_||!i.token?(Z(),U()):(await He.confirm("此操作将会退出当前房间！","温馨提醒").then(()=>{Z()}),U())}catch{U(!1)}});const re=()=>{v.value.show()},Le=async()=>{try{const w={video:{width:{min:200},height:{min:150},frameRate:{ideal:30,max:60}},audio:{noiseSuppression:!0,echoCancellation:!0}};navigator.mediaDevices.getUserMedia?T=await navigator.mediaDevices.getUserMedia(w):navigator.webkitGetUserMedia?T=await navigator.webkitGetUserMedia(w):navigator.mozGetUserMedia?T=await navagator.mozGetUserMedia(w):navigator.getUserMedia?T=await navigator.getUserMedia(w):Ze.warning("你的浏览器不支持访问用户媒体设备！"),T.getTracks().forEach(N=>{N.enabled=!1})}catch{T=null,Ze.warning("没打开摄像头和语音权限！")}},le=async()=>{try{O=await navigator.mediaDevices.getDisplayMedia({video:{width:1920,height:1080}}),O.oninactive=function(){ae.emit("displayMediaEnd"),T=null,a.clear()}}catch{console.log("取消投屏！")}},ue=async(w,N)=>{d.forEach(async U=>{U.conn.getSenders().forEach(j=>{j.tarck&&j.track.kind===w&&(j.track.enabled=N)})}),T&&T.getTracks().forEach(U=>{U.kind===w&&(U.enabled=N)})},xe=(w,N)=>{try{if(!T)return;w.value==2?(ue(N,!0),T&&o.value.setStream(T,!0),w.value=1):(ue(N,!1),w.value=2)}catch(U){console.log("error：",U)}},pe=async()=>{xe(b,"video")},Ee=()=>{xe(A,"audio")},Se=(w,N)=>new So(m,{onTarck(U){const[j]=U.streams;if(w==="video"){let Re=s.value.find(Te=>Te.id==N);Re&&Re.setStream(j,!1),E.set(N,j)}else u.value.setStream(j,!1,!0)},onCandidate(U){U&&ae.emit("candidate",{candidate:U,type:w,to:N,from:i.info.id})},onMessage(U){let j=U.data;typeof j=="string"?(j=JSON.parse(j),j.type==="file-start"?(R.value=wn(R.value,{size:j.size,name:j.name}),Fn(2,R)):j.type==="file-end"?R.value.start=!1:j.type==="chat"&&r.ADD_CHAT({...j.data,unread:!0})):(R.value.receiveSize+=j.size,R.value.buffer.push(j))}}),de=async w=>{await et({method:"POST",url:"/room/update",data:{is_public:w?1:0,id:S}})},H=()=>{He.confirm("确认关闭房间？").then(()=>{ae.emit("closeHouse")})},Ce=()=>{d.length?L.value.start?Ze.warning("正在分享中..."):p.value.click():Ze.warning("当前房间不存在其他人...")},Ae=w=>{const N=w.target.files[0];if(N){const U=new FileReader;let j=1024,Re=Math.ceil(N.size/j),Te=1;const Je=()=>{U.readAsArrayBuffer(N.slice((Te-1)*j,Te*j)),Te++};U.onload=()=>{P.forEach(Ne=>{var be;(be=d.get(Ne).dataChannel)==null||be.send(U.result)}),L.value.receiveSize+=U.result.byteLength,Te<=Re?Je():(P.forEach(Ne=>{var be;(be=d.get(Ne).dataChannel)==null||be.send(JSON.stringify({type:"file-end",size:N.size,name:N.name}))}),L.value.start=!1)},P=[...d.keys()],P.forEach(Ne=>{var be;(be=d.get(Ne).dataChannel)==null||be.send(JSON.stringify({type:"file-start",size:N.size,name:N.name}))}),L.value=wn(L.value,{size:N.size,name:N.name}),Fn(1,L),Je()}},Be=async()=>{var w;await ke(),T&&o.value.setStream(T),(w=s==null?void 0:s.value)==null||w.forEach(N=>{const U=E.get(N.id);U&&N.setStream(U)})},Oe=async w=>{await et({method:"POST",url:"/room/update",data:{id:S,type:w}}).then(()=>{ae.emit("typeChange",w),Be()})},Fe=async()=>{le().then(async()=>{O&&(C.value=2,await ke(),await Oe(2),u.value.setStream(O,!1,!0),r.peoples.forEach(w=>{a.set(w.id,Se("display",w.id))}),a.forEach((w,N)=>{w.addTrack(O),w.createOffer(U=>{ae.emit("offer",{offer:U,type:"display",to:N,from:i.info.id})})}))})};return(w,N)=>{var ye,_t,D,B;const U=wi,j=fn,Re=Ie("CaretBottom"),Te=Ye,Je=Vi,Ne=Ti,be=it;return V(),oe(we,null,[l.value?se("",!0):(V(),oe("div",Qo,[z("div",Zo,he((ye=G(r).info)==null?void 0:ye.name)+" ("+he(G(r).peoples.length)+he(G(r).info.max?"/"+G(r).info.max:"")+") ",1),C.value===1?(V(),oe("div",ea,[Ve(z("div",ta,[z("div",na,[X(lt,{ref_key:"videoRef",ref:o},null,512),G(k)?(V(),oe("div",ra,[G(x).user_id===((_t=G(k))==null?void 0:_t.id)?(V(),ce(U,{key:0,round:""},{default:J(()=>[_e("房主")]),_:1})):se("",!0),z("div",{class:"video-username",title:(D=G(k))==null?void 0:D.username},he((B=G(k))==null?void 0:B.username),9,ia)])):se("",!0),z("div",sa,[X(j,{"icon-name":"shipin-"+b.value,"icon-size":"20",onClick:pe,color:"#ffffff"},null,8,["icon-name"]),X(j,{"icon-name":"yuyin-"+A.value,"icon-size":"20",onClick:Ee,color:"#ffffff"},null,8,["icon-name"])])]),(V(!0),oe(we,null,Ft(G(I),M=>(V(),oe("div",{class:"people-video",key:M.id},[z("div",oa,[G(x).user_id===(M==null?void 0:M.id)?(V(),ce(U,{key:0,round:""},{default:J(()=>[_e("房主")]),_:1})):se("",!0),z("div",{class:"video-username",title:M==null?void 0:M.username},he(M==null?void 0:M.username),9,aa)]),X(lt,{id:M.id,ref_for:!0,ref_key:"remoteVideoRef",ref:s},null,8,["id"])]))),128))],512),[[Ge,y.value]])])):se("",!0),C.value===2?(V(),oe("div",la,[z("div",ua,[X(lt,{ref_key:"mainVideoRef",ref:u},{default:J(()=>[z("div",ca,[z("div",{class:te(["people-video-box-header",{rotate:y.value}]),onClick:N[0]||(N[0]=M=>y.value=!y.value)},[X(Te,{size:20},{default:J(()=>[X(Re)]),_:1})],2),X(Je,null,{default:J(()=>{var M,K,Q;return[Ve(z("div",fa,[z("div",da,[X(lt,{ref_key:"videoRef",ref:o},null,512),G(k)?(V(),oe("div",ha,[G(x).user_id===((M=G(k))==null?void 0:M.id)?(V(),ce(U,{key:0,round:""},{default:J(()=>[_e("房主")]),_:1})):se("",!0),z("div",{class:"video-username",title:(K=G(k))==null?void 0:K.username},he((Q=G(k))==null?void 0:Q.username),9,pa)])):se("",!0),z("div",_a,[X(j,{"icon-name":"shipin-"+b.value,"icon-size":"20",onClick:pe,color:"#ffffff"},null,8,["icon-name"]),X(j,{"icon-name":"yuyin-"+A.value,"icon-size":"20",onClick:Ee,color:"#ffffff"},null,8,["icon-name"])])]),(V(!0),oe(we,null,Ft(G(I),W=>(V(),oe("div",{class:"people-video",key:W.id},[z("div",ma,[G(x).user_id===(W==null?void 0:W.id)?(V(),ce(U,{key:0,round:""},{default:J(()=>[_e("房主")]),_:1})):se("",!0),z("div",{class:"video-username",title:W==null?void 0:W.username},he(W==null?void 0:W.username),9,ga)]),X(lt,{id:W.id,ref_for:!0,ref_key:"remoteVideoRef",ref:s},null,8,["id"])]))),128))],512),[[Ge,y.value]])]}),_:1})])]),_:1},512)])])):se("",!0),z("div",va,[G(x).homeowner?(V(),oe("div",ya,[_e(" 公开 "),X(Ne,{modelValue:h.value,"onUpdate:modelValue":N[1]||(N[1]=M=>h.value=M),onChange:de},null,8,["modelValue"])])):se("",!0),G(x).homeowner?(V(),ce(be,{key:1,onClick:re},{default:J(()=>[_e(" 设置密码 ")]),_:1})):se("",!0),G(x).homeowner?(V(),ce(be,{key:2,onClick:Fe},{default:J(()=>[_e(" 共享屏幕 ")]),_:1})):se("",!0),z("div",Ea,[X(be,{onClick:Ce},{default:J(()=>[_e(" 分享文件 ")]),_:1}),X($o,{onEnter:Y},{default:J(()=>[_e("聊天室")]),_:1}),G(x).homeowner?(V(),ce(be,{key:0,onClick:H},{default:J(()=>[_e(" 关闭房间 ")]),_:1})):se("",!0)])])])),X(Do,{ref_key:"setRoomPassDialogRef",ref:v,id:G(S)},null,8,["id"]),X(Bo,{ref_key:"enterRoomPassDialogRef",ref:c,id:G(S),onOnTrue:ne,onOnCancel:fe},null,8,["id"]),Ve(z("input",{type:"file",ref_key:"fileRef",ref:p,onChange:Ae},null,544),[[Ge,!1]])],64)}}}),Ra=cn(Sa,[["__scopeId","data-v-44ea8715"]]);export{Ra as default};

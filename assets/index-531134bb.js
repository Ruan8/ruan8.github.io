var qr=Object.defineProperty;var Qr=(e,t,n)=>t in e?qr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Kt=(e,t,n)=>(Qr(e,typeof t!="symbol"?t+"":t,n),n);import{G as De,H as yt,f as an,I as Zr,d as st,J as ei,u as Kn,h as pe,o as j,c as se,b as $,r as Be,n as ee,e as G,y as ue,v as X,j as z,K as Wt,L as Fe,M as Je,l as oe,k as rt,T as Ft,_ as wt,w as zn,N as ti,O as ni,P as Wn,Q as $n,R as mn,s as J,g as ri,i as ii,S as si,U as Me,V as ze,W as oi,t as _e,X as We,Y as ai,A as qe,E as Ut,Z as li,$ as ui,a0 as Hn,a1 as Ot,a2 as Pt,a as gn,a3 as kt,a4 as ci,a5 as jt,a6 as fi,a7 as di,a8 as hi,a9 as pi,aa as tt,ab as _t,B as ge,ac as Yn,ad as ln,ae as dt,af as Dt,ag as vn,ah as _i,ai as mi,aj as yn,ak as It,al as gi,am as zt,an as vi,F as we,ao as yi,ap as Ei,aq as xi,ar as Xn,m as ot,as as Si,at as un,au as Jn,av as qn,C as Ge,aw as cn,ax as Ci,ay as bi,az as $t,p as fn,x as Mt,aA as Ri,aB as Ti,aC as Li,aD as Ai,aE as Oi,aF as Pi,aG as ki,aH as Di,q as Ii,aI as Mi,aJ as Bi,aK as En,aL as Fi,aM as wi}from"./index-a49c34ad.js";function Ui(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in e)){const E=Object.getOwnPropertyDescriptor(r,i);E&&Object.defineProperty(e,i,E.get?E:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}const ji='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',Ni=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,xn=e=>Array.from(e.querySelectorAll(ji)).filter(t=>Vi(t)&&Ni(t)),Vi=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},Ht="_trap-focus-children",Xe=[],Sn=e=>{if(Xe.length===0)return;const t=Xe[Xe.length-1][Ht];if(t.length>0&&e.code===yt.tab){if(t.length===1){e.preventDefault(),document.activeElement!==t[0]&&t[0].focus();return}const n=e.shiftKey,r=e.target===t[0],i=e.target===t[t.length-1];r&&n&&(e.preventDefault(),t[t.length-1].focus()),i&&!n&&(e.preventDefault(),t[0].focus())}},Gi={beforeMount(e){e[Ht]=xn(e),Xe.push(e),Xe.length<=1&&document.addEventListener("keydown",Sn)},updated(e){De(()=>{e[Ht]=xn(e)})},unmounted(){Xe.shift(),Xe.length===0&&document.removeEventListener("keydown",Sn)}},Ki=an({type:{type:String,values:["success","info","warning","danger",""],default:""},closable:Boolean,disableTransitions:Boolean,hit:Boolean,color:{type:String,default:""},size:{type:String,values:Zr,default:""},effect:{type:String,values:["dark","light","plain"],default:"light"},round:Boolean}),zi={close:e=>e instanceof MouseEvent,click:e=>e instanceof MouseEvent},Wi=st({name:"ElTag"}),$i=st({...Wi,props:Ki,emits:zi,setup(e,{emit:t}){const n=e,r=ei(),i=Kn("tag"),E=pe(()=>{const{type:p,hit:g,effect:u,closable:o,round:s}=n;return[i.b(),i.is("closable",o),i.m(p),i.m(r.value),i.m(u),i.is("hit",g),i.is("round",s)]}),S=p=>{t("close",p)},m=p=>{t("click",p)};return(p,g)=>p.disableTransitions?(j(),se("span",{key:0,class:ee(G(E)),style:rt({backgroundColor:p.color}),onClick:m},[$("span",{class:ee(G(i).e("content"))},[Be(p.$slots,"default")],2),p.closable?(j(),ue(G(Je),{key:0,class:ee(G(i).e("close")),onClick:Fe(S,["stop"])},{default:X(()=>[z(G(Wt))]),_:1},8,["class","onClick"])):oe("v-if",!0)],6)):(j(),ue(Ft,{key:1,name:`${G(i).namespace.value}-zoom-in-center`,appear:""},{default:X(()=>[$("span",{class:ee(G(E)),style:rt({backgroundColor:p.color}),onClick:m},[$("span",{class:ee(G(i).e("content"))},[Be(p.$slots,"default")],2),p.closable?(j(),ue(G(Je),{key:0,class:ee(G(i).e("close")),onClick:Fe(S,["stop"])},{default:X(()=>[z(G(Wt))]),_:1},8,["class","onClick"])):oe("v-if",!0)],6)]),_:3},8,["name"]))}});var Hi=wt($i,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tag/src/tag.vue"]]);const Yi=zn(Hi),Xi=an({...ti,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0}}),Ji=ni,qi=st({name:"ElDrawer",components:{ElOverlay:Wn,ElFocusTrap:$n,ElIcon:Je,Close:Wt},inheritAttrs:!1,props:Xi,emits:Ji,setup(e,{slots:t}){mn({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},pe(()=>!!t.title)),mn({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},pe(()=>!!e.customClass));const n=J(),r=J(),i=Kn("drawer"),{t:E}=ri(),S=pe(()=>e.direction==="rtl"||e.direction==="ltr"),m=pe(()=>ii(e.size));return{...si(e,n),drawerRef:n,focusStartRef:r,isHorizontal:S,drawerSize:m,ns:i,t:E}}}),Qi=["aria-label","aria-labelledby","aria-describedby"],Zi=["id"],es=["aria-label"],ts=["id"];function ns(e,t,n,r,i,E){const S=Me("close"),m=Me("el-icon"),p=Me("el-focus-trap"),g=Me("el-overlay");return j(),ue(ai,{to:"body",disabled:!e.appendToBody},[z(Ft,{name:e.ns.b("fade"),onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,onBeforeLeave:e.beforeLeave,persisted:""},{default:X(()=>[ze(z(g,{mask:e.modal,"overlay-class":e.modalClass,"z-index":e.zIndex,onClick:e.onModalClick},{default:X(()=>[z(p,{loop:"",trapped:e.visible,"focus-trap-el":e.drawerRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:X(()=>[$("div",oi({ref:"drawerRef","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:e.titleId,"aria-describedby":e.bodyId},e.$attrs,{class:[e.ns.b(),e.direction,e.visible&&"open",e.customClass],style:e.isHorizontal?"width: "+e.drawerSize:"height: "+e.drawerSize,role:"dialog",onClick:t[1]||(t[1]=Fe(()=>{},["stop"]))}),[$("span",{ref:"focusStartRef",class:ee(e.ns.e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?(j(),se("header",{key:0,class:ee(e.ns.e("header"))},[e.$slots.title?Be(e.$slots,"title",{key:1},()=>[oe(" DEPRECATED SLOT ")]):Be(e.$slots,"header",{key:0,close:e.handleClose,titleId:e.titleId,titleClass:e.ns.e("title")},()=>[e.$slots.title?oe("v-if",!0):(j(),se("span",{key:0,id:e.titleId,role:"heading",class:ee(e.ns.e("title"))},_e(e.title),11,Zi))]),e.showClose?(j(),se("button",{key:2,"aria-label":e.t("el.drawer.close"),class:ee(e.ns.e("close-btn")),type:"button",onClick:t[0]||(t[0]=(...u)=>e.handleClose&&e.handleClose(...u))},[z(m,{class:ee(e.ns.e("close"))},{default:X(()=>[z(S)]),_:1},8,["class"])],10,es)):oe("v-if",!0)],2)):oe("v-if",!0),e.rendered?(j(),se("div",{key:1,id:e.bodyId,class:ee(e.ns.e("body"))},[Be(e.$slots,"default")],10,ts)):oe("v-if",!0),e.$slots.footer?(j(),se("div",{key:2,class:ee(e.ns.e("footer"))},[Be(e.$slots,"footer")],2)):oe("v-if",!0)],16,Qi)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[We,e.visible]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}var rs=wt(qi,[["render",ns],["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const is=zn(rs),ss=st({name:"ElMessageBox",directives:{TrapFocus:Gi},components:{ElButton:qe,ElFocusTrap:$n,ElInput:Ut,ElOverlay:Wn,ElIcon:Je,...li},inheritAttrs:!1,props:{buttonSize:{type:String,validator:ui},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,roundButton:{default:!1,type:Boolean},container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(e,{emit:t}){const{locale:n,zIndex:r,ns:i,size:E}=Hn("message-box",pe(()=>e.buttonSize)),{t:S}=n,{nextZIndex:m}=r,p=J(!1),g=Ot({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:null,inputValidator:null,inputErrorMessage:"",message:null,modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:m()}),u=pe(()=>{const k=g.type;return{[i.bm("icon",k)]:k&&Pt[k]}}),o=gn(),s=gn(),y=pe(()=>g.icon||Pt[g.type]||""),c=pe(()=>!!g.message),_=J(),v=J(),f=J(),l=J(),d=J(),h=pe(()=>g.confirmButtonClass);kt(()=>g.inputValue,async k=>{await De(),e.boxType==="prompt"&&k!==null&&A()},{immediate:!0}),kt(()=>p.value,k=>{var D,M;k&&(e.boxType!=="prompt"&&(g.autofocus?f.value=(M=(D=d.value)==null?void 0:D.$el)!=null?M:_.value:f.value=_.value),g.zIndex=m()),e.boxType==="prompt"&&(k?De().then(()=>{var q;l.value&&l.value.$el&&(g.autofocus?f.value=(q=R())!=null?q:_.value:f.value=_.value)}):(g.editorErrorMessage="",g.validateError=!1))});const a=pe(()=>e.draggable);ci(_,v,a),jt(async()=>{await De(),e.closeOnHashChange&&window.addEventListener("hashchange",x)}),fi(()=>{e.closeOnHashChange&&window.removeEventListener("hashchange",x)});function x(){p.value&&(p.value=!1,De(()=>{g.action&&t("action",g.action)}))}const C=()=>{e.closeOnClickModal&&O(g.distinguishCancelAndClose?"close":"cancel")},b=pi(C),L=k=>{if(g.inputType!=="textarea")return k.preventDefault(),O("confirm")},O=k=>{var D;e.boxType==="prompt"&&k==="confirm"&&!A()||(g.action=k,g.beforeClose?(D=g.beforeClose)==null||D.call(g,k,g,x):x())},A=()=>{if(e.boxType==="prompt"){const k=g.inputPattern;if(k&&!k.test(g.inputValue||""))return g.editorErrorMessage=g.inputErrorMessage||S("el.messagebox.error"),g.validateError=!0,!1;const D=g.inputValidator;if(typeof D=="function"){const M=D(g.inputValue);if(M===!1)return g.editorErrorMessage=g.inputErrorMessage||S("el.messagebox.error"),g.validateError=!0,!1;if(typeof M=="string")return g.editorErrorMessage=M,g.validateError=!0,!1}}return g.editorErrorMessage="",g.validateError=!1,!0},R=()=>{const k=l.value.$refs;return k.input||k.textarea},T=()=>{O("close")},P=()=>{e.closeOnPressEscape&&T()};return e.lockScroll&&di(p),{...hi(g),ns:i,overlayEvent:b,visible:p,hasMessage:c,typeClass:u,contentId:o,inputId:s,btnSize:E,iconComponent:y,confirmButtonClasses:h,rootRef:_,focusStartRef:f,headerRef:v,inputRef:l,confirmRef:d,doClose:x,handleClose:T,onCloseRequested:P,handleWrapperClick:C,handleInputEnter:L,handleAction:O,t:S}}}),os=["aria-label","aria-describedby"],as=["aria-label"],ls=["id"];function us(e,t,n,r,i,E){const S=Me("el-icon"),m=Me("close"),p=Me("el-input"),g=Me("el-button"),u=Me("el-focus-trap"),o=Me("el-overlay");return j(),ue(Ft,{name:"fade-in-linear",onAfterLeave:t[11]||(t[11]=s=>e.$emit("vanish")),persisted:""},{default:X(()=>[ze(z(o,{"z-index":e.zIndex,"overlay-class":[e.ns.is("message-box"),e.modalClass],mask:e.modal},{default:X(()=>[$("div",{role:"dialog","aria-label":e.title,"aria-modal":"true","aria-describedby":e.showInput?void 0:e.contentId,class:ee(`${e.ns.namespace.value}-overlay-message-box`),onClick:t[8]||(t[8]=(...s)=>e.overlayEvent.onClick&&e.overlayEvent.onClick(...s)),onMousedown:t[9]||(t[9]=(...s)=>e.overlayEvent.onMousedown&&e.overlayEvent.onMousedown(...s)),onMouseup:t[10]||(t[10]=(...s)=>e.overlayEvent.onMouseup&&e.overlayEvent.onMouseup(...s))},[z(u,{loop:"",trapped:e.visible,"focus-trap-el":e.rootRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:X(()=>[$("div",{ref:"rootRef",class:ee([e.ns.b(),e.customClass,e.ns.is("draggable",e.draggable),{[e.ns.m("center")]:e.center}]),style:rt(e.customStyle),tabindex:"-1",onClick:t[7]||(t[7]=Fe(()=>{},["stop"]))},[e.title!==null&&e.title!==void 0?(j(),se("div",{key:0,ref:"headerRef",class:ee(e.ns.e("header"))},[$("div",{class:ee(e.ns.e("title"))},[e.iconComponent&&e.center?(j(),ue(S,{key:0,class:ee([e.ns.e("status"),e.typeClass])},{default:X(()=>[(j(),ue(tt(e.iconComponent)))]),_:1},8,["class"])):oe("v-if",!0),$("span",null,_e(e.title),1)],2),e.showClose?(j(),se("button",{key:0,type:"button",class:ee(e.ns.e("headerbtn")),"aria-label":e.t("el.messagebox.close"),onClick:t[0]||(t[0]=s=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel")),onKeydown:t[1]||(t[1]=_t(Fe(s=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),["prevent"]),["enter"]))},[z(S,{class:ee(e.ns.e("close"))},{default:X(()=>[z(m)]),_:1},8,["class"])],42,as)):oe("v-if",!0)],2)):oe("v-if",!0),$("div",{id:e.contentId,class:ee(e.ns.e("content"))},[$("div",{class:ee(e.ns.e("container"))},[e.iconComponent&&!e.center&&e.hasMessage?(j(),ue(S,{key:0,class:ee([e.ns.e("status"),e.typeClass])},{default:X(()=>[(j(),ue(tt(e.iconComponent)))]),_:1},8,["class"])):oe("v-if",!0),e.hasMessage?(j(),se("div",{key:1,class:ee(e.ns.e("message"))},[Be(e.$slots,"default",{},()=>[e.dangerouslyUseHTMLString?(j(),ue(tt(e.showInput?"label":"p"),{key:1,for:e.showInput?e.inputId:void 0,innerHTML:e.message},null,8,["for","innerHTML"])):(j(),ue(tt(e.showInput?"label":"p"),{key:0,for:e.showInput?e.inputId:void 0},{default:X(()=>[ge(_e(e.dangerouslyUseHTMLString?"":e.message),1)]),_:1},8,["for"]))])],2)):oe("v-if",!0)],2),ze($("div",{class:ee(e.ns.e("input"))},[z(p,{id:e.inputId,ref:"inputRef",modelValue:e.inputValue,"onUpdate:modelValue":t[2]||(t[2]=s=>e.inputValue=s),type:e.inputType,placeholder:e.inputPlaceholder,"aria-invalid":e.validateError,class:ee({invalid:e.validateError}),onKeydown:_t(e.handleInputEnter,["enter"])},null,8,["id","modelValue","type","placeholder","aria-invalid","class","onKeydown"]),$("div",{class:ee(e.ns.e("errormsg")),style:rt({visibility:e.editorErrorMessage?"visible":"hidden"})},_e(e.editorErrorMessage),7)],2),[[We,e.showInput]])],10,ls),$("div",{class:ee(e.ns.e("btns"))},[e.showCancelButton?(j(),ue(g,{key:0,loading:e.cancelButtonLoading,class:ee([e.cancelButtonClass]),round:e.roundButton,size:e.btnSize,onClick:t[3]||(t[3]=s=>e.handleAction("cancel")),onKeydown:t[4]||(t[4]=_t(Fe(s=>e.handleAction("cancel"),["prevent"]),["enter"]))},{default:X(()=>[ge(_e(e.cancelButtonText||e.t("el.messagebox.cancel")),1)]),_:1},8,["loading","class","round","size"])):oe("v-if",!0),ze(z(g,{ref:"confirmRef",type:"primary",loading:e.confirmButtonLoading,class:ee([e.confirmButtonClasses]),round:e.roundButton,disabled:e.confirmButtonDisabled,size:e.btnSize,onClick:t[5]||(t[5]=s=>e.handleAction("confirm")),onKeydown:t[6]||(t[6]=_t(Fe(s=>e.handleAction("confirm"),["prevent"]),["enter"]))},{default:X(()=>[ge(_e(e.confirmButtonText||e.t("el.messagebox.confirm")),1)]),_:1},8,["loading","class","round","disabled","size"]),[[We,e.showConfirmButton]])],2)],6)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,os)]),_:3},8,["z-index","overlay-class","mask"]),[[We,e.visible]])]),_:3})}var cs=wt(ss,[["render",us],["__file","/home/runner/work/element-plus/element-plus/packages/components/message-box/src/index.vue"]]);const ht=new Map,fs=e=>{let t=document.body;return e.appendTo&&(ln(e.appendTo)&&(t=document.querySelector(e.appendTo)),It(e.appendTo)&&(t=e.appendTo),It(t)||(t=document.body)),t},ds=(e,t,n=null)=>{const r=z(cs,e,yn(e.message)||dt(e.message)?{default:yn(e.message)?e.message:()=>e.message}:null);return r.appContext=n,Dt(r,t),fs(e).appendChild(t.firstElementChild),r.component},hs=()=>document.createElement("div"),ps=(e,t)=>{const n=hs();e.onVanish=()=>{Dt(null,n),ht.delete(i)},e.onAction=E=>{const S=ht.get(i);let m;e.showInput?m={value:i.inputValue,action:E}:m=E,e.callback?e.callback(m,r.proxy):E==="cancel"||E==="close"?e.distinguishCancelAndClose&&E!=="cancel"?S.reject("close"):S.reject("cancel"):S.resolve(m)};const r=ds(e,n,t),i=r.proxy;for(const E in e)vn(e,E)&&!vn(i.$props,E)&&(i[E]=e[E]);return i.visible=!0,i};function at(e,t=null){if(!Yn)return Promise.reject();let n;return ln(e)||dt(e)?e={message:e}:n=e.callback,new Promise((r,i)=>{const E=ps(e,t??at._context);ht.set(E,{options:e,callback:n,resolve:r,reject:i})})}const _s=["alert","confirm","prompt"],ms={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};_s.forEach(e=>{at[e]=gs(e)});function gs(e){return(t,n,r,i)=>{let E="";return _i(n)?(r=n,E=""):mi(n)?E="":E=n,at(Object.assign({title:E,message:t,type:"",...ms[e]},r,{boxType:e}),i)}}at.close=()=>{ht.forEach((e,t)=>{t.doClose()}),ht.clear()};at._context=null;const Ke=at;Ke.install=e=>{Ke._context=e._context,e.config.globalProperties.$msgbox=Ke,e.config.globalProperties.$messageBox=Ke,e.config.globalProperties.$alert=Ke.alert,e.config.globalProperties.$confirm=Ke.confirm,e.config.globalProperties.$prompt=Ke.prompt};const He=Ke,Qn=["success","info","warning","error"],vs=an({customClass:{type:String,default:""},dangerouslyUseHTMLString:{type:Boolean,default:!1},duration:{type:Number,default:4500},icon:{type:gi},id:{type:String,default:""},message:{type:zt([String,Object]),default:""},offset:{type:Number,default:0},onClick:{type:zt(Function),default:()=>{}},onClose:{type:zt(Function),required:!0},position:{type:String,values:["top-right","top-left","bottom-right","bottom-left"],default:"top-right"},showClose:{type:Boolean,default:!0},title:{type:String,default:""},type:{type:String,values:[...Qn,""],default:""},zIndex:Number}),ys={destroy:()=>!0},Es=["id"],xs=["textContent"],Ss={key:0},Cs=["innerHTML"],bs=st({name:"ElNotification"}),Rs=st({...bs,props:vs,emits:ys,setup(e,{expose:t}){const n=e,{ns:r,zIndex:i}=Hn("notification"),{nextZIndex:E,currentZIndex:S}=i,{Close:m}=yi,p=J(!1);let g;const u=pe(()=>{const d=n.type;return d&&Pt[n.type]?r.m(d):""}),o=pe(()=>n.type&&Pt[n.type]||n.icon),s=pe(()=>n.position.endsWith("right")?"right":"left"),y=pe(()=>n.position.startsWith("top")?"top":"bottom"),c=pe(()=>{var d;return{[y.value]:`${n.offset}px`,zIndex:(d=n.zIndex)!=null?d:S.value}});function _(){n.duration>0&&({stop:g}=Ei(()=>{p.value&&f()},n.duration))}function v(){g==null||g()}function f(){p.value=!1}function l({code:d}){d===yt.delete||d===yt.backspace?v():d===yt.esc?p.value&&f():_()}return jt(()=>{_(),E(),p.value=!0}),vi(document,"keydown",l),t({visible:p,close:f}),(d,h)=>(j(),ue(Ft,{name:G(r).b("fade"),onBeforeLeave:d.onClose,onAfterLeave:h[1]||(h[1]=a=>d.$emit("destroy")),persisted:""},{default:X(()=>[ze($("div",{id:d.id,class:ee([G(r).b(),d.customClass,G(s)]),style:rt(G(c)),role:"alert",onMouseenter:v,onMouseleave:_,onClick:h[0]||(h[0]=(...a)=>d.onClick&&d.onClick(...a))},[G(o)?(j(),ue(G(Je),{key:0,class:ee([G(r).e("icon"),G(u)])},{default:X(()=>[(j(),ue(tt(G(o))))]),_:1},8,["class"])):oe("v-if",!0),$("div",{class:ee(G(r).e("group"))},[$("h2",{class:ee(G(r).e("title")),textContent:_e(d.title)},null,10,xs),ze($("div",{class:ee(G(r).e("content")),style:rt(d.title?void 0:{margin:0})},[Be(d.$slots,"default",{},()=>[d.dangerouslyUseHTMLString?(j(),se(we,{key:1},[oe(" Caution here, message could've been compromised, never use user's input as message "),$("p",{innerHTML:d.message},null,8,Cs)],2112)):(j(),se("p",Ss,_e(d.message),1))])],6),[[We,d.message]]),d.showClose?(j(),ue(G(Je),{key:0,class:ee(G(r).e("closeBtn")),onClick:Fe(f,["stop"])},{default:X(()=>[z(G(m))]),_:1},8,["class","onClick"])):oe("v-if",!0)],2)],46,Es),[[We,p.value]])]),_:3},8,["name","onBeforeLeave"]))}});var Ts=wt(Rs,[["__file","/home/runner/work/element-plus/element-plus/packages/components/notification/src/notification.vue"]]);const Bt={"top-left":[],"top-right":[],"bottom-left":[],"bottom-right":[]},Yt=16;let Ls=1;const it=function(e={},t=null){if(!Yn)return{close:()=>{}};(typeof e=="string"||dt(e))&&(e={message:e});const n=e.position||"top-right";let r=e.offset||0;Bt[n].forEach(({vm:u})=>{var o;r+=(((o=u.el)==null?void 0:o.offsetHeight)||0)+Yt}),r+=Yt;const i=`notification_${Ls++}`,E=e.onClose,S={...e,offset:r,id:i,onClose:()=>{As(i,n,E)}};let m=document.body;It(e.appendTo)?m=e.appendTo:ln(e.appendTo)&&(m=document.querySelector(e.appendTo)),It(m)||(m=document.body);const p=document.createElement("div"),g=z(Ts,S,dt(S.message)?{default:()=>S.message}:null);return g.appContext=t??it._context,g.props.onDestroy=()=>{Dt(null,p)},Dt(g,p),Bt[n].push({vm:g}),m.appendChild(p.firstElementChild),{close:()=>{g.component.exposed.visible.value=!1}}};Qn.forEach(e=>{it[e]=(t={})=>((typeof t=="string"||dt(t))&&(t={message:t}),it({...t,type:e}))});function As(e,t,n){const r=Bt[t],i=r.findIndex(({vm:g})=>{var u;return((u=g.component)==null?void 0:u.props.id)===e});if(i===-1)return;const{vm:E}=r[i];if(!E)return;n==null||n(E);const S=E.el.offsetHeight,m=t.split("-")[0];r.splice(i,1);const p=r.length;if(!(p<1))for(let g=i;g<p;g++){const{el:u,component:o}=r[g].vm,s=Number.parseInt(u.style[m],10)-S-Yt;o.props.offset=s}}function Os(){for(const e of Object.values(Bt))e.forEach(({vm:t})=>{t.component.exposed.visible.value=!1})}it.closeAll=Os;it._context=null;const Ps=xi(it,"$notify");const Ve=Object.create(null);Ve.open="0";Ve.close="1";Ve.ping="2";Ve.pong="3";Ve.message="4";Ve.upgrade="5";Ve.noop="6";const Et=Object.create(null);Object.keys(Ve).forEach(e=>{Et[Ve[e]]=e});const ks={type:"error",data:"parser error"},Ds=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Is=typeof ArrayBuffer=="function",Ms=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Zn=({type:e,data:t},n,r)=>Ds&&t instanceof Blob?n?r(t):Cn(t,r):Is&&(t instanceof ArrayBuffer||Ms(t))?n?r(t):Cn(new Blob([t]),r):r(Ve[e]+(t||"")),Cn=(e,t)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];t("b"+(r||""))},n.readAsDataURL(e)},bn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ft=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<bn.length;e++)ft[bn.charCodeAt(e)]=e;const Bs=e=>{let t=e.length*.75,n=e.length,r,i=0,E,S,m,p;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const g=new ArrayBuffer(t),u=new Uint8Array(g);for(r=0;r<n;r+=4)E=ft[e.charCodeAt(r)],S=ft[e.charCodeAt(r+1)],m=ft[e.charCodeAt(r+2)],p=ft[e.charCodeAt(r+3)],u[i++]=E<<2|S>>4,u[i++]=(S&15)<<4|m>>2,u[i++]=(m&3)<<6|p&63;return g},Fs=typeof ArrayBuffer=="function",er=(e,t)=>{if(typeof e!="string")return{type:"message",data:tr(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:ws(e.substring(1),t)}:Et[n]?e.length>1?{type:Et[n],data:e.substring(1)}:{type:Et[n]}:ks},ws=(e,t)=>{if(Fs){const n=Bs(e);return tr(n,t)}else return{base64:!0,data:e}},tr=(e,t)=>{switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}},nr=String.fromCharCode(30),Us=(e,t)=>{const n=e.length,r=new Array(n);let i=0;e.forEach((E,S)=>{Zn(E,!1,m=>{r[S]=m,++i===n&&t(r.join(nr))})})},js=(e,t)=>{const n=e.split(nr),r=[];for(let i=0;i<n.length;i++){const E=er(n[i],t);if(r.push(E),E.type==="error")break}return r},rr=4;function ve(e){if(e)return Ns(e)}function Ns(e){for(var t in ve.prototype)e[t]=ve.prototype[t];return e}ve.prototype.on=ve.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};ve.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};ve.prototype.off=ve.prototype.removeListener=ve.prototype.removeAllListeners=ve.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+e],this};ve.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this};ve.prototype.emitReserved=ve.prototype.emit;ve.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};ve.prototype.hasListeners=function(e){return!!this.listeners(e).length};const ke=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function ir(e,...t){return t.reduce((n,r)=>(e.hasOwnProperty(r)&&(n[r]=e[r]),n),{})}const Vs=ke.setTimeout,Gs=ke.clearTimeout;function Nt(e,t){t.useNativeTimers?(e.setTimeoutFn=Vs.bind(ke),e.clearTimeoutFn=Gs.bind(ke)):(e.setTimeoutFn=ke.setTimeout.bind(ke),e.clearTimeoutFn=ke.clearTimeout.bind(ke))}const Ks=1.33;function zs(e){return typeof e=="string"?Ws(e):Math.ceil((e.byteLength||e.size)*Ks)}function Ws(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}class $s extends Error{constructor(t,n,r){super(t),this.description=n,this.context=r,this.type="TransportError"}}class sr extends ve{constructor(t){super(),this.writable=!1,Nt(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,n,r){return super.emitReserved("error",new $s(t,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=er(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}}const or="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Xt=64,Hs={};let Rn=0,mt=0,Tn;function Ln(e){let t="";do t=or[e%Xt]+t,e=Math.floor(e/Xt);while(e>0);return t}function ar(){const e=Ln(+new Date);return e!==Tn?(Rn=0,Tn=e):e+"."+Ln(Rn++)}for(;mt<Xt;mt++)Hs[or[mt]]=mt;function lr(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function Ys(e){let t={},n=e.split("&");for(let r=0,i=n.length;r<i;r++){let E=n[r].split("=");t[decodeURIComponent(E[0])]=decodeURIComponent(E[1])}return t}let ur=!1;try{ur=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Xs=ur;function cr(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Xs))return new XMLHttpRequest}catch{}if(!t)try{return new ke[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Js(){}const qs=function(){return new cr({xdomain:!1}).responseType!=null}();class Qs extends sr{constructor(t){if(super(t),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||i!==t.port,this.xs=t.secure!==r}const n=t&&t.forceBase64;this.supportsBinary=qs&&!n}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};js(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Us(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.query||{};const n=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=ar()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.opts.port&&(n==="https"&&Number(this.opts.port)!==443||n==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=lr(t),E=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(E?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Ne(this.uri(),t)}doWrite(t,n){const r=this.request({method:"POST",data:t});r.on("success",n),r.on("error",(i,E)=>{this.onError("xhr post error",i,E)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=t}}class Ne extends ve{constructor(t,n){super(),Nt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=t,this.async=n.async!==!1,this.data=n.data!==void 0?n.data:null,this.create()}create(){const t=ir(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const n=this.xhr=new cr(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=Ne.requestsCount++,Ne.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Js,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Ne.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Ne.requestsCount=0;Ne.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",An);else if(typeof addEventListener=="function"){const e="onpagehide"in ke?"pagehide":"unload";addEventListener(e,An,!1)}}function An(){for(let e in Ne.requests)Ne.requests.hasOwnProperty(e)&&Ne.requests[e].abort()}const fr=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0))(),gt=ke.WebSocket||ke.MozWebSocket,On=!0,Zs="arraybuffer",Pn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class eo extends sr{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),n=this.opts.protocols,r=Pn?{}:ir(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=On&&!Pn?n?new gt(t,n):new gt(t):new gt(t,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||Zs,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const r=t[n],i=n===t.length-1;Zn(r,this.supportsBinary,E=>{const S={};try{On&&this.ws.send(E)}catch{}i&&fr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const n=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(n==="wss"&&Number(this.opts.port)!==443||n==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=ar()),this.supportsBinary||(t.b64=1);const i=lr(t),E=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(E?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!gt}}const to={websocket:eo,polling:Qs},no=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ro=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Jt(e){const t=e,n=e.indexOf("["),r=e.indexOf("]");n!=-1&&r!=-1&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let i=no.exec(e||""),E={},S=14;for(;S--;)E[ro[S]]=i[S]||"";return n!=-1&&r!=-1&&(E.source=t,E.host=E.host.substring(1,E.host.length-1).replace(/;/g,":"),E.authority=E.authority.replace("[","").replace("]","").replace(/;/g,":"),E.ipv6uri=!0),E.pathNames=io(E,E.path),E.queryKey=so(E,E.query),E}function io(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&r.splice(0,1),t.slice(-1)=="/"&&r.splice(r.length-1,1),r}function so(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,E){i&&(n[i]=E)}),n}let dr=class et extends ve{constructor(t,n={}){super(),this.writeBuffer=[],t&&typeof t=="object"&&(n=t,t=null),t?(t=Jt(t),n.hostname=t.host,n.secure=t.protocol==="https"||t.protocol==="wss",n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=Jt(n.host).host),Nt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Ys(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=rr,n.transport=t,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts.transportOptions[t],this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new to[t](r)}open(){let t;if(this.opts.rememberUpgrade&&et.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch{this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(t){let n=this.createTransport(t),r=!1;et.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",o=>{if(!r)if(o.type==="pong"&&o.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;et.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const s=new Error("probe error");s.transport=n.name,this.emitReserved("upgradeError",s)}}))};function E(){r||(r=!0,u(),n.close(),n=null)}const S=o=>{const s=new Error("probe error: "+o);s.transport=n.name,E(),this.emitReserved("upgradeError",s)};function m(){S("transport closed")}function p(){S("socket closed")}function g(o){n&&o.name!==n.name&&E()}const u=()=>{n.removeListener("open",i),n.removeListener("error",S),n.removeListener("close",m),this.off("close",p),this.off("upgrading",g)};n.once("open",i),n.once("error",S),n.once("close",m),this.once("close",p),this.once("upgrading",g),n.open()}onOpen(){if(this.readyState="open",et.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let t=0;const n=this.upgrades.length;for(;t<n;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=t.data,this.onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=zs(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(t,n,r){return this.sendPacket("message",t,n,r),this}send(t,n,r){return this.sendPacket("message",t,n,r),this}sendPacket(t,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const E={type:t,data:n,options:r};this.emitReserved("packetCreate",E),this.writeBuffer.push(E),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():t()}):this.upgrading?r():t()),this}onError(t){et.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const n=[];let r=0;const i=t.length;for(;r<i;r++)~this.transports.indexOf(t[r])&&n.push(t[r]);return n}};dr.protocol=rr;function oo(e,t="",n){let r=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),r=Jt(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const E=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+E+":"+r.port+t,r.href=r.protocol+"://"+E+(n&&n.port===r.port?"":":"+r.port),r}const ao=typeof ArrayBuffer=="function",lo=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,hr=Object.prototype.toString,uo=typeof Blob=="function"||typeof Blob<"u"&&hr.call(Blob)==="[object BlobConstructor]",co=typeof File=="function"||typeof File<"u"&&hr.call(File)==="[object FileConstructor]";function dn(e){return ao&&(e instanceof ArrayBuffer||lo(e))||uo&&e instanceof Blob||co&&e instanceof File}function xt(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,r=e.length;n<r;n++)if(xt(e[n]))return!0;return!1}if(dn(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return xt(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&xt(e[n]))return!0;return!1}function fo(e){const t=[],n=e.data,r=e;return r.data=qt(n,t),r.attachments=t.length,{packet:r,buffers:t}}function qt(e,t){if(!e)return e;if(dn(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=qt(e[r],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=qt(e[r],t));return n}return e}function ho(e,t){return e.data=Qt(e.data,t),delete e.attachments,e}function Qt(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Qt(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Qt(e[n],t));return e}const po=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],_o=5;var ie;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(ie||(ie={}));class mo{constructor(t){this.replacer=t}encode(t){return(t.type===ie.EVENT||t.type===ie.ACK)&&xt(t)?this.encodeAsBinary({type:t.type===ie.EVENT?ie.BINARY_EVENT:ie.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===ie.BINARY_EVENT||t.type===ie.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=fo(t),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}function kn(e){return Object.prototype.toString.call(e)==="[object Object]"}class hn extends ve{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const r=n.type===ie.BINARY_EVENT;r||n.type===ie.BINARY_ACK?(n.type=r?ie.EVENT:ie.ACK,this.reconstructor=new go(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(dn(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const r={type:Number(t.charAt(0))};if(ie[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===ie.BINARY_EVENT||r.type===ie.BINARY_ACK){const E=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const S=t.substring(E,n);if(S!=Number(S)||t.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(S)}if(t.charAt(n+1)==="/"){const E=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););r.nsp=t.substring(E,n)}else r.nsp="/";const i=t.charAt(n+1);if(i!==""&&Number(i)==i){const E=n+1;for(;++n;){const S=t.charAt(n);if(S==null||Number(S)!=S){--n;break}if(n===t.length)break}r.id=Number(t.substring(E,n+1))}if(t.charAt(++n)){const E=this.tryParse(t.substr(n));if(hn.isPayloadValid(r.type,E))r.data=E;else throw new Error("invalid payload")}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case ie.CONNECT:return kn(n);case ie.DISCONNECT:return n===void 0;case ie.CONNECT_ERROR:return typeof n=="string"||kn(n);case ie.EVENT:case ie.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&po.indexOf(n[0])===-1);case ie.ACK:case ie.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class go{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=ho(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const vo=Object.freeze(Object.defineProperty({__proto__:null,Decoder:hn,Encoder:mo,get PacketType(){return ie},protocol:_o},Symbol.toStringTag,{value:"Module"}));function Ie(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const yo=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class pr extends ve{constructor(t,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Ie(t,"open",this.onopen.bind(this)),Ie(t,"packet",this.onpacket.bind(this)),Ie(t,"error",this.onerror.bind(this)),Ie(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){if(yo.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const r={type:ie.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const S=this.ids++,m=n.pop();this._registerAckCallback(S,m),r.id=S}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(t,n){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[t]=n;return}const E=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let S=0;S<this.sendBuffer.length;S++)this.sendBuffer[S].id===t&&this.sendBuffer.splice(S,1);n.call(this,new Error("operation has timed out"))},i);this.acks[t]=(...S)=>{this.io.clearTimeoutFn(E),n.apply(this,[null,...S])}}emitWithAck(t,...n){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,E)=>{n.push((S,m)=>r?S?E(S):i(m):i(S)),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...E)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...E)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:ie.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case ie.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ie.EVENT:case ie.BINARY_EVENT:this.onevent(t);break;case ie.ACK:case ie.BINARY_ACK:this.onack(t);break;case ie.DISCONNECT:this.ondisconnect();break;case ie.CONNECT_ERROR:this.destroy();const r=new Error(t.data.message);r.data=t.data.data,this.emitReserved("connect_error",r);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:ie.ACK,id:t,data:i}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(n.apply(this,t.data),delete this.acks[t.id])}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ie.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,t.data)}}}function lt(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}lt.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0};lt.prototype.reset=function(){this.attempts=0};lt.prototype.setMin=function(e){this.ms=e};lt.prototype.setMax=function(e){this.max=e};lt.prototype.setJitter=function(e){this.jitter=e};class Zt extends ve{constructor(t,n){var r;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Nt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new lt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||vo;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new dr(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Ie(n,"open",function(){r.onopen(),t&&t()}),E=Ie(n,"error",S=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",S),t?t(S):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const S=this._timeout;S===0&&i();const m=this.setTimeoutFn(()=>{i(),n.close(),n.emit("error",new Error("timeout"))},S);this.opts.autoUnref&&m.unref(),this.subs.push(function(){clearTimeout(m)})}return this.subs.push(i),this.subs.push(E),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Ie(t,"ping",this.onping.bind(this)),Ie(t,"data",this.ondata.bind(this)),Ie(t,"error",this.onerror.bind(this)),Ie(t,"close",this.onclose.bind(this)),Ie(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){fr(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let r=this.nsps[t];return r?this._autoConnect&&!r.active&&r.connect():(r=new pr(this,t,n),this.nsps[t]=r),r}_destroy(t){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let r=0;r<n.length;r++)this.engine.write(n[r],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const ut={};function St(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=oo(e,t.path||"/socket.io"),r=n.source,i=n.id,E=n.path,S=ut[i]&&E in ut[i].nsps,m=t.forceNew||t["force new connection"]||t.multiplex===!1||S;let p;return m?p=new Zt(r,t):(ut[i]||(ut[i]=new Zt(r,t)),p=ut[i]),n.query&&!t.query&&(t.query=n.queryKey),p.socket(n.path,t)}Object.assign(St,{Manager:Zt,Socket:pr,io:St,connect:St});let le=null;const Eo=({query:e})=>new Promise(t=>{le=St("wss://121.36.99.231:3000",{reconnection:!0,forceNew:!0,transports:["websocket"],query:e,auth:{token:"Bearer "+localStorage.getItem("live_token")}}),le.on("connect",()=>{t(),console.log(le.id,"监听客户端连接成功-connect")})});let _r=!0,mr=!0;function Ct(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Qe(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(S,m){if(S!==t)return i.apply(this,arguments);const p=g=>{const u=n(g);u&&(m.handleEvent?m.handleEvent(u):m(u))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(m,p),i.apply(this,[S,p])};const E=r.removeEventListener;r.removeEventListener=function(S,m){if(S!==t||!this._eventMap||!this._eventMap[t])return E.apply(this,arguments);if(!this._eventMap[t].has(m))return E.apply(this,arguments);const p=this._eventMap[t].get(m);return this._eventMap[t].delete(m),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,E.apply(this,[S,p])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(S){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),S&&this.addEventListener(t,this["_on"+t]=S)},enumerable:!0,configurable:!0})}function xo(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(_r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function So(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(mr=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function gr(){if(typeof window=="object"){if(_r)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function pn(e,t){mr&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Co(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Ct(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Ct(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=Ct(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function Dn(e){return Object.prototype.toString.call(e)==="[object Object]"}function vr(e){return Dn(e)?Object.keys(e).reduce(function(t,n){const r=Dn(e[n]),i=r?vr(e[n]):e[n],E=r&&!Object.keys(i).length;return i===void 0||E?t:Object.assign(t,{[n]:i})},{}):e}function en(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?en(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{en(e,e.get(i),n)})}))}function In(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const E=[];return e.forEach(S=>{S.type==="track"&&S.trackIdentifier===t.id&&E.push(S)}),E.forEach(S=>{e.forEach(m=>{m.type===r&&m.trackId===S.id&&en(e,m,i)})}),i}const Mn=gr;function yr(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(m){if(typeof m!="object"||m.mandatory||m.optional)return m;const p={};return Object.keys(m).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const u=typeof m[g]=="object"?m[g]:{ideal:m[g]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const o=function(s,y){return s?s+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(u.ideal!==void 0){p.optional=p.optional||[];let s={};typeof u.ideal=="number"?(s[o("min",g)]=u.ideal,p.optional.push(s),s={},s[o("max",g)]=u.ideal,p.optional.push(s)):(s[o("",g)]=u.ideal,p.optional.push(s))}u.exact!==void 0&&typeof u.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[o("",g)]=u.exact):["min","max"].forEach(s=>{u[s]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[o(s,g)]=u[s])})}),m.advanced&&(p.optional=(p.optional||[]).concat(m.advanced)),p},i=function(m,p){if(t.version>=61)return p(m);if(m=JSON.parse(JSON.stringify(m)),m&&typeof m.audio=="object"){const g=function(u,o,s){o in u&&!(s in u)&&(u[s]=u[o],delete u[o])};m=JSON.parse(JSON.stringify(m)),g(m.audio,"autoGainControl","googAutoGainControl"),g(m.audio,"noiseSuppression","googNoiseSuppression"),m.audio=r(m.audio)}if(m&&typeof m.video=="object"){let g=m.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const u=t.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete m.video.facingMode;let o;if(g.exact==="environment"||g.ideal==="environment"?o=["back","rear"]:(g.exact==="user"||g.ideal==="user")&&(o=["front"]),o)return n.mediaDevices.enumerateDevices().then(s=>{s=s.filter(c=>c.kind==="videoinput");let y=s.find(c=>o.some(_=>c.label.toLowerCase().includes(_)));return!y&&s.length&&o.includes("back")&&(y=s[s.length-1]),y&&(m.video.deviceId=g.exact?{exact:y.deviceId}:{ideal:y.deviceId}),m.video=r(m.video),Mn("chrome: "+JSON.stringify(m)),p(m)})}m.video=r(m.video)}return Mn("chrome: "+JSON.stringify(m)),p(m)},E=function(m){return t.version>=64?m:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[m.name]||m.name,message:m.message,constraint:m.constraint||m.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},S=function(m,p,g){i(m,u=>{n.webkitGetUserMedia(u,p,o=>{g&&g(E(o))})})};if(n.getUserMedia=S.bind(n),n.mediaDevices.getUserMedia){const m=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(p){return i(p,g=>m(g).then(u=>{if(g.audio&&!u.getAudioTracks().length||g.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(o=>{o.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(E(u))))}}}function bo(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(i=>{const E=r.video&&r.video.width,S=r.video&&r.video.height,m=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:m||3}},E&&(r.video.mandatory.maxWidth=E),S&&(r.video.mandatory.maxHeight=S),e.navigator.mediaDevices.getUserMedia(r)})}}}function Er(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function xr(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let E;e.RTCPeerConnection.prototype.getReceivers?E=this.getReceivers().find(m=>m.track&&m.track.id===i.track.id):E={track:i.track};const S=new Event("track");S.track=i.track,S.receiver=E,S.transceiver={receiver:E},S.streams=[r.stream],this.dispatchEvent(S)}),r.stream.getTracks().forEach(i=>{let E;e.RTCPeerConnection.prototype.getReceivers?E=this.getReceivers().find(m=>m.track&&m.track.id===i.id):E={track:i};const S=new Event("track");S.track=i,S.receiver=E,S.transceiver={receiver:E},S.streams=[r.stream],this.dispatchEvent(S)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Qe(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Sr(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,E){return{track:E,get dtmf(){return this._dtmf===void 0&&(E.kind==="audio"?this._dtmf=i.createDTMFSender(E):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(m,p){let g=i.apply(this,arguments);return g||(g=t(this,m),this._senders.push(g)),g};const E=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(m){E.apply(this,arguments);const p=this._senders.indexOf(m);p!==-1&&this._senders.splice(p,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(E){this._senders=this._senders||[],n.apply(this,[E]),E.getTracks().forEach(S=>{this._senders.push(t(this,S))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(E){this._senders=this._senders||[],r.apply(this,[E]),E.getTracks().forEach(S=>{const m=this._senders.find(p=>p.track===S);m&&this._senders.splice(this._senders.indexOf(m),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Cr(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,i,E]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const S=function(p){const g={};return p.result().forEach(o=>{const s={id:o.id,timestamp:o.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[o.type]||o.type};o.names().forEach(y=>{s[y]=o.stat(y)}),g[s.id]=s}),g},m=function(p){return new Map(Object.keys(p).map(g=>[g,p[g]]))};if(arguments.length>=2){const p=function(g){i(m(S(g)))};return t.apply(this,[p,r])}return new Promise((p,g)=>{t.apply(this,[function(u){p(m(S(u)))},g])}).then(i,E)}}function br(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const E=n.apply(this,[]);return E.forEach(S=>S._pc=this),E});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const E=r.apply(this,arguments);return E._pc=this,E}),e.RTCRtpSender.prototype.getStats=function(){const E=this;return this._pc.getStats().then(S=>In(S,E.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(E=>E._pc=this),i}),Qe(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(E=>In(E,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let i,E,S;return this.getSenders().forEach(m=>{m.track===r&&(i?S=!0:i=m)}),this.getReceivers().forEach(m=>(m.track===r&&(E?S=!0:E=m),m.track===r)),S||i&&E?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():E?E.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Rr(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(S=>this._shimmedLocalStreams[S][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(S,m){if(!m)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=t.apply(this,arguments);return this._shimmedLocalStreams[m.id]?this._shimmedLocalStreams[m.id].indexOf(p)===-1&&this._shimmedLocalStreams[m.id].push(p):this._shimmedLocalStreams[m.id]=[m,p],p};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(S){this._shimmedLocalStreams=this._shimmedLocalStreams||{},S.getTracks().forEach(g=>{if(this.getSenders().find(o=>o.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const m=this.getSenders();n.apply(this,arguments);const p=this.getSenders().filter(g=>m.indexOf(g)===-1);this._shimmedLocalStreams[S.id]=[S].concat(p)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[S.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},S&&Object.keys(this._shimmedLocalStreams).forEach(m=>{const p=this._shimmedLocalStreams[m].indexOf(S);p!==-1&&this._shimmedLocalStreams[m].splice(p,1),this._shimmedLocalStreams[m].length===1&&delete this._shimmedLocalStreams[m]}),i.apply(this,arguments)}}function Tr(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Rr(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(o=>this._reverseStreams[o.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(o=>{if(this.getSenders().find(y=>y.track===o))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const o=new e.MediaStream(u.getTracks());this._streams[u.id]=o,this._reverseStreams[o.id]=u,u=o}r.apply(this,[u])};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},e.RTCPeerConnection.prototype.addTrack=function(u,o){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const s=[].slice.call(arguments,1);if(s.length!==1||!s[0].getTracks().find(_=>_===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(_=>_.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const c=this._streams[o.id];if(c)c.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const _=new e.MediaStream([u]);this._streams[o.id]=_,this._reverseStreams[_.id]=o,this.addStream(_)}return this.getSenders().find(_=>_.track===u)};function E(g,u){let o=u.sdp;return Object.keys(g._reverseStreams||[]).forEach(s=>{const y=g._reverseStreams[s],c=g._streams[y.id];o=o.replace(new RegExp(c.id,"g"),y.id)}),new RTCSessionDescription({type:u.type,sdp:o})}function S(g,u){let o=u.sdp;return Object.keys(g._reverseStreams||[]).forEach(s=>{const y=g._reverseStreams[s],c=g._streams[y.id];o=o.replace(new RegExp(y.id,"g"),c.id)}),new RTCSessionDescription({type:u.type,sdp:o})}["createOffer","createAnswer"].forEach(function(g){const u=e.RTCPeerConnection.prototype[g],o={[g](){const s=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[c=>{const _=E(this,c);s[0].apply(null,[_])},c=>{s[1]&&s[1].apply(null,c)},arguments[2]]):u.apply(this,arguments).then(c=>E(this,c))}};e.RTCPeerConnection.prototype[g]=o[g]});const m=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?m.apply(this,arguments):(arguments[0]=S(this,arguments[0]),m.apply(this,arguments))};const p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const g=p.get.apply(this);return g.type===""?g:E(this,g)}}),e.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let s;Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(_=>u.track===_)&&(s=this._streams[y])}),s&&(s.getTracks().length===1?this.removeStream(this._reverseStreams[s.id]):s.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function tn(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function Lr(e,t){Qe(e,"negotiationneeded",n=>{const r=n.target;if(!((t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const Bn=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Lr,shimAddTrackRemoveTrack:Tr,shimAddTrackRemoveTrackWithNative:Rr,shimGetDisplayMedia:bo,shimGetSendersWithDtmf:Sr,shimGetStats:Cr,shimGetUserMedia:yr,shimMediaStream:Er,shimOnTrack:xr,shimPeerConnection:tn,shimSenderReceiverGetStats:br},Symbol.toStringTag,{value:"Module"}));function Ar(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,E,S){pn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(E,S)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(S,m,p){m in S&&!(p in S)&&(S[p]=S[m],delete S[m])},E=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(S){return typeof S=="object"&&typeof S.audio=="object"&&(S=JSON.parse(JSON.stringify(S)),i(S.audio,"autoGainControl","mozAutoGainControl"),i(S.audio,"noiseSuppression","mozNoiseSuppression")),E(S)},r&&r.prototype.getSettings){const S=r.prototype.getSettings;r.prototype.getSettings=function(){const m=S.apply(this,arguments);return i(m,"mozAutoGainControl","autoGainControl"),i(m,"mozNoiseSuppression","noiseSuppression"),m}}if(r&&r.prototype.applyConstraints){const S=r.prototype.applyConstraints;r.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),i(m,"autoGainControl","mozAutoGainControl"),i(m,"noiseSuppression","mozNoiseSuppression")),S.apply(this,[m])}}}}function Ro(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function Or(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function nn(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const E=e.RTCPeerConnection.prototype[i],S={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),E.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=S[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[E,S,m]=arguments;return r.apply(this,[E||null]).then(p=>{if(t.version<53&&!S)try{p.forEach(g=>{g.type=n[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;p.forEach((u,o)=>{p.set(o,Object.assign({},u,{type:n[u.type]||u.type}))})}return p}).then(S,m)}}function Pr(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(E=>E._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function kr(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Qe(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Dr(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){pn("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Ir(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Mr(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(S=>{if("rid"in S&&!/^[a-z0-9]{0,16}$/i.test(S.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in S&&!(parseFloat(S.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in S&&!(parseFloat(S.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const E=t.apply(this,arguments);if(i){const{sender:S}=E,m=S.getParameters();(!("encodings"in m)||m.encodings.length===1&&Object.keys(m.encodings[0]).length===0)&&(m.encodings=r,S.sendEncodings=r,this.setParametersPromises.push(S.setParameters(m).then(()=>{delete S.sendEncodings}).catch(()=>{delete S.sendEncodings})))}return E})}function Br(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Fr(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function wr(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const Fn=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Mr,shimCreateAnswer:wr,shimCreateOffer:Fr,shimGetDisplayMedia:Ro,shimGetParameters:Br,shimGetUserMedia:Ar,shimOnTrack:Or,shimPeerConnection:nn,shimRTCDataChannel:Ir,shimReceiverGetStats:kr,shimRemoveStream:Dr,shimSenderGetStats:Pr},Symbol.toStringTag,{value:"Module"}));function Ur(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>t.call(this,i,r)),r.getVideoTracks().forEach(i=>t.call(this,i,r))},e.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(E=>{this._localStreams?this._localStreams.includes(E)||this._localStreams.push(E):this._localStreams=[E]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(E=>{i.includes(E.track)&&this.removeTrack(E)})})}}function jr(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const E=new Event("addstream");E.stream=i,this.dispatchEvent(E)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(E=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(E)>=0)return;r._remoteStreams.push(E);const S=new Event("addstream");S.stream=E,r.dispatchEvent(S)})}),t.apply(r,arguments)}}}function Nr(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,E=t.setRemoteDescription,S=t.addIceCandidate;t.createOffer=function(g,u){const o=arguments.length>=2?arguments[2]:arguments[0],s=n.apply(this,[o]);return u?(s.then(g,u),Promise.resolve()):s},t.createAnswer=function(g,u){const o=arguments.length>=2?arguments[2]:arguments[0],s=r.apply(this,[o]);return u?(s.then(g,u),Promise.resolve()):s};let m=function(p,g,u){const o=i.apply(this,[p]);return u?(o.then(g,u),Promise.resolve()):o};t.setLocalDescription=m,m=function(p,g,u){const o=E.apply(this,[p]);return u?(o.then(g,u),Promise.resolve()):o},t.setRemoteDescription=m,m=function(p,g,u){const o=S.apply(this,[p]);return u?(o.then(g,u),Promise.resolve()):o},t.addIceCandidate=m}function Vr(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(Gr(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(r,i,E){t.mediaDevices.getUserMedia(r).then(i,E)}.bind(t))}function Gr(e){return e&&e.video!==void 0?Object.assign({},e,{video:vr(e.video)}):e}function Kr(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const E=[];for(let S=0;S<r.iceServers.length;S++){let m=r.iceServers[S];m.urls===void 0&&m.url?(pn("RTCIceServer.url","RTCIceServer.urls"),m=JSON.parse(JSON.stringify(m)),m.urls=m.url,delete m.url,E.push(m)):E.push(r.iceServers[S])}r.iceServers=E}return new t(r,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function zr(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Wr(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(S=>S.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const E=this.getTransceivers().find(S=>S.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&E?E.direction==="sendrecv"?E.setDirection?E.setDirection("sendonly"):E.direction="sendonly":E.direction==="recvonly"&&(E.setDirection?E.setDirection("inactive"):E.direction="inactive"):r.offerToReceiveVideo===!0&&!E&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function $r(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const wn=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:$r,shimCallbacksAPI:Nr,shimConstraints:Gr,shimCreateOfferLegacy:Wr,shimGetUserMedia:Vr,shimLocalStreamsAPI:Ur,shimRTCIceServerUrls:Kr,shimRemoteStreamsAPI:jr,shimTrackEventTransceiver:zr},Symbol.toStringTag,{value:"Module"}));var Hr={exports:{}};(function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,E)=>(E>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let E=8;E<r.length;E+=2)switch(r[E]){case"raddr":i.relatedAddress=r[E+1];break;case"rport":i.relatedPort=parseInt(r[E+1],10);break;case"tcptype":i.tcpType=r[E+1];break;case"ufrag":i.ufrag=r[E+1],i.usernameFragment=r[E+1];break;default:i[r[E]]===void 0&&(i[r[E]]=r[E+1]);break}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const E=n.type;return r.push("typ"),r.push(E),E!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const E=n.substring(n.indexOf(" ")+1).split(";");for(let S=0;S<E.length;S++)i=E[S].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const E=[];Object.keys(n.parameters).forEach(S=>{n.parameters[S]!==void 0?E.push(S+"="+n.parameters[S]):E.push(S)}),r+="a=fmtp:"+i+" "+E.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(E=>{r+="a=rtcp-fb:"+i+" "+E.type+(E.parameter&&E.parameter.length?" "+E.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},E=n.indexOf(":",r);return E>-1?(i.attribute=n.substring(r+1,E),i.value=n.substring(E+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(E=>{i+="a=fingerprint:"+E.algorithm+" "+E.value+`\r
`}),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],E=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&E?{usernameFragment:i.substring(12),password:E.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},E=t.splitLines(n)[0].split(" ");r.profile=E[2];for(let m=3;m<E.length;m++){const p=E[m],g=t.matchPrefix(n,"a=rtpmap:"+p+" ")[0];if(g){const u=t.parseRtpMap(g),o=t.matchPrefix(n,"a=fmtp:"+p+" ");switch(u.parameters=o.length?t.parseFmtp(o[0]):{},u.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+p+" ").map(t.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}t.matchPrefix(n,"a=extmap:").forEach(m=>{r.headerExtensions.push(t.parseExtmap(m))});const S=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(m=>{S.forEach(p=>{m.rtcpFeedback.find(u=>u.type===p.type&&u.parameter===p.parameter)||m.rtcpFeedback.push(p)})}),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(S=>S.preferredPayloadType!==void 0?S.preferredPayloadType:S.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(S=>{i+=t.writeRtpMap(S),i+=t.writeFmtp(S),i+=t.writeRtcpFb(S)});let E=0;return r.codecs.forEach(S=>{S.maxptime>E&&(E=S.maxptime)}),E>0&&(i+="a=maxptime:"+E+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(S=>{i+=t.writeExtmap(S)}),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),E=i.fecMechanisms.indexOf("RED")!==-1,S=i.fecMechanisms.indexOf("ULPFEC")!==-1,m=t.matchPrefix(n,"a=ssrc:").map(s=>t.parseSsrcMedia(s)).filter(s=>s.attribute==="cname"),p=m.length>0&&m[0].ssrc;let g;const u=t.matchPrefix(n,"a=ssrc-group:FID").map(s=>s.substring(17).split(" ").map(c=>parseInt(c,10)));u.length>0&&u[0].length>1&&u[0][0]===p&&(g=u[0][1]),i.codecs.forEach(s=>{if(s.name.toUpperCase()==="RTX"&&s.parameters.apt){let y={ssrc:p,codecPayloadType:parseInt(s.parameters.apt,10)};p&&g&&(y.rtx={ssrc:g}),r.push(y),E&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:p,mechanism:S?"red+ulpfec":"red"},r.push(y))}}),r.length===0&&p&&r.push({ssrc:p});let o=t.matchPrefix(n,"b=");return o.length&&(o[0].indexOf("b=TIAS:")===0?o=parseInt(o[0].substring(7),10):o[0].indexOf("b=AS:")===0?o=parseInt(o[0].substring(5),10)*1e3*.95-50*40*8:o=void 0,r.forEach(s=>{s.maxBitrate=o})),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map(m=>t.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const E=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=E.length>0,r.compound=E.length===0;const S=t.matchPrefix(n,"a=rtcp-mux");return r.mux=S.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const E=t.matchPrefix(n,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="msid");if(E.length>0)return r=E[0].value.split(" "),{stream:r[0],track:r[1]}},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let E;i.length>0&&(E=parseInt(i[0].substring(19),10)),isNaN(E)&&(E=65536);const S=t.matchPrefix(n,"a=sctp-port:");if(S.length>0)return{port:parseInt(S[0].substring(12),10),protocol:r.fmt,maxMessageSize:E};const m=t.matchPrefix(n,"a=sctpmap:");if(m.length>0){const p=m[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:E}}},t.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let E;const S=r!==void 0?r:2;return n?E=n:E=t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+E+" "+S+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let E=0;E<i.length;E++)switch(i[E]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[E].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(Hr);var Yr=Hr.exports;const nt=Xn(Yr),To=Ui({__proto__:null,default:nt},[Yr]);function bt(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new t(r),E=nt.parseCandidate(r.candidate);for(const S in E)S in i||Object.defineProperty(i,S,{value:E[S]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,Qe(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function rn(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Qe(e,"icecandidate",t=>{if(t.candidate){const n=nt.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function Rt(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(m){if(!m||!m.sdp)return!1;const p=nt.splitSections(m.sdp);return p.shift(),p.some(g=>{const u=nt.parseMLine(g);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(m){const p=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const g=parseInt(p[1],10);return g!==g?-1:g},i=function(m){let p=65536;return t.browser==="firefox"&&(t.version<57?m===-1?p=16384:p=2147483637:t.version<60?p=t.version===57?65535:65536:p=2147483637),p},E=function(m,p){let g=65536;t.browser==="firefox"&&t.version===57&&(g=65535);const u=nt.matchPrefix(m.sdp,"a=max-message-size:");return u.length>0?g=parseInt(u[0].substring(19),10):t.browser==="firefox"&&p!==-1&&(g=2147483637),g},S=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const p=r(arguments[0]),g=i(p),u=E(arguments[0],p);let o;g===0&&u===0?o=Number.POSITIVE_INFINITY:g===0||u===0?o=Math.max(g,u):o=Math.min(g,u);const s={};Object.defineProperty(s,"maxMessageSize",{get(){return o}}),this._sctp=s}return S.apply(this,arguments)}}function Tt(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const E=r.send;r.send=function(){const m=arguments[0],p=m.length||m.size||m.byteLength;if(r.readyState==="open"&&i.sctp&&p>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return E.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},Qe(e,"datachannel",r=>(t(r.channel,r.target),r))}function sn(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const E=i.target;if(E._lastConnectionState!==E.connectionState){E._lastConnectionState=E.connectionState;const S=new Event("connectionstatechange",i);E.dispatchEvent(S)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function on(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const E=i.sdp.split(`
`).filter(S=>S.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:E}):i.sdp=E}return n.apply(this,arguments)}}function Lt(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function At(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(S=>n.apply(this,[S]))})}const Lo=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:on,shimAddIceCandidateNullOrEmpty:Lt,shimConnectionState:sn,shimMaxMessageSize:Rt,shimParameterlessSetLocalDescription:At,shimRTCIceCandidate:bt,shimRTCIceCandidateRelayProtocol:rn,shimSendThrowTypeError:Tt},Symbol.toStringTag,{value:"Module"}));function Ao({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=gr,r=Co(e),i={browserDetails:r,commonShim:Lo,extractVersion:Ct,disableLog:xo,disableWarnings:So,sdp:To};switch(r.browser){case"chrome":if(!Bn||!tn||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Bn,Lt(e,r),At(e),yr(e,r),Er(e),tn(e,r),xr(e),Tr(e,r),Sr(e),Cr(e),br(e),Lr(e,r),bt(e),rn(e),sn(e),Rt(e,r),Tt(e),on(e,r);break;case"firefox":if(!Fn||!nn||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Fn,Lt(e,r),At(e),Ar(e,r),nn(e,r),Or(e),Dr(e),Pr(e),kr(e),Ir(e),Mr(e),Br(e),Fr(e),wr(e),bt(e),sn(e),Rt(e,r),Tt(e);break;case"safari":if(!wn||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=wn,Lt(e,r),At(e),Kr(e),Wr(e),Nr(e),Ur(e),jr(e),zr(e),Vr(e),$r(e),bt(e),rn(e),Rt(e,r),Tt(e),on(e,r);break;default:n("Unsupported browser!");break}return i}Ao({window:typeof window>"u"?void 0:window});const Oo={bundlePolicy:"balanced",iceTransportPolicy:"all",rtcpMuxPolicy:"negotiate",iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:121.36.99.231:3478",username:"ruan8",credential:"123456"}]};class Po{constructor({onTarck:t,onCandidate:n,onMessage:r}){Kt(this,"conn",null);Kt(this,"dataChannel",null);var i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;i||He.alert("当前浏览器不支持RTCPeerConnection！"),this.conn=new i(Oo),this.conn.addEventListener("icecandidate",E=>{E.candidate&&n(E.candidate)}),this.conn.addEventListener("track",t),this.conn.addEventListener("connectionstatechange",()=>{this.conn.connectionState==="connected"&&console.log("对等连接成功！")}),this.createDataChannel({onMessage:r})}createOffer(t){this.conn&&this.conn.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(n=>{this.conn.setLocalDescription(n),t(n)}).catch(()=>{console.log("创建offer失败")})}createAnswer(t){this.conn&&this.conn.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(n=>{this.conn&&this.conn.setLocalDescription(n),t(n)}).catch(()=>{console.log("创建answer失败")})}setRemoteDescription(t){var n;(n=this.conn)==null||n.setRemoteDescription(new RTCSessionDescription(t))}setCandidate(t){this.conn&&t&&this.conn.addIceCandidate(new RTCIceCandidate(t)).catch(n=>{console.log(n)})}addTrack(t){this.conn&&t&&t.getTracks().forEach(n=>{this.conn.addTrack(n,t)})}createDataChannel({onMessage:t}){if(this.dataChannel)return!1;this.dataChannel=this.conn.createDataChannel("channel",{ordered:!0,maxRetransmits:5}),this.onDataChannel({onMessage:t})}onDataChannel({onMessage:t}){this.conn.ondatachannel=n=>{var r=n.channel;r.onmessage=function(i){typeof t=="function"&&t(i)},r.onopen=function(){console.log("dataChannel open")},r.onclose=function(){console.log("dataChannel close")}}}}var Xr={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(self,function(){return function(){var n={"./node_modules/es6-promise/dist/es6-promise.js":function(S,m,p){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(g,u){S.exports=u()})(this,function(){function g(I){var B=typeof I;return I!==null&&(B==="object"||B==="function")}function u(I){return typeof I=="function"}var o=void 0;Array.isArray?o=Array.isArray:o=function(I){return Object.prototype.toString.call(I)==="[object Array]"};var s=o,y=0,c=void 0,_=void 0,v=function(B,F){T[y]=B,T[y+1]=F,y+=2,y===2&&(_?_(P):D())};function f(I){_=I}function l(I){v=I}var d=typeof window<"u"?window:void 0,h=d||{},a=h.MutationObserver||h.WebKitMutationObserver,x=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",C=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function b(){return function(){return process.nextTick(P)}}function L(){return typeof c<"u"?function(){c(P)}:R()}function O(){var I=0,B=new a(P),F=document.createTextNode("");return B.observe(F,{characterData:!0}),function(){F.data=I=++I%2}}function A(){var I=new MessageChannel;return I.port1.onmessage=P,function(){return I.port2.postMessage(0)}}function R(){var I=setTimeout;return function(){return I(P,1)}}var T=new Array(1e3);function P(){for(var I=0;I<y;I+=2){var B=T[I],F=T[I+1];B(F),T[I]=void 0,T[I+1]=void 0}y=0}function k(){try{var I=Function("return this")().require("vertx");return c=I.runOnLoop||I.runOnContext,L()}catch{return R()}}var D=void 0;x?D=b():a?D=O():C?D=A():d===void 0?D=k():D=R();function M(I,B){var F=this,K=new this.constructor(H);K[Q]===void 0&&w(K);var Z=F._state;if(Z){var ne=arguments[Z-1];v(function(){return Ue(Z,K,ne,F._result)})}else Te(F,K,I,B);return K}function q(I){var B=this;if(I&&typeof I=="object"&&I.constructor===B)return I;var F=new B(H);return Se(F,I),F}var Q=Math.random().toString(36).substring(2);function H(){}var te=void 0,ce=1,Y=2;function re(){return new TypeError("You cannot resolve a promise with itself")}function Ae(){return new TypeError("A promises callback cannot return that same promise.")}function ae(I,B,F,K){try{I.call(B,F,K)}catch(Z){return Z}}function fe(I,B,F){v(function(K){var Z=!1,ne=ae(F,B,function(Ee){Z||(Z=!0,B!==Ee?Se(K,Ee):de(K,Ee))},function(Ee){Z||(Z=!0,W(K,Ee))},"Settle: "+(K._label||" unknown promise"));!Z&&ne&&(Z=!0,W(K,ne))},I)}function Le(I,B){B._state===ce?de(I,B._result):B._state===Y?W(I,B._result):Te(B,void 0,function(F){return Se(I,F)},function(F){return W(I,F)})}function me(I,B,F){B.constructor===I.constructor&&F===M&&B.constructor.resolve===q?Le(I,B):F===void 0?de(I,B):u(F)?fe(I,B,F):de(I,B)}function Se(I,B){if(I===B)W(I,re());else if(g(B)){var F=void 0;try{F=B.then}catch(K){W(I,K);return}me(I,B,F)}else de(I,B)}function Re(I){I._onerror&&I._onerror(I._result),Oe(I)}function de(I,B){I._state===te&&(I._result=B,I._state=ce,I._subscribers.length!==0&&v(Oe,I))}function W(I,B){I._state===te&&(I._state=Y,I._result=B,v(Re,I))}function Te(I,B,F,K){var Z=I._subscribers,ne=Z.length;I._onerror=null,Z[ne]=B,Z[ne+ce]=F,Z[ne+Y]=K,ne===0&&I._state&&v(Oe,I)}function Oe(I){var B=I._subscribers,F=I._state;if(B.length!==0){for(var K=void 0,Z=void 0,ne=I._result,Ee=0;Ee<B.length;Ee+=3)K=B[Ee],Z=B[Ee+F],K?Ue(F,K,Z,ne):Z(ne);I._subscribers.length=0}}function Ue(I,B,F,K){var Z=u(F),ne=void 0,Ee=void 0,Ze=!0;if(Z){try{ne=F(K)}catch(pt){Ze=!1,Ee=pt}if(B===ne){W(B,Ae());return}}else ne=K;B._state!==te||(Z&&Ze?Se(B,ne):Ze===!1?W(B,Ee):I===ce?de(B,ne):I===Y&&W(B,ne))}function Pe(I,B){try{B(function(K){Se(I,K)},function(K){W(I,K)})}catch(F){W(I,F)}}var je=0;function N(){return je++}function w(I){I[Q]=je++,I._state=void 0,I._result=void 0,I._subscribers=[]}function U(){return new Error("Array Methods must be provided an Array")}var V=function(){function I(B,F){this._instanceConstructor=B,this.promise=new B(H),this.promise[Q]||w(this.promise),s(F)?(this.length=F.length,this._remaining=F.length,this._result=new Array(this.length),this.length===0?de(this.promise,this._result):(this.length=this.length||0,this._enumerate(F),this._remaining===0&&de(this.promise,this._result))):W(this.promise,U())}return I.prototype._enumerate=function(F){for(var K=0;this._state===te&&K<F.length;K++)this._eachEntry(F[K],K)},I.prototype._eachEntry=function(F,K){var Z=this._instanceConstructor,ne=Z.resolve;if(ne===q){var Ee=void 0,Ze=void 0,pt=!1;try{Ee=F.then}catch(Gt){pt=!0,Ze=Gt}if(Ee===M&&F._state!==te)this._settledAt(F._state,K,F._result);else if(typeof Ee!="function")this._remaining--,this._result[K]=F;else if(Z===he){var Vt=new Z(H);pt?W(Vt,Ze):me(Vt,F,Ee),this._willSettleAt(Vt,K)}else this._willSettleAt(new Z(function(Gt){return Gt(F)}),K)}else this._willSettleAt(ne(F),K)},I.prototype._settledAt=function(F,K,Z){var ne=this.promise;ne._state===te&&(this._remaining--,F===Y?W(ne,Z):this._result[K]=Z),this._remaining===0&&de(ne,this._result)},I.prototype._willSettleAt=function(F,K){var Z=this;Te(F,void 0,function(ne){return Z._settledAt(ce,K,ne)},function(ne){return Z._settledAt(Y,K,ne)})},I}();function Ce(I){return new V(this,I).promise}function be(I){var B=this;return s(I)?new B(function(F,K){for(var Z=I.length,ne=0;ne<Z;ne++)B.resolve(I[ne]).then(F,K)}):new B(function(F,K){return K(new TypeError("You must pass an array to race."))})}function $e(I){var B=this,F=new B(H);return W(F,I),F}function ye(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function xe(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var he=function(){function I(B){this[Q]=N(),this._result=this._state=void 0,this._subscribers=[],H!==B&&(typeof B!="function"&&ye(),this instanceof I?Pe(this,B):xe())}return I.prototype.catch=function(F){return this.then(null,F)},I.prototype.finally=function(F){var K=this,Z=K.constructor;return u(F)?K.then(function(ne){return Z.resolve(F()).then(function(){return ne})},function(ne){return Z.resolve(F()).then(function(){throw ne})}):K.then(F,F)},I}();he.prototype.then=M,he.all=Ce,he.race=be,he.resolve=q,he.reject=$e,he._setScheduler=f,he._setAsap=l,he._asap=v;function Jr(){var I=void 0;if(typeof p.g<"u")I=p.g;else if(typeof self<"u")I=self;else try{I=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var B=I.Promise;if(B){var F=null;try{F=Object.prototype.toString.call(B.resolve())}catch{}if(F==="[object Promise]"&&!B.cast)return}I.Promise=he}return he.polyfill=Jr,he.Promise=he,he})},"./node_modules/events/events.js":function(S){var m=typeof Reflect=="object"?Reflect:null,p=m&&typeof m.apply=="function"?m.apply:function(R,T,P){return Function.prototype.apply.call(R,T,P)},g;m&&typeof m.ownKeys=="function"?g=m.ownKeys:Object.getOwnPropertySymbols?g=function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:g=function(R){return Object.getOwnPropertyNames(R)};function u(A){console&&console.warn&&console.warn(A)}var o=Number.isNaN||function(R){return R!==R};function s(){s.init.call(this)}S.exports=s,S.exports.once=b,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var y=10;function c(A){if(typeof A!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof A)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return y},set:function(A){if(typeof A!="number"||A<0||o(A))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+A+".");y=A}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(R){if(typeof R!="number"||R<0||o(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this};function _(A){return A._maxListeners===void 0?s.defaultMaxListeners:A._maxListeners}s.prototype.getMaxListeners=function(){return _(this)},s.prototype.emit=function(R){for(var T=[],P=1;P<arguments.length;P++)T.push(arguments[P]);var k=R==="error",D=this._events;if(D!==void 0)k=k&&D.error===void 0;else if(!k)return!1;if(k){var M;if(T.length>0&&(M=T[0]),M instanceof Error)throw M;var q=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw q.context=M,q}var Q=D[R];if(Q===void 0)return!1;if(typeof Q=="function")p(Q,this,T);else for(var H=Q.length,te=a(Q,H),P=0;P<H;++P)p(te[P],this,T);return!0};function v(A,R,T,P){var k,D,M;if(c(T),D=A._events,D===void 0?(D=A._events=Object.create(null),A._eventsCount=0):(D.newListener!==void 0&&(A.emit("newListener",R,T.listener?T.listener:T),D=A._events),M=D[R]),M===void 0)M=D[R]=T,++A._eventsCount;else if(typeof M=="function"?M=D[R]=P?[T,M]:[M,T]:P?M.unshift(T):M.push(T),k=_(A),k>0&&M.length>k&&!M.warned){M.warned=!0;var q=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(R)+" listeners added. Use emitter.setMaxListeners() to increase limit");q.name="MaxListenersExceededWarning",q.emitter=A,q.type=R,q.count=M.length,u(q)}return A}s.prototype.addListener=function(R,T){return v(this,R,T,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(R,T){return v(this,R,T,!0)};function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(A,R,T){var P={fired:!1,wrapFn:void 0,target:A,type:R,listener:T},k=f.bind(P);return k.listener=T,P.wrapFn=k,k}s.prototype.once=function(R,T){return c(T),this.on(R,l(this,R,T)),this},s.prototype.prependOnceListener=function(R,T){return c(T),this.prependListener(R,l(this,R,T)),this},s.prototype.removeListener=function(R,T){var P,k,D,M,q;if(c(T),k=this._events,k===void 0)return this;if(P=k[R],P===void 0)return this;if(P===T||P.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete k[R],k.removeListener&&this.emit("removeListener",R,P.listener||T));else if(typeof P!="function"){for(D=-1,M=P.length-1;M>=0;M--)if(P[M]===T||P[M].listener===T){q=P[M].listener,D=M;break}if(D<0)return this;D===0?P.shift():x(P,D),P.length===1&&(k[R]=P[0]),k.removeListener!==void 0&&this.emit("removeListener",R,q||T)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(R){var T,P,k;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[R]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[R]),this;if(arguments.length===0){var D=Object.keys(P),M;for(k=0;k<D.length;++k)M=D[k],M!=="removeListener"&&this.removeAllListeners(M);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=P[R],typeof T=="function")this.removeListener(R,T);else if(T!==void 0)for(k=T.length-1;k>=0;k--)this.removeListener(R,T[k]);return this};function d(A,R,T){var P=A._events;if(P===void 0)return[];var k=P[R];return k===void 0?[]:typeof k=="function"?T?[k.listener||k]:[k]:T?C(k):a(k,k.length)}s.prototype.listeners=function(R){return d(this,R,!0)},s.prototype.rawListeners=function(R){return d(this,R,!1)},s.listenerCount=function(A,R){return typeof A.listenerCount=="function"?A.listenerCount(R):h.call(A,R)},s.prototype.listenerCount=h;function h(A){var R=this._events;if(R!==void 0){var T=R[A];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?g(this._events):[]};function a(A,R){for(var T=new Array(R),P=0;P<R;++P)T[P]=A[P];return T}function x(A,R){for(;R+1<A.length;R++)A[R]=A[R+1];A.pop()}function C(A){for(var R=new Array(A.length),T=0;T<R.length;++T)R[T]=A[T].listener||A[T];return R}function b(A,R){return new Promise(function(T,P){function k(M){A.removeListener(R,D),P(M)}function D(){typeof A.removeListener=="function"&&A.removeListener("error",k),T([].slice.call(arguments))}O(A,R,D,{once:!0}),R!=="error"&&L(A,k,{once:!0})})}function L(A,R,T){typeof A.on=="function"&&O(A,"error",R,T)}function O(A,R,T,P){if(typeof A.on=="function")P.once?A.once(R,T):A.on(R,T);else if(typeof A.addEventListener=="function")A.addEventListener(R,function k(D){P.once&&A.removeEventListener(R,k),T(D)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof A)}},"./node_modules/webworkify-webpack/index.js":function(S,m,p){function g(f){var l={};function d(a){if(l[a])return l[a].exports;var x=l[a]={i:a,l:!1,exports:{}};return f[a].call(x.exports,x,x.exports,d),x.l=!0,x.exports}d.m=f,d.c=l,d.i=function(a){return a},d.d=function(a,x,C){d.o(a,x)||Object.defineProperty(a,x,{configurable:!1,enumerable:!0,get:C})},d.r=function(a){Object.defineProperty(a,"__esModule",{value:!0})},d.n=function(a){var x=a&&a.__esModule?function(){return a.default}:function(){return a};return d.d(x,"a",x),x},d.o=function(a,x){return Object.prototype.hasOwnProperty.call(a,x)},d.p="/",d.oe=function(a){throw console.error(a),a};var h=d(d.s=ENTRY_MODULE);return h.default||h}var u="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+u+").*?\\)";function s(f){return(f+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function y(f){return!isNaN(1*f)}function c(f,l,d){var h={};h[d]=[];var a=l.toString(),x=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!x)return h;for(var C=x[1],b=new RegExp("(\\\\n|\\W)"+s(C)+o,"g"),L;L=b.exec(a);)L[3]!=="dll-reference"&&h[d].push(L[3]);for(b=new RegExp("\\("+s(C)+'\\("(dll-reference\\s('+u+'))"\\)\\)'+o,"g");L=b.exec(a);)f[L[2]]||(h[d].push(L[1]),f[L[2]]=p(L[1]).m),h[L[2]]=h[L[2]]||[],h[L[2]].push(L[4]);for(var O=Object.keys(h),A=0;A<O.length;A++)for(var R=0;R<h[O[A]].length;R++)y(h[O[A]][R])&&(h[O[A]][R]=1*h[O[A]][R]);return h}function _(f){var l=Object.keys(f);return l.reduce(function(d,h){return d||f[h].length>0},!1)}function v(f,l){for(var d={main:[l]},h={main:[]},a={main:{}};_(d);)for(var x=Object.keys(d),C=0;C<x.length;C++){var b=x[C],L=d[b],O=L.pop();if(a[b]=a[b]||{},!(a[b][O]||!f[b][O])){a[b][O]=!0,h[b]=h[b]||[],h[b].push(O);for(var A=c(f,f[b][O],b),R=Object.keys(A),T=0;T<R.length;T++)d[R[T]]=d[R[T]]||[],d[R[T]]=d[R[T]].concat(A[R[T]])}}return h}S.exports=function(f,l){l=l||{};var d={main:p.m},h=l.all?{main:Object.keys(d.main)}:v(d,f),a="";Object.keys(h).filter(function(O){return O!=="main"}).forEach(function(O){for(var A=0;h[O][A];)A++;h[O].push(A),d[O][A]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+O+" = ("+g.toString().replace("ENTRY_MODULE",JSON.stringify(A))+")({"+h[O].map(function(R){return""+JSON.stringify(R)+": "+d[O][R].toString()}).join(",")+`});
`}),a=a+"new (("+g.toString().replace("ENTRY_MODULE",JSON.stringify(f))+")({"+h.main.map(function(O){return""+JSON.stringify(O)+": "+d.main[O].toString()}).join(",")+"}))(self);";var x=new window.Blob([a],{type:"text/javascript"});if(l.bare)return x;var C=window.URL||window.webkitURL||window.mozURL||window.msURL,b=C.createObjectURL(x),L=new window.Worker(b);return L.objectURL=b,L}},"./src/config.js":function(S,m,p){p.r(m),p.d(m,{defaultConfig:function(){return g},createDefaultConfig:function(){return u}});var g={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function u(){return Object.assign({},g)}},"./src/core/features.js":function(S,m,p){p.r(m);var g=p("./src/io/io-controller.js"),u=p("./src/config.js"),o=function(){function s(){}return s.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},s.supportNetworkStreamIO=function(){var y=new g.default({},(0,u.createDefaultConfig)()),c=y.loaderType;return y.destroy(),c=="fetch-stream-loader"||c=="xhr-moz-chunked-loader"},s.getNetworkLoaderTypeName=function(){var y=new g.default({},(0,u.createDefaultConfig)()),c=y.loaderType;return y.destroy(),c},s.supportNativeMediaPlayback=function(y){s.videoElement==null&&(s.videoElement=window.document.createElement("video"));var c=s.videoElement.canPlayType(y);return c==="probably"||c=="maybe"},s.getFeatureList=function(){var y={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return y.mseFlvPlayback=s.supportMSEH264Playback(),y.networkStreamIO=s.supportNetworkStreamIO(),y.networkLoaderName=s.getNetworkLoaderTypeName(),y.mseLiveFlvPlayback=y.mseFlvPlayback&&y.networkStreamIO,y.nativeMP4H264Playback=s.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),y.nativeWebmVP8Playback=s.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),y.nativeWebmVP9Playback=s.supportNativeMediaPlayback('video/webm; codecs="vp9"'),y},s}();m.default=o},"./src/core/media-info.js":function(S,m,p){p.r(m);var g=function(){function u(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return u.prototype.isComplete=function(){var o=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,s=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&o&&s},u.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},u.prototype.getNearestKeyframe=function(o){if(this.keyframesIndex==null)return null;var s=this.keyframesIndex,y=this._search(s.times,o);return{index:y,milliseconds:s.times[y],fileposition:s.filepositions[y]}},u.prototype._search=function(o,s){var y=0,c=o.length-1,_=0,v=0,f=c;for(s<o[0]&&(y=0,v=f+1);v<=f;)if(_=v+Math.floor((f-v)/2),_===c||s>=o[_]&&s<o[_+1]){y=_;break}else o[_]<s?v=_+1:f=_-1;return y},u}();m.default=g},"./src/core/media-segment-info.js":function(S,m,p){p.r(m),p.d(m,{SampleInfo:function(){return g},MediaSegmentInfo:function(){return u},IDRSampleList:function(){return o},MediaSegmentInfoList:function(){return s}});var g=function(){function y(c,_,v,f,l){this.dts=c,this.pts=_,this.duration=v,this.originalDts=f,this.isSyncPoint=l,this.fileposition=null}return y}(),u=function(){function y(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return y.prototype.appendSyncPoint=function(c){c.isSyncPoint=!0,this.syncPoints.push(c)},y}(),o=function(){function y(){this._list=[]}return y.prototype.clear=function(){this._list=[]},y.prototype.appendArray=function(c){var _=this._list;c.length!==0&&(_.length>0&&c[0].originalDts<_[_.length-1].originalDts&&this.clear(),Array.prototype.push.apply(_,c))},y.prototype.getLastSyncPointBeforeDts=function(c){if(this._list.length==0)return null;var _=this._list,v=0,f=_.length-1,l=0,d=0,h=f;for(c<_[0].dts&&(v=0,d=h+1);d<=h;)if(l=d+Math.floor((h-d)/2),l===f||c>=_[l].dts&&c<_[l+1].dts){v=l;break}else _[l].dts<c?d=l+1:h=l-1;return this._list[v]},y}(),s=function(){function y(c){this._type=c,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(y.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),y.prototype.isEmpty=function(){return this._list.length===0},y.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},y.prototype._searchNearestSegmentBefore=function(c){var _=this._list;if(_.length===0)return-2;var v=_.length-1,f=0,l=0,d=v,h=0;if(c<_[0].originalBeginDts)return h=-1,h;for(;l<=d;)if(f=l+Math.floor((d-l)/2),f===v||c>_[f].lastSample.originalDts&&c<_[f+1].originalBeginDts){h=f;break}else _[f].originalBeginDts<c?l=f+1:d=f-1;return h},y.prototype._searchNearestSegmentAfter=function(c){return this._searchNearestSegmentBefore(c)+1},y.prototype.append=function(c){var _=this._list,v=c,f=this._lastAppendLocation,l=0;f!==-1&&f<_.length&&v.originalBeginDts>=_[f].lastSample.originalDts&&(f===_.length-1||f<_.length-1&&v.originalBeginDts<_[f+1].originalBeginDts)?l=f+1:_.length>0&&(l=this._searchNearestSegmentBefore(v.originalBeginDts)+1),this._lastAppendLocation=l,this._list.splice(l,0,v)},y.prototype.getLastSegmentBefore=function(c){var _=this._searchNearestSegmentBefore(c);return _>=0?this._list[_]:null},y.prototype.getLastSampleBefore=function(c){var _=this.getLastSegmentBefore(c);return _!=null?_.lastSample:null},y.prototype.getLastSyncPointBefore=function(c){for(var _=this._searchNearestSegmentBefore(c),v=this._list[_].syncPoints;v.length===0&&_>0;)_--,v=this._list[_].syncPoints;return v.length>0?v[v.length-1]:null},y}()},"./src/core/mse-controller.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),u=p.n(g),o=p("./src/utils/logger.js"),s=p("./src/utils/browser.js"),y=p("./src/core/mse-events.js"),c=p("./src/core/media-segment-info.js"),_=p("./src/utils/exception.js"),v=function(){function f(l){this.TAG="MSEController",this._config=l,this._emitter=new(u()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new c.IDRSampleList}return f.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},f.prototype.on=function(l,d){this._emitter.addListener(l,d)},f.prototype.off=function(l,d){this._emitter.removeListener(l,d)},f.prototype.attachMediaElement=function(l){if(this._mediaSource)throw new _.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var d=this._mediaSource=new window.MediaSource;d.addEventListener("sourceopen",this.e.onSourceOpen),d.addEventListener("sourceended",this.e.onSourceEnded),d.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=l,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),l.src=this._mediaSourceObjectURL},f.prototype.detachMediaElement=function(){if(this._mediaSource){var l=this._mediaSource;for(var d in this._sourceBuffers){var h=this._pendingSegments[d];h.splice(0,h.length),this._pendingSegments[d]=null,this._pendingRemoveRanges[d]=null,this._lastInitSegments[d]=null;var a=this._sourceBuffers[d];if(a){if(l.readyState!=="closed"){try{l.removeSourceBuffer(a)}catch(x){o.default.e(this.TAG,x.message)}a.removeEventListener("error",this.e.onSourceBufferError),a.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[d]=null,this._sourceBuffers[d]=null}}if(l.readyState==="open")try{l.endOfStream()}catch(x){o.default.e(this.TAG,x.message)}l.removeEventListener("sourceopen",this.e.onSourceOpen),l.removeEventListener("sourceended",this.e.onSourceEnded),l.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},f.prototype.appendInitSegment=function(l,d){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(l),this._pendingSegments[l.type].push(l);return}var h=l,a=""+h.container;h.codec&&h.codec.length>0&&(a+=";codecs="+h.codec);var x=!1;if(o.default.v(this.TAG,"Received Initialization Segment, mimeType: "+a),this._lastInitSegments[h.type]=h,a!==this._mimeTypes[h.type]){if(this._mimeTypes[h.type])o.default.v(this.TAG,"Notice: "+h.type+" mimeType changed, origin: "+this._mimeTypes[h.type]+", target: "+a);else{x=!0;try{var C=this._sourceBuffers[h.type]=this._mediaSource.addSourceBuffer(a);C.addEventListener("error",this.e.onSourceBufferError),C.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(b){o.default.e(this.TAG,b.message),this._emitter.emit(y.default.ERROR,{code:b.code,msg:b.message});return}}this._mimeTypes[h.type]=a}d||this._pendingSegments[h.type].push(h),x||this._sourceBuffers[h.type]&&!this._sourceBuffers[h.type].updating&&this._doAppendSegments(),s.default.safari&&h.container==="audio/mpeg"&&h.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=h.mediaDuration/1e3,this._updateMediaSourceDuration())},f.prototype.appendMediaSegment=function(l){var d=l;this._pendingSegments[d.type].push(d),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var h=this._sourceBuffers[d.type];h&&!h.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},f.prototype.seek=function(l){for(var d in this._sourceBuffers)if(this._sourceBuffers[d]){var h=this._sourceBuffers[d];if(this._mediaSource.readyState==="open")try{h.abort()}catch(O){o.default.e(this.TAG,O.message)}this._idrList.clear();var a=this._pendingSegments[d];if(a.splice(0,a.length),this._mediaSource.readyState!=="closed"){for(var x=0;x<h.buffered.length;x++){var C=h.buffered.start(x),b=h.buffered.end(x);this._pendingRemoveRanges[d].push({start:C,end:b})}if(h.updating||this._doRemoveRanges(),s.default.safari){var L=this._lastInitSegments[d];L&&(this._pendingSegments[d].push(L),h.updating||this._doAppendSegments())}}}},f.prototype.endOfStream=function(){var l=this._mediaSource,d=this._sourceBuffers;if(!l||l.readyState!=="open"){l&&l.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}d.video&&d.video.updating||d.audio&&d.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,l.endOfStream())},f.prototype.getNearestKeyframe=function(l){return this._idrList.getLastSyncPointBeforeDts(l)},f.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var l=this._mediaElement.currentTime;for(var d in this._sourceBuffers){var h=this._sourceBuffers[d];if(h){var a=h.buffered;if(a.length>=1&&l-a.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},f.prototype._doCleanupSourceBuffer=function(){var l=this._mediaElement.currentTime;for(var d in this._sourceBuffers){var h=this._sourceBuffers[d];if(h){for(var a=h.buffered,x=!1,C=0;C<a.length;C++){var b=a.start(C),L=a.end(C);if(b<=l&&l<L+3){if(l-b>=this._config.autoCleanupMaxBackwardDuration){x=!0;var O=l-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[d].push({start:b,end:O})}}else L<l&&(x=!0,this._pendingRemoveRanges[d].push({start:b,end:L}))}x&&!h.updating&&this._doRemoveRanges()}}},f.prototype._updateMediaSourceDuration=function(){var l=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(l.video&&l.video.updating||l.audio&&l.audio.updating)){var d=this._mediaSource.duration,h=this._pendingMediaDuration;h>0&&(isNaN(d)||h>d)&&(o.default.v(this.TAG,"Update MediaSource duration from "+d+" to "+h),this._mediaSource.duration=h),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},f.prototype._doRemoveRanges=function(){for(var l in this._pendingRemoveRanges)if(!(!this._sourceBuffers[l]||this._sourceBuffers[l].updating))for(var d=this._sourceBuffers[l],h=this._pendingRemoveRanges[l];h.length&&!d.updating;){var a=h.shift();d.remove(a.start,a.end)}},f.prototype._doAppendSegments=function(){var l=this._pendingSegments;for(var d in l)if(!(!this._sourceBuffers[d]||this._sourceBuffers[d].updating)&&l[d].length>0){var h=l[d].shift();if(h.timestampOffset){var a=this._sourceBuffers[d].timestampOffset,x=h.timestampOffset/1e3,C=Math.abs(a-x);C>.1&&(o.default.v(this.TAG,"Update MPEG audio timestampOffset from "+a+" to "+x),this._sourceBuffers[d].timestampOffset=x),delete h.timestampOffset}if(!h.data||h.data.byteLength===0)continue;try{this._sourceBuffers[d].appendBuffer(h.data),this._isBufferFull=!1,d==="video"&&h.hasOwnProperty("info")&&this._idrList.appendArray(h.info.syncPoints)}catch(b){this._pendingSegments[d].unshift(h),b.code===22?(this._isBufferFull||this._emitter.emit(y.default.BUFFER_FULL),this._isBufferFull=!0):(o.default.e(this.TAG,b.message),this._emitter.emit(y.default.ERROR,{code:b.code,msg:b.message}))}}},f.prototype._onSourceOpen=function(){if(o.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var l=this._pendingSourceBufferInit;l.length;){var d=l.shift();this.appendInitSegment(d,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(y.default.SOURCE_OPEN)},f.prototype._onSourceEnded=function(){o.default.v(this.TAG,"MediaSource onSourceEnded")},f.prototype._onSourceClose=function(){o.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},f.prototype._hasPendingSegments=function(){var l=this._pendingSegments;return l.video.length>0||l.audio.length>0},f.prototype._hasPendingRemoveRanges=function(){var l=this._pendingRemoveRanges;return l.video.length>0||l.audio.length>0},f.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(y.default.UPDATE_END)},f.prototype._onSourceBufferError=function(l){o.default.e(this.TAG,"SourceBuffer Error: "+l)},f}();m.default=v},"./src/core/mse-events.js":function(S,m,p){p.r(m);var g={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};m.default=g},"./src/core/transmuxer.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),u=p.n(g),o=p("./node_modules/webworkify-webpack/index.js"),s=p.n(o),y=p("./src/utils/logger.js"),c=p("./src/utils/logging-control.js"),_=p("./src/core/transmuxing-controller.js"),v=p("./src/core/transmuxing-events.js"),f=p("./src/core/media-info.js"),l=function(){function d(h,a){if(this.TAG="Transmuxer",this._emitter=new(u()),a.enableWorker&&typeof Worker<"u")try{this._worker=s()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[h,a]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},c.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:c.default.getConfig()})}catch{y.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new _.default(h,a)}else this._controller=new _.default(h,a);if(this._controller){var x=this._controller;x.on(v.default.IO_ERROR,this._onIOError.bind(this)),x.on(v.default.DEMUX_ERROR,this._onDemuxError.bind(this)),x.on(v.default.INIT_SEGMENT,this._onInitSegment.bind(this)),x.on(v.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),x.on(v.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),x.on(v.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),x.on(v.default.MEDIA_INFO,this._onMediaInfo.bind(this)),x.on(v.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),x.on(v.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),x.on(v.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),x.on(v.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return d.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),c.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},d.prototype.on=function(h,a){this._emitter.addListener(h,a)},d.prototype.off=function(h,a){this._emitter.removeListener(h,a)},d.prototype.hasWorker=function(){return this._worker!=null},d.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},d.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},d.prototype.seek=function(h){this._worker?this._worker.postMessage({cmd:"seek",param:h}):this._controller.seek(h)},d.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},d.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},d.prototype._onInitSegment=function(h,a){var x=this;Promise.resolve().then(function(){x._emitter.emit(v.default.INIT_SEGMENT,h,a)})},d.prototype._onMediaSegment=function(h,a){var x=this;Promise.resolve().then(function(){x._emitter.emit(v.default.MEDIA_SEGMENT,h,a)})},d.prototype._onLoadingComplete=function(){var h=this;Promise.resolve().then(function(){h._emitter.emit(v.default.LOADING_COMPLETE)})},d.prototype._onRecoveredEarlyEof=function(){var h=this;Promise.resolve().then(function(){h._emitter.emit(v.default.RECOVERED_EARLY_EOF)})},d.prototype._onMediaInfo=function(h){var a=this;Promise.resolve().then(function(){a._emitter.emit(v.default.MEDIA_INFO,h)})},d.prototype._onMetaDataArrived=function(h){var a=this;Promise.resolve().then(function(){a._emitter.emit(v.default.METADATA_ARRIVED,h)})},d.prototype._onScriptDataArrived=function(h){var a=this;Promise.resolve().then(function(){a._emitter.emit(v.default.SCRIPTDATA_ARRIVED,h)})},d.prototype._onStatisticsInfo=function(h){var a=this;Promise.resolve().then(function(){a._emitter.emit(v.default.STATISTICS_INFO,h)})},d.prototype._onIOError=function(h,a){var x=this;Promise.resolve().then(function(){x._emitter.emit(v.default.IO_ERROR,h,a)})},d.prototype._onDemuxError=function(h,a){var x=this;Promise.resolve().then(function(){x._emitter.emit(v.default.DEMUX_ERROR,h,a)})},d.prototype._onRecommendSeekpoint=function(h){var a=this;Promise.resolve().then(function(){a._emitter.emit(v.default.RECOMMEND_SEEKPOINT,h)})},d.prototype._onLoggingConfigChanged=function(h){this._worker&&this._worker.postMessage({cmd:"logging_config",param:h})},d.prototype._onWorkerMessage=function(h){var a=h.data,x=a.data;if(a.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(a.msg){case v.default.INIT_SEGMENT:case v.default.MEDIA_SEGMENT:this._emitter.emit(a.msg,x.type,x.data);break;case v.default.LOADING_COMPLETE:case v.default.RECOVERED_EARLY_EOF:this._emitter.emit(a.msg);break;case v.default.MEDIA_INFO:Object.setPrototypeOf(x,f.default.prototype),this._emitter.emit(a.msg,x);break;case v.default.METADATA_ARRIVED:case v.default.SCRIPTDATA_ARRIVED:case v.default.STATISTICS_INFO:this._emitter.emit(a.msg,x);break;case v.default.IO_ERROR:case v.default.DEMUX_ERROR:this._emitter.emit(a.msg,x.type,x.info);break;case v.default.RECOMMEND_SEEKPOINT:this._emitter.emit(a.msg,x);break;case"logcat_callback":y.default.emitter.emit("log",x.type,x.logcat);break}},d}();m.default=l},"./src/core/transmuxing-controller.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),u=p.n(g),o=p("./src/utils/logger.js"),s=p("./src/utils/browser.js"),y=p("./src/core/media-info.js"),c=p("./src/demux/flv-demuxer.js"),_=p("./src/remux/mp4-remuxer.js"),v=p("./src/demux/demux-errors.js"),f=p("./src/io/io-controller.js"),l=p("./src/core/transmuxing-events.js"),d=function(){function h(a,x){this.TAG="TransmuxingController",this._emitter=new(u()),this._config=x,a.segments||(a.segments=[{duration:a.duration,filesize:a.filesize,url:a.url}]),typeof a.cors!="boolean"&&(a.cors=!0),typeof a.withCredentials!="boolean"&&(a.withCredentials=!1),this._mediaDataSource=a,this._currentSegmentIndex=0;var C=0;this._mediaDataSource.segments.forEach(function(b){b.timestampBase=C,C+=b.duration,b.cors=a.cors,b.withCredentials=a.withCredentials,x.referrerPolicy&&(b.referrerPolicy=x.referrerPolicy)}),!isNaN(C)&&this._mediaDataSource.duration!==C&&(this._mediaDataSource.duration=C),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return h.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},h.prototype.on=function(a,x){this._emitter.addListener(a,x)},h.prototype.off=function(a,x){this._emitter.removeListener(a,x)},h.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},h.prototype._loadSegment=function(a,x){this._currentSegmentIndex=a;var C=this._mediaDataSource.segments[a],b=this._ioctl=new f.default(C,this._config,a);b.onError=this._onIOException.bind(this),b.onSeeked=this._onIOSeeked.bind(this),b.onComplete=this._onIOComplete.bind(this),b.onRedirect=this._onIORedirect.bind(this),b.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),x?this._demuxer.bindDataSource(this._ioctl):b.onDataArrival=this._onInitChunkArrival.bind(this),b.open(x)},h.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},h.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},h.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},h.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},h.prototype.seek=function(a){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var x=this._searchSegmentIndexContains(a);if(x===this._currentSegmentIndex){var C=this._mediaInfo.segments[x];if(C==null)this._pendingSeekTime=a;else{var b=C.getNearestKeyframe(a);this._remuxer.seek(b.milliseconds),this._ioctl.seek(b.fileposition),this._pendingResolveSeekPoint=b.milliseconds}}else{var L=this._mediaInfo.segments[x];if(L==null)this._pendingSeekTime=a,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(x);else{var b=L.getNearestKeyframe(a);this._internalAbort(),this._remuxer.seek(a),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[x].timestampBase,this._loadSegment(x,b.fileposition),this._pendingResolveSeekPoint=b.milliseconds,this._reportSegmentMediaInfo(x)}}this._enableStatisticsReporter()}},h.prototype._searchSegmentIndexContains=function(a){for(var x=this._mediaDataSource.segments,C=x.length-1,b=0;b<x.length;b++)if(a<x[b].timestampBase){C=b-1;break}return C},h.prototype._onInitChunkArrival=function(a,x){var C=this,b=null,L=0;if(x>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,L=this._demuxer.parseChunks(a,x);else if((b=c.default.probe(a)).match){this._demuxer=new c.default(b,this._config),this._remuxer||(this._remuxer=new _.default(this._config));var O=this._mediaDataSource;O.duration!=null&&!isNaN(O.duration)&&(this._demuxer.overridedDuration=O.duration),typeof O.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=O.hasAudio),typeof O.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=O.hasVideo),this._demuxer.timestampBase=O.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),L=this._demuxer.parseChunks(a,x)}else b=null,o.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){C._internalAbort()}),this._emitter.emit(l.default.DEMUX_ERROR,v.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),L=0;return L},h.prototype._onMediaInfo=function(a){var x=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},a),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,y.default.prototype));var C=Object.assign({},a);Object.setPrototypeOf(C,y.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=C,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var b=x._pendingSeekTime;x._pendingSeekTime=null,x.seek(b)})},h.prototype._onMetaDataArrived=function(a){this._emitter.emit(l.default.METADATA_ARRIVED,a)},h.prototype._onScriptDataArrived=function(a){this._emitter.emit(l.default.SCRIPTDATA_ARRIVED,a)},h.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},h.prototype._onIOComplete=function(a){var x=a,C=x+1;C<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(C)):(this._remuxer.flushStashedSamples(),this._emitter.emit(l.default.LOADING_COMPLETE),this._disableStatisticsReporter())},h.prototype._onIORedirect=function(a){var x=this._ioctl.extraData;this._mediaDataSource.segments[x].redirectedURL=a},h.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(l.default.RECOVERED_EARLY_EOF)},h.prototype._onIOException=function(a,x){o.default.e(this.TAG,"IOException: type = "+a+", code = "+x.code+", msg = "+x.msg),this._emitter.emit(l.default.IO_ERROR,a,x),this._disableStatisticsReporter()},h.prototype._onDemuxException=function(a,x){o.default.e(this.TAG,"DemuxException: type = "+a+", info = "+x),this._emitter.emit(l.default.DEMUX_ERROR,a,x)},h.prototype._onRemuxerInitSegmentArrival=function(a,x){this._emitter.emit(l.default.INIT_SEGMENT,a,x)},h.prototype._onRemuxerMediaSegmentArrival=function(a,x){if(this._pendingSeekTime==null&&(this._emitter.emit(l.default.MEDIA_SEGMENT,a,x),this._pendingResolveSeekPoint!=null&&a==="video")){var C=x.info.syncPoints,b=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,s.default.safari&&C.length>0&&C[0].originalDts===b&&(b=C[0].pts),this._emitter.emit(l.default.RECOMMEND_SEEKPOINT,b)}},h.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},h.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},h.prototype._reportSegmentMediaInfo=function(a){var x=this._mediaInfo.segments[a],C=Object.assign({},x);C.duration=this._mediaInfo.duration,C.segmentCount=this._mediaInfo.segmentCount,delete C.segments,delete C.keyframesIndex,this._emitter.emit(l.default.MEDIA_INFO,C)},h.prototype._reportStatisticsInfo=function(){var a={};a.url=this._ioctl.currentURL,a.hasRedirect=this._ioctl.hasRedirect,a.hasRedirect&&(a.redirectedURL=this._ioctl.currentRedirectedURL),a.speed=this._ioctl.currentSpeed,a.loaderType=this._ioctl.loaderType,a.currentSegmentIndex=this._currentSegmentIndex,a.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(l.default.STATISTICS_INFO,a)},h}();m.default=d},"./src/core/transmuxing-events.js":function(S,m,p){p.r(m);var g={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};m.default=g},"./src/core/transmuxing-worker.js":function(S,m,p){p.r(m);var g=p("./src/utils/logging-control.js"),u=p("./src/utils/polyfill.js"),o=p("./src/core/transmuxing-controller.js"),s=p("./src/core/transmuxing-events.js"),y=function(c){var _=null,v=R.bind(this);u.default.install(),c.addEventListener("message",function(T){switch(T.data.cmd){case"init":_=new o.default(T.data.param[0],T.data.param[1]),_.on(s.default.IO_ERROR,L.bind(this)),_.on(s.default.DEMUX_ERROR,O.bind(this)),_.on(s.default.INIT_SEGMENT,f.bind(this)),_.on(s.default.MEDIA_SEGMENT,l.bind(this)),_.on(s.default.LOADING_COMPLETE,d.bind(this)),_.on(s.default.RECOVERED_EARLY_EOF,h.bind(this)),_.on(s.default.MEDIA_INFO,a.bind(this)),_.on(s.default.METADATA_ARRIVED,x.bind(this)),_.on(s.default.SCRIPTDATA_ARRIVED,C.bind(this)),_.on(s.default.STATISTICS_INFO,b.bind(this)),_.on(s.default.RECOMMEND_SEEKPOINT,A.bind(this));break;case"destroy":_&&(_.destroy(),_=null),c.postMessage({msg:"destroyed"});break;case"start":_.start();break;case"stop":_.stop();break;case"seek":_.seek(T.data.param);break;case"pause":_.pause();break;case"resume":_.resume();break;case"logging_config":{var P=T.data.param;g.default.applyConfig(P),P.enableCallback===!0?g.default.addLogListener(v):g.default.removeLogListener(v);break}}});function f(T,P){var k={msg:s.default.INIT_SEGMENT,data:{type:T,data:P}};c.postMessage(k,[P.data])}function l(T,P){var k={msg:s.default.MEDIA_SEGMENT,data:{type:T,data:P}};c.postMessage(k,[P.data])}function d(){var T={msg:s.default.LOADING_COMPLETE};c.postMessage(T)}function h(){var T={msg:s.default.RECOVERED_EARLY_EOF};c.postMessage(T)}function a(T){var P={msg:s.default.MEDIA_INFO,data:T};c.postMessage(P)}function x(T){var P={msg:s.default.METADATA_ARRIVED,data:T};c.postMessage(P)}function C(T){var P={msg:s.default.SCRIPTDATA_ARRIVED,data:T};c.postMessage(P)}function b(T){var P={msg:s.default.STATISTICS_INFO,data:T};c.postMessage(P)}function L(T,P){c.postMessage({msg:s.default.IO_ERROR,data:{type:T,info:P}})}function O(T,P){c.postMessage({msg:s.default.DEMUX_ERROR,data:{type:T,info:P}})}function A(T){c.postMessage({msg:s.default.RECOMMEND_SEEKPOINT,data:T})}function R(T,P){c.postMessage({msg:"logcat_callback",data:{type:T,logcat:P}})}};m.default=y},"./src/demux/amf-parser.js":function(S,m,p){p.r(m);var g=p("./src/utils/logger.js"),u=p("./src/utils/utf8-conv.js"),o=p("./src/utils/exception.js"),s=function(){var c=new ArrayBuffer(2);return new DataView(c).setInt16(0,256,!0),new Int16Array(c)[0]===256}(),y=function(){function c(){}return c.parseScriptData=function(_,v,f){var l={};try{var d=c.parseValue(_,v,f),h=c.parseValue(_,v+d.size,f-d.size);l[d.data]=h.data}catch(a){g.default.e("AMF",a.toString())}return l},c.parseObject=function(_,v,f){if(f<3)throw new o.IllegalStateException("Data not enough when parse ScriptDataObject");var l=c.parseString(_,v,f),d=c.parseValue(_,v+l.size,f-l.size),h=d.objectEnd;return{data:{name:l.data,value:d.data},size:l.size+d.size,objectEnd:h}},c.parseVariable=function(_,v,f){return c.parseObject(_,v,f)},c.parseString=function(_,v,f){if(f<2)throw new o.IllegalStateException("Data not enough when parse String");var l=new DataView(_,v,f),d=l.getUint16(0,!s),h;return d>0?h=(0,u.default)(new Uint8Array(_,v+2,d)):h="",{data:h,size:2+d}},c.parseLongString=function(_,v,f){if(f<4)throw new o.IllegalStateException("Data not enough when parse LongString");var l=new DataView(_,v,f),d=l.getUint32(0,!s),h;return d>0?h=(0,u.default)(new Uint8Array(_,v+4,d)):h="",{data:h,size:4+d}},c.parseDate=function(_,v,f){if(f<10)throw new o.IllegalStateException("Data size invalid when parse Date");var l=new DataView(_,v,f),d=l.getFloat64(0,!s),h=l.getInt16(8,!s);return d+=h*60*1e3,{data:new Date(d),size:8+2}},c.parseValue=function(_,v,f){if(f<1)throw new o.IllegalStateException("Data not enough when parse Value");var l=new DataView(_,v,f),d=1,h=l.getUint8(0),a,x=!1;try{switch(h){case 0:a=l.getFloat64(1,!s),d+=8;break;case 1:{var C=l.getUint8(1);a=!!C,d+=1;break}case 2:{var b=c.parseString(_,v+1,f-1);a=b.data,d+=b.size;break}case 3:{a={};var L=0;for((l.getUint32(f-4,!s)&16777215)===9&&(L=3);d<f-4;){var O=c.parseObject(_,v+d,f-d-L);if(O.objectEnd)break;a[O.data.name]=O.data.value,d+=O.size}if(d<=f-3){var A=l.getUint32(d-1,!s)&16777215;A===9&&(d+=3)}break}case 8:{a={},d+=4;var L=0;for((l.getUint32(f-4,!s)&16777215)===9&&(L=3);d<f-8;){var R=c.parseVariable(_,v+d,f-d-L);if(R.objectEnd)break;a[R.data.name]=R.data.value,d+=R.size}if(d<=f-3){var A=l.getUint32(d-1,!s)&16777215;A===9&&(d+=3)}break}case 9:a=void 0,d=1,x=!0;break;case 10:{a=[];var T=l.getUint32(1,!s);d+=4;for(var P=0;P<T;P++){var k=c.parseValue(_,v+d,f-d);a.push(k.data),d+=k.size}break}case 11:{var D=c.parseDate(_,v+1,f-1);a=D.data,d+=D.size;break}case 12:{var M=c.parseString(_,v+1,f-1);a=M.data,d+=M.size;break}default:d=f,g.default.w("AMF","Unsupported AMF value type "+h)}}catch(q){g.default.e("AMF",q.toString())}return{data:a,size:d,objectEnd:x}},c}();m.default=y},"./src/demux/demux-errors.js":function(S,m,p){p.r(m);var g={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};m.default=g},"./src/demux/exp-golomb.js":function(S,m,p){p.r(m);var g=p("./src/utils/exception.js"),u=function(){function o(s){this.TAG="ExpGolomb",this._buffer=s,this._buffer_index=0,this._total_bytes=s.byteLength,this._total_bits=s.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return o.prototype.destroy=function(){this._buffer=null},o.prototype._fillCurrentWord=function(){var s=this._total_bytes-this._buffer_index;if(s<=0)throw new g.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var y=Math.min(4,s),c=new Uint8Array(4);c.set(this._buffer.subarray(this._buffer_index,this._buffer_index+y)),this._current_word=new DataView(c.buffer).getUint32(0,!1),this._buffer_index+=y,this._current_word_bits_left=y*8},o.prototype.readBits=function(s){if(s>32)throw new g.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(s<=this._current_word_bits_left){var y=this._current_word>>>32-s;return this._current_word<<=s,this._current_word_bits_left-=s,y}var c=this._current_word_bits_left?this._current_word:0;c=c>>>32-this._current_word_bits_left;var _=s-this._current_word_bits_left;this._fillCurrentWord();var v=Math.min(_,this._current_word_bits_left),f=this._current_word>>>32-v;return this._current_word<<=v,this._current_word_bits_left-=v,c=c<<v|f,c},o.prototype.readBool=function(){return this.readBits(1)===1},o.prototype.readByte=function(){return this.readBits(8)},o.prototype._skipLeadingZero=function(){var s;for(s=0;s<this._current_word_bits_left;s++)if(this._current_word&2147483648>>>s)return this._current_word<<=s,this._current_word_bits_left-=s,s;return this._fillCurrentWord(),s+this._skipLeadingZero()},o.prototype.readUEG=function(){var s=this._skipLeadingZero();return this.readBits(s+1)-1},o.prototype.readSEG=function(){var s=this.readUEG();return s&1?s+1>>>1:-1*(s>>>1)},o}();m.default=u},"./src/demux/flv-demuxer.js":function(S,m,p){p.r(m);var g=p("./src/utils/logger.js"),u=p("./src/demux/amf-parser.js"),o=p("./src/demux/sps-parser.js"),s=p("./src/demux/demux-errors.js"),y=p("./src/core/media-info.js"),c=p("./src/utils/exception.js");function _(f,l){return f[l]<<24|f[l+1]<<16|f[l+2]<<8|f[l+3]}var v=function(){function f(l,d){this.TAG="FLVDemuxer",this._config=d,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=l.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=l.hasAudioTrack,this._hasVideo=l.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new y.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var h=new ArrayBuffer(2);return new DataView(h).setInt16(0,256,!0),new Int16Array(h)[0]===256}()}return f.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},f.probe=function(l){var d=new Uint8Array(l),h={match:!1};if(d[0]!==70||d[1]!==76||d[2]!==86||d[3]!==1)return h;var a=(d[4]&4)>>>2!==0,x=(d[4]&1)!==0,C=_(d,5);return C<9?h:{match:!0,consumed:C,dataOffset:C,hasAudioTrack:a,hasVideoTrack:x}},f.prototype.bindDataSource=function(l){return l.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(f.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(l){this._onTrackMetadata=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(l){this._onMediaInfo=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(l){this._onMetaDataArrived=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(l){this._onScriptDataArrived=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onError",{get:function(){return this._onError},set:function(l){this._onError=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(l){this._onDataAvailable=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(l){this._timestampBase=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"overridedDuration",{get:function(){return this._duration},set:function(l){this._durationOverrided=!0,this._duration=l,this._mediaInfo.duration=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"overridedHasAudio",{set:function(l){this._hasAudioFlagOverrided=!0,this._hasAudio=l,this._mediaInfo.hasAudio=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"overridedHasVideo",{set:function(l){this._hasVideoFlagOverrided=!0,this._hasVideo=l,this._mediaInfo.hasVideo=l},enumerable:!1,configurable:!0}),f.prototype.resetMediaInfo=function(){this._mediaInfo=new y.default},f.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},f.prototype.parseChunks=function(l,d){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new c.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var h=0,a=this._littleEndian;if(d===0)if(l.byteLength>13){var x=f.probe(l);h=x.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,d+h!==this._dataOffset&&g.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var C=new DataView(l,h),b=C.getUint32(0,!a);b!==0&&g.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),h+=4}for(;h<l.byteLength;){this._dispatch=!0;var C=new DataView(l,h);if(h+11+4>l.byteLength)break;var L=C.getUint8(0),O=C.getUint32(0,!a)&16777215;if(h+11+O+4>l.byteLength)break;if(L!==8&&L!==9&&L!==18){g.default.w(this.TAG,"Unsupported tag type "+L+", skipped"),h+=11+O+4;continue}var A=C.getUint8(4),R=C.getUint8(5),T=C.getUint8(6),P=C.getUint8(7),k=T|R<<8|A<<16|P<<24,D=C.getUint32(7,!a)&16777215;D!==0&&g.default.w(this.TAG,"Meet tag which has StreamID != 0!");var M=h+11;switch(L){case 8:this._parseAudioData(l,M,O,k);break;case 9:this._parseVideoData(l,M,O,k,d+h);break;case 18:this._parseScriptData(l,M,O);break}var q=C.getUint32(11+O,!a);q!==11+O&&g.default.w(this.TAG,"Invalid PrevTagSize "+q),h+=11+O+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),h},f.prototype._parseScriptData=function(l,d,h){var a=u.default.parseScriptData(l,d,h);if(a.hasOwnProperty("onMetaData")){if(a.onMetaData==null||typeof a.onMetaData!="object"){g.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&g.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=a;var x=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},x)),typeof x.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=x.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof x.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=x.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof x.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=x.audiodatarate),typeof x.videodatarate=="number"&&(this._mediaInfo.videoDataRate=x.videodatarate),typeof x.width=="number"&&(this._mediaInfo.width=x.width),typeof x.height=="number"&&(this._mediaInfo.height=x.height),typeof x.duration=="number"){if(!this._durationOverrided){var C=Math.floor(x.duration*this._timescale);this._duration=C,this._mediaInfo.duration=C}}else this._mediaInfo.duration=0;if(typeof x.framerate=="number"){var b=Math.floor(x.framerate*1e3);if(b>0){var L=b/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=L,this._referenceFrameRate.fps_num=b,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=L}}if(typeof x.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var O=x.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(O),x.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=x,g.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(a).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},a))},f.prototype._parseKeyframesIndex=function(l){for(var d=[],h=[],a=1;a<l.times.length;a++){var x=this._timestampBase+Math.floor(l.times[a]*1e3);d.push(x),h.push(l.filepositions[a])}return{times:d,filepositions:h}},f.prototype._parseAudioData=function(l,d,h,a){if(h<=1){g.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var x=new DataView(l,d,h),C=x.getUint8(0),b=C>>>4;if(b!==2&&b!==10){this._onError(s.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+b);return}var L=0,O=(C&12)>>>2;if(O>=0&&O<=4)L=this._flvSoundRateTable[O];else{this._onError(s.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+O);return}var A=C&1,R=this._audioMetadata,T=this._audioTrack;if(R||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),R=this._audioMetadata={},R.type="audio",R.id=T.id,R.timescale=this._timescale,R.duration=this._duration,R.audioSampleRate=L,R.channelCount=A===0?1:2),b===10){var P=this._parseAACAudioData(l,d+1,h-1);if(P==null)return;if(P.packetType===0){R.config&&g.default.w(this.TAG,"Found another AudioSpecificConfig!");var k=P.data;R.audioSampleRate=k.samplingRate,R.channelCount=k.channelCount,R.codec=k.codec,R.originalCodec=k.originalCodec,R.config=k.config,R.refSampleDuration=1024/R.audioSampleRate*R.timescale,g.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",R);var D=this._mediaInfo;D.audioCodec=R.originalCodec,D.audioSampleRate=R.audioSampleRate,D.audioChannelCount=R.channelCount,D.hasVideo?D.videoCodec!=null&&(D.mimeType='video/x-flv; codecs="'+D.videoCodec+","+D.audioCodec+'"'):D.mimeType='video/x-flv; codecs="'+D.audioCodec+'"',D.isComplete()&&this._onMediaInfo(D)}else if(P.packetType===1){var M=this._timestampBase+a,q={unit:P.data,length:P.data.byteLength,dts:M,pts:M};T.samples.push(q),T.length+=P.data.length}else g.default.e(this.TAG,"Flv: Unsupported AAC data type "+P.packetType)}else if(b===2){if(!R.codec){var k=this._parseMP3AudioData(l,d+1,h-1,!0);if(k==null)return;R.audioSampleRate=k.samplingRate,R.channelCount=k.channelCount,R.codec=k.codec,R.originalCodec=k.originalCodec,R.refSampleDuration=1152/R.audioSampleRate*R.timescale,g.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",R);var D=this._mediaInfo;D.audioCodec=R.codec,D.audioSampleRate=R.audioSampleRate,D.audioChannelCount=R.channelCount,D.audioDataRate=k.bitRate,D.hasVideo?D.videoCodec!=null&&(D.mimeType='video/x-flv; codecs="'+D.videoCodec+","+D.audioCodec+'"'):D.mimeType='video/x-flv; codecs="'+D.audioCodec+'"',D.isComplete()&&this._onMediaInfo(D)}var Q=this._parseMP3AudioData(l,d+1,h-1,!1);if(Q==null)return;var M=this._timestampBase+a,H={unit:Q,length:Q.byteLength,dts:M,pts:M};T.samples.push(H),T.length+=Q.length}}},f.prototype._parseAACAudioData=function(l,d,h){if(h<=1){g.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var a={},x=new Uint8Array(l,d,h);return a.packetType=x[0],x[0]===0?a.data=this._parseAACAudioSpecificConfig(l,d+1,h-1):a.data=x.subarray(1),a},f.prototype._parseAACAudioSpecificConfig=function(l,d,h){var a=new Uint8Array(l,d,h),x=null,C=0,b=0,L=0,O=null;if(C=b=a[0]>>>3,L=(a[0]&7)<<1|a[1]>>>7,L<0||L>=this._mpegSamplingRates.length){this._onError(s.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var A=this._mpegSamplingRates[L],R=(a[1]&120)>>>3;if(R<0||R>=8){this._onError(s.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}C===5&&(O=(a[1]&7)<<1|a[2]>>>7,(a[2]&124)>>>2);var T=self.navigator.userAgent.toLowerCase();return T.indexOf("firefox")!==-1?L>=6?(C=5,x=new Array(4),O=L-3):(C=2,x=new Array(2),O=L):T.indexOf("android")!==-1?(C=2,x=new Array(2),O=L):(C=5,O=L,x=new Array(4),L>=6?O=L-3:R===1&&(C=2,x=new Array(2),O=L)),x[0]=C<<3,x[0]|=(L&15)>>>1,x[1]=(L&15)<<7,x[1]|=(R&15)<<3,C===5&&(x[1]|=(O&15)>>>1,x[2]=(O&1)<<7,x[2]|=8,x[3]=0),{config:x,samplingRate:A,channelCount:R,codec:"mp4a.40."+C,originalCodec:"mp4a.40."+b}},f.prototype._parseMP3AudioData=function(l,d,h,a){if(h<4){g.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var x=new Uint8Array(l,d,h),C=null;if(a){if(x[0]!==255)return;var b=x[1]>>>3&3,L=(x[1]&6)>>1,O=(x[2]&240)>>>4,A=(x[2]&12)>>>2,R=x[3]>>>6&3,T=R!==3?2:1,P=0,k=0,D="mp3";switch(b){case 0:P=this._mpegAudioV25SampleRateTable[A];break;case 2:P=this._mpegAudioV20SampleRateTable[A];break;case 3:P=this._mpegAudioV10SampleRateTable[A];break}switch(L){case 1:O<this._mpegAudioL3BitRateTable.length&&(k=this._mpegAudioL3BitRateTable[O]);break;case 2:O<this._mpegAudioL2BitRateTable.length&&(k=this._mpegAudioL2BitRateTable[O]);break;case 3:O<this._mpegAudioL1BitRateTable.length&&(k=this._mpegAudioL1BitRateTable[O]);break}C={bitRate:k,samplingRate:P,channelCount:T,codec:D,originalCodec:D}}else C=x;return C},f.prototype._parseVideoData=function(l,d,h,a,x){if(h<=1){g.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var C=new Uint8Array(l,d,h)[0],b=(C&240)>>>4,L=C&15;if(L!==7){this._onError(s.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+L);return}this._parseAVCVideoPacket(l,d+1,h-1,a,x,b)}},f.prototype._parseAVCVideoPacket=function(l,d,h,a,x,C){if(h<4){g.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var b=this._littleEndian,L=new DataView(l,d,h),O=L.getUint8(0),A=L.getUint32(0,!b)&16777215,R=A<<8>>8;if(O===0)this._parseAVCDecoderConfigurationRecord(l,d+4,h-4);else if(O===1)this._parseAVCVideoData(l,d+4,h-4,a,x,C,R);else if(O!==2){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid video packet type "+O);return}},f.prototype._parseAVCDecoderConfigurationRecord=function(l,d,h){if(h<7){g.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var a=this._videoMetadata,x=this._videoTrack,C=this._littleEndian,b=new DataView(l,d,h);a?typeof a.avcc<"u"&&g.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),a=this._videoMetadata={},a.type="video",a.id=x.id,a.timescale=this._timescale,a.duration=this._duration);var L=b.getUint8(0),O=b.getUint8(1);if(b.getUint8(2),b.getUint8(3),L!==1||O===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(b.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(s.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var A=b.getUint8(5)&31;if(A===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else A>1&&g.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+A);for(var R=6,T=0;T<A;T++){var P=b.getUint16(R,!C);if(R+=2,P!==0){var k=new Uint8Array(l,d+R,P);R+=P;var D=o.default.parseSPS(k);if(T===0){a.codecWidth=D.codec_size.width,a.codecHeight=D.codec_size.height,a.presentWidth=D.present_size.width,a.presentHeight=D.present_size.height,a.profile=D.profile_string,a.level=D.level_string,a.bitDepth=D.bit_depth,a.chromaFormat=D.chroma_format,a.sarRatio=D.sar_ratio,a.frameRate=D.frame_rate,(D.frame_rate.fixed===!1||D.frame_rate.fps_num===0||D.frame_rate.fps_den===0)&&(a.frameRate=this._referenceFrameRate);var M=a.frameRate.fps_den,q=a.frameRate.fps_num;a.refSampleDuration=a.timescale*(M/q);for(var Q=k.subarray(1,4),H="avc1.",te=0;te<3;te++){var ce=Q[te].toString(16);ce.length<2&&(ce="0"+ce),H+=ce}a.codec=H;var Y=this._mediaInfo;Y.width=a.codecWidth,Y.height=a.codecHeight,Y.fps=a.frameRate.fps,Y.profile=a.profile,Y.level=a.level,Y.refFrames=D.ref_frames,Y.chromaFormat=D.chroma_format_string,Y.sarNum=a.sarRatio.width,Y.sarDen=a.sarRatio.height,Y.videoCodec=H,Y.hasAudio?Y.audioCodec!=null&&(Y.mimeType='video/x-flv; codecs="'+Y.videoCodec+","+Y.audioCodec+'"'):Y.mimeType='video/x-flv; codecs="'+Y.videoCodec+'"',Y.isComplete()&&this._onMediaInfo(Y)}}}var re=b.getUint8(R);if(re===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else re>1&&g.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+re);R++;for(var T=0;T<re;T++){var P=b.getUint16(R,!C);R+=2,P!==0&&(R+=P)}a.avcc=new Uint8Array(h),a.avcc.set(new Uint8Array(l,d,h),0),g.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",a)},f.prototype._parseAVCVideoData=function(l,d,h,a,x,C,b){for(var L=this._littleEndian,O=new DataView(l,d,h),A=[],R=0,T=0,P=this._naluLengthSize,k=this._timestampBase+a,D=C===1;T<h;){if(T+4>=h){g.default.w(this.TAG,"Malformed Nalu near timestamp "+k+", offset = "+T+", dataSize = "+h);break}var M=O.getUint32(T,!L);if(P===3&&(M>>>=8),M>h-P){g.default.w(this.TAG,"Malformed Nalus near timestamp "+k+", NaluSize > DataSize!");return}var q=O.getUint8(T+P)&31;q===5&&(D=!0);var Q=new Uint8Array(l,d+T,P+M),H={type:q,data:Q};A.push(H),R+=Q.byteLength,T+=P+M}if(A.length){var te=this._videoTrack,ce={units:A,length:R,isKeyframe:D,dts:k,cts:b,pts:k+b};D&&(ce.fileposition=x),te.samples.push(ce),te.length+=R}},f}();m.default=v},"./src/demux/sps-parser.js":function(S,m,p){p.r(m);var g=p("./src/demux/exp-golomb.js"),u=function(){function o(){}return o._ebsp2rbsp=function(s){for(var y=s,c=y.byteLength,_=new Uint8Array(c),v=0,f=0;f<c;f++)f>=2&&y[f]===3&&y[f-1]===0&&y[f-2]===0||(_[v]=y[f],v++);return new Uint8Array(_.buffer,0,v)},o.parseSPS=function(s){var y=o._ebsp2rbsp(s),c=new g.default(y);c.readByte();var _=c.readByte();c.readByte();var v=c.readByte();c.readUEG();var f=o.getProfileString(_),l=o.getLevelString(v),d=1,h=420,a=[0,420,422,444],x=8;if((_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128||_===138||_===144)&&(d=c.readUEG(),d===3&&c.readBits(1),d<=3&&(h=a[d]),x=c.readUEG()+8,c.readUEG(),c.readBits(1),c.readBool()))for(var C=d!==3?8:12,b=0;b<C;b++)c.readBool()&&(b<6?o._skipScalingList(c,16):o._skipScalingList(c,64));c.readUEG();var L=c.readUEG();if(L===0)c.readUEG();else if(L===1){c.readBits(1),c.readSEG(),c.readSEG();for(var O=c.readUEG(),b=0;b<O;b++)c.readSEG()}var A=c.readUEG();c.readBits(1);var R=c.readUEG(),T=c.readUEG(),P=c.readBits(1);P===0&&c.readBits(1),c.readBits(1);var k=0,D=0,M=0,q=0,Q=c.readBool();Q&&(k=c.readUEG(),D=c.readUEG(),M=c.readUEG(),q=c.readUEG());var H=1,te=1,ce=0,Y=!0,re=0,Ae=0,ae=c.readBool();if(ae){if(c.readBool()){var fe=c.readByte(),Le=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],me=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];fe>0&&fe<16?(H=Le[fe-1],te=me[fe-1]):fe===255&&(H=c.readByte()<<8|c.readByte(),te=c.readByte()<<8|c.readByte())}if(c.readBool()&&c.readBool(),c.readBool()&&(c.readBits(4),c.readBool()&&c.readBits(24)),c.readBool()&&(c.readUEG(),c.readUEG()),c.readBool()){var Se=c.readBits(32),Re=c.readBits(32);Y=c.readBool(),re=Re,Ae=Se*2,ce=re/Ae}}var de=1;(H!==1||te!==1)&&(de=H/te);var W=0,Te=0;if(d===0)W=1,Te=2-P;else{var Oe=d===3?1:2,Ue=d===1?2:1;W=Oe,Te=Ue*(2-P)}var Pe=(R+1)*16,je=(2-P)*((T+1)*16);Pe-=(k+D)*W,je-=(M+q)*Te;var N=Math.ceil(Pe*de);return c.destroy(),c=null,{profile_string:f,level_string:l,bit_depth:x,ref_frames:A,chroma_format:h,chroma_format_string:o.getChromaFormatString(h),frame_rate:{fixed:Y,fps:ce,fps_den:Ae,fps_num:re},sar_ratio:{width:H,height:te},codec_size:{width:Pe,height:je},present_size:{width:N,height:je}}},o._skipScalingList=function(s,y){for(var c=8,_=8,v=0,f=0;f<y;f++)_!==0&&(v=s.readSEG(),_=(c+v+256)%256),c=_===0?c:_},o.getProfileString=function(s){switch(s){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},o.getLevelString=function(s){return(s/10).toFixed(1)},o.getChromaFormatString=function(s){switch(s){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},o}();m.default=u},"./src/flv.js":function(S,m,p){p.r(m);var g=p("./src/utils/polyfill.js"),u=p("./src/core/features.js"),o=p("./src/io/loader.js"),s=p("./src/player/flv-player.js"),y=p("./src/player/native-player.js"),c=p("./src/player/player-events.js"),_=p("./src/player/player-errors.js"),v=p("./src/utils/logging-control.js"),f=p("./src/utils/exception.js");g.default.install();function l(x,C){var b=x;if(b==null||typeof b!="object")throw new f.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!b.hasOwnProperty("type"))throw new f.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(b.type){case"flv":return new s.default(b,C);default:return new y.default(b,C)}}function d(){return u.default.supportMSEH264Playback()}function h(){return u.default.getFeatureList()}var a={};a.createPlayer=l,a.isSupported=d,a.getFeatureList=h,a.BaseLoader=o.BaseLoader,a.LoaderStatus=o.LoaderStatus,a.LoaderErrors=o.LoaderErrors,a.Events=c.default,a.ErrorTypes=_.ErrorTypes,a.ErrorDetails=_.ErrorDetails,a.FlvPlayer=s.default,a.NativePlayer=y.default,a.LoggingControl=v.default,Object.defineProperty(a,"version",{enumerable:!0,get:function(){return"1.6.2"}}),m.default=a},"./src/index.js":function(S,m,p){S.exports=p("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(S,m,p){p.r(m);var g=p("./src/utils/browser.js"),u=p("./src/io/loader.js"),o=p("./src/utils/exception.js"),s=function(){var c=function(_,v){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,l){f.__proto__=l}||function(f,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(f[d]=l[d])},c(_,v)};return function(_,v){if(typeof v!="function"&&v!==null)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");c(_,v);function f(){this.constructor=_}_.prototype=v===null?Object.create(v):(f.prototype=v.prototype,new f)}}(),y=function(c){s(_,c);function _(v,f){var l=c.call(this,"fetch-stream-loader")||this;return l.TAG="FetchStreamLoader",l._seekHandler=v,l._config=f,l._needStash=!0,l._requestAbort=!1,l._contentLength=null,l._receivedLength=0,l}return _.isSupported=function(){try{var v=g.default.msedge&&g.default.version.minor>=15048,f=g.default.msedge?v:!0;return self.fetch&&self.ReadableStream&&f}catch{return!1}},_.prototype.destroy=function(){this.isWorking()&&this.abort(),c.prototype.destroy.call(this)},_.prototype.open=function(v,f){var l=this;this._dataSource=v,this._range=f;var d=v.url;this._config.reuseRedirectedURL&&v.redirectedURL!=null&&(d=v.redirectedURL);var h=this._seekHandler.getConfig(d,f),a=new self.Headers;if(typeof h.headers=="object"){var x=h.headers;for(var C in x)x.hasOwnProperty(C)&&a.append(C,x[C])}var b={method:"GET",headers:a,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var C in this._config.headers)a.append(C,this._config.headers[C]);v.cors===!1&&(b.mode="same-origin"),v.withCredentials&&(b.credentials="include"),v.referrerPolicy&&(b.referrerPolicy=v.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,b.signal=this._abortController.signal),this._status=u.LoaderStatus.kConnecting,self.fetch(h.url,b).then(function(L){if(l._requestAbort){l._status=u.LoaderStatus.kIdle,L.body.cancel();return}if(L.ok&&L.status>=200&&L.status<=299){if(L.url!==h.url&&l._onURLRedirect){var O=l._seekHandler.removeURLParameters(L.url);l._onURLRedirect(O)}var A=L.headers.get("Content-Length");return A!=null&&(l._contentLength=parseInt(A),l._contentLength!==0&&l._onContentLengthKnown&&l._onContentLengthKnown(l._contentLength)),l._pump.call(l,L.body.getReader())}else if(l._status=u.LoaderStatus.kError,l._onError)l._onError(u.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:L.status,msg:L.statusText});else throw new o.RuntimeException("FetchStreamLoader: Http code invalid, "+L.status+" "+L.statusText)}).catch(function(L){if(!(l._abortController&&l._abortController.signal.aborted))if(l._status=u.LoaderStatus.kError,l._onError)l._onError(u.LoaderErrors.EXCEPTION,{code:-1,msg:L.message});else throw L})},_.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==u.LoaderStatus.kBuffering||!g.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},_.prototype._pump=function(v){var f=this;return v.read().then(function(l){if(l.done)if(f._contentLength!==null&&f._receivedLength<f._contentLength){f._status=u.LoaderStatus.kError;var d=u.LoaderErrors.EARLY_EOF,h={code:-1,msg:"Fetch stream meet Early-EOF"};if(f._onError)f._onError(d,h);else throw new o.RuntimeException(h.msg)}else f._status=u.LoaderStatus.kComplete,f._onComplete&&f._onComplete(f._range.from,f._range.from+f._receivedLength-1);else{if(f._abortController&&f._abortController.signal.aborted){f._status=u.LoaderStatus.kComplete;return}else if(f._requestAbort===!0)return f._status=u.LoaderStatus.kComplete,v.cancel();f._status=u.LoaderStatus.kBuffering;var a=l.value.buffer,x=f._range.from+f._receivedLength;f._receivedLength+=a.byteLength,f._onDataArrival&&f._onDataArrival(a,x,f._receivedLength),f._pump(v)}}).catch(function(l){if(f._abortController&&f._abortController.signal.aborted){f._status=u.LoaderStatus.kComplete;return}if(!(l.code===11&&g.default.msedge)){f._status=u.LoaderStatus.kError;var d=0,h=null;if((l.code===19||l.message==="network error")&&(f._contentLength===null||f._contentLength!==null&&f._receivedLength<f._contentLength)?(d=u.LoaderErrors.EARLY_EOF,h={code:l.code,msg:"Fetch stream meet Early-EOF"}):(d=u.LoaderErrors.EXCEPTION,h={code:l.code,msg:l.message}),f._onError)f._onError(d,h);else throw new o.RuntimeException(h.msg)}})},_}(u.BaseLoader);m.default=y},"./src/io/io-controller.js":function(S,m,p){p.r(m);var g=p("./src/utils/logger.js"),u=p("./src/io/speed-sampler.js"),o=p("./src/io/loader.js"),s=p("./src/io/fetch-stream-loader.js"),y=p("./src/io/xhr-moz-chunked-loader.js"),c=p("./src/io/xhr-range-loader.js"),_=p("./src/io/websocket-loader.js"),v=p("./src/io/range-seek-handler.js"),f=p("./src/io/param-seek-handler.js"),l=p("./src/utils/exception.js"),d=function(){function h(a,x,C){this.TAG="IOController",this._config=x,this._extraData=C,this._stashInitialSize=1024*384,x.stashInitialSize!=null&&x.stashInitialSize>0&&(this._stashInitialSize=x.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,x.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=a,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(a.url),this._refTotalLength=a.filesize?a.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new u.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return h.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},h.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},h.prototype.isPaused=function(){return this._paused},Object.defineProperty(h.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"extraData",{get:function(){return this._extraData},set:function(a){this._extraData=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(a){this._onDataArrival=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(a){this._onSeeked=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onError",{get:function(){return this._onError},set:function(a){this._onError=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onComplete",{get:function(){return this._onComplete},set:function(a){this._onComplete=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(a){this._onRedirect=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(a){this._onRecoveredEarlyEof=a},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"currentSpeed",{get:function(){return this._loaderClass===c.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),h.prototype._selectSeekHandler=function(){var a=this._config;if(a.seekType==="range")this._seekHandler=new v.default(this._config.rangeLoadZeroStart);else if(a.seekType==="param"){var x=a.seekParamStart||"bstart",C=a.seekParamEnd||"bend";this._seekHandler=new f.default(x,C)}else if(a.seekType==="custom"){if(typeof a.customSeekHandler!="function")throw new l.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new a.customSeekHandler}else throw new l.InvalidArgumentException("Invalid seekType in config: "+a.seekType)},h.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=_.default;else if(s.default.isSupported())this._loaderClass=s.default;else if(y.default.isSupported())this._loaderClass=y.default;else if(c.default.isSupported())this._loaderClass=c.default;else throw new l.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},h.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},h.prototype.open=function(a){this._currentRange={from:0,to:-1},a&&(this._currentRange.from=a),this._speedSampler.reset(),a||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},h.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},h.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},h.prototype.resume=function(){if(this._paused){this._paused=!1;var a=this._resumeFrom;this._resumeFrom=0,this._internalSeek(a,!0)}},h.prototype.seek=function(a){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(a,!0)},h.prototype._internalSeek=function(a,x){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(x),this._loader.destroy(),this._loader=null;var C={from:a,to:-1};this._currentRange={from:C.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,C),this._onSeeked&&this._onSeeked()},h.prototype.updateUrl=function(a){if(!a||typeof a!="string"||a.length===0)throw new l.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=a},h.prototype._expandBuffer=function(a){for(var x=this._stashSize;x+1024*1024*1<a;)x*=2;if(x+=1024*1024*1,x!==this._bufferSize){var C=new ArrayBuffer(x);if(this._stashUsed>0){var b=new Uint8Array(this._stashBuffer,0,this._stashUsed),L=new Uint8Array(C,0,x);L.set(b,0)}this._stashBuffer=C,this._bufferSize=x}},h.prototype._normalizeSpeed=function(a){var x=this._speedNormalizeList,C=x.length-1,b=0,L=0,O=C;if(a<x[0])return x[0];for(;L<=O;){if(b=L+Math.floor((O-L)/2),b===C||a>=x[b]&&a<x[b+1])return x[b];x[b]<a?L=b+1:O=b-1}},h.prototype._adjustStashSize=function(a){var x=0;this._config.isLive||a<512?x=a:a>=512&&a<=1024?x=Math.floor(a*1.5):x=a*2,x>8192&&(x=8192);var C=x*1024+1024*1024*1;this._bufferSize<C&&this._expandBuffer(C),this._stashSize=x*1024},h.prototype._dispatchChunks=function(a,x){return this._currentRange.to=x+a.byteLength-1,this._onDataArrival(a,x)},h.prototype._onURLRedirect=function(a){this._redirectedURL=a,this._onRedirect&&this._onRedirect(a)},h.prototype._onContentLengthKnown=function(a){a&&this._fullRequestFlag&&(this._totalLength=a,this._fullRequestFlag=!1)},h.prototype._onLoaderChunkArrival=function(a,x,C){if(!this._onDataArrival)throw new l.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(a.byteLength);var b=this._speedSampler.lastSecondKBps;if(b!==0){var L=this._normalizeSpeed(b);this._speedNormalized!==L&&(this._speedNormalized=L,this._adjustStashSize(L))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=x),this._stashUsed+a.byteLength<=this._stashSize){var R=new Uint8Array(this._stashBuffer,0,this._stashSize);R.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength}else{var R=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var P=this._stashBuffer.slice(0,this._stashUsed),O=this._dispatchChunks(P,this._stashByteStart);if(O<P.byteLength){if(O>0){var T=new Uint8Array(P,O);R.set(T,0),this._stashUsed=T.byteLength,this._stashByteStart+=O}}else this._stashUsed=0,this._stashByteStart+=O;this._stashUsed+a.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+a.byteLength),R=new Uint8Array(this._stashBuffer,0,this._bufferSize)),R.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength}else{var O=this._dispatchChunks(a,x);if(O<a.byteLength){var A=a.byteLength-O;A>this._bufferSize&&(this._expandBuffer(A),R=new Uint8Array(this._stashBuffer,0,this._bufferSize)),R.set(new Uint8Array(a,O),0),this._stashUsed+=A,this._stashByteStart=x+O}}}else if(this._stashUsed===0){var O=this._dispatchChunks(a,x);if(O<a.byteLength){var A=a.byteLength-O;A>this._bufferSize&&this._expandBuffer(A);var R=new Uint8Array(this._stashBuffer,0,this._bufferSize);R.set(new Uint8Array(a,O),0),this._stashUsed+=A,this._stashByteStart=x+O}}else{this._stashUsed+a.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+a.byteLength);var R=new Uint8Array(this._stashBuffer,0,this._bufferSize);R.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength;var O=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(O<this._stashUsed&&O>0){var T=new Uint8Array(this._stashBuffer,O);R.set(T,0)}this._stashUsed-=O,this._stashByteStart+=O}}},h.prototype._flushStashBuffer=function(a){if(this._stashUsed>0){var x=this._stashBuffer.slice(0,this._stashUsed),C=this._dispatchChunks(x,this._stashByteStart),b=x.byteLength-C;if(C<x.byteLength)if(a)g.default.w(this.TAG,b+" bytes unconsumed data remain when flush buffer, dropped");else{if(C>0){var L=new Uint8Array(this._stashBuffer,0,this._bufferSize),O=new Uint8Array(x,C);L.set(O,0),this._stashUsed=O.byteLength,this._stashByteStart+=C}return 0}return this._stashUsed=0,this._stashByteStart=0,b}return 0},h.prototype._onLoaderComplete=function(a,x){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},h.prototype._onLoaderError=function(a,x){switch(g.default.e(this.TAG,"Loader error, code = "+x.code+", msg = "+x.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,a=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF),a){case o.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var C=this._currentRange.to+1;C<this._totalLength&&(g.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(C,!1));return}a=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case o.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case o.LoaderErrors.CONNECTING_TIMEOUT:case o.LoaderErrors.HTTP_STATUS_CODE_INVALID:case o.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(a,x);else throw new l.RuntimeException("IOException: "+x.msg)},h}();m.default=d},"./src/io/loader.js":function(S,m,p){p.r(m),p.d(m,{LoaderStatus:function(){return u},LoaderErrors:function(){return o},BaseLoader:function(){return s}});var g=p("./src/utils/exception.js"),u={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},o={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},s=function(){function y(c){this._type=c||"undefined",this._status=u.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return y.prototype.destroy=function(){this._status=u.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},y.prototype.isWorking=function(){return this._status===u.kConnecting||this._status===u.kBuffering},Object.defineProperty(y.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(c){this._onContentLengthKnown=c},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(c){this._onURLRedirect=c},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(c){this._onDataArrival=c},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"onError",{get:function(){return this._onError},set:function(c){this._onError=c},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"onComplete",{get:function(){return this._onComplete},set:function(c){this._onComplete=c},enumerable:!1,configurable:!0}),y.prototype.open=function(c,_){throw new g.NotImplementedException("Unimplemented abstract function!")},y.prototype.abort=function(){throw new g.NotImplementedException("Unimplemented abstract function!")},y}()},"./src/io/param-seek-handler.js":function(S,m,p){p.r(m);var g=function(){function u(o,s){this._startName=o,this._endName=s}return u.prototype.getConfig=function(o,s){var y=o;if(s.from!==0||s.to!==-1){var c=!0;y.indexOf("?")===-1&&(y+="?",c=!1),c&&(y+="&"),y+=this._startName+"="+s.from.toString(),s.to!==-1&&(y+="&"+this._endName+"="+s.to.toString())}return{url:y,headers:{}}},u.prototype.removeURLParameters=function(o){var s=o.split("?")[0],y=void 0,c=o.indexOf("?");c!==-1&&(y=o.substring(c+1));var _="";if(y!=null&&y.length>0)for(var v=y.split("&"),f=0;f<v.length;f++){var l=v[f].split("="),d=f>0;l[0]!==this._startName&&l[0]!==this._endName&&(d&&(_+="&"),_+=v[f])}return _.length===0?s:s+"?"+_},u}();m.default=g},"./src/io/range-seek-handler.js":function(S,m,p){p.r(m);var g=function(){function u(o){this._zeroStart=o||!1}return u.prototype.getConfig=function(o,s){var y={};if(s.from!==0||s.to!==-1){var c=void 0;s.to!==-1?c="bytes="+s.from.toString()+"-"+s.to.toString():c="bytes="+s.from.toString()+"-",y.Range=c}else this._zeroStart&&(y.Range="bytes=0-");return{url:o,headers:y}},u.prototype.removeURLParameters=function(o){return o},u}();m.default=g},"./src/io/speed-sampler.js":function(S,m,p){p.r(m);var g=function(){function u(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return u.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},u.prototype.addBytes=function(o){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=o,this._totalBytes+=o):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=o,this._totalBytes+=o):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=o,this._totalBytes+=o,this._lastCheckpoint=this._now())},Object.defineProperty(u.prototype,"currentKBps",{get:function(){this.addBytes(0);var o=(this._now()-this._lastCheckpoint)/1e3;return o==0&&(o=1),this._intervalBytes/o/1024},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"averageKBps",{get:function(){var o=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/o/1024},enumerable:!1,configurable:!0}),u}();m.default=g},"./src/io/websocket-loader.js":function(S,m,p){p.r(m);var g=p("./src/io/loader.js"),u=p("./src/utils/exception.js"),o=function(){var y=function(c,_){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,f){v.__proto__=f}||function(v,f){for(var l in f)Object.prototype.hasOwnProperty.call(f,l)&&(v[l]=f[l])},y(c,_)};return function(c,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");y(c,_);function v(){this.constructor=c}c.prototype=_===null?Object.create(_):(v.prototype=_.prototype,new v)}}(),s=function(y){o(c,y);function c(){var _=y.call(this,"websocket-loader")||this;return _.TAG="WebSocketLoader",_._needStash=!0,_._ws=null,_._requestAbort=!1,_._receivedLength=0,_}return c.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},c.prototype.destroy=function(){this._ws&&this.abort(),y.prototype.destroy.call(this)},c.prototype.open=function(_){try{var v=this._ws=new self.WebSocket(_.url);v.binaryType="arraybuffer",v.onopen=this._onWebSocketOpen.bind(this),v.onclose=this._onWebSocketClose.bind(this),v.onmessage=this._onWebSocketMessage.bind(this),v.onerror=this._onWebSocketError.bind(this),this._status=g.LoaderStatus.kConnecting}catch(l){this._status=g.LoaderStatus.kError;var f={code:l.code,msg:l.message};if(this._onError)this._onError(g.LoaderErrors.EXCEPTION,f);else throw new u.RuntimeException(f.msg)}},c.prototype.abort=function(){var _=this._ws;_&&(_.readyState===0||_.readyState===1)&&(this._requestAbort=!0,_.close()),this._ws=null,this._status=g.LoaderStatus.kComplete},c.prototype._onWebSocketOpen=function(_){this._status=g.LoaderStatus.kBuffering},c.prototype._onWebSocketClose=function(_){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=g.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},c.prototype._onWebSocketMessage=function(_){var v=this;if(_.data instanceof ArrayBuffer)this._dispatchArrayBuffer(_.data);else if(_.data instanceof Blob){var f=new FileReader;f.onload=function(){v._dispatchArrayBuffer(f.result)},f.readAsArrayBuffer(_.data)}else{this._status=g.LoaderStatus.kError;var l={code:-1,msg:"Unsupported WebSocket message type: "+_.data.constructor.name};if(this._onError)this._onError(g.LoaderErrors.EXCEPTION,l);else throw new u.RuntimeException(l.msg)}},c.prototype._dispatchArrayBuffer=function(_){var v=_,f=this._receivedLength;this._receivedLength+=v.byteLength,this._onDataArrival&&this._onDataArrival(v,f,this._receivedLength)},c.prototype._onWebSocketError=function(_){this._status=g.LoaderStatus.kError;var v={code:_.code,msg:_.message};if(this._onError)this._onError(g.LoaderErrors.EXCEPTION,v);else throw new u.RuntimeException(v.msg)},c}(g.BaseLoader);m.default=s},"./src/io/xhr-moz-chunked-loader.js":function(S,m,p){p.r(m);var g=p("./src/utils/logger.js"),u=p("./src/io/loader.js"),o=p("./src/utils/exception.js"),s=function(){var c=function(_,v){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,l){f.__proto__=l}||function(f,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(f[d]=l[d])},c(_,v)};return function(_,v){if(typeof v!="function"&&v!==null)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");c(_,v);function f(){this.constructor=_}_.prototype=v===null?Object.create(v):(f.prototype=v.prototype,new f)}}(),y=function(c){s(_,c);function _(v,f){var l=c.call(this,"xhr-moz-chunked-loader")||this;return l.TAG="MozChunkedLoader",l._seekHandler=v,l._config=f,l._needStash=!0,l._xhr=null,l._requestAbort=!1,l._contentLength=null,l._receivedLength=0,l}return _.isSupported=function(){try{var v=new XMLHttpRequest;return v.open("GET","https://example.com",!0),v.responseType="moz-chunked-arraybuffer",v.responseType==="moz-chunked-arraybuffer"}catch(f){return g.default.w("MozChunkedLoader",f.message),!1}},_.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),c.prototype.destroy.call(this)},_.prototype.open=function(v,f){this._dataSource=v,this._range=f;var l=v.url;this._config.reuseRedirectedURL&&v.redirectedURL!=null&&(l=v.redirectedURL);var d=this._seekHandler.getConfig(l,f);this._requestURL=d.url;var h=this._xhr=new XMLHttpRequest;if(h.open("GET",d.url,!0),h.responseType="moz-chunked-arraybuffer",h.onreadystatechange=this._onReadyStateChange.bind(this),h.onprogress=this._onProgress.bind(this),h.onloadend=this._onLoadEnd.bind(this),h.onerror=this._onXhrError.bind(this),v.withCredentials&&(h.withCredentials=!0),typeof d.headers=="object"){var a=d.headers;for(var x in a)a.hasOwnProperty(x)&&h.setRequestHeader(x,a[x])}if(typeof this._config.headers=="object"){var a=this._config.headers;for(var x in a)a.hasOwnProperty(x)&&h.setRequestHeader(x,a[x])}this._status=u.LoaderStatus.kConnecting,h.send()},_.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=u.LoaderStatus.kComplete},_.prototype._onReadyStateChange=function(v){var f=v.target;if(f.readyState===2){if(f.responseURL!=null&&f.responseURL!==this._requestURL&&this._onURLRedirect){var l=this._seekHandler.removeURLParameters(f.responseURL);this._onURLRedirect(l)}if(f.status!==0&&(f.status<200||f.status>299))if(this._status=u.LoaderStatus.kError,this._onError)this._onError(u.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:f.status,msg:f.statusText});else throw new o.RuntimeException("MozChunkedLoader: Http code invalid, "+f.status+" "+f.statusText);else this._status=u.LoaderStatus.kBuffering}},_.prototype._onProgress=function(v){if(this._status!==u.LoaderStatus.kError){this._contentLength===null&&v.total!==null&&v.total!==0&&(this._contentLength=v.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var f=v.target.response,l=this._range.from+this._receivedLength;this._receivedLength+=f.byteLength,this._onDataArrival&&this._onDataArrival(f,l,this._receivedLength)}},_.prototype._onLoadEnd=function(v){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===u.LoaderStatus.kError)return;this._status=u.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},_.prototype._onXhrError=function(v){this._status=u.LoaderStatus.kError;var f=0,l=null;if(this._contentLength&&v.loaded<this._contentLength?(f=u.LoaderErrors.EARLY_EOF,l={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(f=u.LoaderErrors.EXCEPTION,l={code:-1,msg:v.constructor.name+" "+v.type}),this._onError)this._onError(f,l);else throw new o.RuntimeException(l.msg)},_}(u.BaseLoader);m.default=y},"./src/io/xhr-range-loader.js":function(S,m,p){p.r(m);var g=p("./src/utils/logger.js"),u=p("./src/io/speed-sampler.js"),o=p("./src/io/loader.js"),s=p("./src/utils/exception.js"),y=function(){var _=function(v,f){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h])},_(v,f)};return function(v,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");_(v,f);function l(){this.constructor=v}v.prototype=f===null?Object.create(f):(l.prototype=f.prototype,new l)}}(),c=function(_){y(v,_);function v(f,l){var d=_.call(this,"xhr-range-loader")||this;return d.TAG="RangeLoader",d._seekHandler=f,d._config=l,d._needStash=!1,d._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],d._currentChunkSizeKB=384,d._currentSpeedNormalized=0,d._zeroSpeedChunkCount=0,d._xhr=null,d._speedSampler=new u.default,d._requestAbort=!1,d._waitForTotalLength=!1,d._totalLengthReceived=!1,d._currentRequestURL=null,d._currentRedirectedURL=null,d._currentRequestRange=null,d._totalLength=null,d._contentLength=null,d._receivedLength=0,d._lastTimeLoaded=0,d}return v.isSupported=function(){try{var f=new XMLHttpRequest;return f.open("GET","https://example.com",!0),f.responseType="arraybuffer",f.responseType==="arraybuffer"}catch(l){return g.default.w("RangeLoader",l.message),!1}},v.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),_.prototype.destroy.call(this)},Object.defineProperty(v.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),v.prototype.open=function(f,l){this._dataSource=f,this._range=l,this._status=o.LoaderStatus.kConnecting;var d=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(d=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!d?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},v.prototype._openSubRange=function(){var f=this._currentChunkSizeKB*1024,l=this._range.from+this._receivedLength,d=l+f;this._contentLength!=null&&d-this._range.from>=this._contentLength&&(d=this._range.from+this._contentLength-1),this._currentRequestRange={from:l,to:d},this._internalOpen(this._dataSource,this._currentRequestRange)},v.prototype._internalOpen=function(f,l){this._lastTimeLoaded=0;var d=f.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?d=this._currentRedirectedURL:f.redirectedURL!=null&&(d=f.redirectedURL));var h=this._seekHandler.getConfig(d,l);this._currentRequestURL=h.url;var a=this._xhr=new XMLHttpRequest;if(a.open("GET",h.url,!0),a.responseType="arraybuffer",a.onreadystatechange=this._onReadyStateChange.bind(this),a.onprogress=this._onProgress.bind(this),a.onload=this._onLoad.bind(this),a.onerror=this._onXhrError.bind(this),f.withCredentials&&(a.withCredentials=!0),typeof h.headers=="object"){var x=h.headers;for(var C in x)x.hasOwnProperty(C)&&a.setRequestHeader(C,x[C])}if(typeof this._config.headers=="object"){var x=this._config.headers;for(var C in x)x.hasOwnProperty(C)&&a.setRequestHeader(C,x[C])}a.send()},v.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=o.LoaderStatus.kComplete},v.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},v.prototype._onReadyStateChange=function(f){var l=f.target;if(l.readyState===2){if(l.responseURL!=null){var d=this._seekHandler.removeURLParameters(l.responseURL);l.responseURL!==this._currentRequestURL&&d!==this._currentRedirectedURL&&(this._currentRedirectedURL=d,this._onURLRedirect&&this._onURLRedirect(d))}if(l.status>=200&&l.status<=299){if(this._waitForTotalLength)return;this._status=o.LoaderStatus.kBuffering}else if(this._status=o.LoaderStatus.kError,this._onError)this._onError(o.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:l.status,msg:l.statusText});else throw new s.RuntimeException("RangeLoader: Http code invalid, "+l.status+" "+l.statusText)}},v.prototype._onProgress=function(f){if(this._status!==o.LoaderStatus.kError){if(this._contentLength===null){var l=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,l=!0;var d=f.total;this._internalAbort(),d!=null&d!==0&&(this._totalLength=d)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,l){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var h=f.loaded-this._lastTimeLoaded;this._lastTimeLoaded=f.loaded,this._speedSampler.addBytes(h)}},v.prototype._normalizeSpeed=function(f){var l=this._chunkSizeKBList,d=l.length-1,h=0,a=0,x=d;if(f<l[0])return l[0];for(;a<=x;){if(h=a+Math.floor((x-a)/2),h===d||f>=l[h]&&f<l[h+1])return l[h];l[h]<f?a=h+1:x=h-1}},v.prototype._onLoad=function(f){if(this._status!==o.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var l=this._speedSampler.lastSecondKBps;if(l===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(l=this._speedSampler.currentKBps)),l!==0){var d=this._normalizeSpeed(l);this._currentSpeedNormalized!==d&&(this._currentSpeedNormalized=d,this._currentChunkSizeKB=d)}var h=f.target.response,a=this._range.from+this._receivedLength;this._receivedLength+=h.byteLength;var x=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():x=!0,this._onDataArrival&&this._onDataArrival(h,a,this._receivedLength),x&&(this._status=o.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},v.prototype._onXhrError=function(f){this._status=o.LoaderStatus.kError;var l=0,d=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(l=o.LoaderErrors.EARLY_EOF,d={code:-1,msg:"RangeLoader meet Early-Eof"}):(l=o.LoaderErrors.EXCEPTION,d={code:-1,msg:f.constructor.name+" "+f.type}),this._onError)this._onError(l,d);else throw new s.RuntimeException(d.msg)},v}(o.BaseLoader);m.default=c},"./src/player/flv-player.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),u=p.n(g),o=p("./src/utils/logger.js"),s=p("./src/utils/browser.js"),y=p("./src/player/player-events.js"),c=p("./src/core/transmuxer.js"),_=p("./src/core/transmuxing-events.js"),v=p("./src/core/mse-controller.js"),f=p("./src/core/mse-events.js"),l=p("./src/player/player-errors.js"),d=p("./src/config.js"),h=p("./src/utils/exception.js"),a=function(){function x(C,b){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(u()),this._config=(0,d.createDefaultConfig)(),typeof b=="object"&&Object.assign(this._config,b),C.type.toLowerCase()!=="flv")throw new h.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");C.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=C,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var L=s.default.chrome&&(s.default.version.major<50||s.default.version.major===50&&s.default.version.build<2661);this._alwaysSeekKeyframe=!!(L||s.default.msedge||s.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return x.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},x.prototype.on=function(C,b){var L=this;C===y.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){L._emitter.emit(y.default.MEDIA_INFO,L.mediaInfo)}):C===y.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){L._emitter.emit(y.default.STATISTICS_INFO,L.statisticsInfo)}),this._emitter.addListener(C,b)},x.prototype.off=function(C,b){this._emitter.removeListener(C,b)},x.prototype.attachMediaElement=function(C){var b=this;if(this._mediaElement=C,C.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),C.addEventListener("seeking",this.e.onvSeeking),C.addEventListener("canplay",this.e.onvCanPlay),C.addEventListener("stalled",this.e.onvStalled),C.addEventListener("progress",this.e.onvProgress),this._msectl=new v.default(this._config),this._msectl.on(f.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(f.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(f.default.SOURCE_OPEN,function(){b._mseSourceOpened=!0,b._hasPendingLoad&&(b._hasPendingLoad=!1,b.load())}),this._msectl.on(f.default.ERROR,function(L){b._emitter.emit(y.default.ERROR,l.ErrorTypes.MEDIA_ERROR,l.ErrorDetails.MEDIA_MSE_ERROR,L)}),this._msectl.attachMediaElement(C),this._pendingSeekTime!=null)try{C.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},x.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},x.prototype.load=function(){var C=this;if(!this._mediaElement)throw new h.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new h.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new c.default(this._mediaDataSource,this._config),this._transmuxer.on(_.default.INIT_SEGMENT,function(b,L){C._msectl.appendInitSegment(L)}),this._transmuxer.on(_.default.MEDIA_SEGMENT,function(b,L){if(C._msectl.appendMediaSegment(L),C._config.lazyLoad&&!C._config.isLive){var O=C._mediaElement.currentTime;L.info.endDts>=(O+C._config.lazyLoadMaxDuration)*1e3&&C._progressChecker==null&&(o.default.v(C.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),C._suspendTransmuxer())}}),this._transmuxer.on(_.default.LOADING_COMPLETE,function(){C._msectl.endOfStream(),C._emitter.emit(y.default.LOADING_COMPLETE)}),this._transmuxer.on(_.default.RECOVERED_EARLY_EOF,function(){C._emitter.emit(y.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(_.default.IO_ERROR,function(b,L){C._emitter.emit(y.default.ERROR,l.ErrorTypes.NETWORK_ERROR,b,L)}),this._transmuxer.on(_.default.DEMUX_ERROR,function(b,L){C._emitter.emit(y.default.ERROR,l.ErrorTypes.MEDIA_ERROR,b,{code:-1,msg:L})}),this._transmuxer.on(_.default.MEDIA_INFO,function(b){C._mediaInfo=b,C._emitter.emit(y.default.MEDIA_INFO,Object.assign({},b))}),this._transmuxer.on(_.default.METADATA_ARRIVED,function(b){C._emitter.emit(y.default.METADATA_ARRIVED,b)}),this._transmuxer.on(_.default.SCRIPTDATA_ARRIVED,function(b){C._emitter.emit(y.default.SCRIPTDATA_ARRIVED,b)}),this._transmuxer.on(_.default.STATISTICS_INFO,function(b){C._statisticsInfo=C._fillStatisticsInfo(b),C._emitter.emit(y.default.STATISTICS_INFO,Object.assign({},C._statisticsInfo))}),this._transmuxer.on(_.default.RECOMMEND_SEEKPOINT,function(b){C._mediaElement&&!C._config.accurateSeek&&(C._requestSetTime=!0,C._mediaElement.currentTime=b/1e3)}),this._transmuxer.open()}},x.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},x.prototype.play=function(){return this._mediaElement.play()},x.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(x.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(C){this._mediaElement.volume=C},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(C){this._mediaElement.muted=C},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(C){this._mediaElement?this._internalSeek(C):this._pendingSeekTime=C},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),x.prototype._fillStatisticsInfo=function(C){if(C.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return C;var b=!0,L=0,O=0;if(this._mediaElement.getVideoPlaybackQuality){var A=this._mediaElement.getVideoPlaybackQuality();L=A.totalVideoFrames,O=A.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(L=this._mediaElement.webkitDecodedFrameCount,O=this._mediaElement.webkitDroppedFrameCount):b=!1;return b&&(C.decodedFrames=L,C.droppedFrames=O),C},x.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var C=this._mediaElement.buffered,b=this._mediaElement.currentTime,L=0,O=0;O<C.length;O++){var A=C.start(O),R=C.end(O);if(A<=b&&b<R){L=R;break}}L>=b+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(o.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},x.prototype._onmseBufferFull=function(){o.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},x.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},x.prototype._checkProgressAndResume=function(){for(var C=this._mediaElement.currentTime,b=this._mediaElement.buffered,L=!1,O=0;O<b.length;O++){var A=b.start(O),R=b.end(O);if(C>=A&&C<R){C>=R-this._config.lazyLoadRecoverDuration&&(L=!0);break}}L&&(window.clearInterval(this._progressChecker),this._progressChecker=null,L&&(o.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},x.prototype._isTimepointBuffered=function(C){for(var b=this._mediaElement.buffered,L=0;L<b.length;L++){var O=b.start(L),A=b.end(L);if(C>=O&&C<A)return!0}return!1},x.prototype._internalSeek=function(C){var b=this._isTimepointBuffered(C),L=!1,O=0;if(C<1&&this._mediaElement.buffered.length>0){var A=this._mediaElement.buffered.start(0);(A<1&&C<A||s.default.safari)&&(L=!0,O=s.default.safari?.1:A)}if(L)this._requestSetTime=!0,this._mediaElement.currentTime=O;else if(b){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=C;else{var R=this._msectl.getNearestKeyframe(Math.floor(C*1e3));this._requestSetTime=!0,R!=null?this._mediaElement.currentTime=R.dts/1e3:this._mediaElement.currentTime=C}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(C),this._transmuxer.seek(Math.floor(C*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=C)},x.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var C=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(C)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(C),this._transmuxer.seek(Math.floor(C*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=C))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},x.prototype._checkAndResumeStuckPlayback=function(C){var b=this._mediaElement;if(C||!this._receivedCanPlay||b.readyState<2){var L=b.buffered;L.length>0&&b.currentTime<L.start(0)&&(o.default.w(this.TAG,"Playback seems stuck at "+b.currentTime+", seek to "+L.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=L.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},x.prototype._onvLoadedMetadata=function(C){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},x.prototype._onvSeeking=function(C){var b=this._mediaElement.currentTime,L=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(b<1&&L.length>0){var O=L.start(0);if(O<1&&b<O||s.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=s.default.safari?.1:O;return}}if(this._isTimepointBuffered(b)){if(this._alwaysSeekKeyframe){var A=this._msectl.getNearestKeyframe(Math.floor(b*1e3));A!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=A.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:b,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},x.prototype._onvCanPlay=function(C){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},x.prototype._onvStalled=function(C){this._checkAndResumeStuckPlayback(!0)},x.prototype._onvProgress=function(C){this._checkAndResumeStuckPlayback()},x}();m.default=a},"./src/player/native-player.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),u=p.n(g),o=p("./src/player/player-events.js"),s=p("./src/config.js"),y=p("./src/utils/exception.js"),c=function(){function _(v,f){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(u()),this._config=(0,s.createDefaultConfig)(),typeof f=="object"&&Object.assign(this._config,f),v.type.toLowerCase()==="flv")throw new y.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(v.hasOwnProperty("segments"))throw new y.InvalidArgumentException("NativePlayer("+v.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=v,this._mediaElement=null}return _.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},_.prototype.on=function(v,f){var l=this;v===o.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){l._emitter.emit(o.default.MEDIA_INFO,l.mediaInfo)}):v===o.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){l._emitter.emit(o.default.STATISTICS_INFO,l.statisticsInfo)}),this._emitter.addListener(v,f)},_.prototype.off=function(v,f){this._emitter.removeListener(v,f)},_.prototype.attachMediaElement=function(v){if(this._mediaElement=v,v.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{v.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},_.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},_.prototype.load=function(){if(!this._mediaElement)throw new y.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},_.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},_.prototype.play=function(){return this._mediaElement.play()},_.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(_.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(v){this._mediaElement.volume=v},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(v){this._mediaElement.muted=v},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(v){this._mediaElement?this._mediaElement.currentTime=v:this._pendingSeekTime=v},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"mediaInfo",{get:function(){var v=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",f={mimeType:v+this._mediaDataSource.type};return this._mediaElement&&(f.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(f.width=this._mediaElement.videoWidth,f.height=this._mediaElement.videoHeight)),f},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"statisticsInfo",{get:function(){var v={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return v;var f=!0,l=0,d=0;if(this._mediaElement.getVideoPlaybackQuality){var h=this._mediaElement.getVideoPlaybackQuality();l=h.totalVideoFrames,d=h.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(l=this._mediaElement.webkitDecodedFrameCount,d=this._mediaElement.webkitDroppedFrameCount):f=!1;return f&&(v.decodedFrames=l,v.droppedFrames=d),v},enumerable:!1,configurable:!0}),_.prototype._onvLoadedMetadata=function(v){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(o.default.MEDIA_INFO,this.mediaInfo)},_.prototype._reportStatisticsInfo=function(){this._emitter.emit(o.default.STATISTICS_INFO,this.statisticsInfo)},_}();m.default=c},"./src/player/player-errors.js":function(S,m,p){p.r(m),p.d(m,{ErrorTypes:function(){return o},ErrorDetails:function(){return s}});var g=p("./src/io/loader.js"),u=p("./src/demux/demux-errors.js"),o={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},s={NETWORK_EXCEPTION:g.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:g.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:g.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:g.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:u.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:u.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:u.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(S,m,p){p.r(m);var g={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};m.default=g},"./src/remux/aac-silent.js":function(S,m,p){p.r(m);var g=function(){function u(){}return u.getSilentFrame=function(o,s){if(o==="mp4a.40.2"){if(s===1)return new Uint8Array([0,200,0,128,35,128]);if(s===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(s===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(s===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(s===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(s===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(s===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},u}();m.default=g},"./src/remux/mp4-generator.js":function(S,m,p){p.r(m);var g=function(){function u(){}return u.init=function(){u.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var o in u.types)u.types.hasOwnProperty(o)&&(u.types[o]=[o.charCodeAt(0),o.charCodeAt(1),o.charCodeAt(2),o.charCodeAt(3)]);var s=u.constants={};s.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),s.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),s.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),s.STSC=s.STCO=s.STTS,s.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),s.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),s.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),s.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},u.box=function(o){for(var s=8,y=null,c=Array.prototype.slice.call(arguments,1),_=c.length,v=0;v<_;v++)s+=c[v].byteLength;y=new Uint8Array(s),y[0]=s>>>24&255,y[1]=s>>>16&255,y[2]=s>>>8&255,y[3]=s&255,y.set(o,4);for(var f=8,v=0;v<_;v++)y.set(c[v],f),f+=c[v].byteLength;return y},u.generateInitSegment=function(o){var s=u.box(u.types.ftyp,u.constants.FTYP),y=u.moov(o),c=new Uint8Array(s.byteLength+y.byteLength);return c.set(s,0),c.set(y,s.byteLength),c},u.moov=function(o){var s=u.mvhd(o.timescale,o.duration),y=u.trak(o),c=u.mvex(o);return u.box(u.types.moov,s,y,c)},u.mvhd=function(o,s){return u.box(u.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},u.trak=function(o){return u.box(u.types.trak,u.tkhd(o),u.mdia(o))},u.tkhd=function(o){var s=o.id,y=o.duration,c=o.presentWidth,_=o.presentHeight;return u.box(u.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,y&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,c>>>8&255,c&255,0,0,_>>>8&255,_&255,0,0]))},u.mdia=function(o){return u.box(u.types.mdia,u.mdhd(o),u.hdlr(o),u.minf(o))},u.mdhd=function(o){var s=o.timescale,y=o.duration;return u.box(u.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,y>>>24&255,y>>>16&255,y>>>8&255,y&255,85,196,0,0]))},u.hdlr=function(o){var s=null;return o.type==="audio"?s=u.constants.HDLR_AUDIO:s=u.constants.HDLR_VIDEO,u.box(u.types.hdlr,s)},u.minf=function(o){var s=null;return o.type==="audio"?s=u.box(u.types.smhd,u.constants.SMHD):s=u.box(u.types.vmhd,u.constants.VMHD),u.box(u.types.minf,s,u.dinf(),u.stbl(o))},u.dinf=function(){var o=u.box(u.types.dinf,u.box(u.types.dref,u.constants.DREF));return o},u.stbl=function(o){var s=u.box(u.types.stbl,u.stsd(o),u.box(u.types.stts,u.constants.STTS),u.box(u.types.stsc,u.constants.STSC),u.box(u.types.stsz,u.constants.STSZ),u.box(u.types.stco,u.constants.STCO));return s},u.stsd=function(o){return o.type==="audio"?o.codec==="mp3"?u.box(u.types.stsd,u.constants.STSD_PREFIX,u.mp3(o)):u.box(u.types.stsd,u.constants.STSD_PREFIX,u.mp4a(o)):u.box(u.types.stsd,u.constants.STSD_PREFIX,u.avc1(o))},u.mp3=function(o){var s=o.channelCount,y=o.audioSampleRate,c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,y>>>8&255,y&255,0,0]);return u.box(u.types[".mp3"],c)},u.mp4a=function(o){var s=o.channelCount,y=o.audioSampleRate,c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,y>>>8&255,y&255,0,0]);return u.box(u.types.mp4a,c,u.esds(o))},u.esds=function(o){var s=o.config||[],y=s.length,c=new Uint8Array([0,0,0,0,3,23+y,0,1,0,4,15+y,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([y]).concat(s).concat([6,1,2]));return u.box(u.types.esds,c)},u.avc1=function(o){var s=o.avcc,y=o.codecWidth,c=o.codecHeight,_=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,y>>>8&255,y&255,c>>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return u.box(u.types.avc1,_,u.box(u.types.avcC,s))},u.mvex=function(o){return u.box(u.types.mvex,u.trex(o))},u.trex=function(o){var s=o.id,y=new Uint8Array([0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return u.box(u.types.trex,y)},u.moof=function(o,s){return u.box(u.types.moof,u.mfhd(o.sequenceNumber),u.traf(o,s))},u.mfhd=function(o){var s=new Uint8Array([0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255]);return u.box(u.types.mfhd,s)},u.traf=function(o,s){var y=o.id,c=u.box(u.types.tfhd,new Uint8Array([0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,y&255])),_=u.box(u.types.tfdt,new Uint8Array([0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255])),v=u.sdtp(o),f=u.trun(o,v.byteLength+16+16+8+16+8+8);return u.box(u.types.traf,c,_,f,v)},u.sdtp=function(o){for(var s=o.samples||[],y=s.length,c=new Uint8Array(4+y),_=0;_<y;_++){var v=s[_].flags;c[_+4]=v.isLeading<<6|v.dependsOn<<4|v.isDependedOn<<2|v.hasRedundancy}return u.box(u.types.sdtp,c)},u.trun=function(o,s){var y=o.samples||[],c=y.length,_=12+16*c,v=new Uint8Array(_);s+=8+_,v.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,c&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255],0);for(var f=0;f<c;f++){var l=y[f].duration,d=y[f].size,h=y[f].flags,a=y[f].cts;v.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.isNonSync,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255],12+16*f)}return u.box(u.types.trun,v)},u.mdat=function(o){return u.box(u.types.mdat,o)},u}();g.init(),m.default=g},"./src/remux/mp4-remuxer.js":function(S,m,p){p.r(m);var g=p("./src/utils/logger.js"),u=p("./src/remux/mp4-generator.js"),o=p("./src/remux/aac-silent.js"),s=p("./src/utils/browser.js"),y=p("./src/core/media-segment-info.js"),c=p("./src/utils/exception.js"),_=function(){function v(f){this.TAG="MP4Remuxer",this._config=f,this._isLive=f.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new y.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new y.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(s.default.chrome&&(s.default.version.major<50||s.default.version.major===50&&s.default.version.build<2661)),this._fillSilentAfterSeek=s.default.msedge||s.default.msie,this._mp3UseMpegAudio=!s.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return v.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},v.prototype.bindDataSource=function(f){return f.onDataAvailable=this.remux.bind(this),f.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(v.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(f){this._onInitSegment=f},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(f){this._onMediaSegment=f},enumerable:!1,configurable:!0}),v.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},v.prototype.seek=function(f){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},v.prototype.remux=function(f,l){if(!this._onMediaSegment)throw new c.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(f,l),this._remuxVideo(l),this._remuxAudio(f)},v.prototype._onTrackMetadataReceived=function(f,l){var d=null,h="mp4",a=l.codec;if(f==="audio")this._audioMeta=l,l.codec==="mp3"&&this._mp3UseMpegAudio?(h="mpeg",a="",d=new Uint8Array):d=u.default.generateInitSegment(l);else if(f==="video")this._videoMeta=l,d=u.default.generateInitSegment(l);else return;if(!this._onInitSegment)throw new c.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(f,{type:f,data:d.buffer,codec:a,container:f+"/"+h,mediaDuration:l.duration})},v.prototype._calculateDtsBase=function(f,l){this._dtsBaseInited||(f.samples&&f.samples.length&&(this._audioDtsBase=f.samples[0].dts),l.samples&&l.samples.length&&(this._videoDtsBase=l.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},v.prototype.flushStashedSamples=function(){var f=this._videoStashedLastSample,l=this._audioStashedLastSample,d={type:"video",id:1,sequenceNumber:0,samples:[],length:0};f!=null&&(d.samples.push(f),d.length=f.length);var h={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};l!=null&&(h.samples.push(l),h.length=l.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(d,!0),this._remuxAudio(h,!0)},v.prototype._remuxAudio=function(f,l){if(this._audioMeta!=null){var d=f,h=d.samples,a=void 0,x=-1,C=-1,b=this._audioMeta.refSampleDuration,L=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,O=this._dtsBaseInited&&this._audioNextDts===void 0,A=!1;if(!(!h||h.length===0)&&!(h.length===1&&!l)){var R=0,T=null,P=0;L?(R=0,P=d.length):(R=8,P=8+d.length);var k=null;if(h.length>1&&(k=h.pop(),P-=k.length),this._audioStashedLastSample!=null){var D=this._audioStashedLastSample;this._audioStashedLastSample=null,h.unshift(D),P+=D.length}k!=null&&(this._audioStashedLastSample=k);var M=h[0].dts-this._dtsBase;if(this._audioNextDts)a=M-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())a=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(A=!0);else{var q=this._audioSegmentInfoList.getLastSampleBefore(M);if(q!=null){var Q=M-(q.originalDts+q.duration);Q<=3&&(Q=0);var H=q.dts+q.duration+Q;a=M-H}else a=0}if(A){var te=M-a,ce=this._videoSegmentInfoList.getLastSegmentBefore(M);if(ce!=null&&ce.beginDts<te){var Y=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(Y){var re=ce.beginDts,Ae=te-ce.beginDts;g.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+re+", duration: "+Ae),h.unshift({unit:Y,dts:re,pts:re}),P+=Y.byteLength}}else A=!1}for(var ae=[],fe=0;fe<h.length;fe++){var D=h[fe],Le=D.unit,me=D.dts-this._dtsBase,re=me,Se=!1,Re=null,de=0;if(!(me<-.001)){if(this._audioMeta.codec!=="mp3"){var W=me,Te=3;if(this._audioNextDts&&(W=this._audioNextDts),a=me-W,a<=-Te*b){g.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+me+" ms ,curRefDts: "+W+" ms)  due to dtsCorrection: "+a+" ms overlap.");continue}else if(a>=Te*b&&this._fillAudioTimestampGap&&!s.default.safari){Se=!0;var Oe=Math.floor(a/b);g.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+me+" ms, curRefDts: "+W+" ms, ")+("dtsCorrection: "+Math.round(a)+" ms, generate: "+Oe+" frames")),re=Math.floor(W),de=Math.floor(W+b)-re;var Y=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);Y==null&&(g.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),Y=Le),Re=[];for(var Ue=0;Ue<Oe;Ue++){W=W+b;var Pe=Math.floor(W),je=Math.floor(W+b)-Pe,N={dts:Pe,pts:Pe,cts:0,unit:Y,size:Y.byteLength,duration:je,originalDts:me,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};Re.push(N),P+=N.size}this._audioNextDts=W+b}else re=Math.floor(W),de=Math.floor(W+b)-re,this._audioNextDts=W+b}else{if(re=me-a,fe!==h.length-1){var w=h[fe+1].dts-this._dtsBase-a;de=w-re}else if(k!=null){var w=k.dts-this._dtsBase-a;de=w-re}else ae.length>=1?de=ae[ae.length-1].duration:de=Math.floor(b);this._audioNextDts=re+de}x===-1&&(x=re),ae.push({dts:re,pts:re,cts:0,unit:D.unit,size:D.unit.byteLength,duration:de,originalDts:me,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Se&&ae.push.apply(ae,Re)}}if(ae.length===0){d.samples=[],d.length=0;return}L?T=new Uint8Array(P):(T=new Uint8Array(P),T[0]=P>>>24&255,T[1]=P>>>16&255,T[2]=P>>>8&255,T[3]=P&255,T.set(u.default.types.mdat,4));for(var fe=0;fe<ae.length;fe++){var Le=ae[fe].unit;T.set(Le,R),R+=Le.byteLength}var U=ae[ae.length-1];C=U.dts+U.duration;var V=new y.MediaSegmentInfo;V.beginDts=x,V.endDts=C,V.beginPts=x,V.endPts=C,V.originalBeginDts=ae[0].originalDts,V.originalEndDts=U.originalDts+U.duration,V.firstSample=new y.SampleInfo(ae[0].dts,ae[0].pts,ae[0].duration,ae[0].originalDts,!1),V.lastSample=new y.SampleInfo(U.dts,U.pts,U.duration,U.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(V),d.samples=ae,d.sequenceNumber++;var Ce=null;L?Ce=new Uint8Array:Ce=u.default.moof(d,x),d.samples=[],d.length=0;var be={type:"audio",data:this._mergeBoxes(Ce,T).buffer,sampleCount:ae.length,info:V};L&&O&&(be.timestampOffset=x),this._onMediaSegment("audio",be)}}},v.prototype._remuxVideo=function(f,l){if(this._videoMeta!=null){var d=f,h=d.samples,a=void 0,x=-1,C=-1,b=-1,L=-1;if(!(!h||h.length===0)&&!(h.length===1&&!l)){var O=8,A=null,R=8+f.length,T=null;if(h.length>1&&(T=h.pop(),R-=T.length),this._videoStashedLastSample!=null){var P=this._videoStashedLastSample;this._videoStashedLastSample=null,h.unshift(P),R+=P.length}T!=null&&(this._videoStashedLastSample=T);var k=h[0].dts-this._dtsBase;if(this._videoNextDts)a=k-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())a=0;else{var D=this._videoSegmentInfoList.getLastSampleBefore(k);if(D!=null){var M=k-(D.originalDts+D.duration);M<=3&&(M=0);var q=D.dts+D.duration+M;a=k-q}else a=0}for(var Q=new y.MediaSegmentInfo,H=[],te=0;te<h.length;te++){var P=h[te],ce=P.dts-this._dtsBase,Y=P.isKeyframe,re=ce-a,Ae=P.cts,ae=re+Ae;x===-1&&(x=re,b=ae);var fe=0;if(te!==h.length-1){var Le=h[te+1].dts-this._dtsBase-a;fe=Le-re}else if(T!=null){var Le=T.dts-this._dtsBase-a;fe=Le-re}else H.length>=1?fe=H[H.length-1].duration:fe=Math.floor(this._videoMeta.refSampleDuration);if(Y){var me=new y.SampleInfo(re,ae,fe,P.dts,!0);me.fileposition=P.fileposition,Q.appendSyncPoint(me)}H.push({dts:re,pts:ae,cts:Ae,units:P.units,size:P.length,isKeyframe:Y,duration:fe,originalDts:ce,flags:{isLeading:0,dependsOn:Y?2:1,isDependedOn:Y?1:0,hasRedundancy:0,isNonSync:Y?0:1}})}A=new Uint8Array(R),A[0]=R>>>24&255,A[1]=R>>>16&255,A[2]=R>>>8&255,A[3]=R&255,A.set(u.default.types.mdat,4);for(var te=0;te<H.length;te++)for(var Se=H[te].units;Se.length;){var Re=Se.shift(),de=Re.data;A.set(de,O),O+=de.byteLength}var W=H[H.length-1];if(C=W.dts+W.duration,L=W.pts+W.duration,this._videoNextDts=C,Q.beginDts=x,Q.endDts=C,Q.beginPts=b,Q.endPts=L,Q.originalBeginDts=H[0].originalDts,Q.originalEndDts=W.originalDts+W.duration,Q.firstSample=new y.SampleInfo(H[0].dts,H[0].pts,H[0].duration,H[0].originalDts,H[0].isKeyframe),Q.lastSample=new y.SampleInfo(W.dts,W.pts,W.duration,W.originalDts,W.isKeyframe),this._isLive||this._videoSegmentInfoList.append(Q),d.samples=H,d.sequenceNumber++,this._forceFirstIDR){var Te=H[0].flags;Te.dependsOn=2,Te.isNonSync=0}var Oe=u.default.moof(d,x);d.samples=[],d.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(Oe,A).buffer,sampleCount:H.length,info:Q})}}},v.prototype._mergeBoxes=function(f,l){var d=new Uint8Array(f.byteLength+l.byteLength);return d.set(f,0),d.set(l,f.byteLength),d},v}();m.default=_},"./src/utils/browser.js":function(S,m,p){p.r(m);var g={};function u(){var o=self.navigator.userAgent.toLowerCase(),s=/(edge)\/([\w.]+)/.exec(o)||/(opr)[\/]([\w.]+)/.exec(o)||/(chrome)[ \/]([\w.]+)/.exec(o)||/(iemobile)[\/]([\w.]+)/.exec(o)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+)/.exec(o)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(o)||/(msie) ([\w.]+)/.exec(o)||o.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(o)||o.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(o)||[],y=/(ipad)/.exec(o)||/(ipod)/.exec(o)||/(windows phone)/.exec(o)||/(iphone)/.exec(o)||/(kindle)/.exec(o)||/(android)/.exec(o)||/(windows)/.exec(o)||/(mac)/.exec(o)||/(linux)/.exec(o)||/(cros)/.exec(o)||[],c={browser:s[5]||s[3]||s[1]||"",version:s[2]||s[4]||"0",majorVersion:s[4]||s[2]||"0",platform:y[0]||""},_={};if(c.browser){_[c.browser]=!0;var v=c.majorVersion.split(".");_.version={major:parseInt(c.majorVersion,10),string:c.version},v.length>1&&(_.version.minor=parseInt(v[1],10)),v.length>2&&(_.version.build=parseInt(v[2],10))}if(c.platform&&(_[c.platform]=!0),(_.chrome||_.opr||_.safari)&&(_.webkit=!0),_.rv||_.iemobile){_.rv&&delete _.rv;var f="msie";c.browser=f,_[f]=!0}if(_.edge){delete _.edge;var l="msedge";c.browser=l,_[l]=!0}if(_.opr){var d="opera";c.browser=d,_[d]=!0}if(_.safari&&_.android){var h="android";c.browser=h,_[h]=!0}_.name=c.browser,_.platform=c.platform;for(var a in g)g.hasOwnProperty(a)&&delete g[a];Object.assign(g,_)}u(),m.default=g},"./src/utils/exception.js":function(S,m,p){p.r(m),p.d(m,{RuntimeException:function(){return u},IllegalStateException:function(){return o},InvalidArgumentException:function(){return s},NotImplementedException:function(){return y}});var g=function(){var c=function(_,v){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,l){f.__proto__=l}||function(f,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(f[d]=l[d])},c(_,v)};return function(_,v){if(typeof v!="function"&&v!==null)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");c(_,v);function f(){this.constructor=_}_.prototype=v===null?Object.create(v):(f.prototype=v.prototype,new f)}}(),u=function(){function c(_){this._message=_}return Object.defineProperty(c.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),c.prototype.toString=function(){return this.name+": "+this.message},c}(),o=function(c){g(_,c);function _(v){return c.call(this,v)||this}return Object.defineProperty(_.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),_}(u),s=function(c){g(_,c);function _(v){return c.call(this,v)||this}return Object.defineProperty(_.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),_}(u),y=function(c){g(_,c);function _(v){return c.call(this,v)||this}return Object.defineProperty(_.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),_}(u)},"./src/utils/logger.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),u=p.n(g),o=function(){function s(){}return s.e=function(y,c){(!y||s.FORCE_GLOBAL_TAG)&&(y=s.GLOBAL_TAG);var _="["+y+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","error",_),s.ENABLE_ERROR&&(console.error?console.error(_):console.warn?console.warn(_):console.log(_))},s.i=function(y,c){(!y||s.FORCE_GLOBAL_TAG)&&(y=s.GLOBAL_TAG);var _="["+y+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","info",_),s.ENABLE_INFO&&(console.info?console.info(_):console.log(_))},s.w=function(y,c){(!y||s.FORCE_GLOBAL_TAG)&&(y=s.GLOBAL_TAG);var _="["+y+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","warn",_),s.ENABLE_WARN&&(console.warn?console.warn(_):console.log(_))},s.d=function(y,c){(!y||s.FORCE_GLOBAL_TAG)&&(y=s.GLOBAL_TAG);var _="["+y+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","debug",_),s.ENABLE_DEBUG&&(console.debug?console.debug(_):console.log(_))},s.v=function(y,c){(!y||s.FORCE_GLOBAL_TAG)&&(y=s.GLOBAL_TAG);var _="["+y+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","verbose",_),s.ENABLE_VERBOSE&&console.log(_)},s}();o.GLOBAL_TAG="flv.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new(u()),m.default=o},"./src/utils/logging-control.js":function(S,m,p){p.r(m);var g=p("./node_modules/events/events.js"),u=p.n(g),o=p("./src/utils/logger.js"),s=function(){function y(){}return Object.defineProperty(y,"forceGlobalTag",{get:function(){return o.default.FORCE_GLOBAL_TAG},set:function(c){o.default.FORCE_GLOBAL_TAG=c,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"globalTag",{get:function(){return o.default.GLOBAL_TAG},set:function(c){o.default.GLOBAL_TAG=c,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"enableAll",{get:function(){return o.default.ENABLE_VERBOSE&&o.default.ENABLE_DEBUG&&o.default.ENABLE_INFO&&o.default.ENABLE_WARN&&o.default.ENABLE_ERROR},set:function(c){o.default.ENABLE_VERBOSE=c,o.default.ENABLE_DEBUG=c,o.default.ENABLE_INFO=c,o.default.ENABLE_WARN=c,o.default.ENABLE_ERROR=c,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"enableDebug",{get:function(){return o.default.ENABLE_DEBUG},set:function(c){o.default.ENABLE_DEBUG=c,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"enableVerbose",{get:function(){return o.default.ENABLE_VERBOSE},set:function(c){o.default.ENABLE_VERBOSE=c,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"enableInfo",{get:function(){return o.default.ENABLE_INFO},set:function(c){o.default.ENABLE_INFO=c,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"enableWarn",{get:function(){return o.default.ENABLE_WARN},set:function(c){o.default.ENABLE_WARN=c,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"enableError",{get:function(){return o.default.ENABLE_ERROR},set:function(c){o.default.ENABLE_ERROR=c,y._notifyChange()},enumerable:!1,configurable:!0}),y.getConfig=function(){return{globalTag:o.default.GLOBAL_TAG,forceGlobalTag:o.default.FORCE_GLOBAL_TAG,enableVerbose:o.default.ENABLE_VERBOSE,enableDebug:o.default.ENABLE_DEBUG,enableInfo:o.default.ENABLE_INFO,enableWarn:o.default.ENABLE_WARN,enableError:o.default.ENABLE_ERROR,enableCallback:o.default.ENABLE_CALLBACK}},y.applyConfig=function(c){o.default.GLOBAL_TAG=c.globalTag,o.default.FORCE_GLOBAL_TAG=c.forceGlobalTag,o.default.ENABLE_VERBOSE=c.enableVerbose,o.default.ENABLE_DEBUG=c.enableDebug,o.default.ENABLE_INFO=c.enableInfo,o.default.ENABLE_WARN=c.enableWarn,o.default.ENABLE_ERROR=c.enableError,o.default.ENABLE_CALLBACK=c.enableCallback},y._notifyChange=function(){var c=y.emitter;if(c.listenerCount("change")>0){var _=y.getConfig();c.emit("change",_)}},y.registerListener=function(c){y.emitter.addListener("change",c)},y.removeListener=function(c){y.emitter.removeListener("change",c)},y.addLogListener=function(c){o.default.emitter.addListener("log",c),o.default.emitter.listenerCount("log")>0&&(o.default.ENABLE_CALLBACK=!0,y._notifyChange())},y.removeLogListener=function(c){o.default.emitter.removeListener("log",c),o.default.emitter.listenerCount("log")===0&&(o.default.ENABLE_CALLBACK=!1,y._notifyChange())},y}();s.emitter=new(u()),m.default=s},"./src/utils/polyfill.js":function(S,m,p){p.r(m);var g=function(){function u(){}return u.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(o,s){return o.__proto__=s,o},Object.assign=Object.assign||function(o){if(o==null)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(o),y=1;y<arguments.length;y++){var c=arguments[y];if(c!=null)for(var _ in c)c.hasOwnProperty(_)&&(s[_]=c[_])}return s},typeof self.Promise!="function"&&p("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},u}();g.install(),m.default=g},"./src/utils/utf8-conv.js":function(S,m,p){p.r(m);function g(o,s,y){var c=o;if(s+y<c.length){for(;y--;)if((c[++s]&192)!==128)return!1;return!0}else return!1}function u(o){for(var s=[],y=o,c=0,_=o.length;c<_;){if(y[c]<128){s.push(String.fromCharCode(y[c])),++c;continue}else if(!(y[c]<192)){if(y[c]<224){if(g(y,c,1)){var v=(y[c]&31)<<6|y[c+1]&63;if(v>=128){s.push(String.fromCharCode(v&65535)),c+=2;continue}}}else if(y[c]<240){if(g(y,c,2)){var v=(y[c]&15)<<12|(y[c+1]&63)<<6|y[c+2]&63;if(v>=2048&&(v&63488)!==55296){s.push(String.fromCharCode(v&65535)),c+=3;continue}}}else if(y[c]<248&&g(y,c,3)){var v=(y[c]&7)<<18|(y[c+1]&63)<<12|(y[c+2]&63)<<6|y[c+3]&63;if(v>65536&&v<1114112){v-=65536,s.push(String.fromCharCode(v>>>10|55296)),s.push(String.fromCharCode(v&1023|56320)),c+=4;continue}}}s.push(String.fromCharCode(65533)),++c}return s.join("")}m.default=u}},r={};function i(S){var m=r[S];if(m!==void 0)return m.exports;var p=r[S]={exports:{}};return n[S].call(p.exports,p,p.exports,i),p.exports}i.m=n,function(){i.n=function(S){var m=S&&S.__esModule?function(){return S.default}:function(){return S};return i.d(m,{a:m}),m}}(),function(){i.d=function(S,m){for(var p in m)i.o(m,p)&&!i.o(S,p)&&Object.defineProperty(S,p,{enumerable:!0,get:m[p]})}}(),function(){i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){i.o=function(S,m){return Object.prototype.hasOwnProperty.call(S,m)}}(),function(){i.r=function(S){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(S,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(S,"__esModule",{value:!0})}}();var E=i("./src/index.js");return E}()})})(Xr);var ko=Xr.exports;const Do=Xn(ko);const Io={class:"video-container"},Mo={key:1,class:"controls"},Bo={class:"left"},Fo={class:"right"},wo={name:"Video"},Uo=Object.assign(wo,{props:{flv:{type:Boolean,default:!1},url:{type:String,default:""},id:{type:String,default:""},abbr:{type:Boolean,default:!1}},emits:"full",setup(e,{expose:t,emit:n}){const r=e,i=J(null),E=J(null);let S=J(!1),m=J(!0),p=J(!1),g=null;const u=()=>{g=Do.createPlayer({type:"flv",isLive:!0,url:r.url}),g.attachMediaElement(i==null?void 0:i.value),g.load(),g.play()};Si(()=>{r.flv&&r.url&&u()});const o=(v,f,l)=>{v&&(i.value.srcObject=v,i.value.muted=f,m.value=f,p.value=l)},s=v=>{v.requestFullscreen?v.requestFullscreen():ele.mozRequestFullScreen?v.mozRequestFullScreen():ele.webkitRequestFullScreen&&v.webkitRequestFullScreen()};function y(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}const c=()=>{S.value?(y(),S.value=!1):(s(E==null?void 0:E.value),S.value=!0)},_=()=>{let v=!i.value.muted;m.value=v,i.value.muted=v};return t({setStream:o,id:r.id}),(v,f)=>{const l=un;return j(),se("div",{class:ee(["live-video",{"is-full":G(S)}]),ref_key:"videoContainerRef",ref:E},[$("div",Io,[$("video",{class:"video",ref_key:"videoRef",ref:i,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:"","x-webkit-airplay":"allow","x5-video-player-type":"h5","x5-video-player-fullscreen":"true",oncontextmenu:"return false"},null,512),Be(v.$slots,"default",{},void 0,!0),r.abbr?(j(),ue(l,{key:0,class:"full-center","icon-name":"full","icon-size":"28",color:"#cfcfcf",onClick:f[0]||(f[0]=Fe(d=>n("full"),["stop"]))})):oe("",!0),G(p)?(j(),se("div",Mo,[$("div",Bo,[z(l,{"icon-name":G(m)?"sound-close":"sound","icon-size":"24",color:"#cfcfcf",onClick:Fe(_,["stop"])},null,8,["icon-name","onClick"])]),$("div",Fo,[z(l,{"icon-name":"full","icon-size":"20",color:"#cfcfcf",onClick:Fe(c,["stop"])},null,8,["onClick"])])])):oe("",!0)])],2)}}}),ct=ot(Uo,[["__scopeId","data-v-c26449f1"]]);const jo={class:"user-video-control"},No={__name:"control",props:{state:{type:Object,required:!0}},emits:"control",setup(e,{emit:t}){const n=e,i=Jn()?18:20,E=S=>{t("control",{state:n.state[S],type:S})};return(S,m)=>{const p=un;return j(),se("div",jo,[z(p,{"icon-name":"shipin-"+n.state.video,"icon-size":G(i),onClick:m[0]||(m[0]=g=>E("video")),color:"#ffffff"},null,8,["icon-name","icon-size"]),z(p,{"icon-name":"yuyin-"+n.state.audio,"icon-size":G(i),onClick:m[1]||(m[1]=g=>E("audio")),color:"#ffffff"},null,8,["icon-name","icon-size"])])}}},Un=ot(No,[["__scopeId","data-v-7d5237bd"]]);const Vo={class:"user-video-header"},Go=["title"],Ko={__name:"header",props:{homeowner:{type:Boolean,default:!1},name:{type:String,default:""}},setup(e){const t=e,n=Jn();return(r,i)=>{const E=Yi;return j(),se("div",Vo,[t.homeowner?(j(),ue(E,{key:0,round:"",size:G(n)?"small":""},{default:X(()=>[ge("房主")]),_:1},8,["size"])):oe("",!0),$("div",{class:"video-username",title:t.name},_e(t.name),9,Go)])}}},vt=ot(Ko,[["__scopeId","data-v-c5788485"]]),zo={class:"dialog-footer"},Wo={name:"SetRoomPassDialog"},$o=Object.assign(Wo,{props:{id:{type:String,default:""}},setup(e,{expose:t}){const n=e,r=J(),i=J(!1),E=J(""),S=()=>{i.value=!1},m=()=>{E.value.trim().length===6||E.value.length===0?qn({method:"POST",url:"room/update",data:{id:n.id,password:E.value}}).then(()=>{i.value=!1,E.value.length===0?Ge.success("密码已设置为空！"):Ge.success("密码设置成功！")}):Ge.warning("密码输入格式错误！")};return t({show:()=>i.value=!0,hide:()=>i.value=!1}),(p,g)=>{const u=Ut,o=qe,s=cn;return j(),ue(s,{ref_key:"dialogRef",ref:r,modelValue:i.value,"onUpdate:modelValue":g[1]||(g[1]=y=>i.value=y),title:"设置密码",width:"400px","show-close":!1,"close-on-click-modal":!1},{footer:X(()=>[$("div",zo,[z(o,{onClick:S},{default:X(()=>[ge("取消")]),_:1}),z(o,{type:"primary",onClick:m},{default:X(()=>[ge(" 确定 ")]),_:1})])]),default:X(()=>[z(u,{modelValue:E.value,"onUpdate:modelValue":g[0]||(g[0]=y=>E.value=y),modelModifiers:{trim:!0},placeholder:"请输入6位密码"},null,8,["modelValue"])]),_:1},8,["modelValue"])}}}),Ho={class:"dialog-footer"},Yo={name:"EnterRoomPassDialog"},Xo=Object.assign(Yo,{props:{id:{type:String,default:""}},emits:["onTrue","onFalse","onCancel"],setup(e,{expose:t,emit:n}){const r=e,i=J(),E=J(),S=()=>{n("onCancel"),E.value=!1},m=()=>{qn({method:"POST",url:"/room/checkPassword",data:{id:r.id,password:i.value}}).then(p=>{p.data?(n("onTrue"),E.value=!1):(n("onFalse"),Ge.warning("密码错误！"))})};return t({show:()=>E.value=!0,hide:()=>E.value=!1}),(p,g)=>{const u=Ut,o=qe,s=cn;return j(),ue(s,{ref:"dialogRef",modelValue:E.value,"onUpdate:modelValue":g[1]||(g[1]=y=>E.value=y),title:"设置密码",width:"400px","show-close":!1,"close-on-click-modal":!1},{footer:X(()=>[$("div",Ho,[z(o,{onClick:S},{default:X(()=>[ge("取消")]),_:1}),z(o,{type:"primary",onClick:m},{default:X(()=>[ge(" 确定 ")]),_:1})])]),default:X(()=>[z(u,{modelValue:i.value,"onUpdate:modelValue":g[0]||(g[0]=y=>i.value=y),modelModifiers:{trim:!0},placeholder:"请输入6位密码"},null,8,["modelValue"])]),_:1},8,["modelValue"])}}});const _n=Ci("room",()=>{const e=J({}),t=J([]),n=J([]);return{info:e,peoples:t,chatList:n,GET_INFO:async(m,p)=>{var u,o;const g=await bi({id:m}).catch(()=>{typeof p=="function"&&p()});e.value=((u=g==null?void 0:g.data)==null?void 0:u.info)||{},t.value=((o=g==null?void 0:g.data)==null?void 0:o.peoples)||[]},ADD_PEOPLE:m=>{t.value.findIndex(p=>p.id===m.id)===-1&&t.value.push(m)},ADD_CHAT:(...m)=>{n.value.push(...m)},REMOVE_PEOPLE:m=>{t.value=t.value.filter(p=>p.id!==m)}}}),Jo=["😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","😘","😗","😙","😚","😋","😛","😝","😜","🤪","🤨","🧐","🤓","😎","🤩","😏","😒","😞","😔","😟","😕","🙁","😣","😖","😫","😩","😢","😭","😮","💨","😤","😠","😡","🤬","🤯","😳","😱","😨","😰","😥","😓","🤗","🤔","🤭","🤫","🤥","😶","🌫️","😐","😑","😬","🙄","😯","😦","😧","😮","😲","😴","🤤","😪","😵","😵","💫","🤐","🤢","🤮","🤧","😷","🤒","🤕","🤑","🤠","😈","👿","👹","👺","🤡","💩","👻","💀","👽","👾","🤖","🎃","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🐶"];const qo=e=>(Ti("data-v-19e71906"),e=e(),Li(),e),Qo={key:0,class:"unread-dot"},Zo={class:"user-name"},ea={class:"chat-content"},ta=qo(()=>$("div",{class:"chat-textarea-placeholder"},null,-1)),na={class:"chat-textarea"},ra={class:"emoji-container"},ia=["onClick"],sa={name:"ChatButton"},oa=Object.assign(sa,{emits:"enter",setup(e,{emit:t}){const n=J(!1),r=J(""),i=J(),E=J(),S=_n(),{chatList:m}=$t(S),{info:p}=$t(fn());jt(()=>{c()});const g=_=>{if(!_.shiftKey&&_.keyCode===13){if(r.value.trim()==="")return;const v=r.value;r.value="";const f={info:{id:p.value.id,name:p.value.username},time:Date.now(),content:v};S.ADD_CHAT({...f,unread:!1}),t("enter",f),_.preventDefault()}},u=_=>{r.value+=_,E.value.focus()},o=()=>{for(let _=0;_<m.value.length;_++)m.value[_].unread=!1};kt(n,async()=>{n.value&&(await De(),E.value.focus())},{flush:"post"});const s=async()=>{n.value=!0,o(),await De(),c()};kt(m,()=>{c(),n.value&&o()},{flush:"post",deep:!0});const y=pe(()=>{let _=0;if(n.value)return _;for(let v of m.value)v.unread&&_++;return _}),c=async()=>{await De(),i.value&&(i.value.scrollTop=i.value.scrollHeight)};return(_,v)=>{const f=qe,l=un,d=Ri,h=Ut,a=is;return j(),se(we,null,[z(f,{class:"drawer-button",onClick:s},{default:X(()=>[Be(_.$slots,"default",{},void 0,!0),G(y)?(j(),se("span",Qo,"("+_e(G(y))+")",1)):oe("",!0)]),_:3}),z(a,{class:"chat-container","append-to-body":"",size:300,modelValue:n.value,"onUpdate:modelValue":v[1]||(v[1]=x=>n.value=x),title:"聊天室"},{default:X(()=>[$("div",{class:"chat-list",ref_key:"chatListRef",ref:i},[(j(!0),se(we,null,Mt(G(m),x=>(j(),se("div",{class:"chat-item",key:x.info.id+"_"+x.time},[$("div",Zo,_e(x.info.id===G(p).id?"我":x.info.name),1),$("div",ea,_e(x.content),1)]))),128)),ta],512),$("div",na,[z(d,{placement:"top-start",width:250,trigger:"click"},{reference:X(()=>[z(l,{iconName:"expression",iconSize:"30",color:"#999"})]),default:X(()=>[$("div",ra,[(j(!0),se(we,null,Mt(G(Jo),x=>(j(),se("div",{class:"emoji-item",onClick:C=>u(x),key:x},_e(x),9,ia))),128))])]),_:1}),z(h,{ref_key:"contentRef",ref:E,type:"textarea",modelValue:r.value,"onUpdate:modelValue":v[0]||(v[0]=x=>r.value=x),placeholder:"请输入",rows:1,onKeydown:g,resize:"none"},null,8,["modelValue"])])]),_:1},8,["modelValue"])],64)}}}),aa=ot(oa,[["__scopeId","data-v-19e71906"]]);const la={class:"link"},ua={key:0,class:"pwd"},ca={class:"btn-group"},fa={__name:"index",props:{id:{type:String,required:!0}},setup(e){const t=e,n=J(!1),r=location.href,i=J("");Ai({id:t.id}).then(S=>{i.value=S.data});const E=()=>{Oi(`房间链接：${r}`+(i.value?`  房间密码：${i.value}`:"")),Ge.success("复制成功！"),n.value=!1};return(S,m)=>{const p=qe,g=cn;return j(),se(we,null,[z(p,{onClick:m[0]||(m[0]=u=>n.value=!0)},{default:X(()=>[Be(S.$slots,"default",{},void 0,!0)]),_:3}),z(g,{modelValue:n.value,"onUpdate:modelValue":m[1]||(m[1]=u=>n.value=u),width:"500",title:"分享房间"},{default:X(()=>[$("div",la,"房间链接："+_e(G(r)),1),i.value?(j(),se("div",ua,"密码："+_e(i.value),1)):oe("",!0),$("div",ca,[z(p,{type:"primary",onClick:E},{default:X(()=>[ge("复制")]),_:1})])]),_:1},8,["modelValue"])],64)}}},da=ot(fa,[["__scopeId","data-v-54382612"]]),ha={class:"file-name"},pa={class:"notice-group"},_a={__name:"progress",props:{type:{type:Number,default:1},percentage:{type:Number,default:0},name:{type:String,default:""},buffer:{type:Array,default:[]}},setup(e){const t=e,n=()=>{Pi({data:t.buffer,name:t.name})};return(r,i)=>{const E=qe;return j(),se(we,null,[$("div",ha,_e(t.name),1),$("div",pa,[t.percentage.value!=100?(j(),se(we,{key:0},[ge(" 文件"+_e(t.type===1?"发送":"接收")+"中... "+_e(t.percentage)+"% ",1)],64)):(j(),se(we,{key:1},[ge(" 文件"+_e(t.type===1?"发送":"接收")+"成功... ",1)],64)),t.percentage.value==100&&t.type===2?(j(),ue(E,{key:2,onClick:n,type:"primary",link:""},{default:X(()=>[ge(" 下载 ")]),_:1})):oe("",!0)])],64)}}},jn=(e,t)=>{const n=pe(()=>Math.floor(t.value.receiveSize/t.value.maxSize*100));Ps({title:e===1?"发送文件":"接收文件",duration:0,"custom-class":"progress-notice",message:ki(_a,{type:e,percentage:n,name:t.value.name,buffer:t.value.buffer})})},Ye=_n(),Nn=fn();J(null);const Vn=(e,t)=>{const n=JSON.parse(JSON.stringify(e));return n.name=t.name,n.maxSize=t.size,n.receiveSize=0,n.start=!0,n},ma=()=>{const e=pe(()=>Ye.peoples.find(n=>n.id===Nn.info.id)),t=pe(()=>Ye.peoples.filter(n=>n.id!==Nn.info.id));return[e,t]},ga=()=>pe(()=>Ye.info.name?Ye.info.name+" ("+Ye.peoples.length+(Ye.info.max?"/"+Ye.info.max:"")+")":""),va=async()=>{let e=null;try{const t={video:{width:{min:720},height:{min:480},frameRate:{ideal:30,max:60}},audio:{noiseSuppression:!0,echoCancellation:!0}};return navigator.mediaDevices.getUserMedia?e=await navigator.mediaDevices.getUserMedia(t):navigator.webkitGetUserMedia?e=await navigator.webkitGetUserMedia(t):navigator.mozGetUserMedia?e=await navagator.mozGetUserMedia(t):navigator.getUserMedia?e=await navigator.getUserMedia(t):Ge.warning("你的浏览器不支持访问用户媒体设备！"),e.getTracks().forEach(n=>{n.enabled=!1}),Promise.resolve(e)}catch{return Ge.warning("没打开摄像头和语音权限！"),Promise.reject()}},ya=e=>{const t=J(e);return[t,r=>t.value=r]},Ea=async e=>{try{const t=await navigator.mediaDevices.getDisplayMedia({video:{width:1920,height:1080}});return t.oninactive=e,t}catch{console.log("取消投屏！")}},Gn=()=>{const e=Ot(new Map);return{list:e,set:(i,E)=>e.set(i,E),get:(i,E)=>{const S=e.get(i);S&&typeof E=="function"&&E(S)},del:i=>e.delete(i)}};const xa={key:0,class:"container"},Sa={class:"live-name"},Ca={key:0,class:"video-main"},ba={class:"people-video-group"},Ra={class:"people-video"},Ta={key:1,class:"video-metting-main"},La={class:"screen-video"},Aa={class:"people-video-group"},Oa={class:"people-video"},Pa={class:"btn-group"},ka={key:0,class:"btn-group-public"},Da={class:"btn-group-right"},Ia={name:"Room"},Ma=Object.assign(Ia,{setup(e){const t=Di(),n=Ii(),r=_n(),i=fn(),{info:E}=$t(r),S=t.query.id,m=ga();let p=!1,g=null;const u=J(),o=J(),s=J(),y=J(),c=J(),_=J(),v=J(!1),f=J(!1),l=J(!1),d=Gn(),h=Gn(),a=Ot(new Map),[x,C]=ya(1),b=J(!1),L=Ot({video:2,audio:2}),[O,A]=ma();let R=J(null),T=J(null);const P={start:!1,maxSize:0,receiveSize:0,name:"",buffer:[]},k=J(P),D=J(P);let M=[];const q=()=>{le.on("initSuccessed",()=>{le.emit("join")}),le.on("joined",async function(N){let w=JSON.parse(N.info);if(r.ADD_PEOPLE(w),i.info.id!==w.id){const U=Re("video",w.id);d.set(w.id,U),U.addTrack(R.value),U.createOffer(V=>{le.emit("offer",{offer:V,type:"video",to:w.id,from:i.info.id})})}if(T.value){const U=Re("display",w.id);h.set(w.id,U),U.addTrack(T.value),U.createOffer(V=>{le.emit("offer",{offer:V,type:"display",to:w.id,from:i.info.id})})}}),le.on("leave",function(N){N.id===E.user_id&&(g=null),d.del(N.id),h.del(N.id),a.delete(N.id),r.REMOVE_PEOPLE(N.id),s.value.forEach(w=>{w.id===N.id&&w.setStream(null)})}),le.on("offer",function({offer:N,type:w,from:U}){w==="video"?d.get(U,V=>{V.addTrack(R.value),V.setRemoteDescription(N),V.createAnswer(Ce=>{le.emit("answer",{answer:Ce,type:w,to:U,from:i.info.id})})}):(g=Re(w,U),g.setRemoteDescription(N),g.createAnswer(V=>{le.emit("answer",{answer:V,type:w,to:U,from:i.info.id})}))}),le.on("answer",function({answer:N,type:w,from:U}){w==="video"?d.get(U,V=>{V.setRemoteDescription(N)}):h.get(U,V=>{V.setRemoteDescription(N)})}),le.on("candidate",({candidate:N,type:w,from:U})=>{w==="video"?d.get(U,V=>{V.setCandidate(N)}):g?g.setCandidate(N):h.get(U,V=>{V.setCandidate(N)})}),le.on("noLogin",()=>{i.SET_TOKEN(""),i.SET_LOGIN(!0,1)}),le.on("fulled",()=>{f.value=!0,He.alert("当前房间已经满人！").then(()=>{n.go(-1)}),le.close(),le.disconnect()}),le.on("closed",()=>{p=!0,He.alert("当前房间已经关闭！").then(()=>{n.replace("/"),i.SET_ROOM("")})}),le.on("rejectConn",()=>{He.alert("对方拒绝了你的连接申请！")}),le.on("typeChange",async N=>{C(N),await De(),Ue(),T.value&&u.value.setStream(T.value,!1,!0)}),le.on("displayMediaEnd",async()=>{u.value.setStream(null,!0,!1),C(1),await De(),await Pe(1)})},Q=async()=>{(await wi({id:S})).data?(f.value=!0,He.alert("已在其他页面打开，请不要重复打开！","温馨提醒").then(()=>{n.go(-1)})):(va().then(w=>{R.value=w}),o.value.setStream(R.value,!0),await Eo({query:{id:S}}),q())},H=()=>{le.disconnect(),le.close()},te=N=>{N&&N.getTracks().forEach(w=>{w.stop()})},ce=async()=>{C(r.info.type),r.peoples.forEach(N=>{const w=Re("video",N.id);d.set(N.id,w)}),await Q(),l.value=!!E.value.is_public},Y=()=>{ce()},re=()=>{n.go(-1),p=!0},Ae=N=>{d.list.forEach(w=>{var U;(U=w.dataChannel)==null||U.send(JSON.stringify({type:"chat",data:N}))})},ae=(N,w)=>{let U=null;switch(N){case 1:U=R.value;break;case 2:U=a.get(w);break}b.value=!0,u.value.setStream(U)},fe=()=>{u.value.setStream(T.value),b.value=!1};jt(async()=>{if(i.token){await r.GET_INFO(S,()=>{p=!0,f.value=!0,n.push("/")});const{data:N}=await Mi({id:S});N?c.value.show():ce()}}),Bi(async(N,w,U)=>{try{p||!i.token?(H(),te(R.value),U()):(await He.confirm("此操作将会退出当前房间！","温馨提醒").then(()=>{H(),te(R.value)}),U())}catch{U(!1)}});const Le=()=>{y.value.show()},me=async(N,w)=>{d.list.forEach(async U=>{U.conn.getSenders().forEach(V=>{V.tarck&&V.track.kind===N&&(V.track.enabled=w)})}),R.value&&R.value.getTracks().forEach(U=>{U.kind===N&&(U.enabled=w)})},Se=({state:N,type:w})=>{try{if(!R.value)return;N===2?(me(w,!0),o.value.setStream(R.value,!0),L[w]=1):(me(w,!1),L[w]=2)}catch(U){console.log("error：",U)}},Re=(N,w)=>new Po({async onTarck(U){const[V]=U.streams;if(N==="video"){let Ce=s.value.find(be=>be.id==w);Ce&&Ce.setStream(V,!1),a.set(w,V)}else u.value?u.value.setStream(V,!1,!0):T.value=V},onCandidate(U){U&&le.emit("candidate",{candidate:U,type:N,to:w,from:i.info.id})},onMessage(U){let V=U.data;typeof V=="string"?(V=JSON.parse(V),V.type==="file-start"?(k.value=Vn(k.value,{size:V.size,name:V.name}),jn(2,k)):V.type==="file-end"?k.value.start=!1:V.type==="chat"&&r.ADD_CHAT({...V.data,unread:!0})):(k.value.receiveSize+=V.size,k.value.buffer.push(V))}}),de=async N=>{await En({is_public:N?1:0,id:S})},W=()=>{He.confirm("确认关闭房间？").then(()=>{le.emit("closeHouse")})},Te=()=>{d.list.size?D.value.start?Ge.warning("正在分享中..."):_.value.click():Ge.warning("当前房间不存在其他人...")},Oe=N=>{const w=N.target.files[0];if(w){const U=new FileReader;let V=1024,Ce=Math.ceil(w.size/V),be=1;const $e=()=>{U.readAsArrayBuffer(w.slice((be-1)*V,be*V)),be++};U.onload=()=>{M.forEach(ye=>{d.get(ye,xe=>{var he;(he=xe.dataChannel)==null||he.send(U.result)})}),D.value.receiveSize+=U.result.byteLength,be<=Ce?$e():(M.forEach(ye=>{d.get(ye,xe=>{var he;(he=xe.dataChannel)==null||he.send(JSON.stringify({type:"file-end",size:w.size,name:w.name}))})}),D.value.start=!1)},M=[...d.list.keys()],M.forEach(ye=>{d.get(ye,xe=>{var he;(he=xe.dataChannel)==null||he.send(JSON.stringify({type:"file-start",size:w.size,name:w.name}))})}),D.value=Vn(D.value,{size:w.size,name:w.name}),jn(1,D),$e()}},Ue=async()=>{var N;await De(),o.value.setStream(R.value),(N=s==null?void 0:s.value)==null||N.forEach(w=>{const U=a.get(w.id);U&&w.setStream(U)})},Pe=async N=>{En({id:S,type:N}).then(()=>{E.user_id!==(O==null?void 0:O.id)&&(T.value=null),le.emit("typeChange",N),Ue()})},je=async()=>{T.value?te(T.value):Ea(()=>{le.emit("displayMediaEnd"),T.value=null,h.list.clear()}).then(async w=>{w&&(T.value=w,C(2),await De(),await Pe(2),u.value.setStream(w,!1,!0),r.peoples.forEach(U=>{h.set(U.id,Re("display",U.id))}),h.list.forEach((U,V)=>{U.addTrack(w),U.createOffer(Ce=>{le.emit("offer",{offer:Ce,type:"display",to:V,from:i.info.id})})}))})};return(N,w)=>{var $e;const U=Me("ArrowLeft"),V=Je,Ce=Fi,be=qe;return j(),se(we,null,[f.value?oe("",!0):(j(),se("div",xa,[$("div",Sa,_e(G(m)),1),G(x)===1?(j(),se("div",Ca,[$("div",ba,[$("div",Ra,[z(ct,{ref_key:"videoRef",ref:o},null,512),G(O)?(j(),ue(vt,{key:0,homeowner:G(E).homeowner,name:($e=G(O))==null?void 0:$e.username},null,8,["homeowner","name"])):oe("",!0),z(Un,{state:L,onControl:Se},null,8,["state"])]),(j(!0),se(we,null,Mt(G(A),ye=>(j(),se("div",{class:"people-video",key:ye.id},[z(vt,{homeowner:G(E).homeowner,name:ye==null?void 0:ye.username},null,8,["homeowner","name"]),z(ct,{id:ye.id,ref_for:!0,ref_key:"remoteVideoRef",ref:s},null,8,["id"])]))),128))])])):oe("",!0),G(x)===2?(j(),se("div",Ta,[$("div",La,[z(ct,{ref_key:"mainVideoRef",ref:u},{default:X(()=>{var ye;return[ze($("div",{class:ee(["back-main",{move:v.value}]),onClick:fe},[z(V,{size:"16"},{default:X(()=>[z(U)]),_:1}),ge(" 返回投屏 ")],2),[[We,b.value]]),$("div",{class:ee(["people-video-box",{collapse:v.value}])},[$("div",{class:"people-video-slider",onClick:w[0]||(w[0]=xe=>v.value=!v.value)},[z(V,{size:20,color:"rgba(255, 255, 255, 0.5)"},{default:X(()=>[(j(),ue(tt(v.value?"DArrowRight":"DArrowLeft")))]),_:1})]),$("div",Aa,[$("div",Oa,[z(ct,{abbr:G(R),ref_key:"videoRef",ref:o,onFull:w[1]||(w[1]=xe=>ae(1))},null,8,["abbr"]),G(O)?(j(),ue(vt,{key:0,homeowner:G(E).homeowner,name:(ye=G(O))==null?void 0:ye.username},null,8,["homeowner","name"])):oe("",!0),z(Un,{state:L,onControl:Se},null,8,["state"])]),(j(!0),se(we,null,Mt(G(A),xe=>(j(),se("div",{class:"people-video",key:xe.id},[z(vt,{homeowner:G(E).homeowner,name:xe==null?void 0:xe.username},null,8,["homeowner","name"]),z(ct,{abbr:a.get(xe.id),id:xe.id,ref_for:!0,ref_key:"remoteVideoRef",ref:s,onFull:he=>ae(2,xe.id)},null,8,["abbr","id","onFull"])]))),128))])],2)]}),_:1},512)])])):oe("",!0),$("div",Pa,[G(E).homeowner?(j(),se("div",ka,[ge(" 公开 "),z(Ce,{modelValue:l.value,"onUpdate:modelValue":w[2]||(w[2]=ye=>l.value=ye),onChange:de},null,8,["modelValue"])])):oe("",!0),G(E).homeowner?(j(),ue(be,{key:1,onClick:Le},{default:X(()=>[ge(" 设置密码 ")]),_:1})):oe("",!0),G(E).homeowner?(j(),ue(be,{key:2,onClick:je},{default:X(()=>[ge(_e(G(T)?"停止共享":"共享屏幕"),1)]),_:1})):oe("",!0),$("div",Da,[z(be,{onClick:Te},{default:X(()=>[ge(" 分享文件 ")]),_:1}),G(E).homeowner?(j(),ue(da,{key:0,id:G(S)},{default:X(()=>[ge(" 分享房间 ")]),_:1},8,["id"])):oe("",!0),z(aa,{onEnter:Ae},{default:X(()=>[ge("聊天室")]),_:1}),G(E).homeowner?(j(),ue(be,{key:1,onClick:W},{default:X(()=>[ge(" 关闭房间 ")]),_:1})):oe("",!0)])])])),z($o,{ref_key:"setRoomPassDialogRef",ref:y,id:G(S)},null,8,["id"]),z(Xo,{ref_key:"enterRoomPassDialogRef",ref:c,id:G(S),onOnTrue:Y,onOnCancel:re},null,8,["id"]),ze($("input",{type:"file",ref_key:"fileRef",ref:_,onChange:Oe},null,544),[[We,!1]])],64)}}}),wa=ot(Ma,[["__scopeId","data-v-ade00d14"]]);export{wa as default};

var Wn=Object.defineProperty;var zn=(t,e,n)=>e in t?Wn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Mt=(t,e,n)=>(zn(t,typeof e!="symbol"?e+"":e,n),n);import{D as we,G as gt,f as Ht,H as Hn,d as ze,I as $n,u as $t,h as ge,o as K,c as se,b as W,r as Pe,n as te,e as G,y as _e,v as X,j as z,J as Ft,K as We,L as Ye,l as ue,k as Ze,T as ft,_ as ct,w as vn,M as gn,N as Yn,O as Xn,P as Jn,Q as yn,R as En,S as Zt,s as ee,g as qn,i as Qn,U as Zn,V as De,W as je,t as pe,X as Ve,Y as er,A as tt,E as Tt,Z as tr,$ as nr,a0 as xn,a1 as yt,a2 as Rt,a as en,a3 as At,a4 as rr,a5 as It,a6 as ir,a7 as sr,a8 as or,a9 as ar,aa as ot,ab as pt,B as me,ac as bn,ad as Yt,ae as ut,af as Lt,ag as tn,ah as lr,ai as ur,aj as nn,ak as Ct,al as dr,am as Bt,an as fr,F as ke,ao as cr,ap as hr,aq as _r,ar as pr,m as Xt,as as mr,at as Jt,z as Qe,C as lt,au as Sn,av as vr,aw as Ut,p as Rn,x as Ot,ax as gr,ay as yr,az as Er,aA as xr,aB as br,q as Sr,aC as Rr,aD as Ar}from"./index-6e3ebc85.js";const Lr='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',Cr=t=>getComputedStyle(t).position==="fixed"?!1:t.offsetParent!==null,rn=t=>Array.from(t.querySelectorAll(Lr)).filter(e=>Or(e)&&Cr(e)),Or=t=>{if(t.tabIndex>0||t.tabIndex===0&&t.getAttribute("tabIndex")!==null)return!0;if(t.disabled)return!1;switch(t.nodeName){case"A":return!!t.href&&t.rel!=="ignore";case"INPUT":return!(t.type==="hidden"||t.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},Nt="_trap-focus-children",$e=[],sn=t=>{if($e.length===0)return;const e=$e[$e.length-1][Nt];if(e.length>0&&t.code===gt.tab){if(e.length===1){t.preventDefault(),document.activeElement!==e[0]&&e[0].focus();return}const n=t.shiftKey,a=t.target===e[0],S=t.target===e[e.length-1];a&&n&&(t.preventDefault(),e[e.length-1].focus()),S&&!n&&(t.preventDefault(),e[0].focus())}},wr={beforeMount(t){t[Nt]=rn(t),$e.push(t),$e.length<=1&&document.addEventListener("keydown",sn)},updated(t){we(()=>{t[Nt]=rn(t)})},unmounted(){$e.shift(),$e.length===0&&document.removeEventListener("keydown",sn)}},Tr=Ht({type:{type:String,values:["success","info","warning","danger",""],default:""},closable:Boolean,disableTransitions:Boolean,hit:Boolean,color:{type:String,default:""},size:{type:String,values:Hn,default:""},effect:{type:String,values:["dark","light","plain"],default:"light"},round:Boolean}),Ir={close:t=>t instanceof MouseEvent,click:t=>t instanceof MouseEvent},Dr=ze({name:"ElTag"}),Pr=ze({...Dr,props:Tr,emits:Ir,setup(t,{emit:e}){const n=t,a=$n(),S=$t("tag"),T=ge(()=>{const{type:v,hit:y,effect:m,closable:c,round:o}=n;return[S.b(),S.is("closable",c),S.m(v),S.m(a.value),S.m(m),S.is("hit",y),S.is("round",o)]}),O=v=>{e("close",v)},b=v=>{e("click",v)};return(v,y)=>v.disableTransitions?(K(),se("span",{key:0,class:te(G(T)),style:Ze({backgroundColor:v.color}),onClick:b},[W("span",{class:te(G(S).e("content"))},[Pe(v.$slots,"default")],2),v.closable?(K(),_e(G(Ye),{key:0,class:te(G(S).e("close")),onClick:We(O,["stop"])},{default:X(()=>[z(G(Ft))]),_:1},8,["class","onClick"])):ue("v-if",!0)],6)):(K(),_e(ft,{key:1,name:`${G(S).namespace.value}-zoom-in-center`,appear:""},{default:X(()=>[W("span",{class:te(G(T)),style:Ze({backgroundColor:v.color}),onClick:b},[W("span",{class:te(G(S).e("content"))},[Pe(v.$slots,"default")],2),v.closable?(K(),_e(G(Ye),{key:0,class:te(G(S).e("close")),onClick:We(O,["stop"])},{default:X(()=>[z(G(Ft))]),_:1},8,["class","onClick"])):ue("v-if",!0)],6)]),_:3},8,["name"]))}});var kr=ct(Pr,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tag/src/tag.vue"]]);const Mr=vn(kr),Br=ze({name:"ElCollapseTransition"}),Fr=ze({...Br,setup(t){const e=$t("collapse-transition"),n={beforeEnter(a){a.dataset||(a.dataset={}),a.dataset.oldPaddingTop=a.style.paddingTop,a.dataset.oldPaddingBottom=a.style.paddingBottom,a.style.maxHeight=0,a.style.paddingTop=0,a.style.paddingBottom=0},enter(a){a.dataset.oldOverflow=a.style.overflow,a.scrollHeight!==0?(a.style.maxHeight=`${a.scrollHeight}px`,a.style.paddingTop=a.dataset.oldPaddingTop,a.style.paddingBottom=a.dataset.oldPaddingBottom):(a.style.maxHeight=0,a.style.paddingTop=a.dataset.oldPaddingTop,a.style.paddingBottom=a.dataset.oldPaddingBottom),a.style.overflow="hidden"},afterEnter(a){a.style.maxHeight="",a.style.overflow=a.dataset.oldOverflow},beforeLeave(a){a.dataset||(a.dataset={}),a.dataset.oldPaddingTop=a.style.paddingTop,a.dataset.oldPaddingBottom=a.style.paddingBottom,a.dataset.oldOverflow=a.style.overflow,a.style.maxHeight=`${a.scrollHeight}px`,a.style.overflow="hidden"},leave(a){a.scrollHeight!==0&&(a.style.maxHeight=0,a.style.paddingTop=0,a.style.paddingBottom=0)},afterLeave(a){a.style.maxHeight="",a.style.overflow=a.dataset.oldOverflow,a.style.paddingTop=a.dataset.oldPaddingTop,a.style.paddingBottom=a.dataset.oldPaddingBottom}};return(a,S)=>(K(),_e(ft,gn({name:G(e).b()},Yn(n)),{default:X(()=>[Pe(a.$slots,"default")]),_:3},16,["name"]))}});var Et=ct(Fr,[["__file","/home/runner/work/element-plus/element-plus/packages/components/collapse-transition/src/collapse-transition.vue"]]);Et.install=t=>{t.component(Et.name,Et)};const Ur=Et,Nr=Ur,jr=Ht({...Xn,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0}}),Vr=Jn,Kr=ze({name:"ElDrawer",components:{ElOverlay:yn,ElFocusTrap:En,ElIcon:Ye,Close:Ft},inheritAttrs:!1,props:jr,emits:Vr,setup(t,{slots:e}){Zt({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},ge(()=>!!e.title)),Zt({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},ge(()=>!!t.customClass));const n=ee(),a=ee(),S=$t("drawer"),{t:T}=qn(),O=ge(()=>t.direction==="rtl"||t.direction==="ltr"),b=ge(()=>Qn(t.size));return{...Zn(t,n),drawerRef:n,focusStartRef:a,isHorizontal:O,drawerSize:b,ns:S,t:T}}}),Gr=["aria-label","aria-labelledby","aria-describedby"],Wr=["id"],zr=["aria-label"],Hr=["id"];function $r(t,e,n,a,S,T){const O=De("close"),b=De("el-icon"),v=De("el-focus-trap"),y=De("el-overlay");return K(),_e(er,{to:"body",disabled:!t.appendToBody},[z(ft,{name:t.ns.b("fade"),onAfterEnter:t.afterEnter,onAfterLeave:t.afterLeave,onBeforeLeave:t.beforeLeave,persisted:""},{default:X(()=>[je(z(y,{mask:t.modal,"overlay-class":t.modalClass,"z-index":t.zIndex,onClick:t.onModalClick},{default:X(()=>[z(v,{loop:"",trapped:t.visible,"focus-trap-el":t.drawerRef,"focus-start-el":t.focusStartRef,onReleaseRequested:t.onCloseRequested},{default:X(()=>[W("div",gn({ref:"drawerRef","aria-modal":"true","aria-label":t.title||void 0,"aria-labelledby":t.title?void 0:t.titleId,"aria-describedby":t.bodyId},t.$attrs,{class:[t.ns.b(),t.direction,t.visible&&"open",t.customClass],style:t.isHorizontal?"width: "+t.drawerSize:"height: "+t.drawerSize,role:"dialog",onClick:e[1]||(e[1]=We(()=>{},["stop"]))}),[W("span",{ref:"focusStartRef",class:te(t.ns.e("sr-focus")),tabindex:"-1"},null,2),t.withHeader?(K(),se("header",{key:0,class:te(t.ns.e("header"))},[t.$slots.title?Pe(t.$slots,"title",{key:1},()=>[ue(" DEPRECATED SLOT ")]):Pe(t.$slots,"header",{key:0,close:t.handleClose,titleId:t.titleId,titleClass:t.ns.e("title")},()=>[t.$slots.title?ue("v-if",!0):(K(),se("span",{key:0,id:t.titleId,role:"heading",class:te(t.ns.e("title"))},pe(t.title),11,Wr))]),t.showClose?(K(),se("button",{key:2,"aria-label":t.t("el.drawer.close"),class:te(t.ns.e("close-btn")),type:"button",onClick:e[0]||(e[0]=(...m)=>t.handleClose&&t.handleClose(...m))},[z(b,{class:te(t.ns.e("close"))},{default:X(()=>[z(O)]),_:1},8,["class"])],10,zr)):ue("v-if",!0)],2)):ue("v-if",!0),t.rendered?(K(),se("div",{key:1,id:t.bodyId,class:te(t.ns.e("body"))},[Pe(t.$slots,"default")],10,Hr)):ue("v-if",!0),t.$slots.footer?(K(),se("div",{key:2,class:te(t.ns.e("footer"))},[Pe(t.$slots,"footer")],2)):ue("v-if",!0)],16,Gr)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[Ve,t.visible]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}var Yr=ct(Kr,[["render",$r],["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const Xr=vn(Yr),Jr=ze({name:"ElMessageBox",directives:{TrapFocus:wr},components:{ElButton:tt,ElFocusTrap:En,ElInput:Tt,ElOverlay:yn,ElIcon:Ye,...tr},inheritAttrs:!1,props:{buttonSize:{type:String,validator:nr},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,roundButton:{default:!1,type:Boolean},container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(t,{emit:e}){const{locale:n,zIndex:a,ns:S,size:T}=xn("message-box",ge(()=>t.buttonSize)),{t:O}=n,{nextZIndex:b}=a,v=ee(!1),y=yt({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:null,inputValidator:null,inputErrorMessage:"",message:null,modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:b()}),m=ge(()=>{const I=y.type;return{[S.bm("icon",I)]:I&&Rt[I]}}),c=en(),o=en(),p=ge(()=>y.icon||Rt[y.type]||""),l=ge(()=>!!y.message),f=ee(),h=ee(),s=ee(),i=ee(),d=ee(),u=ge(()=>y.confirmButtonClass);At(()=>y.inputValue,async I=>{await we(),t.boxType==="prompt"&&I!==null&&C()},{immediate:!0}),At(()=>v.value,I=>{var P,M;I&&(t.boxType!=="prompt"&&(y.autofocus?s.value=(M=(P=d.value)==null?void 0:P.$el)!=null?M:f.value:s.value=f.value),y.zIndex=b()),t.boxType==="prompt"&&(I?we().then(()=>{var J;i.value&&i.value.$el&&(y.autofocus?s.value=(J=x())!=null?J:f.value:s.value=f.value)}):(y.editorErrorMessage="",y.validateError=!1))});const r=ge(()=>t.draggable);rr(f,h,r),It(async()=>{await we(),t.closeOnHashChange&&window.addEventListener("hashchange",_)}),ir(()=>{t.closeOnHashChange&&window.removeEventListener("hashchange",_)});function _(){v.value&&(v.value=!1,we(()=>{y.action&&e("action",y.action)}))}const g=()=>{t.closeOnClickModal&&R(y.distinguishCancelAndClose?"close":"cancel")},E=ar(g),L=I=>{if(y.inputType!=="textarea")return I.preventDefault(),R("confirm")},R=I=>{var P;t.boxType==="prompt"&&I==="confirm"&&!C()||(y.action=I,y.beforeClose?(P=y.beforeClose)==null||P.call(y,I,y,_):_())},C=()=>{if(t.boxType==="prompt"){const I=y.inputPattern;if(I&&!I.test(y.inputValue||""))return y.editorErrorMessage=y.inputErrorMessage||O("el.messagebox.error"),y.validateError=!0,!1;const P=y.inputValidator;if(typeof P=="function"){const M=P(y.inputValue);if(M===!1)return y.editorErrorMessage=y.inputErrorMessage||O("el.messagebox.error"),y.validateError=!0,!1;if(typeof M=="string")return y.editorErrorMessage=M,y.validateError=!0,!1}}return y.editorErrorMessage="",y.validateError=!1,!0},x=()=>{const I=i.value.$refs;return I.input||I.textarea},A=()=>{R("close")},w=()=>{t.closeOnPressEscape&&A()};return t.lockScroll&&sr(v),{...or(y),ns:S,overlayEvent:E,visible:v,hasMessage:l,typeClass:m,contentId:c,inputId:o,btnSize:T,iconComponent:p,confirmButtonClasses:u,rootRef:f,focusStartRef:s,headerRef:h,inputRef:i,confirmRef:d,doClose:_,handleClose:A,onCloseRequested:w,handleWrapperClick:g,handleInputEnter:L,handleAction:R,t:O}}}),qr=["aria-label","aria-describedby"],Qr=["aria-label"],Zr=["id"];function ei(t,e,n,a,S,T){const O=De("el-icon"),b=De("close"),v=De("el-input"),y=De("el-button"),m=De("el-focus-trap"),c=De("el-overlay");return K(),_e(ft,{name:"fade-in-linear",onAfterLeave:e[11]||(e[11]=o=>t.$emit("vanish")),persisted:""},{default:X(()=>[je(z(c,{"z-index":t.zIndex,"overlay-class":[t.ns.is("message-box"),t.modalClass],mask:t.modal},{default:X(()=>[W("div",{role:"dialog","aria-label":t.title,"aria-modal":"true","aria-describedby":t.showInput?void 0:t.contentId,class:te(`${t.ns.namespace.value}-overlay-message-box`),onClick:e[8]||(e[8]=(...o)=>t.overlayEvent.onClick&&t.overlayEvent.onClick(...o)),onMousedown:e[9]||(e[9]=(...o)=>t.overlayEvent.onMousedown&&t.overlayEvent.onMousedown(...o)),onMouseup:e[10]||(e[10]=(...o)=>t.overlayEvent.onMouseup&&t.overlayEvent.onMouseup(...o))},[z(m,{loop:"",trapped:t.visible,"focus-trap-el":t.rootRef,"focus-start-el":t.focusStartRef,onReleaseRequested:t.onCloseRequested},{default:X(()=>[W("div",{ref:"rootRef",class:te([t.ns.b(),t.customClass,t.ns.is("draggable",t.draggable),{[t.ns.m("center")]:t.center}]),style:Ze(t.customStyle),tabindex:"-1",onClick:e[7]||(e[7]=We(()=>{},["stop"]))},[t.title!==null&&t.title!==void 0?(K(),se("div",{key:0,ref:"headerRef",class:te(t.ns.e("header"))},[W("div",{class:te(t.ns.e("title"))},[t.iconComponent&&t.center?(K(),_e(O,{key:0,class:te([t.ns.e("status"),t.typeClass])},{default:X(()=>[(K(),_e(ot(t.iconComponent)))]),_:1},8,["class"])):ue("v-if",!0),W("span",null,pe(t.title),1)],2),t.showClose?(K(),se("button",{key:0,type:"button",class:te(t.ns.e("headerbtn")),"aria-label":t.t("el.messagebox.close"),onClick:e[0]||(e[0]=o=>t.handleAction(t.distinguishCancelAndClose?"close":"cancel")),onKeydown:e[1]||(e[1]=pt(We(o=>t.handleAction(t.distinguishCancelAndClose?"close":"cancel"),["prevent"]),["enter"]))},[z(O,{class:te(t.ns.e("close"))},{default:X(()=>[z(b)]),_:1},8,["class"])],42,Qr)):ue("v-if",!0)],2)):ue("v-if",!0),W("div",{id:t.contentId,class:te(t.ns.e("content"))},[W("div",{class:te(t.ns.e("container"))},[t.iconComponent&&!t.center&&t.hasMessage?(K(),_e(O,{key:0,class:te([t.ns.e("status"),t.typeClass])},{default:X(()=>[(K(),_e(ot(t.iconComponent)))]),_:1},8,["class"])):ue("v-if",!0),t.hasMessage?(K(),se("div",{key:1,class:te(t.ns.e("message"))},[Pe(t.$slots,"default",{},()=>[t.dangerouslyUseHTMLString?(K(),_e(ot(t.showInput?"label":"p"),{key:1,for:t.showInput?t.inputId:void 0,innerHTML:t.message},null,8,["for","innerHTML"])):(K(),_e(ot(t.showInput?"label":"p"),{key:0,for:t.showInput?t.inputId:void 0},{default:X(()=>[me(pe(t.dangerouslyUseHTMLString?"":t.message),1)]),_:1},8,["for"]))])],2)):ue("v-if",!0)],2),je(W("div",{class:te(t.ns.e("input"))},[z(v,{id:t.inputId,ref:"inputRef",modelValue:t.inputValue,"onUpdate:modelValue":e[2]||(e[2]=o=>t.inputValue=o),type:t.inputType,placeholder:t.inputPlaceholder,"aria-invalid":t.validateError,class:te({invalid:t.validateError}),onKeydown:pt(t.handleInputEnter,["enter"])},null,8,["id","modelValue","type","placeholder","aria-invalid","class","onKeydown"]),W("div",{class:te(t.ns.e("errormsg")),style:Ze({visibility:t.editorErrorMessage?"visible":"hidden"})},pe(t.editorErrorMessage),7)],2),[[Ve,t.showInput]])],10,Zr),W("div",{class:te(t.ns.e("btns"))},[t.showCancelButton?(K(),_e(y,{key:0,loading:t.cancelButtonLoading,class:te([t.cancelButtonClass]),round:t.roundButton,size:t.btnSize,onClick:e[3]||(e[3]=o=>t.handleAction("cancel")),onKeydown:e[4]||(e[4]=pt(We(o=>t.handleAction("cancel"),["prevent"]),["enter"]))},{default:X(()=>[me(pe(t.cancelButtonText||t.t("el.messagebox.cancel")),1)]),_:1},8,["loading","class","round","size"])):ue("v-if",!0),je(z(y,{ref:"confirmRef",type:"primary",loading:t.confirmButtonLoading,class:te([t.confirmButtonClasses]),round:t.roundButton,disabled:t.confirmButtonDisabled,size:t.btnSize,onClick:e[5]||(e[5]=o=>t.handleAction("confirm")),onKeydown:e[6]||(e[6]=pt(We(o=>t.handleAction("confirm"),["prevent"]),["enter"]))},{default:X(()=>[me(pe(t.confirmButtonText||t.t("el.messagebox.confirm")),1)]),_:1},8,["loading","class","round","disabled","size"]),[[Ve,t.showConfirmButton]])],2)],6)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,qr)]),_:3},8,["z-index","overlay-class","mask"]),[[Ve,t.visible]])]),_:3})}var ti=ct(Jr,[["render",ei],["__file","/home/runner/work/element-plus/element-plus/packages/components/message-box/src/index.vue"]]);const dt=new Map,ni=t=>{let e=document.body;return t.appendTo&&(Yt(t.appendTo)&&(e=document.querySelector(t.appendTo)),Ct(t.appendTo)&&(e=t.appendTo),Ct(e)||(e=document.body)),e},ri=(t,e,n=null)=>{const a=z(ti,t,nn(t.message)||ut(t.message)?{default:nn(t.message)?t.message:()=>t.message}:null);return a.appContext=n,Lt(a,e),ni(t).appendChild(e.firstElementChild),a.component},ii=()=>document.createElement("div"),si=(t,e)=>{const n=ii();t.onVanish=()=>{Lt(null,n),dt.delete(S)},t.onAction=T=>{const O=dt.get(S);let b;t.showInput?b={value:S.inputValue,action:T}:b=T,t.callback?t.callback(b,a.proxy):T==="cancel"||T==="close"?t.distinguishCancelAndClose&&T!=="cancel"?O.reject("close"):O.reject("cancel"):O.resolve(b)};const a=ri(t,n,e),S=a.proxy;for(const T in t)tn(t,T)&&!tn(S.$props,T)&&(S[T]=t[T]);return S.visible=!0,S};function nt(t,e=null){if(!bn)return Promise.reject();let n;return Yt(t)||ut(t)?t={message:t}:n=t.callback,new Promise((a,S)=>{const T=si(t,e??nt._context);dt.set(T,{options:t,callback:n,resolve:a,reject:S})})}const oi=["alert","confirm","prompt"],ai={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};oi.forEach(t=>{nt[t]=li(t)});function li(t){return(e,n,a,S)=>{let T="";return lr(n)?(a=n,T=""):ur(n)?T="":T=n,nt(Object.assign({title:T,message:e,type:"",...ai[t]},a,{boxType:t}),S)}}nt.close=()=>{dt.forEach((t,e)=>{e.doClose()}),dt.clear()};nt._context=null;const Ge=nt;Ge.install=t=>{Ge._context=t._context,t.config.globalProperties.$msgbox=Ge,t.config.globalProperties.$messageBox=Ge,t.config.globalProperties.$alert=Ge.alert,t.config.globalProperties.$confirm=Ge.confirm,t.config.globalProperties.$prompt=Ge.prompt};const He=Ge,An=["success","info","warning","error"],ui=Ht({customClass:{type:String,default:""},dangerouslyUseHTMLString:{type:Boolean,default:!1},duration:{type:Number,default:4500},icon:{type:dr},id:{type:String,default:""},message:{type:Bt([String,Object]),default:""},offset:{type:Number,default:0},onClick:{type:Bt(Function),default:()=>{}},onClose:{type:Bt(Function),required:!0},position:{type:String,values:["top-right","top-left","bottom-right","bottom-left"],default:"top-right"},showClose:{type:Boolean,default:!0},title:{type:String,default:""},type:{type:String,values:[...An,""],default:""},zIndex:Number}),di={destroy:()=>!0},fi=["id"],ci=["textContent"],hi={key:0},_i=["innerHTML"],pi=ze({name:"ElNotification"}),mi=ze({...pi,props:ui,emits:di,setup(t,{expose:e}){const n=t,{ns:a,zIndex:S}=xn("notification"),{nextZIndex:T,currentZIndex:O}=S,{Close:b}=cr,v=ee(!1);let y;const m=ge(()=>{const d=n.type;return d&&Rt[n.type]?a.m(d):""}),c=ge(()=>n.type&&Rt[n.type]||n.icon),o=ge(()=>n.position.endsWith("right")?"right":"left"),p=ge(()=>n.position.startsWith("top")?"top":"bottom"),l=ge(()=>{var d;return{[p.value]:`${n.offset}px`,zIndex:(d=n.zIndex)!=null?d:O.value}});function f(){n.duration>0&&({stop:y}=hr(()=>{v.value&&s()},n.duration))}function h(){y==null||y()}function s(){v.value=!1}function i({code:d}){d===gt.delete||d===gt.backspace?h():d===gt.esc?v.value&&s():f()}return It(()=>{f(),T(),v.value=!0}),fr(document,"keydown",i),e({visible:v,close:s}),(d,u)=>(K(),_e(ft,{name:G(a).b("fade"),onBeforeLeave:d.onClose,onAfterLeave:u[1]||(u[1]=r=>d.$emit("destroy")),persisted:""},{default:X(()=>[je(W("div",{id:d.id,class:te([G(a).b(),d.customClass,G(o)]),style:Ze(G(l)),role:"alert",onMouseenter:h,onMouseleave:f,onClick:u[0]||(u[0]=(...r)=>d.onClick&&d.onClick(...r))},[G(c)?(K(),_e(G(Ye),{key:0,class:te([G(a).e("icon"),G(m)])},{default:X(()=>[(K(),_e(ot(G(c))))]),_:1},8,["class"])):ue("v-if",!0),W("div",{class:te(G(a).e("group"))},[W("h2",{class:te(G(a).e("title")),textContent:pe(d.title)},null,10,ci),je(W("div",{class:te(G(a).e("content")),style:Ze(d.title?void 0:{margin:0})},[Pe(d.$slots,"default",{},()=>[d.dangerouslyUseHTMLString?(K(),se(ke,{key:1},[ue(" Caution here, message could've been compromised, never use user's input as message "),W("p",{innerHTML:d.message},null,8,_i)],2112)):(K(),se("p",hi,pe(d.message),1))])],6),[[Ve,d.message]]),d.showClose?(K(),_e(G(Ye),{key:0,class:te(G(a).e("closeBtn")),onClick:We(s,["stop"])},{default:X(()=>[z(G(b))]),_:1},8,["class","onClick"])):ue("v-if",!0)],2)],46,fi),[[Ve,v.value]])]),_:3},8,["name","onBeforeLeave"]))}});var vi=ct(mi,[["__file","/home/runner/work/element-plus/element-plus/packages/components/notification/src/notification.vue"]]);const wt={"top-left":[],"top-right":[],"bottom-left":[],"bottom-right":[]},jt=16;let gi=1;const et=function(t={},e=null){if(!bn)return{close:()=>{}};(typeof t=="string"||ut(t))&&(t={message:t});const n=t.position||"top-right";let a=t.offset||0;wt[n].forEach(({vm:m})=>{var c;a+=(((c=m.el)==null?void 0:c.offsetHeight)||0)+jt}),a+=jt;const S=`notification_${gi++}`,T=t.onClose,O={...t,offset:a,id:S,onClose:()=>{yi(S,n,T)}};let b=document.body;Ct(t.appendTo)?b=t.appendTo:Yt(t.appendTo)&&(b=document.querySelector(t.appendTo)),Ct(b)||(b=document.body);const v=document.createElement("div"),y=z(vi,O,ut(O.message)?{default:()=>O.message}:null);return y.appContext=e??et._context,y.props.onDestroy=()=>{Lt(null,v)},Lt(y,v),wt[n].push({vm:y}),b.appendChild(v.firstElementChild),{close:()=>{y.component.exposed.visible.value=!1}}};An.forEach(t=>{et[t]=(e={})=>((typeof e=="string"||ut(e))&&(e={message:e}),et({...e,type:t}))});function yi(t,e,n){const a=wt[e],S=a.findIndex(({vm:y})=>{var m;return((m=y.component)==null?void 0:m.props.id)===t});if(S===-1)return;const{vm:T}=a[S];if(!T)return;n==null||n(T);const O=T.el.offsetHeight,b=e.split("-")[0];a.splice(S,1);const v=a.length;if(!(v<1))for(let y=S;y<v;y++){const{el:m,component:c}=a[y].vm,o=Number.parseInt(m.style[b],10)-O-jt;c.props.offset=o}}function Ei(){for(const t of Object.values(wt))t.forEach(({vm:e})=>{e.component.exposed.visible.value=!1})}et.closeAll=Ei;et._context=null;const xi=_r(et,"$notify");const Fe=Object.create(null);Fe.open="0";Fe.close="1";Fe.ping="2";Fe.pong="3";Fe.message="4";Fe.upgrade="5";Fe.noop="6";const xt=Object.create(null);Object.keys(Fe).forEach(t=>{xt[Fe[t]]=t});const bi={type:"error",data:"parser error"},Si=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Ri=typeof ArrayBuffer=="function",Ai=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Ln=({type:t,data:e},n,a)=>Si&&e instanceof Blob?n?a(e):on(e,a):Ri&&(e instanceof ArrayBuffer||Ai(e))?n?a(e):on(new Blob([e]),a):a(Fe[t]+(e||"")),on=(t,e)=>{const n=new FileReader;return n.onload=function(){const a=n.result.split(",")[1];e("b"+(a||""))},n.readAsDataURL(t)},an="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",at=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<an.length;t++)at[an.charCodeAt(t)]=t;const Li=t=>{let e=t.length*.75,n=t.length,a,S=0,T,O,b,v;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const y=new ArrayBuffer(e),m=new Uint8Array(y);for(a=0;a<n;a+=4)T=at[t.charCodeAt(a)],O=at[t.charCodeAt(a+1)],b=at[t.charCodeAt(a+2)],v=at[t.charCodeAt(a+3)],m[S++]=T<<2|O>>4,m[S++]=(O&15)<<4|b>>2,m[S++]=(b&3)<<6|v&63;return y},Ci=typeof ArrayBuffer=="function",Cn=(t,e)=>{if(typeof t!="string")return{type:"message",data:On(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:Oi(t.substring(1),e)}:xt[n]?t.length>1?{type:xt[n],data:t.substring(1)}:{type:xt[n]}:bi},Oi=(t,e)=>{if(Ci){const n=Li(t);return On(n,e)}else return{base64:!0,data:t}},On=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}},wn=String.fromCharCode(30),wi=(t,e)=>{const n=t.length,a=new Array(n);let S=0;t.forEach((T,O)=>{Ln(T,!1,b=>{a[O]=b,++S===n&&e(a.join(wn))})})},Ti=(t,e)=>{const n=t.split(wn),a=[];for(let S=0;S<n.length;S++){const T=Cn(n[S],e);if(a.push(T),T.type==="error")break}return a},Tn=4;function ye(t){if(t)return Ii(t)}function Ii(t){for(var e in ye.prototype)t[e]=ye.prototype[e];return t}ye.prototype.on=ye.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};ye.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};ye.prototype.off=ye.prototype.removeListener=ye.prototype.removeAllListeners=ye.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var a,S=0;S<n.length;S++)if(a=n[S],a===e||a.fn===e){n.splice(S,1);break}return n.length===0&&delete this._callbacks["$"+t],this};ye.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],a=1;a<arguments.length;a++)e[a-1]=arguments[a];if(n){n=n.slice(0);for(var a=0,S=n.length;a<S;++a)n[a].apply(this,e)}return this};ye.prototype.emitReserved=ye.prototype.emit;ye.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};ye.prototype.hasListeners=function(t){return!!this.listeners(t).length};const Oe=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function In(t,...e){return e.reduce((n,a)=>(t.hasOwnProperty(a)&&(n[a]=t[a]),n),{})}const Di=Oe.setTimeout,Pi=Oe.clearTimeout;function Dt(t,e){e.useNativeTimers?(t.setTimeoutFn=Di.bind(Oe),t.clearTimeoutFn=Pi.bind(Oe)):(t.setTimeoutFn=Oe.setTimeout.bind(Oe),t.clearTimeoutFn=Oe.clearTimeout.bind(Oe))}const ki=1.33;function Mi(t){return typeof t=="string"?Bi(t):Math.ceil((t.byteLength||t.size)*ki)}function Bi(t){let e=0,n=0;for(let a=0,S=t.length;a<S;a++)e=t.charCodeAt(a),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(a++,n+=4);return n}class Fi extends Error{constructor(e,n,a){super(e),this.description=n,this.context=a,this.type="TransportError"}}class Dn extends ye{constructor(e){super(),this.writable=!1,Dt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,n,a){return super.emitReserved("error",new Fi(e,n,a)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=Cn(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const Pn="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Vt=64,Ui={};let ln=0,mt=0,un;function dn(t){let e="";do e=Pn[t%Vt]+e,t=Math.floor(t/Vt);while(t>0);return e}function kn(){const t=dn(+new Date);return t!==un?(ln=0,un=t):t+"."+dn(ln++)}for(;mt<Vt;mt++)Ui[Pn[mt]]=mt;function Mn(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function Ni(t){let e={},n=t.split("&");for(let a=0,S=n.length;a<S;a++){let T=n[a].split("=");e[decodeURIComponent(T[0])]=decodeURIComponent(T[1])}return e}let Bn=!1;try{Bn=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const ji=Bn;function Fn(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||ji))return new XMLHttpRequest}catch{}if(!e)try{return new Oe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Vi(){}const Ki=function(){return new Fn({xdomain:!1}).responseType!=null}();class Gi extends Dn{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const a=location.protocol==="https:";let S=location.port;S||(S=a?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||S!==e.port,this.xs=e.secure!==a}const n=e&&e.forceBase64;this.supportsBinary=Ki&&!n}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let a=0;this.polling&&(a++,this.once("pollComplete",function(){--a||n()})),this.writable||(a++,this.once("drain",function(){--a||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=a=>{if(this.readyState==="opening"&&a.type==="open"&&this.onOpen(),a.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(a)};Ti(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,wi(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const n=this.opts.secure?"https":"http";let a="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=kn()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(n==="https"&&Number(this.opts.port)!==443||n==="http"&&Number(this.opts.port)!==80)&&(a=":"+this.opts.port);const S=Mn(e),T=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(T?"["+this.opts.hostname+"]":this.opts.hostname)+a+this.opts.path+(S.length?"?"+S:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new Be(this.uri(),e)}doWrite(e,n){const a=this.request({method:"POST",data:e});a.on("success",n),a.on("error",(S,T)=>{this.onError("xhr post error",S,T)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,a)=>{this.onError("xhr poll error",n,a)}),this.pollXhr=e}}class Be extends ye{constructor(e,n){super(),Dt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=e,this.async=n.async!==!1,this.data=n.data!==void 0?n.data:null,this.create()}create(){const e=In(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const n=this.xhr=new Fn(e);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let a in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(a)&&n.setRequestHeader(a,this.opts.extraHeaders[a])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(a){this.setTimeoutFn(()=>{this.onError(a)},0);return}typeof document<"u"&&(this.index=Be.requestsCount++,Be.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Vi,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Be.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Be.requestsCount=0;Be.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",fn);else if(typeof addEventListener=="function"){const t="onpagehide"in Oe?"pagehide":"unload";addEventListener(t,fn,!1)}}function fn(){for(let t in Be.requests)Be.requests.hasOwnProperty(t)&&Be.requests[t].abort()}const Un=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0))(),vt=Oe.WebSocket||Oe.MozWebSocket,cn=!0,Wi="arraybuffer",hn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class zi extends Dn{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),n=this.opts.protocols,a=hn?{}:In(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(a.headers=this.opts.extraHeaders);try{this.ws=cn&&!hn?n?new vt(e,n):new vt(e):new vt(e,n,a)}catch(S){return this.emitReserved("error",S)}this.ws.binaryType=this.socket.binaryType||Wi,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const a=e[n],S=n===e.length-1;Ln(a,this.supportsBinary,T=>{const O={};try{cn&&this.ws.send(T)}catch{}S&&Un(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const n=this.opts.secure?"wss":"ws";let a="";this.opts.port&&(n==="wss"&&Number(this.opts.port)!==443||n==="ws"&&Number(this.opts.port)!==80)&&(a=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=kn()),this.supportsBinary||(e.b64=1);const S=Mn(e),T=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(T?"["+this.opts.hostname+"]":this.opts.hostname)+a+this.opts.path+(S.length?"?"+S:"")}check(){return!!vt}}const Hi={websocket:zi,polling:Gi},$i=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Yi=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Kt(t){const e=t,n=t.indexOf("["),a=t.indexOf("]");n!=-1&&a!=-1&&(t=t.substring(0,n)+t.substring(n,a).replace(/:/g,";")+t.substring(a,t.length));let S=$i.exec(t||""),T={},O=14;for(;O--;)T[Yi[O]]=S[O]||"";return n!=-1&&a!=-1&&(T.source=e,T.host=T.host.substring(1,T.host.length-1).replace(/;/g,":"),T.authority=T.authority.replace("[","").replace("]","").replace(/;/g,":"),T.ipv6uri=!0),T.pathNames=Xi(T,T.path),T.queryKey=Ji(T,T.query),T}function Xi(t,e){const n=/\/{2,9}/g,a=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&a.splice(0,1),e.slice(-1)=="/"&&a.splice(a.length-1,1),a}function Ji(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(a,S,T){S&&(n[S]=T)}),n}let Nn=class qe extends ye{constructor(e,n={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(n=e,e=null),e?(e=Kt(e),n.hostname=e.host,n.secure=e.protocol==="https"||e.protocol==="wss",n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=Kt(n.host).host),Dt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Ni(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=Tn,n.transport=e,this.id&&(n.sid=this.id);const a=Object.assign({},this.opts.transportOptions[e],this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Hi[e](a)}open(){let e;if(this.opts.rememberUpgrade&&qe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(e){let n=this.createTransport(e),a=!1;qe.priorWebsocketSuccess=!1;const S=()=>{a||(n.send([{type:"ping",data:"probe"}]),n.once("packet",c=>{if(!a)if(c.type==="pong"&&c.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;qe.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{a||this.readyState!=="closed"&&(m(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const o=new Error("probe error");o.transport=n.name,this.emitReserved("upgradeError",o)}}))};function T(){a||(a=!0,m(),n.close(),n=null)}const O=c=>{const o=new Error("probe error: "+c);o.transport=n.name,T(),this.emitReserved("upgradeError",o)};function b(){O("transport closed")}function v(){O("socket closed")}function y(c){n&&c.name!==n.name&&T()}const m=()=>{n.removeListener("open",S),n.removeListener("error",O),n.removeListener("close",b),this.off("close",v),this.off("upgrading",y)};n.once("open",S),n.once("error",O),n.once("close",b),this.once("close",v),this.once("upgrading",y),n.open()}onOpen(){if(this.readyState="open",qe.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const n=this.upgrades.length;for(;e<n;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=e.data,this.onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let a=0;a<this.writeBuffer.length;a++){const S=this.writeBuffer[a].data;if(S&&(n+=Mi(S)),a>0&&n>this.maxPayload)return this.writeBuffer.slice(0,a);n+=2}return this.writeBuffer}write(e,n,a){return this.sendPacket("message",e,n,a),this}send(e,n,a){return this.sendPacket("message",e,n,a),this}sendPacket(e,n,a,S){if(typeof n=="function"&&(S=n,n=void 0),typeof a=="function"&&(S=a,a=null),this.readyState==="closing"||this.readyState==="closed")return;a=a||{},a.compress=a.compress!==!1;const T={type:e,data:n,options:a};this.emitReserved("packetCreate",T),this.writeBuffer.push(T),S&&this.once("flush",S),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},a=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?a():e()}):this.upgrading?a():e()),this}onError(e){qe.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const n=[];let a=0;const S=e.length;for(;a<S;a++)~this.transports.indexOf(e[a])&&n.push(e[a]);return n}};Nn.protocol=Tn;function qi(t,e="",n){let a=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),a=Kt(t)),a.port||(/^(http|ws)$/.test(a.protocol)?a.port="80":/^(http|ws)s$/.test(a.protocol)&&(a.port="443")),a.path=a.path||"/";const T=a.host.indexOf(":")!==-1?"["+a.host+"]":a.host;return a.id=a.protocol+"://"+T+":"+a.port+e,a.href=a.protocol+"://"+T+(n&&n.port===a.port?"":":"+a.port),a}const Qi=typeof ArrayBuffer=="function",Zi=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,jn=Object.prototype.toString,es=typeof Blob=="function"||typeof Blob<"u"&&jn.call(Blob)==="[object BlobConstructor]",ts=typeof File=="function"||typeof File<"u"&&jn.call(File)==="[object FileConstructor]";function qt(t){return Qi&&(t instanceof ArrayBuffer||Zi(t))||es&&t instanceof Blob||ts&&t instanceof File}function bt(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,a=t.length;n<a;n++)if(bt(t[n]))return!0;return!1}if(qt(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return bt(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&bt(t[n]))return!0;return!1}function ns(t){const e=[],n=t.data,a=t;return a.data=Gt(n,e),a.attachments=e.length,{packet:a,buffers:e}}function Gt(t,e){if(!t)return t;if(qt(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let a=0;a<t.length;a++)n[a]=Gt(t[a],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=Gt(t[a],e));return n}return t}function rs(t,e){return t.data=Wt(t.data,e),delete t.attachments,t}function Wt(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=Wt(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=Wt(t[n],e));return t}const is=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ss=5;var ie;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(ie||(ie={}));class os{constructor(e){this.replacer=e}encode(e){return(e.type===ie.EVENT||e.type===ie.ACK)&&bt(e)?this.encodeAsBinary({type:e.type===ie.EVENT?ie.BINARY_EVENT:ie.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===ie.BINARY_EVENT||e.type===ie.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=ns(e),a=this.encodeAsString(n.packet),S=n.buffers;return S.unshift(a),S}}function _n(t){return Object.prototype.toString.call(t)==="[object Object]"}class Qt extends ye{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const a=n.type===ie.BINARY_EVENT;a||n.type===ie.BINARY_ACK?(n.type=a?ie.EVENT:ie.ACK,this.reconstructor=new as(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(qt(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const a={type:Number(e.charAt(0))};if(ie[a.type]===void 0)throw new Error("unknown packet type "+a.type);if(a.type===ie.BINARY_EVENT||a.type===ie.BINARY_ACK){const T=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const O=e.substring(T,n);if(O!=Number(O)||e.charAt(n)!=="-")throw new Error("Illegal attachments");a.attachments=Number(O)}if(e.charAt(n+1)==="/"){const T=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););a.nsp=e.substring(T,n)}else a.nsp="/";const S=e.charAt(n+1);if(S!==""&&Number(S)==S){const T=n+1;for(;++n;){const O=e.charAt(n);if(O==null||Number(O)!=O){--n;break}if(n===e.length)break}a.id=Number(e.substring(T,n+1))}if(e.charAt(++n)){const T=this.tryParse(e.substr(n));if(Qt.isPayloadValid(a.type,T))a.data=T;else throw new Error("invalid payload")}return a}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case ie.CONNECT:return _n(n);case ie.DISCONNECT:return n===void 0;case ie.CONNECT_ERROR:return typeof n=="string"||_n(n);case ie.EVENT:case ie.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&is.indexOf(n[0])===-1);case ie.ACK:case ie.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class as{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=rs(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ls=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Qt,Encoder:os,get PacketType(){return ie},protocol:ss},Symbol.toStringTag,{value:"Module"}));function Ie(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const us=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Vn extends ye{constructor(e,n,a){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,a&&a.auth&&(this.auth=a.auth),this._opts=Object.assign({},a),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ie(e,"open",this.onopen.bind(this)),Ie(e,"packet",this.onpacket.bind(this)),Ie(e,"error",this.onerror.bind(this)),Ie(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){if(us.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const a={type:ie.EVENT,data:n};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const O=this.ids++,b=n.pop();this._registerAckCallback(O,b),a.id=O}const S=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!S||!this.connected)||(this.connected?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(e,n){var a;const S=(a=this.flags.timeout)!==null&&a!==void 0?a:this._opts.ackTimeout;if(S===void 0){this.acks[e]=n;return}const T=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let O=0;O<this.sendBuffer.length;O++)this.sendBuffer[O].id===e&&this.sendBuffer.splice(O,1);n.call(this,new Error("operation has timed out"))},S);this.acks[e]=(...O)=>{this.io.clearTimeoutFn(T),n.apply(this,[null,...O])}}emitWithAck(e,...n){const a=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((S,T)=>{n.push((O,b)=>a?O?T(O):S(b):S(O)),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const a={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((S,...T)=>a!==this._queue[0]?void 0:(S!==null?a.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(S)):(this._queue.shift(),n&&n(null,...T)),a.pending=!1,this._drainQueue())),this._queue.push(a),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ie.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ie.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ie.EVENT:case ie.BINARY_EVENT:this.onevent(e);break;case ie.ACK:case ie.BINARY_ACK:this.onack(e);break;case ie.DISCONNECT:this.ondisconnect();break;case ie.CONNECT_ERROR:this.destroy();const a=new Error(e.data.message);a.data=e.data.data,this.emitReserved("connect_error",a);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const a of n)a.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let a=!1;return function(...S){a||(a=!0,n.packet({type:ie.ACK,id:e,data:S}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(n.apply(this,e.data),delete this.acks[e.id])}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ie.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let a=0;a<n.length;a++)if(e===n[a])return n.splice(a,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let a=0;a<n.length;a++)if(e===n[a])return n.splice(a,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const a of n)a.apply(this,e.data)}}}function rt(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}rt.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+n:t-n}return Math.min(t,this.max)|0};rt.prototype.reset=function(){this.attempts=0};rt.prototype.setMin=function(t){this.ms=t};rt.prototype.setMax=function(t){this.max=t};rt.prototype.setJitter=function(t){this.jitter=t};class zt extends ye{constructor(e,n){var a;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Dt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((a=n.randomizationFactor)!==null&&a!==void 0?a:.5),this.backoff=new rt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const S=n.parser||ls;this.encoder=new S.Encoder,this.decoder=new S.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Nn(this.uri,this.opts);const n=this.engine,a=this;this._readyState="opening",this.skipReconnect=!1;const S=Ie(n,"open",function(){a.onopen(),e&&e()}),T=Ie(n,"error",O=>{a.cleanup(),a._readyState="closed",this.emitReserved("error",O),e?e(O):a.maybeReconnectOnOpen()});if(this._timeout!==!1){const O=this._timeout;O===0&&S();const b=this.setTimeoutFn(()=>{S(),n.close(),n.emit("error",new Error("timeout"))},O);this.opts.autoUnref&&b.unref(),this.subs.push(function(){clearTimeout(b)})}return this.subs.push(S),this.subs.push(T),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ie(e,"ping",this.onping.bind(this)),Ie(e,"data",this.ondata.bind(this)),Ie(e,"error",this.onerror.bind(this)),Ie(e,"close",this.onclose.bind(this)),Ie(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){Un(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let a=this.nsps[e];return a?this._autoConnect&&!a.active&&a.connect():(a=new Vn(this,e,n),this.nsps[e]=a),a}_destroy(e){const n=Object.keys(this.nsps);for(const a of n)if(this.nsps[a].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let a=0;a<n.length;a++)this.engine.write(n[a],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const a=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(S=>{S?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",S)):e.onreconnect()}))},n);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const it={};function St(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=qi(t,e.path||"/socket.io"),a=n.source,S=n.id,T=n.path,O=it[S]&&T in it[S].nsps,b=e.forceNew||e["force new connection"]||e.multiplex===!1||O;let v;return b?v=new zt(a,e):(it[S]||(it[S]=new zt(a,e)),v=it[S]),n.query&&!e.query&&(e.query=n.queryKey),v.socket(n.path,e)}Object.assign(St,{Manager:zt,Socket:Vn,io:St,connect:St});let le=null;const ds=({query:t})=>new Promise(e=>{le=St("wss://121.36.99.231:3000",{reconnection:!0,forceNew:!0,transports:["websocket"],query:t,auth:{token:"Bearer "+localStorage.getItem("live_token")}}),le.on("connect",()=>{e(),console.log(le.id,"监听客户端连接成功-connect")})});class fs{constructor(e,{onTarck:n,onCandidate:a,onMessage:S}){Mt(this,"conn",null);Mt(this,"dataChannel",null);var T=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;T||He.alert("当前浏览器不支持RTCPeerConnection！"),this.conn=new T(e),this.conn.addEventListener("icecandidate",O=>{O.candidate&&a(O.candidate)}),this.conn.addEventListener("track",n),this.conn.addEventListener("connectionstatechange",()=>{this.conn.connectionState==="connected"&&console.log("对等连接成功！")}),this.createDataChannel({onMessage:S})}createOffer(e){this.conn&&this.conn.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(n=>{this.conn.setLocalDescription(n),e(n)}).catch(()=>{console.log("创建offer失败")})}createAnswer(e){this.conn&&this.conn.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(n=>{this.conn&&this.conn.setLocalDescription(n),e(n)}).catch(()=>{console.log("创建answer失败")})}setRemoteDescription(e){var n;(n=this.conn)==null||n.setRemoteDescription(new RTCSessionDescription(e))}setCandidate(e){this.conn&&e&&this.conn.addIceCandidate(new RTCIceCandidate(e)).catch(n=>{console.log(n)})}addTrack(e){this.conn&&e&&e.getTracks().forEach(n=>{this.conn.addTrack(n,e)})}createDataChannel({onMessage:e}){if(this.dataChannel)return!1;this.dataChannel=this.conn.createDataChannel("channel",{ordered:!0,maxRetransmits:5}),this.onDataChannel({onMessage:e})}onDataChannel({onMessage:e}){this.conn.ondatachannel=n=>{var a=n.channel;a.onmessage=function(S){typeof e=="function"&&e(S)},a.onopen=function(){console.log("dataChannel open")},a.onclose=function(){console.log("dataChannel close")}}}}var Kn={exports:{}};(function(t,e){(function(a,S){t.exports=S()})(self,function(){return function(){var n={"./node_modules/es6-promise/dist/es6-promise.js":function(O,b,v){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(y,m){O.exports=m()})(this,function(){function y(D){var k=typeof D;return D!==null&&(k==="object"||k==="function")}function m(D){return typeof D=="function"}var c=void 0;Array.isArray?c=Array.isArray:c=function(D){return Object.prototype.toString.call(D)==="[object Array]"};var o=c,p=0,l=void 0,f=void 0,h=function(k,B){A[p]=k,A[p+1]=B,p+=2,p===2&&(f?f(w):P())};function s(D){f=D}function i(D){h=D}var d=typeof window<"u"?window:void 0,u=d||{},r=u.MutationObserver||u.WebKitMutationObserver,_=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",g=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function E(){return function(){return process.nextTick(w)}}function L(){return typeof l<"u"?function(){l(w)}:x()}function R(){var D=0,k=new r(w),B=document.createTextNode("");return k.observe(B,{characterData:!0}),function(){B.data=D=++D%2}}function C(){var D=new MessageChannel;return D.port1.onmessage=w,function(){return D.port2.postMessage(0)}}function x(){var D=setTimeout;return function(){return D(w,1)}}var A=new Array(1e3);function w(){for(var D=0;D<p;D+=2){var k=A[D],B=A[D+1];k(B),A[D]=void 0,A[D+1]=void 0}p=0}function I(){try{var D=Function("return this")().require("vertx");return l=D.runOnLoop||D.runOnContext,L()}catch{return x()}}var P=void 0;_?P=E():r?P=R():g?P=C():d===void 0?P=I():P=x();function M(D,k){var B=this,U=new this.constructor($);U[Q]===void 0&&F(U);var q=B._state;if(q){var Z=arguments[q-1];h(function(){return Ue(q,U,Z,B._result)})}else be(B,U,D,k);return U}function J(D){var k=this;if(D&&typeof D=="object"&&D.constructor===k)return D;var B=new k($);return Ee(B,D),B}var Q=Math.random().toString(36).substring(2);function $(){}var ne=void 0,ce=1,Y=2;function re(){return new TypeError("You cannot resolve a promise with itself")}function Re(){return new TypeError("A promises callback cannot return that same promise.")}function fe(D,k,B,U){try{D.call(k,B,U)}catch(q){return q}}function he(D,k,B){h(function(U){var q=!1,Z=fe(B,k,function(ae){q||(q=!0,k!==ae?Ee(U,ae):oe(U,ae))},function(ae){q||(q=!0,H(U,ae))},"Settle: "+(U._label||" unknown promise"));!q&&Z&&(q=!0,H(U,Z))},D)}function xe(D,k){k._state===ce?oe(D,k._result):k._state===Y?H(D,k._result):be(k,void 0,function(B){return Ee(D,B)},function(B){return H(D,B)})}function ve(D,k,B){k.constructor===D.constructor&&B===M&&k.constructor.resolve===J?xe(D,k):B===void 0?oe(D,k):m(B)?he(D,k,B):oe(D,k)}function Ee(D,k){if(D===k)H(D,re());else if(y(k)){var B=void 0;try{B=k.then}catch(U){H(D,U);return}ve(D,k,B)}else oe(D,k)}function Ae(D){D._onerror&&D._onerror(D._result),Le(D)}function oe(D,k){D._state===ne&&(D._result=k,D._state=ce,D._subscribers.length!==0&&h(Le,D))}function H(D,k){D._state===ne&&(D._state=Y,D._result=k,h(Ae,D))}function be(D,k,B,U){var q=D._subscribers,Z=q.length;D._onerror=null,q[Z]=k,q[Z+ce]=B,q[Z+Y]=U,Z===0&&D._state&&h(Le,D)}function Le(D){var k=D._subscribers,B=D._state;if(k.length!==0){for(var U=void 0,q=void 0,Z=D._result,ae=0;ae<k.length;ae+=3)U=k[ae],q=k[ae+B],U?Ue(B,U,q,Z):q(Z);D._subscribers.length=0}}function Ue(D,k,B,U){var q=m(B),Z=void 0,ae=void 0,Je=!0;if(q){try{Z=B(U)}catch(_t){Je=!1,ae=_t}if(k===Z){H(k,Re());return}}else Z=U;k._state!==ne||(q&&Je?Ee(k,Z):Je===!1?H(k,ae):D===ce?oe(k,Z):D===Y&&H(k,Z))}function Ce(D,k){try{k(function(U){Ee(D,U)},function(U){H(D,U)})}catch(B){H(D,B)}}var Te=0;function Ke(){return Te++}function F(D){D[Q]=Te++,D._state=void 0,D._result=void 0,D._subscribers=[]}function N(){return new Error("Array Methods must be provided an Array")}var j=function(){function D(k,B){this._instanceConstructor=k,this.promise=new k($),this.promise[Q]||F(this.promise),o(B)?(this.length=B.length,this._remaining=B.length,this._result=new Array(this.length),this.length===0?oe(this.promise,this._result):(this.length=this.length||0,this._enumerate(B),this._remaining===0&&oe(this.promise,this._result))):H(this.promise,N())}return D.prototype._enumerate=function(B){for(var U=0;this._state===ne&&U<B.length;U++)this._eachEntry(B[U],U)},D.prototype._eachEntry=function(B,U){var q=this._instanceConstructor,Z=q.resolve;if(Z===J){var ae=void 0,Je=void 0,_t=!1;try{ae=B.then}catch(kt){_t=!0,Je=kt}if(ae===M&&B._state!==ne)this._settledAt(B._state,U,B._result);else if(typeof ae!="function")this._remaining--,this._result[U]=B;else if(q===de){var Pt=new q($);_t?H(Pt,Je):ve(Pt,B,ae),this._willSettleAt(Pt,U)}else this._willSettleAt(new q(function(kt){return kt(B)}),U)}else this._willSettleAt(Z(B),U)},D.prototype._settledAt=function(B,U,q){var Z=this.promise;Z._state===ne&&(this._remaining--,B===Y?H(Z,q):this._result[U]=q),this._remaining===0&&oe(Z,this._result)},D.prototype._willSettleAt=function(B,U){var q=this;be(B,void 0,function(Z){return q._settledAt(ce,U,Z)},function(Z){return q._settledAt(Y,U,Z)})},D}();function V(D){return new j(this,D).promise}function Se(D){var k=this;return o(D)?new k(function(B,U){for(var q=D.length,Z=0;Z<q;Z++)k.resolve(D[Z]).then(B,U)}):new k(function(B,U){return U(new TypeError("You must pass an array to race."))})}function Me(D){var k=this,B=new k($);return H(B,D),B}function Xe(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Ne(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var de=function(){function D(k){this[Q]=Ke(),this._result=this._state=void 0,this._subscribers=[],$!==k&&(typeof k!="function"&&Xe(),this instanceof D?Ce(this,k):Ne())}return D.prototype.catch=function(B){return this.then(null,B)},D.prototype.finally=function(B){var U=this,q=U.constructor;return m(B)?U.then(function(Z){return q.resolve(B()).then(function(){return Z})},function(Z){return q.resolve(B()).then(function(){throw Z})}):U.then(B,B)},D}();de.prototype.then=M,de.all=V,de.race=Se,de.resolve=J,de.reject=Me,de._setScheduler=s,de._setAsap=i,de._asap=h;function ht(){var D=void 0;if(typeof v.g<"u")D=v.g;else if(typeof self<"u")D=self;else try{D=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var k=D.Promise;if(k){var B=null;try{B=Object.prototype.toString.call(k.resolve())}catch{}if(B==="[object Promise]"&&!k.cast)return}D.Promise=de}return de.polyfill=ht,de.Promise=de,de})},"./node_modules/events/events.js":function(O){var b=typeof Reflect=="object"?Reflect:null,v=b&&typeof b.apply=="function"?b.apply:function(x,A,w){return Function.prototype.apply.call(x,A,w)},y;b&&typeof b.ownKeys=="function"?y=b.ownKeys:Object.getOwnPropertySymbols?y=function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:y=function(x){return Object.getOwnPropertyNames(x)};function m(C){console&&console.warn&&console.warn(C)}var c=Number.isNaN||function(x){return x!==x};function o(){o.init.call(this)}O.exports=o,O.exports.once=E,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var p=10;function l(C){if(typeof C!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(C){if(typeof C!="number"||C<0||c(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");p=C}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||c(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this};function f(C){return C._maxListeners===void 0?o.defaultMaxListeners:C._maxListeners}o.prototype.getMaxListeners=function(){return f(this)},o.prototype.emit=function(x){for(var A=[],w=1;w<arguments.length;w++)A.push(arguments[w]);var I=x==="error",P=this._events;if(P!==void 0)I=I&&P.error===void 0;else if(!I)return!1;if(I){var M;if(A.length>0&&(M=A[0]),M instanceof Error)throw M;var J=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw J.context=M,J}var Q=P[x];if(Q===void 0)return!1;if(typeof Q=="function")v(Q,this,A);else for(var $=Q.length,ne=r(Q,$),w=0;w<$;++w)v(ne[w],this,A);return!0};function h(C,x,A,w){var I,P,M;if(l(A),P=C._events,P===void 0?(P=C._events=Object.create(null),C._eventsCount=0):(P.newListener!==void 0&&(C.emit("newListener",x,A.listener?A.listener:A),P=C._events),M=P[x]),M===void 0)M=P[x]=A,++C._eventsCount;else if(typeof M=="function"?M=P[x]=w?[A,M]:[M,A]:w?M.unshift(A):M.push(A),I=f(C),I>0&&M.length>I&&!M.warned){M.warned=!0;var J=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");J.name="MaxListenersExceededWarning",J.emitter=C,J.type=x,J.count=M.length,m(J)}return C}o.prototype.addListener=function(x,A){return h(this,x,A,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(x,A){return h(this,x,A,!0)};function s(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function i(C,x,A){var w={fired:!1,wrapFn:void 0,target:C,type:x,listener:A},I=s.bind(w);return I.listener=A,w.wrapFn=I,I}o.prototype.once=function(x,A){return l(A),this.on(x,i(this,x,A)),this},o.prototype.prependOnceListener=function(x,A){return l(A),this.prependListener(x,i(this,x,A)),this},o.prototype.removeListener=function(x,A){var w,I,P,M,J;if(l(A),I=this._events,I===void 0)return this;if(w=I[x],w===void 0)return this;if(w===A||w.listener===A)--this._eventsCount===0?this._events=Object.create(null):(delete I[x],I.removeListener&&this.emit("removeListener",x,w.listener||A));else if(typeof w!="function"){for(P=-1,M=w.length-1;M>=0;M--)if(w[M]===A||w[M].listener===A){J=w[M].listener,P=M;break}if(P<0)return this;P===0?w.shift():_(w,P),w.length===1&&(I[x]=w[0]),I.removeListener!==void 0&&this.emit("removeListener",x,J||A)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(x){var A,w,I;if(w=this._events,w===void 0)return this;if(w.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):w[x]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete w[x]),this;if(arguments.length===0){var P=Object.keys(w),M;for(I=0;I<P.length;++I)M=P[I],M!=="removeListener"&&this.removeAllListeners(M);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=w[x],typeof A=="function")this.removeListener(x,A);else if(A!==void 0)for(I=A.length-1;I>=0;I--)this.removeListener(x,A[I]);return this};function d(C,x,A){var w=C._events;if(w===void 0)return[];var I=w[x];return I===void 0?[]:typeof I=="function"?A?[I.listener||I]:[I]:A?g(I):r(I,I.length)}o.prototype.listeners=function(x){return d(this,x,!0)},o.prototype.rawListeners=function(x){return d(this,x,!1)},o.listenerCount=function(C,x){return typeof C.listenerCount=="function"?C.listenerCount(x):u.call(C,x)},o.prototype.listenerCount=u;function u(C){var x=this._events;if(x!==void 0){var A=x[C];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?y(this._events):[]};function r(C,x){for(var A=new Array(x),w=0;w<x;++w)A[w]=C[w];return A}function _(C,x){for(;x+1<C.length;x++)C[x]=C[x+1];C.pop()}function g(C){for(var x=new Array(C.length),A=0;A<x.length;++A)x[A]=C[A].listener||C[A];return x}function E(C,x){return new Promise(function(A,w){function I(M){C.removeListener(x,P),w(M)}function P(){typeof C.removeListener=="function"&&C.removeListener("error",I),A([].slice.call(arguments))}R(C,x,P,{once:!0}),x!=="error"&&L(C,I,{once:!0})})}function L(C,x,A){typeof C.on=="function"&&R(C,"error",x,A)}function R(C,x,A,w){if(typeof C.on=="function")w.once?C.once(x,A):C.on(x,A);else if(typeof C.addEventListener=="function")C.addEventListener(x,function I(P){w.once&&C.removeEventListener(x,I),A(P)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C)}},"./node_modules/webworkify-webpack/index.js":function(O,b,v){function y(s){var i={};function d(r){if(i[r])return i[r].exports;var _=i[r]={i:r,l:!1,exports:{}};return s[r].call(_.exports,_,_.exports,d),_.l=!0,_.exports}d.m=s,d.c=i,d.i=function(r){return r},d.d=function(r,_,g){d.o(r,_)||Object.defineProperty(r,_,{configurable:!1,enumerable:!0,get:g})},d.r=function(r){Object.defineProperty(r,"__esModule",{value:!0})},d.n=function(r){var _=r&&r.__esModule?function(){return r.default}:function(){return r};return d.d(_,"a",_),_},d.o=function(r,_){return Object.prototype.hasOwnProperty.call(r,_)},d.p="/",d.oe=function(r){throw console.error(r),r};var u=d(d.s=ENTRY_MODULE);return u.default||u}var m="[\\.|\\-|\\+|\\w|/|@]+",c="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+m+").*?\\)";function o(s){return(s+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function p(s){return!isNaN(1*s)}function l(s,i,d){var u={};u[d]=[];var r=i.toString(),_=r.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!_)return u;for(var g=_[1],E=new RegExp("(\\\\n|\\W)"+o(g)+c,"g"),L;L=E.exec(r);)L[3]!=="dll-reference"&&u[d].push(L[3]);for(E=new RegExp("\\("+o(g)+'\\("(dll-reference\\s('+m+'))"\\)\\)'+c,"g");L=E.exec(r);)s[L[2]]||(u[d].push(L[1]),s[L[2]]=v(L[1]).m),u[L[2]]=u[L[2]]||[],u[L[2]].push(L[4]);for(var R=Object.keys(u),C=0;C<R.length;C++)for(var x=0;x<u[R[C]].length;x++)p(u[R[C]][x])&&(u[R[C]][x]=1*u[R[C]][x]);return u}function f(s){var i=Object.keys(s);return i.reduce(function(d,u){return d||s[u].length>0},!1)}function h(s,i){for(var d={main:[i]},u={main:[]},r={main:{}};f(d);)for(var _=Object.keys(d),g=0;g<_.length;g++){var E=_[g],L=d[E],R=L.pop();if(r[E]=r[E]||{},!(r[E][R]||!s[E][R])){r[E][R]=!0,u[E]=u[E]||[],u[E].push(R);for(var C=l(s,s[E][R],E),x=Object.keys(C),A=0;A<x.length;A++)d[x[A]]=d[x[A]]||[],d[x[A]]=d[x[A]].concat(C[x[A]])}}return u}O.exports=function(s,i){i=i||{};var d={main:v.m},u=i.all?{main:Object.keys(d.main)}:h(d,s),r="";Object.keys(u).filter(function(R){return R!=="main"}).forEach(function(R){for(var C=0;u[R][C];)C++;u[R].push(C),d[R][C]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",r=r+"var "+R+" = ("+y.toString().replace("ENTRY_MODULE",JSON.stringify(C))+")({"+u[R].map(function(x){return""+JSON.stringify(x)+": "+d[R][x].toString()}).join(",")+`});
`}),r=r+"new (("+y.toString().replace("ENTRY_MODULE",JSON.stringify(s))+")({"+u.main.map(function(R){return""+JSON.stringify(R)+": "+d.main[R].toString()}).join(",")+"}))(self);";var _=new window.Blob([r],{type:"text/javascript"});if(i.bare)return _;var g=window.URL||window.webkitURL||window.mozURL||window.msURL,E=g.createObjectURL(_),L=new window.Worker(E);return L.objectURL=E,L}},"./src/config.js":function(O,b,v){v.r(b),v.d(b,{defaultConfig:function(){return y},createDefaultConfig:function(){return m}});var y={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function m(){return Object.assign({},y)}},"./src/core/features.js":function(O,b,v){v.r(b);var y=v("./src/io/io-controller.js"),m=v("./src/config.js"),c=function(){function o(){}return o.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},o.supportNetworkStreamIO=function(){var p=new y.default({},(0,m.createDefaultConfig)()),l=p.loaderType;return p.destroy(),l=="fetch-stream-loader"||l=="xhr-moz-chunked-loader"},o.getNetworkLoaderTypeName=function(){var p=new y.default({},(0,m.createDefaultConfig)()),l=p.loaderType;return p.destroy(),l},o.supportNativeMediaPlayback=function(p){o.videoElement==null&&(o.videoElement=window.document.createElement("video"));var l=o.videoElement.canPlayType(p);return l==="probably"||l=="maybe"},o.getFeatureList=function(){var p={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return p.mseFlvPlayback=o.supportMSEH264Playback(),p.networkStreamIO=o.supportNetworkStreamIO(),p.networkLoaderName=o.getNetworkLoaderTypeName(),p.mseLiveFlvPlayback=p.mseFlvPlayback&&p.networkStreamIO,p.nativeMP4H264Playback=o.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),p.nativeWebmVP8Playback=o.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),p.nativeWebmVP9Playback=o.supportNativeMediaPlayback('video/webm; codecs="vp9"'),p},o}();b.default=c},"./src/core/media-info.js":function(O,b,v){v.r(b);var y=function(){function m(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return m.prototype.isComplete=function(){var c=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,o=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&c&&o},m.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},m.prototype.getNearestKeyframe=function(c){if(this.keyframesIndex==null)return null;var o=this.keyframesIndex,p=this._search(o.times,c);return{index:p,milliseconds:o.times[p],fileposition:o.filepositions[p]}},m.prototype._search=function(c,o){var p=0,l=c.length-1,f=0,h=0,s=l;for(o<c[0]&&(p=0,h=s+1);h<=s;)if(f=h+Math.floor((s-h)/2),f===l||o>=c[f]&&o<c[f+1]){p=f;break}else c[f]<o?h=f+1:s=f-1;return p},m}();b.default=y},"./src/core/media-segment-info.js":function(O,b,v){v.r(b),v.d(b,{SampleInfo:function(){return y},MediaSegmentInfo:function(){return m},IDRSampleList:function(){return c},MediaSegmentInfoList:function(){return o}});var y=function(){function p(l,f,h,s,i){this.dts=l,this.pts=f,this.duration=h,this.originalDts=s,this.isSyncPoint=i,this.fileposition=null}return p}(),m=function(){function p(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return p.prototype.appendSyncPoint=function(l){l.isSyncPoint=!0,this.syncPoints.push(l)},p}(),c=function(){function p(){this._list=[]}return p.prototype.clear=function(){this._list=[]},p.prototype.appendArray=function(l){var f=this._list;l.length!==0&&(f.length>0&&l[0].originalDts<f[f.length-1].originalDts&&this.clear(),Array.prototype.push.apply(f,l))},p.prototype.getLastSyncPointBeforeDts=function(l){if(this._list.length==0)return null;var f=this._list,h=0,s=f.length-1,i=0,d=0,u=s;for(l<f[0].dts&&(h=0,d=u+1);d<=u;)if(i=d+Math.floor((u-d)/2),i===s||l>=f[i].dts&&l<f[i+1].dts){h=i;break}else f[i].dts<l?d=i+1:u=i-1;return this._list[h]},p}(),o=function(){function p(l){this._type=l,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(p.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),p.prototype.isEmpty=function(){return this._list.length===0},p.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},p.prototype._searchNearestSegmentBefore=function(l){var f=this._list;if(f.length===0)return-2;var h=f.length-1,s=0,i=0,d=h,u=0;if(l<f[0].originalBeginDts)return u=-1,u;for(;i<=d;)if(s=i+Math.floor((d-i)/2),s===h||l>f[s].lastSample.originalDts&&l<f[s+1].originalBeginDts){u=s;break}else f[s].originalBeginDts<l?i=s+1:d=s-1;return u},p.prototype._searchNearestSegmentAfter=function(l){return this._searchNearestSegmentBefore(l)+1},p.prototype.append=function(l){var f=this._list,h=l,s=this._lastAppendLocation,i=0;s!==-1&&s<f.length&&h.originalBeginDts>=f[s].lastSample.originalDts&&(s===f.length-1||s<f.length-1&&h.originalBeginDts<f[s+1].originalBeginDts)?i=s+1:f.length>0&&(i=this._searchNearestSegmentBefore(h.originalBeginDts)+1),this._lastAppendLocation=i,this._list.splice(i,0,h)},p.prototype.getLastSegmentBefore=function(l){var f=this._searchNearestSegmentBefore(l);return f>=0?this._list[f]:null},p.prototype.getLastSampleBefore=function(l){var f=this.getLastSegmentBefore(l);return f!=null?f.lastSample:null},p.prototype.getLastSyncPointBefore=function(l){for(var f=this._searchNearestSegmentBefore(l),h=this._list[f].syncPoints;h.length===0&&f>0;)f--,h=this._list[f].syncPoints;return h.length>0?h[h.length-1]:null},p}()},"./src/core/mse-controller.js":function(O,b,v){v.r(b);var y=v("./node_modules/events/events.js"),m=v.n(y),c=v("./src/utils/logger.js"),o=v("./src/utils/browser.js"),p=v("./src/core/mse-events.js"),l=v("./src/core/media-segment-info.js"),f=v("./src/utils/exception.js"),h=function(){function s(i){this.TAG="MSEController",this._config=i,this._emitter=new(m()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new l.IDRSampleList}return s.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},s.prototype.on=function(i,d){this._emitter.addListener(i,d)},s.prototype.off=function(i,d){this._emitter.removeListener(i,d)},s.prototype.attachMediaElement=function(i){if(this._mediaSource)throw new f.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var d=this._mediaSource=new window.MediaSource;d.addEventListener("sourceopen",this.e.onSourceOpen),d.addEventListener("sourceended",this.e.onSourceEnded),d.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=i,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),i.src=this._mediaSourceObjectURL},s.prototype.detachMediaElement=function(){if(this._mediaSource){var i=this._mediaSource;for(var d in this._sourceBuffers){var u=this._pendingSegments[d];u.splice(0,u.length),this._pendingSegments[d]=null,this._pendingRemoveRanges[d]=null,this._lastInitSegments[d]=null;var r=this._sourceBuffers[d];if(r){if(i.readyState!=="closed"){try{i.removeSourceBuffer(r)}catch(_){c.default.e(this.TAG,_.message)}r.removeEventListener("error",this.e.onSourceBufferError),r.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[d]=null,this._sourceBuffers[d]=null}}if(i.readyState==="open")try{i.endOfStream()}catch(_){c.default.e(this.TAG,_.message)}i.removeEventListener("sourceopen",this.e.onSourceOpen),i.removeEventListener("sourceended",this.e.onSourceEnded),i.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},s.prototype.appendInitSegment=function(i,d){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(i),this._pendingSegments[i.type].push(i);return}var u=i,r=""+u.container;u.codec&&u.codec.length>0&&(r+=";codecs="+u.codec);var _=!1;if(c.default.v(this.TAG,"Received Initialization Segment, mimeType: "+r),this._lastInitSegments[u.type]=u,r!==this._mimeTypes[u.type]){if(this._mimeTypes[u.type])c.default.v(this.TAG,"Notice: "+u.type+" mimeType changed, origin: "+this._mimeTypes[u.type]+", target: "+r);else{_=!0;try{var g=this._sourceBuffers[u.type]=this._mediaSource.addSourceBuffer(r);g.addEventListener("error",this.e.onSourceBufferError),g.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(E){c.default.e(this.TAG,E.message),this._emitter.emit(p.default.ERROR,{code:E.code,msg:E.message});return}}this._mimeTypes[u.type]=r}d||this._pendingSegments[u.type].push(u),_||this._sourceBuffers[u.type]&&!this._sourceBuffers[u.type].updating&&this._doAppendSegments(),o.default.safari&&u.container==="audio/mpeg"&&u.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=u.mediaDuration/1e3,this._updateMediaSourceDuration())},s.prototype.appendMediaSegment=function(i){var d=i;this._pendingSegments[d.type].push(d),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var u=this._sourceBuffers[d.type];u&&!u.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},s.prototype.seek=function(i){for(var d in this._sourceBuffers)if(this._sourceBuffers[d]){var u=this._sourceBuffers[d];if(this._mediaSource.readyState==="open")try{u.abort()}catch(R){c.default.e(this.TAG,R.message)}this._idrList.clear();var r=this._pendingSegments[d];if(r.splice(0,r.length),this._mediaSource.readyState!=="closed"){for(var _=0;_<u.buffered.length;_++){var g=u.buffered.start(_),E=u.buffered.end(_);this._pendingRemoveRanges[d].push({start:g,end:E})}if(u.updating||this._doRemoveRanges(),o.default.safari){var L=this._lastInitSegments[d];L&&(this._pendingSegments[d].push(L),u.updating||this._doAppendSegments())}}}},s.prototype.endOfStream=function(){var i=this._mediaSource,d=this._sourceBuffers;if(!i||i.readyState!=="open"){i&&i.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}d.video&&d.video.updating||d.audio&&d.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,i.endOfStream())},s.prototype.getNearestKeyframe=function(i){return this._idrList.getLastSyncPointBeforeDts(i)},s.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var i=this._mediaElement.currentTime;for(var d in this._sourceBuffers){var u=this._sourceBuffers[d];if(u){var r=u.buffered;if(r.length>=1&&i-r.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},s.prototype._doCleanupSourceBuffer=function(){var i=this._mediaElement.currentTime;for(var d in this._sourceBuffers){var u=this._sourceBuffers[d];if(u){for(var r=u.buffered,_=!1,g=0;g<r.length;g++){var E=r.start(g),L=r.end(g);if(E<=i&&i<L+3){if(i-E>=this._config.autoCleanupMaxBackwardDuration){_=!0;var R=i-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[d].push({start:E,end:R})}}else L<i&&(_=!0,this._pendingRemoveRanges[d].push({start:E,end:L}))}_&&!u.updating&&this._doRemoveRanges()}}},s.prototype._updateMediaSourceDuration=function(){var i=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(i.video&&i.video.updating||i.audio&&i.audio.updating)){var d=this._mediaSource.duration,u=this._pendingMediaDuration;u>0&&(isNaN(d)||u>d)&&(c.default.v(this.TAG,"Update MediaSource duration from "+d+" to "+u),this._mediaSource.duration=u),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},s.prototype._doRemoveRanges=function(){for(var i in this._pendingRemoveRanges)if(!(!this._sourceBuffers[i]||this._sourceBuffers[i].updating))for(var d=this._sourceBuffers[i],u=this._pendingRemoveRanges[i];u.length&&!d.updating;){var r=u.shift();d.remove(r.start,r.end)}},s.prototype._doAppendSegments=function(){var i=this._pendingSegments;for(var d in i)if(!(!this._sourceBuffers[d]||this._sourceBuffers[d].updating)&&i[d].length>0){var u=i[d].shift();if(u.timestampOffset){var r=this._sourceBuffers[d].timestampOffset,_=u.timestampOffset/1e3,g=Math.abs(r-_);g>.1&&(c.default.v(this.TAG,"Update MPEG audio timestampOffset from "+r+" to "+_),this._sourceBuffers[d].timestampOffset=_),delete u.timestampOffset}if(!u.data||u.data.byteLength===0)continue;try{this._sourceBuffers[d].appendBuffer(u.data),this._isBufferFull=!1,d==="video"&&u.hasOwnProperty("info")&&this._idrList.appendArray(u.info.syncPoints)}catch(E){this._pendingSegments[d].unshift(u),E.code===22?(this._isBufferFull||this._emitter.emit(p.default.BUFFER_FULL),this._isBufferFull=!0):(c.default.e(this.TAG,E.message),this._emitter.emit(p.default.ERROR,{code:E.code,msg:E.message}))}}},s.prototype._onSourceOpen=function(){if(c.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var i=this._pendingSourceBufferInit;i.length;){var d=i.shift();this.appendInitSegment(d,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(p.default.SOURCE_OPEN)},s.prototype._onSourceEnded=function(){c.default.v(this.TAG,"MediaSource onSourceEnded")},s.prototype._onSourceClose=function(){c.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},s.prototype._hasPendingSegments=function(){var i=this._pendingSegments;return i.video.length>0||i.audio.length>0},s.prototype._hasPendingRemoveRanges=function(){var i=this._pendingRemoveRanges;return i.video.length>0||i.audio.length>0},s.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(p.default.UPDATE_END)},s.prototype._onSourceBufferError=function(i){c.default.e(this.TAG,"SourceBuffer Error: "+i)},s}();b.default=h},"./src/core/mse-events.js":function(O,b,v){v.r(b);var y={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};b.default=y},"./src/core/transmuxer.js":function(O,b,v){v.r(b);var y=v("./node_modules/events/events.js"),m=v.n(y),c=v("./node_modules/webworkify-webpack/index.js"),o=v.n(c),p=v("./src/utils/logger.js"),l=v("./src/utils/logging-control.js"),f=v("./src/core/transmuxing-controller.js"),h=v("./src/core/transmuxing-events.js"),s=v("./src/core/media-info.js"),i=function(){function d(u,r){if(this.TAG="Transmuxer",this._emitter=new(m()),r.enableWorker&&typeof Worker<"u")try{this._worker=o()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[u,r]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},l.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:l.default.getConfig()})}catch{p.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new f.default(u,r)}else this._controller=new f.default(u,r);if(this._controller){var _=this._controller;_.on(h.default.IO_ERROR,this._onIOError.bind(this)),_.on(h.default.DEMUX_ERROR,this._onDemuxError.bind(this)),_.on(h.default.INIT_SEGMENT,this._onInitSegment.bind(this)),_.on(h.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),_.on(h.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),_.on(h.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),_.on(h.default.MEDIA_INFO,this._onMediaInfo.bind(this)),_.on(h.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),_.on(h.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),_.on(h.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),_.on(h.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return d.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),l.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},d.prototype.on=function(u,r){this._emitter.addListener(u,r)},d.prototype.off=function(u,r){this._emitter.removeListener(u,r)},d.prototype.hasWorker=function(){return this._worker!=null},d.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},d.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},d.prototype.seek=function(u){this._worker?this._worker.postMessage({cmd:"seek",param:u}):this._controller.seek(u)},d.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},d.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},d.prototype._onInitSegment=function(u,r){var _=this;Promise.resolve().then(function(){_._emitter.emit(h.default.INIT_SEGMENT,u,r)})},d.prototype._onMediaSegment=function(u,r){var _=this;Promise.resolve().then(function(){_._emitter.emit(h.default.MEDIA_SEGMENT,u,r)})},d.prototype._onLoadingComplete=function(){var u=this;Promise.resolve().then(function(){u._emitter.emit(h.default.LOADING_COMPLETE)})},d.prototype._onRecoveredEarlyEof=function(){var u=this;Promise.resolve().then(function(){u._emitter.emit(h.default.RECOVERED_EARLY_EOF)})},d.prototype._onMediaInfo=function(u){var r=this;Promise.resolve().then(function(){r._emitter.emit(h.default.MEDIA_INFO,u)})},d.prototype._onMetaDataArrived=function(u){var r=this;Promise.resolve().then(function(){r._emitter.emit(h.default.METADATA_ARRIVED,u)})},d.prototype._onScriptDataArrived=function(u){var r=this;Promise.resolve().then(function(){r._emitter.emit(h.default.SCRIPTDATA_ARRIVED,u)})},d.prototype._onStatisticsInfo=function(u){var r=this;Promise.resolve().then(function(){r._emitter.emit(h.default.STATISTICS_INFO,u)})},d.prototype._onIOError=function(u,r){var _=this;Promise.resolve().then(function(){_._emitter.emit(h.default.IO_ERROR,u,r)})},d.prototype._onDemuxError=function(u,r){var _=this;Promise.resolve().then(function(){_._emitter.emit(h.default.DEMUX_ERROR,u,r)})},d.prototype._onRecommendSeekpoint=function(u){var r=this;Promise.resolve().then(function(){r._emitter.emit(h.default.RECOMMEND_SEEKPOINT,u)})},d.prototype._onLoggingConfigChanged=function(u){this._worker&&this._worker.postMessage({cmd:"logging_config",param:u})},d.prototype._onWorkerMessage=function(u){var r=u.data,_=r.data;if(r.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(r.msg){case h.default.INIT_SEGMENT:case h.default.MEDIA_SEGMENT:this._emitter.emit(r.msg,_.type,_.data);break;case h.default.LOADING_COMPLETE:case h.default.RECOVERED_EARLY_EOF:this._emitter.emit(r.msg);break;case h.default.MEDIA_INFO:Object.setPrototypeOf(_,s.default.prototype),this._emitter.emit(r.msg,_);break;case h.default.METADATA_ARRIVED:case h.default.SCRIPTDATA_ARRIVED:case h.default.STATISTICS_INFO:this._emitter.emit(r.msg,_);break;case h.default.IO_ERROR:case h.default.DEMUX_ERROR:this._emitter.emit(r.msg,_.type,_.info);break;case h.default.RECOMMEND_SEEKPOINT:this._emitter.emit(r.msg,_);break;case"logcat_callback":p.default.emitter.emit("log",_.type,_.logcat);break}},d}();b.default=i},"./src/core/transmuxing-controller.js":function(O,b,v){v.r(b);var y=v("./node_modules/events/events.js"),m=v.n(y),c=v("./src/utils/logger.js"),o=v("./src/utils/browser.js"),p=v("./src/core/media-info.js"),l=v("./src/demux/flv-demuxer.js"),f=v("./src/remux/mp4-remuxer.js"),h=v("./src/demux/demux-errors.js"),s=v("./src/io/io-controller.js"),i=v("./src/core/transmuxing-events.js"),d=function(){function u(r,_){this.TAG="TransmuxingController",this._emitter=new(m()),this._config=_,r.segments||(r.segments=[{duration:r.duration,filesize:r.filesize,url:r.url}]),typeof r.cors!="boolean"&&(r.cors=!0),typeof r.withCredentials!="boolean"&&(r.withCredentials=!1),this._mediaDataSource=r,this._currentSegmentIndex=0;var g=0;this._mediaDataSource.segments.forEach(function(E){E.timestampBase=g,g+=E.duration,E.cors=r.cors,E.withCredentials=r.withCredentials,_.referrerPolicy&&(E.referrerPolicy=_.referrerPolicy)}),!isNaN(g)&&this._mediaDataSource.duration!==g&&(this._mediaDataSource.duration=g),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return u.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},u.prototype.on=function(r,_){this._emitter.addListener(r,_)},u.prototype.off=function(r,_){this._emitter.removeListener(r,_)},u.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},u.prototype._loadSegment=function(r,_){this._currentSegmentIndex=r;var g=this._mediaDataSource.segments[r],E=this._ioctl=new s.default(g,this._config,r);E.onError=this._onIOException.bind(this),E.onSeeked=this._onIOSeeked.bind(this),E.onComplete=this._onIOComplete.bind(this),E.onRedirect=this._onIORedirect.bind(this),E.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),_?this._demuxer.bindDataSource(this._ioctl):E.onDataArrival=this._onInitChunkArrival.bind(this),E.open(_)},u.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},u.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},u.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},u.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},u.prototype.seek=function(r){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var _=this._searchSegmentIndexContains(r);if(_===this._currentSegmentIndex){var g=this._mediaInfo.segments[_];if(g==null)this._pendingSeekTime=r;else{var E=g.getNearestKeyframe(r);this._remuxer.seek(E.milliseconds),this._ioctl.seek(E.fileposition),this._pendingResolveSeekPoint=E.milliseconds}}else{var L=this._mediaInfo.segments[_];if(L==null)this._pendingSeekTime=r,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(_);else{var E=L.getNearestKeyframe(r);this._internalAbort(),this._remuxer.seek(r),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[_].timestampBase,this._loadSegment(_,E.fileposition),this._pendingResolveSeekPoint=E.milliseconds,this._reportSegmentMediaInfo(_)}}this._enableStatisticsReporter()}},u.prototype._searchSegmentIndexContains=function(r){for(var _=this._mediaDataSource.segments,g=_.length-1,E=0;E<_.length;E++)if(r<_[E].timestampBase){g=E-1;break}return g},u.prototype._onInitChunkArrival=function(r,_){var g=this,E=null,L=0;if(_>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,L=this._demuxer.parseChunks(r,_);else if((E=l.default.probe(r)).match){this._demuxer=new l.default(E,this._config),this._remuxer||(this._remuxer=new f.default(this._config));var R=this._mediaDataSource;R.duration!=null&&!isNaN(R.duration)&&(this._demuxer.overridedDuration=R.duration),typeof R.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=R.hasAudio),typeof R.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=R.hasVideo),this._demuxer.timestampBase=R.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),L=this._demuxer.parseChunks(r,_)}else E=null,c.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){g._internalAbort()}),this._emitter.emit(i.default.DEMUX_ERROR,h.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),L=0;return L},u.prototype._onMediaInfo=function(r){var _=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},r),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,p.default.prototype));var g=Object.assign({},r);Object.setPrototypeOf(g,p.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=g,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var E=_._pendingSeekTime;_._pendingSeekTime=null,_.seek(E)})},u.prototype._onMetaDataArrived=function(r){this._emitter.emit(i.default.METADATA_ARRIVED,r)},u.prototype._onScriptDataArrived=function(r){this._emitter.emit(i.default.SCRIPTDATA_ARRIVED,r)},u.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},u.prototype._onIOComplete=function(r){var _=r,g=_+1;g<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(g)):(this._remuxer.flushStashedSamples(),this._emitter.emit(i.default.LOADING_COMPLETE),this._disableStatisticsReporter())},u.prototype._onIORedirect=function(r){var _=this._ioctl.extraData;this._mediaDataSource.segments[_].redirectedURL=r},u.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(i.default.RECOVERED_EARLY_EOF)},u.prototype._onIOException=function(r,_){c.default.e(this.TAG,"IOException: type = "+r+", code = "+_.code+", msg = "+_.msg),this._emitter.emit(i.default.IO_ERROR,r,_),this._disableStatisticsReporter()},u.prototype._onDemuxException=function(r,_){c.default.e(this.TAG,"DemuxException: type = "+r+", info = "+_),this._emitter.emit(i.default.DEMUX_ERROR,r,_)},u.prototype._onRemuxerInitSegmentArrival=function(r,_){this._emitter.emit(i.default.INIT_SEGMENT,r,_)},u.prototype._onRemuxerMediaSegmentArrival=function(r,_){if(this._pendingSeekTime==null&&(this._emitter.emit(i.default.MEDIA_SEGMENT,r,_),this._pendingResolveSeekPoint!=null&&r==="video")){var g=_.info.syncPoints,E=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,o.default.safari&&g.length>0&&g[0].originalDts===E&&(E=g[0].pts),this._emitter.emit(i.default.RECOMMEND_SEEKPOINT,E)}},u.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},u.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},u.prototype._reportSegmentMediaInfo=function(r){var _=this._mediaInfo.segments[r],g=Object.assign({},_);g.duration=this._mediaInfo.duration,g.segmentCount=this._mediaInfo.segmentCount,delete g.segments,delete g.keyframesIndex,this._emitter.emit(i.default.MEDIA_INFO,g)},u.prototype._reportStatisticsInfo=function(){var r={};r.url=this._ioctl.currentURL,r.hasRedirect=this._ioctl.hasRedirect,r.hasRedirect&&(r.redirectedURL=this._ioctl.currentRedirectedURL),r.speed=this._ioctl.currentSpeed,r.loaderType=this._ioctl.loaderType,r.currentSegmentIndex=this._currentSegmentIndex,r.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(i.default.STATISTICS_INFO,r)},u}();b.default=d},"./src/core/transmuxing-events.js":function(O,b,v){v.r(b);var y={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};b.default=y},"./src/core/transmuxing-worker.js":function(O,b,v){v.r(b);var y=v("./src/utils/logging-control.js"),m=v("./src/utils/polyfill.js"),c=v("./src/core/transmuxing-controller.js"),o=v("./src/core/transmuxing-events.js"),p=function(l){var f=null,h=x.bind(this);m.default.install(),l.addEventListener("message",function(A){switch(A.data.cmd){case"init":f=new c.default(A.data.param[0],A.data.param[1]),f.on(o.default.IO_ERROR,L.bind(this)),f.on(o.default.DEMUX_ERROR,R.bind(this)),f.on(o.default.INIT_SEGMENT,s.bind(this)),f.on(o.default.MEDIA_SEGMENT,i.bind(this)),f.on(o.default.LOADING_COMPLETE,d.bind(this)),f.on(o.default.RECOVERED_EARLY_EOF,u.bind(this)),f.on(o.default.MEDIA_INFO,r.bind(this)),f.on(o.default.METADATA_ARRIVED,_.bind(this)),f.on(o.default.SCRIPTDATA_ARRIVED,g.bind(this)),f.on(o.default.STATISTICS_INFO,E.bind(this)),f.on(o.default.RECOMMEND_SEEKPOINT,C.bind(this));break;case"destroy":f&&(f.destroy(),f=null),l.postMessage({msg:"destroyed"});break;case"start":f.start();break;case"stop":f.stop();break;case"seek":f.seek(A.data.param);break;case"pause":f.pause();break;case"resume":f.resume();break;case"logging_config":{var w=A.data.param;y.default.applyConfig(w),w.enableCallback===!0?y.default.addLogListener(h):y.default.removeLogListener(h);break}}});function s(A,w){var I={msg:o.default.INIT_SEGMENT,data:{type:A,data:w}};l.postMessage(I,[w.data])}function i(A,w){var I={msg:o.default.MEDIA_SEGMENT,data:{type:A,data:w}};l.postMessage(I,[w.data])}function d(){var A={msg:o.default.LOADING_COMPLETE};l.postMessage(A)}function u(){var A={msg:o.default.RECOVERED_EARLY_EOF};l.postMessage(A)}function r(A){var w={msg:o.default.MEDIA_INFO,data:A};l.postMessage(w)}function _(A){var w={msg:o.default.METADATA_ARRIVED,data:A};l.postMessage(w)}function g(A){var w={msg:o.default.SCRIPTDATA_ARRIVED,data:A};l.postMessage(w)}function E(A){var w={msg:o.default.STATISTICS_INFO,data:A};l.postMessage(w)}function L(A,w){l.postMessage({msg:o.default.IO_ERROR,data:{type:A,info:w}})}function R(A,w){l.postMessage({msg:o.default.DEMUX_ERROR,data:{type:A,info:w}})}function C(A){l.postMessage({msg:o.default.RECOMMEND_SEEKPOINT,data:A})}function x(A,w){l.postMessage({msg:"logcat_callback",data:{type:A,logcat:w}})}};b.default=p},"./src/demux/amf-parser.js":function(O,b,v){v.r(b);var y=v("./src/utils/logger.js"),m=v("./src/utils/utf8-conv.js"),c=v("./src/utils/exception.js"),o=function(){var l=new ArrayBuffer(2);return new DataView(l).setInt16(0,256,!0),new Int16Array(l)[0]===256}(),p=function(){function l(){}return l.parseScriptData=function(f,h,s){var i={};try{var d=l.parseValue(f,h,s),u=l.parseValue(f,h+d.size,s-d.size);i[d.data]=u.data}catch(r){y.default.e("AMF",r.toString())}return i},l.parseObject=function(f,h,s){if(s<3)throw new c.IllegalStateException("Data not enough when parse ScriptDataObject");var i=l.parseString(f,h,s),d=l.parseValue(f,h+i.size,s-i.size),u=d.objectEnd;return{data:{name:i.data,value:d.data},size:i.size+d.size,objectEnd:u}},l.parseVariable=function(f,h,s){return l.parseObject(f,h,s)},l.parseString=function(f,h,s){if(s<2)throw new c.IllegalStateException("Data not enough when parse String");var i=new DataView(f,h,s),d=i.getUint16(0,!o),u;return d>0?u=(0,m.default)(new Uint8Array(f,h+2,d)):u="",{data:u,size:2+d}},l.parseLongString=function(f,h,s){if(s<4)throw new c.IllegalStateException("Data not enough when parse LongString");var i=new DataView(f,h,s),d=i.getUint32(0,!o),u;return d>0?u=(0,m.default)(new Uint8Array(f,h+4,d)):u="",{data:u,size:4+d}},l.parseDate=function(f,h,s){if(s<10)throw new c.IllegalStateException("Data size invalid when parse Date");var i=new DataView(f,h,s),d=i.getFloat64(0,!o),u=i.getInt16(8,!o);return d+=u*60*1e3,{data:new Date(d),size:8+2}},l.parseValue=function(f,h,s){if(s<1)throw new c.IllegalStateException("Data not enough when parse Value");var i=new DataView(f,h,s),d=1,u=i.getUint8(0),r,_=!1;try{switch(u){case 0:r=i.getFloat64(1,!o),d+=8;break;case 1:{var g=i.getUint8(1);r=!!g,d+=1;break}case 2:{var E=l.parseString(f,h+1,s-1);r=E.data,d+=E.size;break}case 3:{r={};var L=0;for((i.getUint32(s-4,!o)&16777215)===9&&(L=3);d<s-4;){var R=l.parseObject(f,h+d,s-d-L);if(R.objectEnd)break;r[R.data.name]=R.data.value,d+=R.size}if(d<=s-3){var C=i.getUint32(d-1,!o)&16777215;C===9&&(d+=3)}break}case 8:{r={},d+=4;var L=0;for((i.getUint32(s-4,!o)&16777215)===9&&(L=3);d<s-8;){var x=l.parseVariable(f,h+d,s-d-L);if(x.objectEnd)break;r[x.data.name]=x.data.value,d+=x.size}if(d<=s-3){var C=i.getUint32(d-1,!o)&16777215;C===9&&(d+=3)}break}case 9:r=void 0,d=1,_=!0;break;case 10:{r=[];var A=i.getUint32(1,!o);d+=4;for(var w=0;w<A;w++){var I=l.parseValue(f,h+d,s-d);r.push(I.data),d+=I.size}break}case 11:{var P=l.parseDate(f,h+1,s-1);r=P.data,d+=P.size;break}case 12:{var M=l.parseString(f,h+1,s-1);r=M.data,d+=M.size;break}default:d=s,y.default.w("AMF","Unsupported AMF value type "+u)}}catch(J){y.default.e("AMF",J.toString())}return{data:r,size:d,objectEnd:_}},l}();b.default=p},"./src/demux/demux-errors.js":function(O,b,v){v.r(b);var y={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};b.default=y},"./src/demux/exp-golomb.js":function(O,b,v){v.r(b);var y=v("./src/utils/exception.js"),m=function(){function c(o){this.TAG="ExpGolomb",this._buffer=o,this._buffer_index=0,this._total_bytes=o.byteLength,this._total_bits=o.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return c.prototype.destroy=function(){this._buffer=null},c.prototype._fillCurrentWord=function(){var o=this._total_bytes-this._buffer_index;if(o<=0)throw new y.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var p=Math.min(4,o),l=new Uint8Array(4);l.set(this._buffer.subarray(this._buffer_index,this._buffer_index+p)),this._current_word=new DataView(l.buffer).getUint32(0,!1),this._buffer_index+=p,this._current_word_bits_left=p*8},c.prototype.readBits=function(o){if(o>32)throw new y.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(o<=this._current_word_bits_left){var p=this._current_word>>>32-o;return this._current_word<<=o,this._current_word_bits_left-=o,p}var l=this._current_word_bits_left?this._current_word:0;l=l>>>32-this._current_word_bits_left;var f=o-this._current_word_bits_left;this._fillCurrentWord();var h=Math.min(f,this._current_word_bits_left),s=this._current_word>>>32-h;return this._current_word<<=h,this._current_word_bits_left-=h,l=l<<h|s,l},c.prototype.readBool=function(){return this.readBits(1)===1},c.prototype.readByte=function(){return this.readBits(8)},c.prototype._skipLeadingZero=function(){var o;for(o=0;o<this._current_word_bits_left;o++)if(this._current_word&2147483648>>>o)return this._current_word<<=o,this._current_word_bits_left-=o,o;return this._fillCurrentWord(),o+this._skipLeadingZero()},c.prototype.readUEG=function(){var o=this._skipLeadingZero();return this.readBits(o+1)-1},c.prototype.readSEG=function(){var o=this.readUEG();return o&1?o+1>>>1:-1*(o>>>1)},c}();b.default=m},"./src/demux/flv-demuxer.js":function(O,b,v){v.r(b);var y=v("./src/utils/logger.js"),m=v("./src/demux/amf-parser.js"),c=v("./src/demux/sps-parser.js"),o=v("./src/demux/demux-errors.js"),p=v("./src/core/media-info.js"),l=v("./src/utils/exception.js");function f(s,i){return s[i]<<24|s[i+1]<<16|s[i+2]<<8|s[i+3]}var h=function(){function s(i,d){this.TAG="FLVDemuxer",this._config=d,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=i.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=i.hasAudioTrack,this._hasVideo=i.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new p.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var u=new ArrayBuffer(2);return new DataView(u).setInt16(0,256,!0),new Int16Array(u)[0]===256}()}return s.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},s.probe=function(i){var d=new Uint8Array(i),u={match:!1};if(d[0]!==70||d[1]!==76||d[2]!==86||d[3]!==1)return u;var r=(d[4]&4)>>>2!==0,_=(d[4]&1)!==0,g=f(d,5);return g<9?u:{match:!0,consumed:g,dataOffset:g,hasAudioTrack:r,hasVideoTrack:_}},s.prototype.bindDataSource=function(i){return i.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(s.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(i){this._onTrackMetadata=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(i){this._onMediaInfo=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(i){this._onMetaDataArrived=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(i){this._onScriptDataArrived=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onError",{get:function(){return this._onError},set:function(i){this._onError=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(i){this._onDataAvailable=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(i){this._timestampBase=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"overridedDuration",{get:function(){return this._duration},set:function(i){this._durationOverrided=!0,this._duration=i,this._mediaInfo.duration=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"overridedHasAudio",{set:function(i){this._hasAudioFlagOverrided=!0,this._hasAudio=i,this._mediaInfo.hasAudio=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"overridedHasVideo",{set:function(i){this._hasVideoFlagOverrided=!0,this._hasVideo=i,this._mediaInfo.hasVideo=i},enumerable:!1,configurable:!0}),s.prototype.resetMediaInfo=function(){this._mediaInfo=new p.default},s.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},s.prototype.parseChunks=function(i,d){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new l.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var u=0,r=this._littleEndian;if(d===0)if(i.byteLength>13){var _=s.probe(i);u=_.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,d+u!==this._dataOffset&&y.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var g=new DataView(i,u),E=g.getUint32(0,!r);E!==0&&y.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),u+=4}for(;u<i.byteLength;){this._dispatch=!0;var g=new DataView(i,u);if(u+11+4>i.byteLength)break;var L=g.getUint8(0),R=g.getUint32(0,!r)&16777215;if(u+11+R+4>i.byteLength)break;if(L!==8&&L!==9&&L!==18){y.default.w(this.TAG,"Unsupported tag type "+L+", skipped"),u+=11+R+4;continue}var C=g.getUint8(4),x=g.getUint8(5),A=g.getUint8(6),w=g.getUint8(7),I=A|x<<8|C<<16|w<<24,P=g.getUint32(7,!r)&16777215;P!==0&&y.default.w(this.TAG,"Meet tag which has StreamID != 0!");var M=u+11;switch(L){case 8:this._parseAudioData(i,M,R,I);break;case 9:this._parseVideoData(i,M,R,I,d+u);break;case 18:this._parseScriptData(i,M,R);break}var J=g.getUint32(11+R,!r);J!==11+R&&y.default.w(this.TAG,"Invalid PrevTagSize "+J),u+=11+R+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),u},s.prototype._parseScriptData=function(i,d,u){var r=m.default.parseScriptData(i,d,u);if(r.hasOwnProperty("onMetaData")){if(r.onMetaData==null||typeof r.onMetaData!="object"){y.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&y.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=r;var _=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},_)),typeof _.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=_.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof _.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=_.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof _.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=_.audiodatarate),typeof _.videodatarate=="number"&&(this._mediaInfo.videoDataRate=_.videodatarate),typeof _.width=="number"&&(this._mediaInfo.width=_.width),typeof _.height=="number"&&(this._mediaInfo.height=_.height),typeof _.duration=="number"){if(!this._durationOverrided){var g=Math.floor(_.duration*this._timescale);this._duration=g,this._mediaInfo.duration=g}}else this._mediaInfo.duration=0;if(typeof _.framerate=="number"){var E=Math.floor(_.framerate*1e3);if(E>0){var L=E/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=L,this._referenceFrameRate.fps_num=E,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=L}}if(typeof _.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var R=_.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(R),_.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=_,y.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(r).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},r))},s.prototype._parseKeyframesIndex=function(i){for(var d=[],u=[],r=1;r<i.times.length;r++){var _=this._timestampBase+Math.floor(i.times[r]*1e3);d.push(_),u.push(i.filepositions[r])}return{times:d,filepositions:u}},s.prototype._parseAudioData=function(i,d,u,r){if(u<=1){y.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var _=new DataView(i,d,u),g=_.getUint8(0),E=g>>>4;if(E!==2&&E!==10){this._onError(o.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+E);return}var L=0,R=(g&12)>>>2;if(R>=0&&R<=4)L=this._flvSoundRateTable[R];else{this._onError(o.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+R);return}var C=g&1,x=this._audioMetadata,A=this._audioTrack;if(x||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),x=this._audioMetadata={},x.type="audio",x.id=A.id,x.timescale=this._timescale,x.duration=this._duration,x.audioSampleRate=L,x.channelCount=C===0?1:2),E===10){var w=this._parseAACAudioData(i,d+1,u-1);if(w==null)return;if(w.packetType===0){x.config&&y.default.w(this.TAG,"Found another AudioSpecificConfig!");var I=w.data;x.audioSampleRate=I.samplingRate,x.channelCount=I.channelCount,x.codec=I.codec,x.originalCodec=I.originalCodec,x.config=I.config,x.refSampleDuration=1024/x.audioSampleRate*x.timescale,y.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",x);var P=this._mediaInfo;P.audioCodec=x.originalCodec,P.audioSampleRate=x.audioSampleRate,P.audioChannelCount=x.channelCount,P.hasVideo?P.videoCodec!=null&&(P.mimeType='video/x-flv; codecs="'+P.videoCodec+","+P.audioCodec+'"'):P.mimeType='video/x-flv; codecs="'+P.audioCodec+'"',P.isComplete()&&this._onMediaInfo(P)}else if(w.packetType===1){var M=this._timestampBase+r,J={unit:w.data,length:w.data.byteLength,dts:M,pts:M};A.samples.push(J),A.length+=w.data.length}else y.default.e(this.TAG,"Flv: Unsupported AAC data type "+w.packetType)}else if(E===2){if(!x.codec){var I=this._parseMP3AudioData(i,d+1,u-1,!0);if(I==null)return;x.audioSampleRate=I.samplingRate,x.channelCount=I.channelCount,x.codec=I.codec,x.originalCodec=I.originalCodec,x.refSampleDuration=1152/x.audioSampleRate*x.timescale,y.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",x);var P=this._mediaInfo;P.audioCodec=x.codec,P.audioSampleRate=x.audioSampleRate,P.audioChannelCount=x.channelCount,P.audioDataRate=I.bitRate,P.hasVideo?P.videoCodec!=null&&(P.mimeType='video/x-flv; codecs="'+P.videoCodec+","+P.audioCodec+'"'):P.mimeType='video/x-flv; codecs="'+P.audioCodec+'"',P.isComplete()&&this._onMediaInfo(P)}var Q=this._parseMP3AudioData(i,d+1,u-1,!1);if(Q==null)return;var M=this._timestampBase+r,$={unit:Q,length:Q.byteLength,dts:M,pts:M};A.samples.push($),A.length+=Q.length}}},s.prototype._parseAACAudioData=function(i,d,u){if(u<=1){y.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var r={},_=new Uint8Array(i,d,u);return r.packetType=_[0],_[0]===0?r.data=this._parseAACAudioSpecificConfig(i,d+1,u-1):r.data=_.subarray(1),r},s.prototype._parseAACAudioSpecificConfig=function(i,d,u){var r=new Uint8Array(i,d,u),_=null,g=0,E=0,L=0,R=null;if(g=E=r[0]>>>3,L=(r[0]&7)<<1|r[1]>>>7,L<0||L>=this._mpegSamplingRates.length){this._onError(o.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var C=this._mpegSamplingRates[L],x=(r[1]&120)>>>3;if(x<0||x>=8){this._onError(o.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}g===5&&(R=(r[1]&7)<<1|r[2]>>>7,(r[2]&124)>>>2);var A=self.navigator.userAgent.toLowerCase();return A.indexOf("firefox")!==-1?L>=6?(g=5,_=new Array(4),R=L-3):(g=2,_=new Array(2),R=L):A.indexOf("android")!==-1?(g=2,_=new Array(2),R=L):(g=5,R=L,_=new Array(4),L>=6?R=L-3:x===1&&(g=2,_=new Array(2),R=L)),_[0]=g<<3,_[0]|=(L&15)>>>1,_[1]=(L&15)<<7,_[1]|=(x&15)<<3,g===5&&(_[1]|=(R&15)>>>1,_[2]=(R&1)<<7,_[2]|=8,_[3]=0),{config:_,samplingRate:C,channelCount:x,codec:"mp4a.40."+g,originalCodec:"mp4a.40."+E}},s.prototype._parseMP3AudioData=function(i,d,u,r){if(u<4){y.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var _=new Uint8Array(i,d,u),g=null;if(r){if(_[0]!==255)return;var E=_[1]>>>3&3,L=(_[1]&6)>>1,R=(_[2]&240)>>>4,C=(_[2]&12)>>>2,x=_[3]>>>6&3,A=x!==3?2:1,w=0,I=0,P="mp3";switch(E){case 0:w=this._mpegAudioV25SampleRateTable[C];break;case 2:w=this._mpegAudioV20SampleRateTable[C];break;case 3:w=this._mpegAudioV10SampleRateTable[C];break}switch(L){case 1:R<this._mpegAudioL3BitRateTable.length&&(I=this._mpegAudioL3BitRateTable[R]);break;case 2:R<this._mpegAudioL2BitRateTable.length&&(I=this._mpegAudioL2BitRateTable[R]);break;case 3:R<this._mpegAudioL1BitRateTable.length&&(I=this._mpegAudioL1BitRateTable[R]);break}g={bitRate:I,samplingRate:w,channelCount:A,codec:P,originalCodec:P}}else g=_;return g},s.prototype._parseVideoData=function(i,d,u,r,_){if(u<=1){y.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var g=new Uint8Array(i,d,u)[0],E=(g&240)>>>4,L=g&15;if(L!==7){this._onError(o.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+L);return}this._parseAVCVideoPacket(i,d+1,u-1,r,_,E)}},s.prototype._parseAVCVideoPacket=function(i,d,u,r,_,g){if(u<4){y.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var E=this._littleEndian,L=new DataView(i,d,u),R=L.getUint8(0),C=L.getUint32(0,!E)&16777215,x=C<<8>>8;if(R===0)this._parseAVCDecoderConfigurationRecord(i,d+4,u-4);else if(R===1)this._parseAVCVideoData(i,d+4,u-4,r,_,g,x);else if(R!==2){this._onError(o.default.FORMAT_ERROR,"Flv: Invalid video packet type "+R);return}},s.prototype._parseAVCDecoderConfigurationRecord=function(i,d,u){if(u<7){y.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var r=this._videoMetadata,_=this._videoTrack,g=this._littleEndian,E=new DataView(i,d,u);r?typeof r.avcc<"u"&&y.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),r=this._videoMetadata={},r.type="video",r.id=_.id,r.timescale=this._timescale,r.duration=this._duration);var L=E.getUint8(0),R=E.getUint8(1);if(E.getUint8(2),E.getUint8(3),L!==1||R===0){this._onError(o.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(E.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(o.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var C=E.getUint8(5)&31;if(C===0){this._onError(o.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else C>1&&y.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+C);for(var x=6,A=0;A<C;A++){var w=E.getUint16(x,!g);if(x+=2,w!==0){var I=new Uint8Array(i,d+x,w);x+=w;var P=c.default.parseSPS(I);if(A===0){r.codecWidth=P.codec_size.width,r.codecHeight=P.codec_size.height,r.presentWidth=P.present_size.width,r.presentHeight=P.present_size.height,r.profile=P.profile_string,r.level=P.level_string,r.bitDepth=P.bit_depth,r.chromaFormat=P.chroma_format,r.sarRatio=P.sar_ratio,r.frameRate=P.frame_rate,(P.frame_rate.fixed===!1||P.frame_rate.fps_num===0||P.frame_rate.fps_den===0)&&(r.frameRate=this._referenceFrameRate);var M=r.frameRate.fps_den,J=r.frameRate.fps_num;r.refSampleDuration=r.timescale*(M/J);for(var Q=I.subarray(1,4),$="avc1.",ne=0;ne<3;ne++){var ce=Q[ne].toString(16);ce.length<2&&(ce="0"+ce),$+=ce}r.codec=$;var Y=this._mediaInfo;Y.width=r.codecWidth,Y.height=r.codecHeight,Y.fps=r.frameRate.fps,Y.profile=r.profile,Y.level=r.level,Y.refFrames=P.ref_frames,Y.chromaFormat=P.chroma_format_string,Y.sarNum=r.sarRatio.width,Y.sarDen=r.sarRatio.height,Y.videoCodec=$,Y.hasAudio?Y.audioCodec!=null&&(Y.mimeType='video/x-flv; codecs="'+Y.videoCodec+","+Y.audioCodec+'"'):Y.mimeType='video/x-flv; codecs="'+Y.videoCodec+'"',Y.isComplete()&&this._onMediaInfo(Y)}}}var re=E.getUint8(x);if(re===0){this._onError(o.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else re>1&&y.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+re);x++;for(var A=0;A<re;A++){var w=E.getUint16(x,!g);x+=2,w!==0&&(x+=w)}r.avcc=new Uint8Array(u),r.avcc.set(new Uint8Array(i,d,u),0),y.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",r)},s.prototype._parseAVCVideoData=function(i,d,u,r,_,g,E){for(var L=this._littleEndian,R=new DataView(i,d,u),C=[],x=0,A=0,w=this._naluLengthSize,I=this._timestampBase+r,P=g===1;A<u;){if(A+4>=u){y.default.w(this.TAG,"Malformed Nalu near timestamp "+I+", offset = "+A+", dataSize = "+u);break}var M=R.getUint32(A,!L);if(w===3&&(M>>>=8),M>u-w){y.default.w(this.TAG,"Malformed Nalus near timestamp "+I+", NaluSize > DataSize!");return}var J=R.getUint8(A+w)&31;J===5&&(P=!0);var Q=new Uint8Array(i,d+A,w+M),$={type:J,data:Q};C.push($),x+=Q.byteLength,A+=w+M}if(C.length){var ne=this._videoTrack,ce={units:C,length:x,isKeyframe:P,dts:I,cts:E,pts:I+E};P&&(ce.fileposition=_),ne.samples.push(ce),ne.length+=x}},s}();b.default=h},"./src/demux/sps-parser.js":function(O,b,v){v.r(b);var y=v("./src/demux/exp-golomb.js"),m=function(){function c(){}return c._ebsp2rbsp=function(o){for(var p=o,l=p.byteLength,f=new Uint8Array(l),h=0,s=0;s<l;s++)s>=2&&p[s]===3&&p[s-1]===0&&p[s-2]===0||(f[h]=p[s],h++);return new Uint8Array(f.buffer,0,h)},c.parseSPS=function(o){var p=c._ebsp2rbsp(o),l=new y.default(p);l.readByte();var f=l.readByte();l.readByte();var h=l.readByte();l.readUEG();var s=c.getProfileString(f),i=c.getLevelString(h),d=1,u=420,r=[0,420,422,444],_=8;if((f===100||f===110||f===122||f===244||f===44||f===83||f===86||f===118||f===128||f===138||f===144)&&(d=l.readUEG(),d===3&&l.readBits(1),d<=3&&(u=r[d]),_=l.readUEG()+8,l.readUEG(),l.readBits(1),l.readBool()))for(var g=d!==3?8:12,E=0;E<g;E++)l.readBool()&&(E<6?c._skipScalingList(l,16):c._skipScalingList(l,64));l.readUEG();var L=l.readUEG();if(L===0)l.readUEG();else if(L===1){l.readBits(1),l.readSEG(),l.readSEG();for(var R=l.readUEG(),E=0;E<R;E++)l.readSEG()}var C=l.readUEG();l.readBits(1);var x=l.readUEG(),A=l.readUEG(),w=l.readBits(1);w===0&&l.readBits(1),l.readBits(1);var I=0,P=0,M=0,J=0,Q=l.readBool();Q&&(I=l.readUEG(),P=l.readUEG(),M=l.readUEG(),J=l.readUEG());var $=1,ne=1,ce=0,Y=!0,re=0,Re=0,fe=l.readBool();if(fe){if(l.readBool()){var he=l.readByte(),xe=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],ve=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];he>0&&he<16?($=xe[he-1],ne=ve[he-1]):he===255&&($=l.readByte()<<8|l.readByte(),ne=l.readByte()<<8|l.readByte())}if(l.readBool()&&l.readBool(),l.readBool()&&(l.readBits(4),l.readBool()&&l.readBits(24)),l.readBool()&&(l.readUEG(),l.readUEG()),l.readBool()){var Ee=l.readBits(32),Ae=l.readBits(32);Y=l.readBool(),re=Ae,Re=Ee*2,ce=re/Re}}var oe=1;($!==1||ne!==1)&&(oe=$/ne);var H=0,be=0;if(d===0)H=1,be=2-w;else{var Le=d===3?1:2,Ue=d===1?2:1;H=Le,be=Ue*(2-w)}var Ce=(x+1)*16,Te=(2-w)*((A+1)*16);Ce-=(I+P)*H,Te-=(M+J)*be;var Ke=Math.ceil(Ce*oe);return l.destroy(),l=null,{profile_string:s,level_string:i,bit_depth:_,ref_frames:C,chroma_format:u,chroma_format_string:c.getChromaFormatString(u),frame_rate:{fixed:Y,fps:ce,fps_den:Re,fps_num:re},sar_ratio:{width:$,height:ne},codec_size:{width:Ce,height:Te},present_size:{width:Ke,height:Te}}},c._skipScalingList=function(o,p){for(var l=8,f=8,h=0,s=0;s<p;s++)f!==0&&(h=o.readSEG(),f=(l+h+256)%256),l=f===0?l:f},c.getProfileString=function(o){switch(o){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},c.getLevelString=function(o){return(o/10).toFixed(1)},c.getChromaFormatString=function(o){switch(o){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},c}();b.default=m},"./src/flv.js":function(O,b,v){v.r(b);var y=v("./src/utils/polyfill.js"),m=v("./src/core/features.js"),c=v("./src/io/loader.js"),o=v("./src/player/flv-player.js"),p=v("./src/player/native-player.js"),l=v("./src/player/player-events.js"),f=v("./src/player/player-errors.js"),h=v("./src/utils/logging-control.js"),s=v("./src/utils/exception.js");y.default.install();function i(_,g){var E=_;if(E==null||typeof E!="object")throw new s.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!E.hasOwnProperty("type"))throw new s.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(E.type){case"flv":return new o.default(E,g);default:return new p.default(E,g)}}function d(){return m.default.supportMSEH264Playback()}function u(){return m.default.getFeatureList()}var r={};r.createPlayer=i,r.isSupported=d,r.getFeatureList=u,r.BaseLoader=c.BaseLoader,r.LoaderStatus=c.LoaderStatus,r.LoaderErrors=c.LoaderErrors,r.Events=l.default,r.ErrorTypes=f.ErrorTypes,r.ErrorDetails=f.ErrorDetails,r.FlvPlayer=o.default,r.NativePlayer=p.default,r.LoggingControl=h.default,Object.defineProperty(r,"version",{enumerable:!0,get:function(){return"1.6.2"}}),b.default=r},"./src/index.js":function(O,b,v){O.exports=v("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(O,b,v){v.r(b);var y=v("./src/utils/browser.js"),m=v("./src/io/loader.js"),c=v("./src/utils/exception.js"),o=function(){var l=function(f,h){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,i){s.__proto__=i}||function(s,i){for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(s[d]=i[d])},l(f,h)};return function(f,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");l(f,h);function s(){this.constructor=f}f.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),p=function(l){o(f,l);function f(h,s){var i=l.call(this,"fetch-stream-loader")||this;return i.TAG="FetchStreamLoader",i._seekHandler=h,i._config=s,i._needStash=!0,i._requestAbort=!1,i._contentLength=null,i._receivedLength=0,i}return f.isSupported=function(){try{var h=y.default.msedge&&y.default.version.minor>=15048,s=y.default.msedge?h:!0;return self.fetch&&self.ReadableStream&&s}catch{return!1}},f.prototype.destroy=function(){this.isWorking()&&this.abort(),l.prototype.destroy.call(this)},f.prototype.open=function(h,s){var i=this;this._dataSource=h,this._range=s;var d=h.url;this._config.reuseRedirectedURL&&h.redirectedURL!=null&&(d=h.redirectedURL);var u=this._seekHandler.getConfig(d,s),r=new self.Headers;if(typeof u.headers=="object"){var _=u.headers;for(var g in _)_.hasOwnProperty(g)&&r.append(g,_[g])}var E={method:"GET",headers:r,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var g in this._config.headers)r.append(g,this._config.headers[g]);h.cors===!1&&(E.mode="same-origin"),h.withCredentials&&(E.credentials="include"),h.referrerPolicy&&(E.referrerPolicy=h.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,E.signal=this._abortController.signal),this._status=m.LoaderStatus.kConnecting,self.fetch(u.url,E).then(function(L){if(i._requestAbort){i._status=m.LoaderStatus.kIdle,L.body.cancel();return}if(L.ok&&L.status>=200&&L.status<=299){if(L.url!==u.url&&i._onURLRedirect){var R=i._seekHandler.removeURLParameters(L.url);i._onURLRedirect(R)}var C=L.headers.get("Content-Length");return C!=null&&(i._contentLength=parseInt(C),i._contentLength!==0&&i._onContentLengthKnown&&i._onContentLengthKnown(i._contentLength)),i._pump.call(i,L.body.getReader())}else if(i._status=m.LoaderStatus.kError,i._onError)i._onError(m.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:L.status,msg:L.statusText});else throw new c.RuntimeException("FetchStreamLoader: Http code invalid, "+L.status+" "+L.statusText)}).catch(function(L){if(!(i._abortController&&i._abortController.signal.aborted))if(i._status=m.LoaderStatus.kError,i._onError)i._onError(m.LoaderErrors.EXCEPTION,{code:-1,msg:L.message});else throw L})},f.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==m.LoaderStatus.kBuffering||!y.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},f.prototype._pump=function(h){var s=this;return h.read().then(function(i){if(i.done)if(s._contentLength!==null&&s._receivedLength<s._contentLength){s._status=m.LoaderStatus.kError;var d=m.LoaderErrors.EARLY_EOF,u={code:-1,msg:"Fetch stream meet Early-EOF"};if(s._onError)s._onError(d,u);else throw new c.RuntimeException(u.msg)}else s._status=m.LoaderStatus.kComplete,s._onComplete&&s._onComplete(s._range.from,s._range.from+s._receivedLength-1);else{if(s._abortController&&s._abortController.signal.aborted){s._status=m.LoaderStatus.kComplete;return}else if(s._requestAbort===!0)return s._status=m.LoaderStatus.kComplete,h.cancel();s._status=m.LoaderStatus.kBuffering;var r=i.value.buffer,_=s._range.from+s._receivedLength;s._receivedLength+=r.byteLength,s._onDataArrival&&s._onDataArrival(r,_,s._receivedLength),s._pump(h)}}).catch(function(i){if(s._abortController&&s._abortController.signal.aborted){s._status=m.LoaderStatus.kComplete;return}if(!(i.code===11&&y.default.msedge)){s._status=m.LoaderStatus.kError;var d=0,u=null;if((i.code===19||i.message==="network error")&&(s._contentLength===null||s._contentLength!==null&&s._receivedLength<s._contentLength)?(d=m.LoaderErrors.EARLY_EOF,u={code:i.code,msg:"Fetch stream meet Early-EOF"}):(d=m.LoaderErrors.EXCEPTION,u={code:i.code,msg:i.message}),s._onError)s._onError(d,u);else throw new c.RuntimeException(u.msg)}})},f}(m.BaseLoader);b.default=p},"./src/io/io-controller.js":function(O,b,v){v.r(b);var y=v("./src/utils/logger.js"),m=v("./src/io/speed-sampler.js"),c=v("./src/io/loader.js"),o=v("./src/io/fetch-stream-loader.js"),p=v("./src/io/xhr-moz-chunked-loader.js"),l=v("./src/io/xhr-range-loader.js"),f=v("./src/io/websocket-loader.js"),h=v("./src/io/range-seek-handler.js"),s=v("./src/io/param-seek-handler.js"),i=v("./src/utils/exception.js"),d=function(){function u(r,_,g){this.TAG="IOController",this._config=_,this._extraData=g,this._stashInitialSize=1024*384,_.stashInitialSize!=null&&_.stashInitialSize>0&&(this._stashInitialSize=_.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,_.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=r,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(r.url),this._refTotalLength=r.filesize?r.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new m.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return u.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},u.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},u.prototype.isPaused=function(){return this._paused},Object.defineProperty(u.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"extraData",{get:function(){return this._extraData},set:function(r){this._extraData=r},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(r){this._onDataArrival=r},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(r){this._onSeeked=r},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onError",{get:function(){return this._onError},set:function(r){this._onError=r},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onComplete",{get:function(){return this._onComplete},set:function(r){this._onComplete=r},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(r){this._onRedirect=r},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(r){this._onRecoveredEarlyEof=r},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"currentSpeed",{get:function(){return this._loaderClass===l.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),u.prototype._selectSeekHandler=function(){var r=this._config;if(r.seekType==="range")this._seekHandler=new h.default(this._config.rangeLoadZeroStart);else if(r.seekType==="param"){var _=r.seekParamStart||"bstart",g=r.seekParamEnd||"bend";this._seekHandler=new s.default(_,g)}else if(r.seekType==="custom"){if(typeof r.customSeekHandler!="function")throw new i.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new r.customSeekHandler}else throw new i.InvalidArgumentException("Invalid seekType in config: "+r.seekType)},u.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=f.default;else if(o.default.isSupported())this._loaderClass=o.default;else if(p.default.isSupported())this._loaderClass=p.default;else if(l.default.isSupported())this._loaderClass=l.default;else throw new i.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},u.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},u.prototype.open=function(r){this._currentRange={from:0,to:-1},r&&(this._currentRange.from=r),this._speedSampler.reset(),r||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},u.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},u.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},u.prototype.resume=function(){if(this._paused){this._paused=!1;var r=this._resumeFrom;this._resumeFrom=0,this._internalSeek(r,!0)}},u.prototype.seek=function(r){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(r,!0)},u.prototype._internalSeek=function(r,_){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(_),this._loader.destroy(),this._loader=null;var g={from:r,to:-1};this._currentRange={from:g.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,g),this._onSeeked&&this._onSeeked()},u.prototype.updateUrl=function(r){if(!r||typeof r!="string"||r.length===0)throw new i.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=r},u.prototype._expandBuffer=function(r){for(var _=this._stashSize;_+1024*1024*1<r;)_*=2;if(_+=1024*1024*1,_!==this._bufferSize){var g=new ArrayBuffer(_);if(this._stashUsed>0){var E=new Uint8Array(this._stashBuffer,0,this._stashUsed),L=new Uint8Array(g,0,_);L.set(E,0)}this._stashBuffer=g,this._bufferSize=_}},u.prototype._normalizeSpeed=function(r){var _=this._speedNormalizeList,g=_.length-1,E=0,L=0,R=g;if(r<_[0])return _[0];for(;L<=R;){if(E=L+Math.floor((R-L)/2),E===g||r>=_[E]&&r<_[E+1])return _[E];_[E]<r?L=E+1:R=E-1}},u.prototype._adjustStashSize=function(r){var _=0;this._config.isLive||r<512?_=r:r>=512&&r<=1024?_=Math.floor(r*1.5):_=r*2,_>8192&&(_=8192);var g=_*1024+1024*1024*1;this._bufferSize<g&&this._expandBuffer(g),this._stashSize=_*1024},u.prototype._dispatchChunks=function(r,_){return this._currentRange.to=_+r.byteLength-1,this._onDataArrival(r,_)},u.prototype._onURLRedirect=function(r){this._redirectedURL=r,this._onRedirect&&this._onRedirect(r)},u.prototype._onContentLengthKnown=function(r){r&&this._fullRequestFlag&&(this._totalLength=r,this._fullRequestFlag=!1)},u.prototype._onLoaderChunkArrival=function(r,_,g){if(!this._onDataArrival)throw new i.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(r.byteLength);var E=this._speedSampler.lastSecondKBps;if(E!==0){var L=this._normalizeSpeed(E);this._speedNormalized!==L&&(this._speedNormalized=L,this._adjustStashSize(L))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=_),this._stashUsed+r.byteLength<=this._stashSize){var x=new Uint8Array(this._stashBuffer,0,this._stashSize);x.set(new Uint8Array(r),this._stashUsed),this._stashUsed+=r.byteLength}else{var x=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var w=this._stashBuffer.slice(0,this._stashUsed),R=this._dispatchChunks(w,this._stashByteStart);if(R<w.byteLength){if(R>0){var A=new Uint8Array(w,R);x.set(A,0),this._stashUsed=A.byteLength,this._stashByteStart+=R}}else this._stashUsed=0,this._stashByteStart+=R;this._stashUsed+r.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+r.byteLength),x=new Uint8Array(this._stashBuffer,0,this._bufferSize)),x.set(new Uint8Array(r),this._stashUsed),this._stashUsed+=r.byteLength}else{var R=this._dispatchChunks(r,_);if(R<r.byteLength){var C=r.byteLength-R;C>this._bufferSize&&(this._expandBuffer(C),x=new Uint8Array(this._stashBuffer,0,this._bufferSize)),x.set(new Uint8Array(r,R),0),this._stashUsed+=C,this._stashByteStart=_+R}}}else if(this._stashUsed===0){var R=this._dispatchChunks(r,_);if(R<r.byteLength){var C=r.byteLength-R;C>this._bufferSize&&this._expandBuffer(C);var x=new Uint8Array(this._stashBuffer,0,this._bufferSize);x.set(new Uint8Array(r,R),0),this._stashUsed+=C,this._stashByteStart=_+R}}else{this._stashUsed+r.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+r.byteLength);var x=new Uint8Array(this._stashBuffer,0,this._bufferSize);x.set(new Uint8Array(r),this._stashUsed),this._stashUsed+=r.byteLength;var R=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(R<this._stashUsed&&R>0){var A=new Uint8Array(this._stashBuffer,R);x.set(A,0)}this._stashUsed-=R,this._stashByteStart+=R}}},u.prototype._flushStashBuffer=function(r){if(this._stashUsed>0){var _=this._stashBuffer.slice(0,this._stashUsed),g=this._dispatchChunks(_,this._stashByteStart),E=_.byteLength-g;if(g<_.byteLength)if(r)y.default.w(this.TAG,E+" bytes unconsumed data remain when flush buffer, dropped");else{if(g>0){var L=new Uint8Array(this._stashBuffer,0,this._bufferSize),R=new Uint8Array(_,g);L.set(R,0),this._stashUsed=R.byteLength,this._stashByteStart+=g}return 0}return this._stashUsed=0,this._stashByteStart=0,E}return 0},u.prototype._onLoaderComplete=function(r,_){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},u.prototype._onLoaderError=function(r,_){switch(y.default.e(this.TAG,"Loader error, code = "+_.code+", msg = "+_.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,r=c.LoaderErrors.UNRECOVERABLE_EARLY_EOF),r){case c.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var g=this._currentRange.to+1;g<this._totalLength&&(y.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(g,!1));return}r=c.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case c.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case c.LoaderErrors.CONNECTING_TIMEOUT:case c.LoaderErrors.HTTP_STATUS_CODE_INVALID:case c.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(r,_);else throw new i.RuntimeException("IOException: "+_.msg)},u}();b.default=d},"./src/io/loader.js":function(O,b,v){v.r(b),v.d(b,{LoaderStatus:function(){return m},LoaderErrors:function(){return c},BaseLoader:function(){return o}});var y=v("./src/utils/exception.js"),m={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},c={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},o=function(){function p(l){this._type=l||"undefined",this._status=m.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return p.prototype.destroy=function(){this._status=m.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},p.prototype.isWorking=function(){return this._status===m.kConnecting||this._status===m.kBuffering},Object.defineProperty(p.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(l){this._onContentLengthKnown=l},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(l){this._onURLRedirect=l},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(l){this._onDataArrival=l},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onError",{get:function(){return this._onError},set:function(l){this._onError=l},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onComplete",{get:function(){return this._onComplete},set:function(l){this._onComplete=l},enumerable:!1,configurable:!0}),p.prototype.open=function(l,f){throw new y.NotImplementedException("Unimplemented abstract function!")},p.prototype.abort=function(){throw new y.NotImplementedException("Unimplemented abstract function!")},p}()},"./src/io/param-seek-handler.js":function(O,b,v){v.r(b);var y=function(){function m(c,o){this._startName=c,this._endName=o}return m.prototype.getConfig=function(c,o){var p=c;if(o.from!==0||o.to!==-1){var l=!0;p.indexOf("?")===-1&&(p+="?",l=!1),l&&(p+="&"),p+=this._startName+"="+o.from.toString(),o.to!==-1&&(p+="&"+this._endName+"="+o.to.toString())}return{url:p,headers:{}}},m.prototype.removeURLParameters=function(c){var o=c.split("?")[0],p=void 0,l=c.indexOf("?");l!==-1&&(p=c.substring(l+1));var f="";if(p!=null&&p.length>0)for(var h=p.split("&"),s=0;s<h.length;s++){var i=h[s].split("="),d=s>0;i[0]!==this._startName&&i[0]!==this._endName&&(d&&(f+="&"),f+=h[s])}return f.length===0?o:o+"?"+f},m}();b.default=y},"./src/io/range-seek-handler.js":function(O,b,v){v.r(b);var y=function(){function m(c){this._zeroStart=c||!1}return m.prototype.getConfig=function(c,o){var p={};if(o.from!==0||o.to!==-1){var l=void 0;o.to!==-1?l="bytes="+o.from.toString()+"-"+o.to.toString():l="bytes="+o.from.toString()+"-",p.Range=l}else this._zeroStart&&(p.Range="bytes=0-");return{url:c,headers:p}},m.prototype.removeURLParameters=function(c){return c},m}();b.default=y},"./src/io/speed-sampler.js":function(O,b,v){v.r(b);var y=function(){function m(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return m.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},m.prototype.addBytes=function(c){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=c,this._totalBytes+=c):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=c,this._totalBytes+=c):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=c,this._totalBytes+=c,this._lastCheckpoint=this._now())},Object.defineProperty(m.prototype,"currentKBps",{get:function(){this.addBytes(0);var c=(this._now()-this._lastCheckpoint)/1e3;return c==0&&(c=1),this._intervalBytes/c/1024},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"averageKBps",{get:function(){var c=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/c/1024},enumerable:!1,configurable:!0}),m}();b.default=y},"./src/io/websocket-loader.js":function(O,b,v){v.r(b);var y=v("./src/io/loader.js"),m=v("./src/utils/exception.js"),c=function(){var p=function(l,f){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,s){h.__proto__=s}||function(h,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(h[i]=s[i])},p(l,f)};return function(l,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");p(l,f);function h(){this.constructor=l}l.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)}}(),o=function(p){c(l,p);function l(){var f=p.call(this,"websocket-loader")||this;return f.TAG="WebSocketLoader",f._needStash=!0,f._ws=null,f._requestAbort=!1,f._receivedLength=0,f}return l.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},l.prototype.destroy=function(){this._ws&&this.abort(),p.prototype.destroy.call(this)},l.prototype.open=function(f){try{var h=this._ws=new self.WebSocket(f.url);h.binaryType="arraybuffer",h.onopen=this._onWebSocketOpen.bind(this),h.onclose=this._onWebSocketClose.bind(this),h.onmessage=this._onWebSocketMessage.bind(this),h.onerror=this._onWebSocketError.bind(this),this._status=y.LoaderStatus.kConnecting}catch(i){this._status=y.LoaderStatus.kError;var s={code:i.code,msg:i.message};if(this._onError)this._onError(y.LoaderErrors.EXCEPTION,s);else throw new m.RuntimeException(s.msg)}},l.prototype.abort=function(){var f=this._ws;f&&(f.readyState===0||f.readyState===1)&&(this._requestAbort=!0,f.close()),this._ws=null,this._status=y.LoaderStatus.kComplete},l.prototype._onWebSocketOpen=function(f){this._status=y.LoaderStatus.kBuffering},l.prototype._onWebSocketClose=function(f){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=y.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},l.prototype._onWebSocketMessage=function(f){var h=this;if(f.data instanceof ArrayBuffer)this._dispatchArrayBuffer(f.data);else if(f.data instanceof Blob){var s=new FileReader;s.onload=function(){h._dispatchArrayBuffer(s.result)},s.readAsArrayBuffer(f.data)}else{this._status=y.LoaderStatus.kError;var i={code:-1,msg:"Unsupported WebSocket message type: "+f.data.constructor.name};if(this._onError)this._onError(y.LoaderErrors.EXCEPTION,i);else throw new m.RuntimeException(i.msg)}},l.prototype._dispatchArrayBuffer=function(f){var h=f,s=this._receivedLength;this._receivedLength+=h.byteLength,this._onDataArrival&&this._onDataArrival(h,s,this._receivedLength)},l.prototype._onWebSocketError=function(f){this._status=y.LoaderStatus.kError;var h={code:f.code,msg:f.message};if(this._onError)this._onError(y.LoaderErrors.EXCEPTION,h);else throw new m.RuntimeException(h.msg)},l}(y.BaseLoader);b.default=o},"./src/io/xhr-moz-chunked-loader.js":function(O,b,v){v.r(b);var y=v("./src/utils/logger.js"),m=v("./src/io/loader.js"),c=v("./src/utils/exception.js"),o=function(){var l=function(f,h){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,i){s.__proto__=i}||function(s,i){for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(s[d]=i[d])},l(f,h)};return function(f,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");l(f,h);function s(){this.constructor=f}f.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),p=function(l){o(f,l);function f(h,s){var i=l.call(this,"xhr-moz-chunked-loader")||this;return i.TAG="MozChunkedLoader",i._seekHandler=h,i._config=s,i._needStash=!0,i._xhr=null,i._requestAbort=!1,i._contentLength=null,i._receivedLength=0,i}return f.isSupported=function(){try{var h=new XMLHttpRequest;return h.open("GET","https://example.com",!0),h.responseType="moz-chunked-arraybuffer",h.responseType==="moz-chunked-arraybuffer"}catch(s){return y.default.w("MozChunkedLoader",s.message),!1}},f.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),l.prototype.destroy.call(this)},f.prototype.open=function(h,s){this._dataSource=h,this._range=s;var i=h.url;this._config.reuseRedirectedURL&&h.redirectedURL!=null&&(i=h.redirectedURL);var d=this._seekHandler.getConfig(i,s);this._requestURL=d.url;var u=this._xhr=new XMLHttpRequest;if(u.open("GET",d.url,!0),u.responseType="moz-chunked-arraybuffer",u.onreadystatechange=this._onReadyStateChange.bind(this),u.onprogress=this._onProgress.bind(this),u.onloadend=this._onLoadEnd.bind(this),u.onerror=this._onXhrError.bind(this),h.withCredentials&&(u.withCredentials=!0),typeof d.headers=="object"){var r=d.headers;for(var _ in r)r.hasOwnProperty(_)&&u.setRequestHeader(_,r[_])}if(typeof this._config.headers=="object"){var r=this._config.headers;for(var _ in r)r.hasOwnProperty(_)&&u.setRequestHeader(_,r[_])}this._status=m.LoaderStatus.kConnecting,u.send()},f.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=m.LoaderStatus.kComplete},f.prototype._onReadyStateChange=function(h){var s=h.target;if(s.readyState===2){if(s.responseURL!=null&&s.responseURL!==this._requestURL&&this._onURLRedirect){var i=this._seekHandler.removeURLParameters(s.responseURL);this._onURLRedirect(i)}if(s.status!==0&&(s.status<200||s.status>299))if(this._status=m.LoaderStatus.kError,this._onError)this._onError(m.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:s.status,msg:s.statusText});else throw new c.RuntimeException("MozChunkedLoader: Http code invalid, "+s.status+" "+s.statusText);else this._status=m.LoaderStatus.kBuffering}},f.prototype._onProgress=function(h){if(this._status!==m.LoaderStatus.kError){this._contentLength===null&&h.total!==null&&h.total!==0&&(this._contentLength=h.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var s=h.target.response,i=this._range.from+this._receivedLength;this._receivedLength+=s.byteLength,this._onDataArrival&&this._onDataArrival(s,i,this._receivedLength)}},f.prototype._onLoadEnd=function(h){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===m.LoaderStatus.kError)return;this._status=m.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},f.prototype._onXhrError=function(h){this._status=m.LoaderStatus.kError;var s=0,i=null;if(this._contentLength&&h.loaded<this._contentLength?(s=m.LoaderErrors.EARLY_EOF,i={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(s=m.LoaderErrors.EXCEPTION,i={code:-1,msg:h.constructor.name+" "+h.type}),this._onError)this._onError(s,i);else throw new c.RuntimeException(i.msg)},f}(m.BaseLoader);b.default=p},"./src/io/xhr-range-loader.js":function(O,b,v){v.r(b);var y=v("./src/utils/logger.js"),m=v("./src/io/speed-sampler.js"),c=v("./src/io/loader.js"),o=v("./src/utils/exception.js"),p=function(){var f=function(h,s){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,d){i.__proto__=d}||function(i,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(i[u]=d[u])},f(h,s)};return function(h,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");f(h,s);function i(){this.constructor=h}h.prototype=s===null?Object.create(s):(i.prototype=s.prototype,new i)}}(),l=function(f){p(h,f);function h(s,i){var d=f.call(this,"xhr-range-loader")||this;return d.TAG="RangeLoader",d._seekHandler=s,d._config=i,d._needStash=!1,d._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],d._currentChunkSizeKB=384,d._currentSpeedNormalized=0,d._zeroSpeedChunkCount=0,d._xhr=null,d._speedSampler=new m.default,d._requestAbort=!1,d._waitForTotalLength=!1,d._totalLengthReceived=!1,d._currentRequestURL=null,d._currentRedirectedURL=null,d._currentRequestRange=null,d._totalLength=null,d._contentLength=null,d._receivedLength=0,d._lastTimeLoaded=0,d}return h.isSupported=function(){try{var s=new XMLHttpRequest;return s.open("GET","https://example.com",!0),s.responseType="arraybuffer",s.responseType==="arraybuffer"}catch(i){return y.default.w("RangeLoader",i.message),!1}},h.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),f.prototype.destroy.call(this)},Object.defineProperty(h.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),h.prototype.open=function(s,i){this._dataSource=s,this._range=i,this._status=c.LoaderStatus.kConnecting;var d=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(d=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!d?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},h.prototype._openSubRange=function(){var s=this._currentChunkSizeKB*1024,i=this._range.from+this._receivedLength,d=i+s;this._contentLength!=null&&d-this._range.from>=this._contentLength&&(d=this._range.from+this._contentLength-1),this._currentRequestRange={from:i,to:d},this._internalOpen(this._dataSource,this._currentRequestRange)},h.prototype._internalOpen=function(s,i){this._lastTimeLoaded=0;var d=s.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?d=this._currentRedirectedURL:s.redirectedURL!=null&&(d=s.redirectedURL));var u=this._seekHandler.getConfig(d,i);this._currentRequestURL=u.url;var r=this._xhr=new XMLHttpRequest;if(r.open("GET",u.url,!0),r.responseType="arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onload=this._onLoad.bind(this),r.onerror=this._onXhrError.bind(this),s.withCredentials&&(r.withCredentials=!0),typeof u.headers=="object"){var _=u.headers;for(var g in _)_.hasOwnProperty(g)&&r.setRequestHeader(g,_[g])}if(typeof this._config.headers=="object"){var _=this._config.headers;for(var g in _)_.hasOwnProperty(g)&&r.setRequestHeader(g,_[g])}r.send()},h.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=c.LoaderStatus.kComplete},h.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},h.prototype._onReadyStateChange=function(s){var i=s.target;if(i.readyState===2){if(i.responseURL!=null){var d=this._seekHandler.removeURLParameters(i.responseURL);i.responseURL!==this._currentRequestURL&&d!==this._currentRedirectedURL&&(this._currentRedirectedURL=d,this._onURLRedirect&&this._onURLRedirect(d))}if(i.status>=200&&i.status<=299){if(this._waitForTotalLength)return;this._status=c.LoaderStatus.kBuffering}else if(this._status=c.LoaderStatus.kError,this._onError)this._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:i.status,msg:i.statusText});else throw new o.RuntimeException("RangeLoader: Http code invalid, "+i.status+" "+i.statusText)}},h.prototype._onProgress=function(s){if(this._status!==c.LoaderStatus.kError){if(this._contentLength===null){var i=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,i=!0;var d=s.total;this._internalAbort(),d!=null&d!==0&&(this._totalLength=d)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,i){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var u=s.loaded-this._lastTimeLoaded;this._lastTimeLoaded=s.loaded,this._speedSampler.addBytes(u)}},h.prototype._normalizeSpeed=function(s){var i=this._chunkSizeKBList,d=i.length-1,u=0,r=0,_=d;if(s<i[0])return i[0];for(;r<=_;){if(u=r+Math.floor((_-r)/2),u===d||s>=i[u]&&s<i[u+1])return i[u];i[u]<s?r=u+1:_=u-1}},h.prototype._onLoad=function(s){if(this._status!==c.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var i=this._speedSampler.lastSecondKBps;if(i===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(i=this._speedSampler.currentKBps)),i!==0){var d=this._normalizeSpeed(i);this._currentSpeedNormalized!==d&&(this._currentSpeedNormalized=d,this._currentChunkSizeKB=d)}var u=s.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=u.byteLength;var _=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():_=!0,this._onDataArrival&&this._onDataArrival(u,r,this._receivedLength),_&&(this._status=c.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},h.prototype._onXhrError=function(s){this._status=c.LoaderStatus.kError;var i=0,d=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(i=c.LoaderErrors.EARLY_EOF,d={code:-1,msg:"RangeLoader meet Early-Eof"}):(i=c.LoaderErrors.EXCEPTION,d={code:-1,msg:s.constructor.name+" "+s.type}),this._onError)this._onError(i,d);else throw new o.RuntimeException(d.msg)},h}(c.BaseLoader);b.default=l},"./src/player/flv-player.js":function(O,b,v){v.r(b);var y=v("./node_modules/events/events.js"),m=v.n(y),c=v("./src/utils/logger.js"),o=v("./src/utils/browser.js"),p=v("./src/player/player-events.js"),l=v("./src/core/transmuxer.js"),f=v("./src/core/transmuxing-events.js"),h=v("./src/core/mse-controller.js"),s=v("./src/core/mse-events.js"),i=v("./src/player/player-errors.js"),d=v("./src/config.js"),u=v("./src/utils/exception.js"),r=function(){function _(g,E){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(m()),this._config=(0,d.createDefaultConfig)(),typeof E=="object"&&Object.assign(this._config,E),g.type.toLowerCase()!=="flv")throw new u.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");g.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=g,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var L=o.default.chrome&&(o.default.version.major<50||o.default.version.major===50&&o.default.version.build<2661);this._alwaysSeekKeyframe=!!(L||o.default.msedge||o.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return _.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},_.prototype.on=function(g,E){var L=this;g===p.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){L._emitter.emit(p.default.MEDIA_INFO,L.mediaInfo)}):g===p.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){L._emitter.emit(p.default.STATISTICS_INFO,L.statisticsInfo)}),this._emitter.addListener(g,E)},_.prototype.off=function(g,E){this._emitter.removeListener(g,E)},_.prototype.attachMediaElement=function(g){var E=this;if(this._mediaElement=g,g.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),g.addEventListener("seeking",this.e.onvSeeking),g.addEventListener("canplay",this.e.onvCanPlay),g.addEventListener("stalled",this.e.onvStalled),g.addEventListener("progress",this.e.onvProgress),this._msectl=new h.default(this._config),this._msectl.on(s.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(s.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(s.default.SOURCE_OPEN,function(){E._mseSourceOpened=!0,E._hasPendingLoad&&(E._hasPendingLoad=!1,E.load())}),this._msectl.on(s.default.ERROR,function(L){E._emitter.emit(p.default.ERROR,i.ErrorTypes.MEDIA_ERROR,i.ErrorDetails.MEDIA_MSE_ERROR,L)}),this._msectl.attachMediaElement(g),this._pendingSeekTime!=null)try{g.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},_.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},_.prototype.load=function(){var g=this;if(!this._mediaElement)throw new u.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new u.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new l.default(this._mediaDataSource,this._config),this._transmuxer.on(f.default.INIT_SEGMENT,function(E,L){g._msectl.appendInitSegment(L)}),this._transmuxer.on(f.default.MEDIA_SEGMENT,function(E,L){if(g._msectl.appendMediaSegment(L),g._config.lazyLoad&&!g._config.isLive){var R=g._mediaElement.currentTime;L.info.endDts>=(R+g._config.lazyLoadMaxDuration)*1e3&&g._progressChecker==null&&(c.default.v(g.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),g._suspendTransmuxer())}}),this._transmuxer.on(f.default.LOADING_COMPLETE,function(){g._msectl.endOfStream(),g._emitter.emit(p.default.LOADING_COMPLETE)}),this._transmuxer.on(f.default.RECOVERED_EARLY_EOF,function(){g._emitter.emit(p.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(f.default.IO_ERROR,function(E,L){g._emitter.emit(p.default.ERROR,i.ErrorTypes.NETWORK_ERROR,E,L)}),this._transmuxer.on(f.default.DEMUX_ERROR,function(E,L){g._emitter.emit(p.default.ERROR,i.ErrorTypes.MEDIA_ERROR,E,{code:-1,msg:L})}),this._transmuxer.on(f.default.MEDIA_INFO,function(E){g._mediaInfo=E,g._emitter.emit(p.default.MEDIA_INFO,Object.assign({},E))}),this._transmuxer.on(f.default.METADATA_ARRIVED,function(E){g._emitter.emit(p.default.METADATA_ARRIVED,E)}),this._transmuxer.on(f.default.SCRIPTDATA_ARRIVED,function(E){g._emitter.emit(p.default.SCRIPTDATA_ARRIVED,E)}),this._transmuxer.on(f.default.STATISTICS_INFO,function(E){g._statisticsInfo=g._fillStatisticsInfo(E),g._emitter.emit(p.default.STATISTICS_INFO,Object.assign({},g._statisticsInfo))}),this._transmuxer.on(f.default.RECOMMEND_SEEKPOINT,function(E){g._mediaElement&&!g._config.accurateSeek&&(g._requestSetTime=!0,g._mediaElement.currentTime=E/1e3)}),this._transmuxer.open()}},_.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},_.prototype.play=function(){return this._mediaElement.play()},_.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(_.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(g){this._mediaElement.volume=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(g){this._mediaElement.muted=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(g){this._mediaElement?this._internalSeek(g):this._pendingSeekTime=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),_.prototype._fillStatisticsInfo=function(g){if(g.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return g;var E=!0,L=0,R=0;if(this._mediaElement.getVideoPlaybackQuality){var C=this._mediaElement.getVideoPlaybackQuality();L=C.totalVideoFrames,R=C.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(L=this._mediaElement.webkitDecodedFrameCount,R=this._mediaElement.webkitDroppedFrameCount):E=!1;return E&&(g.decodedFrames=L,g.droppedFrames=R),g},_.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var g=this._mediaElement.buffered,E=this._mediaElement.currentTime,L=0,R=0;R<g.length;R++){var C=g.start(R),x=g.end(R);if(C<=E&&E<x){L=x;break}}L>=E+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(c.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},_.prototype._onmseBufferFull=function(){c.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},_.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},_.prototype._checkProgressAndResume=function(){for(var g=this._mediaElement.currentTime,E=this._mediaElement.buffered,L=!1,R=0;R<E.length;R++){var C=E.start(R),x=E.end(R);if(g>=C&&g<x){g>=x-this._config.lazyLoadRecoverDuration&&(L=!0);break}}L&&(window.clearInterval(this._progressChecker),this._progressChecker=null,L&&(c.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},_.prototype._isTimepointBuffered=function(g){for(var E=this._mediaElement.buffered,L=0;L<E.length;L++){var R=E.start(L),C=E.end(L);if(g>=R&&g<C)return!0}return!1},_.prototype._internalSeek=function(g){var E=this._isTimepointBuffered(g),L=!1,R=0;if(g<1&&this._mediaElement.buffered.length>0){var C=this._mediaElement.buffered.start(0);(C<1&&g<C||o.default.safari)&&(L=!0,R=o.default.safari?.1:C)}if(L)this._requestSetTime=!0,this._mediaElement.currentTime=R;else if(E){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=g;else{var x=this._msectl.getNearestKeyframe(Math.floor(g*1e3));this._requestSetTime=!0,x!=null?this._mediaElement.currentTime=x.dts/1e3:this._mediaElement.currentTime=g}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(g),this._transmuxer.seek(Math.floor(g*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=g)},_.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var g=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(g)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(g),this._transmuxer.seek(Math.floor(g*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=g))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},_.prototype._checkAndResumeStuckPlayback=function(g){var E=this._mediaElement;if(g||!this._receivedCanPlay||E.readyState<2){var L=E.buffered;L.length>0&&E.currentTime<L.start(0)&&(c.default.w(this.TAG,"Playback seems stuck at "+E.currentTime+", seek to "+L.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=L.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},_.prototype._onvLoadedMetadata=function(g){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},_.prototype._onvSeeking=function(g){var E=this._mediaElement.currentTime,L=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(E<1&&L.length>0){var R=L.start(0);if(R<1&&E<R||o.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=o.default.safari?.1:R;return}}if(this._isTimepointBuffered(E)){if(this._alwaysSeekKeyframe){var C=this._msectl.getNearestKeyframe(Math.floor(E*1e3));C!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=C.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:E,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},_.prototype._onvCanPlay=function(g){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},_.prototype._onvStalled=function(g){this._checkAndResumeStuckPlayback(!0)},_.prototype._onvProgress=function(g){this._checkAndResumeStuckPlayback()},_}();b.default=r},"./src/player/native-player.js":function(O,b,v){v.r(b);var y=v("./node_modules/events/events.js"),m=v.n(y),c=v("./src/player/player-events.js"),o=v("./src/config.js"),p=v("./src/utils/exception.js"),l=function(){function f(h,s){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(m()),this._config=(0,o.createDefaultConfig)(),typeof s=="object"&&Object.assign(this._config,s),h.type.toLowerCase()==="flv")throw new p.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(h.hasOwnProperty("segments"))throw new p.InvalidArgumentException("NativePlayer("+h.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=h,this._mediaElement=null}return f.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},f.prototype.on=function(h,s){var i=this;h===c.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){i._emitter.emit(c.default.MEDIA_INFO,i.mediaInfo)}):h===c.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){i._emitter.emit(c.default.STATISTICS_INFO,i.statisticsInfo)}),this._emitter.addListener(h,s)},f.prototype.off=function(h,s){this._emitter.removeListener(h,s)},f.prototype.attachMediaElement=function(h){if(this._mediaElement=h,h.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{h.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},f.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},f.prototype.load=function(){if(!this._mediaElement)throw new p.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},f.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},f.prototype.play=function(){return this._mediaElement.play()},f.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(h){this._mediaElement.volume=h},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(h){this._mediaElement.muted=h},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(h){this._mediaElement?this._mediaElement.currentTime=h:this._pendingSeekTime=h},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"mediaInfo",{get:function(){var h=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",s={mimeType:h+this._mediaDataSource.type};return this._mediaElement&&(s.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(s.width=this._mediaElement.videoWidth,s.height=this._mediaElement.videoHeight)),s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"statisticsInfo",{get:function(){var h={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return h;var s=!0,i=0,d=0;if(this._mediaElement.getVideoPlaybackQuality){var u=this._mediaElement.getVideoPlaybackQuality();i=u.totalVideoFrames,d=u.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(i=this._mediaElement.webkitDecodedFrameCount,d=this._mediaElement.webkitDroppedFrameCount):s=!1;return s&&(h.decodedFrames=i,h.droppedFrames=d),h},enumerable:!1,configurable:!0}),f.prototype._onvLoadedMetadata=function(h){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(c.default.MEDIA_INFO,this.mediaInfo)},f.prototype._reportStatisticsInfo=function(){this._emitter.emit(c.default.STATISTICS_INFO,this.statisticsInfo)},f}();b.default=l},"./src/player/player-errors.js":function(O,b,v){v.r(b),v.d(b,{ErrorTypes:function(){return c},ErrorDetails:function(){return o}});var y=v("./src/io/loader.js"),m=v("./src/demux/demux-errors.js"),c={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},o={NETWORK_EXCEPTION:y.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:y.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:y.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:y.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:m.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:m.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:m.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(O,b,v){v.r(b);var y={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};b.default=y},"./src/remux/aac-silent.js":function(O,b,v){v.r(b);var y=function(){function m(){}return m.getSilentFrame=function(c,o){if(c==="mp4a.40.2"){if(o===1)return new Uint8Array([0,200,0,128,35,128]);if(o===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(o===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(o===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(o===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(o===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(o===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(o===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(o===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},m}();b.default=y},"./src/remux/mp4-generator.js":function(O,b,v){v.r(b);var y=function(){function m(){}return m.init=function(){m.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var c in m.types)m.types.hasOwnProperty(c)&&(m.types[c]=[c.charCodeAt(0),c.charCodeAt(1),c.charCodeAt(2),c.charCodeAt(3)]);var o=m.constants={};o.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),o.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),o.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),o.STSC=o.STCO=o.STTS,o.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),o.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),o.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),o.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),o.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},m.box=function(c){for(var o=8,p=null,l=Array.prototype.slice.call(arguments,1),f=l.length,h=0;h<f;h++)o+=l[h].byteLength;p=new Uint8Array(o),p[0]=o>>>24&255,p[1]=o>>>16&255,p[2]=o>>>8&255,p[3]=o&255,p.set(c,4);for(var s=8,h=0;h<f;h++)p.set(l[h],s),s+=l[h].byteLength;return p},m.generateInitSegment=function(c){var o=m.box(m.types.ftyp,m.constants.FTYP),p=m.moov(c),l=new Uint8Array(o.byteLength+p.byteLength);return l.set(o,0),l.set(p,o.byteLength),l},m.moov=function(c){var o=m.mvhd(c.timescale,c.duration),p=m.trak(c),l=m.mvex(c);return m.box(m.types.moov,o,p,l)},m.mvhd=function(c,o){return m.box(m.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,c>>>24&255,c>>>16&255,c>>>8&255,c&255,o>>>24&255,o>>>16&255,o>>>8&255,o&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},m.trak=function(c){return m.box(m.types.trak,m.tkhd(c),m.mdia(c))},m.tkhd=function(c){var o=c.id,p=c.duration,l=c.presentWidth,f=c.presentHeight;return m.box(m.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,0,0,0,0,p>>>24&255,p>>>16&255,p>>>8&255,p&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,l>>>8&255,l&255,0,0,f>>>8&255,f&255,0,0]))},m.mdia=function(c){return m.box(m.types.mdia,m.mdhd(c),m.hdlr(c),m.minf(c))},m.mdhd=function(c){var o=c.timescale,p=c.duration;return m.box(m.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,p>>>24&255,p>>>16&255,p>>>8&255,p&255,85,196,0,0]))},m.hdlr=function(c){var o=null;return c.type==="audio"?o=m.constants.HDLR_AUDIO:o=m.constants.HDLR_VIDEO,m.box(m.types.hdlr,o)},m.minf=function(c){var o=null;return c.type==="audio"?o=m.box(m.types.smhd,m.constants.SMHD):o=m.box(m.types.vmhd,m.constants.VMHD),m.box(m.types.minf,o,m.dinf(),m.stbl(c))},m.dinf=function(){var c=m.box(m.types.dinf,m.box(m.types.dref,m.constants.DREF));return c},m.stbl=function(c){var o=m.box(m.types.stbl,m.stsd(c),m.box(m.types.stts,m.constants.STTS),m.box(m.types.stsc,m.constants.STSC),m.box(m.types.stsz,m.constants.STSZ),m.box(m.types.stco,m.constants.STCO));return o},m.stsd=function(c){return c.type==="audio"?c.codec==="mp3"?m.box(m.types.stsd,m.constants.STSD_PREFIX,m.mp3(c)):m.box(m.types.stsd,m.constants.STSD_PREFIX,m.mp4a(c)):m.box(m.types.stsd,m.constants.STSD_PREFIX,m.avc1(c))},m.mp3=function(c){var o=c.channelCount,p=c.audioSampleRate,l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,o,0,16,0,0,0,0,p>>>8&255,p&255,0,0]);return m.box(m.types[".mp3"],l)},m.mp4a=function(c){var o=c.channelCount,p=c.audioSampleRate,l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,o,0,16,0,0,0,0,p>>>8&255,p&255,0,0]);return m.box(m.types.mp4a,l,m.esds(c))},m.esds=function(c){var o=c.config||[],p=o.length,l=new Uint8Array([0,0,0,0,3,23+p,0,1,0,4,15+p,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([p]).concat(o).concat([6,1,2]));return m.box(m.types.esds,l)},m.avc1=function(c){var o=c.avcc,p=c.codecWidth,l=c.codecHeight,f=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>>8&255,p&255,l>>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return m.box(m.types.avc1,f,m.box(m.types.avcC,o))},m.mvex=function(c){return m.box(m.types.mvex,m.trex(c))},m.trex=function(c){var o=c.id,p=new Uint8Array([0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return m.box(m.types.trex,p)},m.moof=function(c,o){return m.box(m.types.moof,m.mfhd(c.sequenceNumber),m.traf(c,o))},m.mfhd=function(c){var o=new Uint8Array([0,0,0,0,c>>>24&255,c>>>16&255,c>>>8&255,c&255]);return m.box(m.types.mfhd,o)},m.traf=function(c,o){var p=c.id,l=m.box(m.types.tfhd,new Uint8Array([0,0,0,0,p>>>24&255,p>>>16&255,p>>>8&255,p&255])),f=m.box(m.types.tfdt,new Uint8Array([0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255])),h=m.sdtp(c),s=m.trun(c,h.byteLength+16+16+8+16+8+8);return m.box(m.types.traf,l,f,s,h)},m.sdtp=function(c){for(var o=c.samples||[],p=o.length,l=new Uint8Array(4+p),f=0;f<p;f++){var h=o[f].flags;l[f+4]=h.isLeading<<6|h.dependsOn<<4|h.isDependedOn<<2|h.hasRedundancy}return m.box(m.types.sdtp,l)},m.trun=function(c,o){var p=c.samples||[],l=p.length,f=12+16*l,h=new Uint8Array(f);o+=8+f,h.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,l&255,o>>>24&255,o>>>16&255,o>>>8&255,o&255],0);for(var s=0;s<l;s++){var i=p[s].duration,d=p[s].size,u=p[s].flags,r=p[s].cts;h.set([i>>>24&255,i>>>16&255,i>>>8&255,i&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.isNonSync,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255],12+16*s)}return m.box(m.types.trun,h)},m.mdat=function(c){return m.box(m.types.mdat,c)},m}();y.init(),b.default=y},"./src/remux/mp4-remuxer.js":function(O,b,v){v.r(b);var y=v("./src/utils/logger.js"),m=v("./src/remux/mp4-generator.js"),c=v("./src/remux/aac-silent.js"),o=v("./src/utils/browser.js"),p=v("./src/core/media-segment-info.js"),l=v("./src/utils/exception.js"),f=function(){function h(s){this.TAG="MP4Remuxer",this._config=s,this._isLive=s.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new p.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new p.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(o.default.chrome&&(o.default.version.major<50||o.default.version.major===50&&o.default.version.build<2661)),this._fillSilentAfterSeek=o.default.msedge||o.default.msie,this._mp3UseMpegAudio=!o.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return h.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},h.prototype.bindDataSource=function(s){return s.onDataAvailable=this.remux.bind(this),s.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(h.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(s){this._onInitSegment=s},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(s){this._onMediaSegment=s},enumerable:!1,configurable:!0}),h.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},h.prototype.seek=function(s){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},h.prototype.remux=function(s,i){if(!this._onMediaSegment)throw new l.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(s,i),this._remuxVideo(i),this._remuxAudio(s)},h.prototype._onTrackMetadataReceived=function(s,i){var d=null,u="mp4",r=i.codec;if(s==="audio")this._audioMeta=i,i.codec==="mp3"&&this._mp3UseMpegAudio?(u="mpeg",r="",d=new Uint8Array):d=m.default.generateInitSegment(i);else if(s==="video")this._videoMeta=i,d=m.default.generateInitSegment(i);else return;if(!this._onInitSegment)throw new l.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(s,{type:s,data:d.buffer,codec:r,container:s+"/"+u,mediaDuration:i.duration})},h.prototype._calculateDtsBase=function(s,i){this._dtsBaseInited||(s.samples&&s.samples.length&&(this._audioDtsBase=s.samples[0].dts),i.samples&&i.samples.length&&(this._videoDtsBase=i.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},h.prototype.flushStashedSamples=function(){var s=this._videoStashedLastSample,i=this._audioStashedLastSample,d={type:"video",id:1,sequenceNumber:0,samples:[],length:0};s!=null&&(d.samples.push(s),d.length=s.length);var u={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};i!=null&&(u.samples.push(i),u.length=i.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(d,!0),this._remuxAudio(u,!0)},h.prototype._remuxAudio=function(s,i){if(this._audioMeta!=null){var d=s,u=d.samples,r=void 0,_=-1,g=-1,E=this._audioMeta.refSampleDuration,L=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,R=this._dtsBaseInited&&this._audioNextDts===void 0,C=!1;if(!(!u||u.length===0)&&!(u.length===1&&!i)){var x=0,A=null,w=0;L?(x=0,w=d.length):(x=8,w=8+d.length);var I=null;if(u.length>1&&(I=u.pop(),w-=I.length),this._audioStashedLastSample!=null){var P=this._audioStashedLastSample;this._audioStashedLastSample=null,u.unshift(P),w+=P.length}I!=null&&(this._audioStashedLastSample=I);var M=u[0].dts-this._dtsBase;if(this._audioNextDts)r=M-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())r=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(C=!0);else{var J=this._audioSegmentInfoList.getLastSampleBefore(M);if(J!=null){var Q=M-(J.originalDts+J.duration);Q<=3&&(Q=0);var $=J.dts+J.duration+Q;r=M-$}else r=0}if(C){var ne=M-r,ce=this._videoSegmentInfoList.getLastSegmentBefore(M);if(ce!=null&&ce.beginDts<ne){var Y=c.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(Y){var re=ce.beginDts,Re=ne-ce.beginDts;y.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+re+", duration: "+Re),u.unshift({unit:Y,dts:re,pts:re}),w+=Y.byteLength}}else C=!1}for(var fe=[],he=0;he<u.length;he++){var P=u[he],xe=P.unit,ve=P.dts-this._dtsBase,re=ve,Ee=!1,Ae=null,oe=0;if(!(ve<-.001)){if(this._audioMeta.codec!=="mp3"){var H=ve,be=3;if(this._audioNextDts&&(H=this._audioNextDts),r=ve-H,r<=-be*E){y.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+ve+" ms ,curRefDts: "+H+" ms)  due to dtsCorrection: "+r+" ms overlap.");continue}else if(r>=be*E&&this._fillAudioTimestampGap&&!o.default.safari){Ee=!0;var Le=Math.floor(r/E);y.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+ve+" ms, curRefDts: "+H+" ms, ")+("dtsCorrection: "+Math.round(r)+" ms, generate: "+Le+" frames")),re=Math.floor(H),oe=Math.floor(H+E)-re;var Y=c.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);Y==null&&(y.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),Y=xe),Ae=[];for(var Ue=0;Ue<Le;Ue++){H=H+E;var Ce=Math.floor(H),Te=Math.floor(H+E)-Ce,Ke={dts:Ce,pts:Ce,cts:0,unit:Y,size:Y.byteLength,duration:Te,originalDts:ve,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};Ae.push(Ke),w+=Ke.size}this._audioNextDts=H+E}else re=Math.floor(H),oe=Math.floor(H+E)-re,this._audioNextDts=H+E}else{if(re=ve-r,he!==u.length-1){var F=u[he+1].dts-this._dtsBase-r;oe=F-re}else if(I!=null){var F=I.dts-this._dtsBase-r;oe=F-re}else fe.length>=1?oe=fe[fe.length-1].duration:oe=Math.floor(E);this._audioNextDts=re+oe}_===-1&&(_=re),fe.push({dts:re,pts:re,cts:0,unit:P.unit,size:P.unit.byteLength,duration:oe,originalDts:ve,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Ee&&fe.push.apply(fe,Ae)}}if(fe.length===0){d.samples=[],d.length=0;return}L?A=new Uint8Array(w):(A=new Uint8Array(w),A[0]=w>>>24&255,A[1]=w>>>16&255,A[2]=w>>>8&255,A[3]=w&255,A.set(m.default.types.mdat,4));for(var he=0;he<fe.length;he++){var xe=fe[he].unit;A.set(xe,x),x+=xe.byteLength}var N=fe[fe.length-1];g=N.dts+N.duration;var j=new p.MediaSegmentInfo;j.beginDts=_,j.endDts=g,j.beginPts=_,j.endPts=g,j.originalBeginDts=fe[0].originalDts,j.originalEndDts=N.originalDts+N.duration,j.firstSample=new p.SampleInfo(fe[0].dts,fe[0].pts,fe[0].duration,fe[0].originalDts,!1),j.lastSample=new p.SampleInfo(N.dts,N.pts,N.duration,N.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(j),d.samples=fe,d.sequenceNumber++;var V=null;L?V=new Uint8Array:V=m.default.moof(d,_),d.samples=[],d.length=0;var Se={type:"audio",data:this._mergeBoxes(V,A).buffer,sampleCount:fe.length,info:j};L&&R&&(Se.timestampOffset=_),this._onMediaSegment("audio",Se)}}},h.prototype._remuxVideo=function(s,i){if(this._videoMeta!=null){var d=s,u=d.samples,r=void 0,_=-1,g=-1,E=-1,L=-1;if(!(!u||u.length===0)&&!(u.length===1&&!i)){var R=8,C=null,x=8+s.length,A=null;if(u.length>1&&(A=u.pop(),x-=A.length),this._videoStashedLastSample!=null){var w=this._videoStashedLastSample;this._videoStashedLastSample=null,u.unshift(w),x+=w.length}A!=null&&(this._videoStashedLastSample=A);var I=u[0].dts-this._dtsBase;if(this._videoNextDts)r=I-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())r=0;else{var P=this._videoSegmentInfoList.getLastSampleBefore(I);if(P!=null){var M=I-(P.originalDts+P.duration);M<=3&&(M=0);var J=P.dts+P.duration+M;r=I-J}else r=0}for(var Q=new p.MediaSegmentInfo,$=[],ne=0;ne<u.length;ne++){var w=u[ne],ce=w.dts-this._dtsBase,Y=w.isKeyframe,re=ce-r,Re=w.cts,fe=re+Re;_===-1&&(_=re,E=fe);var he=0;if(ne!==u.length-1){var xe=u[ne+1].dts-this._dtsBase-r;he=xe-re}else if(A!=null){var xe=A.dts-this._dtsBase-r;he=xe-re}else $.length>=1?he=$[$.length-1].duration:he=Math.floor(this._videoMeta.refSampleDuration);if(Y){var ve=new p.SampleInfo(re,fe,he,w.dts,!0);ve.fileposition=w.fileposition,Q.appendSyncPoint(ve)}$.push({dts:re,pts:fe,cts:Re,units:w.units,size:w.length,isKeyframe:Y,duration:he,originalDts:ce,flags:{isLeading:0,dependsOn:Y?2:1,isDependedOn:Y?1:0,hasRedundancy:0,isNonSync:Y?0:1}})}C=new Uint8Array(x),C[0]=x>>>24&255,C[1]=x>>>16&255,C[2]=x>>>8&255,C[3]=x&255,C.set(m.default.types.mdat,4);for(var ne=0;ne<$.length;ne++)for(var Ee=$[ne].units;Ee.length;){var Ae=Ee.shift(),oe=Ae.data;C.set(oe,R),R+=oe.byteLength}var H=$[$.length-1];if(g=H.dts+H.duration,L=H.pts+H.duration,this._videoNextDts=g,Q.beginDts=_,Q.endDts=g,Q.beginPts=E,Q.endPts=L,Q.originalBeginDts=$[0].originalDts,Q.originalEndDts=H.originalDts+H.duration,Q.firstSample=new p.SampleInfo($[0].dts,$[0].pts,$[0].duration,$[0].originalDts,$[0].isKeyframe),Q.lastSample=new p.SampleInfo(H.dts,H.pts,H.duration,H.originalDts,H.isKeyframe),this._isLive||this._videoSegmentInfoList.append(Q),d.samples=$,d.sequenceNumber++,this._forceFirstIDR){var be=$[0].flags;be.dependsOn=2,be.isNonSync=0}var Le=m.default.moof(d,_);d.samples=[],d.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(Le,C).buffer,sampleCount:$.length,info:Q})}}},h.prototype._mergeBoxes=function(s,i){var d=new Uint8Array(s.byteLength+i.byteLength);return d.set(s,0),d.set(i,s.byteLength),d},h}();b.default=f},"./src/utils/browser.js":function(O,b,v){v.r(b);var y={};function m(){var c=self.navigator.userAgent.toLowerCase(),o=/(edge)\/([\w.]+)/.exec(c)||/(opr)[\/]([\w.]+)/.exec(c)||/(chrome)[ \/]([\w.]+)/.exec(c)||/(iemobile)[\/]([\w.]+)/.exec(c)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+)/.exec(c)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(c)||/(msie) ([\w.]+)/.exec(c)||c.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(c)||c.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(c)||[],p=/(ipad)/.exec(c)||/(ipod)/.exec(c)||/(windows phone)/.exec(c)||/(iphone)/.exec(c)||/(kindle)/.exec(c)||/(android)/.exec(c)||/(windows)/.exec(c)||/(mac)/.exec(c)||/(linux)/.exec(c)||/(cros)/.exec(c)||[],l={browser:o[5]||o[3]||o[1]||"",version:o[2]||o[4]||"0",majorVersion:o[4]||o[2]||"0",platform:p[0]||""},f={};if(l.browser){f[l.browser]=!0;var h=l.majorVersion.split(".");f.version={major:parseInt(l.majorVersion,10),string:l.version},h.length>1&&(f.version.minor=parseInt(h[1],10)),h.length>2&&(f.version.build=parseInt(h[2],10))}if(l.platform&&(f[l.platform]=!0),(f.chrome||f.opr||f.safari)&&(f.webkit=!0),f.rv||f.iemobile){f.rv&&delete f.rv;var s="msie";l.browser=s,f[s]=!0}if(f.edge){delete f.edge;var i="msedge";l.browser=i,f[i]=!0}if(f.opr){var d="opera";l.browser=d,f[d]=!0}if(f.safari&&f.android){var u="android";l.browser=u,f[u]=!0}f.name=l.browser,f.platform=l.platform;for(var r in y)y.hasOwnProperty(r)&&delete y[r];Object.assign(y,f)}m(),b.default=y},"./src/utils/exception.js":function(O,b,v){v.r(b),v.d(b,{RuntimeException:function(){return m},IllegalStateException:function(){return c},InvalidArgumentException:function(){return o},NotImplementedException:function(){return p}});var y=function(){var l=function(f,h){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,i){s.__proto__=i}||function(s,i){for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(s[d]=i[d])},l(f,h)};return function(f,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");l(f,h);function s(){this.constructor=f}f.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),m=function(){function l(f){this._message=f}return Object.defineProperty(l.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),l.prototype.toString=function(){return this.name+": "+this.message},l}(),c=function(l){y(f,l);function f(h){return l.call(this,h)||this}return Object.defineProperty(f.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),f}(m),o=function(l){y(f,l);function f(h){return l.call(this,h)||this}return Object.defineProperty(f.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),f}(m),p=function(l){y(f,l);function f(h){return l.call(this,h)||this}return Object.defineProperty(f.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),f}(m)},"./src/utils/logger.js":function(O,b,v){v.r(b);var y=v("./node_modules/events/events.js"),m=v.n(y),c=function(){function o(){}return o.e=function(p,l){(!p||o.FORCE_GLOBAL_TAG)&&(p=o.GLOBAL_TAG);var f="["+p+"] > "+l;o.ENABLE_CALLBACK&&o.emitter.emit("log","error",f),o.ENABLE_ERROR&&(console.error?console.error(f):console.warn?console.warn(f):console.log(f))},o.i=function(p,l){(!p||o.FORCE_GLOBAL_TAG)&&(p=o.GLOBAL_TAG);var f="["+p+"] > "+l;o.ENABLE_CALLBACK&&o.emitter.emit("log","info",f),o.ENABLE_INFO&&(console.info?console.info(f):console.log(f))},o.w=function(p,l){(!p||o.FORCE_GLOBAL_TAG)&&(p=o.GLOBAL_TAG);var f="["+p+"] > "+l;o.ENABLE_CALLBACK&&o.emitter.emit("log","warn",f),o.ENABLE_WARN&&(console.warn?console.warn(f):console.log(f))},o.d=function(p,l){(!p||o.FORCE_GLOBAL_TAG)&&(p=o.GLOBAL_TAG);var f="["+p+"] > "+l;o.ENABLE_CALLBACK&&o.emitter.emit("log","debug",f),o.ENABLE_DEBUG&&(console.debug?console.debug(f):console.log(f))},o.v=function(p,l){(!p||o.FORCE_GLOBAL_TAG)&&(p=o.GLOBAL_TAG);var f="["+p+"] > "+l;o.ENABLE_CALLBACK&&o.emitter.emit("log","verbose",f),o.ENABLE_VERBOSE&&console.log(f)},o}();c.GLOBAL_TAG="flv.js",c.FORCE_GLOBAL_TAG=!1,c.ENABLE_ERROR=!0,c.ENABLE_INFO=!0,c.ENABLE_WARN=!0,c.ENABLE_DEBUG=!0,c.ENABLE_VERBOSE=!0,c.ENABLE_CALLBACK=!1,c.emitter=new(m()),b.default=c},"./src/utils/logging-control.js":function(O,b,v){v.r(b);var y=v("./node_modules/events/events.js"),m=v.n(y),c=v("./src/utils/logger.js"),o=function(){function p(){}return Object.defineProperty(p,"forceGlobalTag",{get:function(){return c.default.FORCE_GLOBAL_TAG},set:function(l){c.default.FORCE_GLOBAL_TAG=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"globalTag",{get:function(){return c.default.GLOBAL_TAG},set:function(l){c.default.GLOBAL_TAG=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"enableAll",{get:function(){return c.default.ENABLE_VERBOSE&&c.default.ENABLE_DEBUG&&c.default.ENABLE_INFO&&c.default.ENABLE_WARN&&c.default.ENABLE_ERROR},set:function(l){c.default.ENABLE_VERBOSE=l,c.default.ENABLE_DEBUG=l,c.default.ENABLE_INFO=l,c.default.ENABLE_WARN=l,c.default.ENABLE_ERROR=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"enableDebug",{get:function(){return c.default.ENABLE_DEBUG},set:function(l){c.default.ENABLE_DEBUG=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"enableVerbose",{get:function(){return c.default.ENABLE_VERBOSE},set:function(l){c.default.ENABLE_VERBOSE=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"enableInfo",{get:function(){return c.default.ENABLE_INFO},set:function(l){c.default.ENABLE_INFO=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"enableWarn",{get:function(){return c.default.ENABLE_WARN},set:function(l){c.default.ENABLE_WARN=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"enableError",{get:function(){return c.default.ENABLE_ERROR},set:function(l){c.default.ENABLE_ERROR=l,p._notifyChange()},enumerable:!1,configurable:!0}),p.getConfig=function(){return{globalTag:c.default.GLOBAL_TAG,forceGlobalTag:c.default.FORCE_GLOBAL_TAG,enableVerbose:c.default.ENABLE_VERBOSE,enableDebug:c.default.ENABLE_DEBUG,enableInfo:c.default.ENABLE_INFO,enableWarn:c.default.ENABLE_WARN,enableError:c.default.ENABLE_ERROR,enableCallback:c.default.ENABLE_CALLBACK}},p.applyConfig=function(l){c.default.GLOBAL_TAG=l.globalTag,c.default.FORCE_GLOBAL_TAG=l.forceGlobalTag,c.default.ENABLE_VERBOSE=l.enableVerbose,c.default.ENABLE_DEBUG=l.enableDebug,c.default.ENABLE_INFO=l.enableInfo,c.default.ENABLE_WARN=l.enableWarn,c.default.ENABLE_ERROR=l.enableError,c.default.ENABLE_CALLBACK=l.enableCallback},p._notifyChange=function(){var l=p.emitter;if(l.listenerCount("change")>0){var f=p.getConfig();l.emit("change",f)}},p.registerListener=function(l){p.emitter.addListener("change",l)},p.removeListener=function(l){p.emitter.removeListener("change",l)},p.addLogListener=function(l){c.default.emitter.addListener("log",l),c.default.emitter.listenerCount("log")>0&&(c.default.ENABLE_CALLBACK=!0,p._notifyChange())},p.removeLogListener=function(l){c.default.emitter.removeListener("log",l),c.default.emitter.listenerCount("log")===0&&(c.default.ENABLE_CALLBACK=!1,p._notifyChange())},p}();o.emitter=new(m()),b.default=o},"./src/utils/polyfill.js":function(O,b,v){v.r(b);var y=function(){function m(){}return m.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(c,o){return c.__proto__=o,c},Object.assign=Object.assign||function(c){if(c==null)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(c),p=1;p<arguments.length;p++){var l=arguments[p];if(l!=null)for(var f in l)l.hasOwnProperty(f)&&(o[f]=l[f])}return o},typeof self.Promise!="function"&&v("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},m}();y.install(),b.default=y},"./src/utils/utf8-conv.js":function(O,b,v){v.r(b);function y(c,o,p){var l=c;if(o+p<l.length){for(;p--;)if((l[++o]&192)!==128)return!1;return!0}else return!1}function m(c){for(var o=[],p=c,l=0,f=c.length;l<f;){if(p[l]<128){o.push(String.fromCharCode(p[l])),++l;continue}else if(!(p[l]<192)){if(p[l]<224){if(y(p,l,1)){var h=(p[l]&31)<<6|p[l+1]&63;if(h>=128){o.push(String.fromCharCode(h&65535)),l+=2;continue}}}else if(p[l]<240){if(y(p,l,2)){var h=(p[l]&15)<<12|(p[l+1]&63)<<6|p[l+2]&63;if(h>=2048&&(h&63488)!==55296){o.push(String.fromCharCode(h&65535)),l+=3;continue}}}else if(p[l]<248&&y(p,l,3)){var h=(p[l]&7)<<18|(p[l+1]&63)<<12|(p[l+2]&63)<<6|p[l+3]&63;if(h>65536&&h<1114112){h-=65536,o.push(String.fromCharCode(h>>>10|55296)),o.push(String.fromCharCode(h&1023|56320)),l+=4;continue}}}o.push(String.fromCharCode(65533)),++l}return o.join("")}b.default=m}},a={};function S(O){var b=a[O];if(b!==void 0)return b.exports;var v=a[O]={exports:{}};return n[O].call(v.exports,v,v.exports,S),v.exports}S.m=n,function(){S.n=function(O){var b=O&&O.__esModule?function(){return O.default}:function(){return O};return S.d(b,{a:b}),b}}(),function(){S.d=function(O,b){for(var v in b)S.o(b,v)&&!S.o(O,v)&&Object.defineProperty(O,v,{enumerable:!0,get:b[v]})}}(),function(){S.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){S.o=function(O,b){return Object.prototype.hasOwnProperty.call(O,b)}}(),function(){S.r=function(O){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})}}();var T=S("./src/index.js");return T}()})})(Kn);var cs=Kn.exports;const hs=pr(cs);const _s={key:0,class:"controls"},ps={class:"left"},ms={class:"right"},vs={name:"Video"},gs=Object.assign(vs,{props:{flv:{type:Boolean,default:!1},url:{type:String,default:""},id:{type:String,default:""}},setup(t,{expose:e}){const n=t,a=ee(null),S=ee(null);let T=ee(!1),O=ee(!0),b=ee(!1),v=null;const y=()=>{v=hs.createPlayer({type:"flv",isLive:!0,url:n.url}),v.attachMediaElement(a==null?void 0:a.value),v.load(),v.play()};mr(()=>{n.flv&&n.url&&y()});const m=(f,h,s)=>{a.value.srcObject=f,a.value.muted=h,O.value=h,b.value=s},c=f=>{f.requestFullscreen?f.requestFullscreen():ele.mozRequestFullScreen?f.mozRequestFullScreen():ele.webkitRequestFullScreen&&f.webkitRequestFullScreen()};function o(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}const p=()=>{T.value?(o(),T.value=!1):(c(S==null?void 0:S.value),T.value=!0)},l=()=>{let f=!a.value.muted;O.value=f,a.value.muted=f};return e({setStream:m,id:n.id}),(f,h)=>{const s=Jt;return K(),se("div",{class:te(["live-video",{"is-full":G(T)}]),ref_key:"videoContainerRef",ref:S},[W("video",{class:"video",ref_key:"videoRef",ref:a,muted:"",autoplay:"",disablePictureInPicture:"","x-webkit-airplay":"allow","x5-video-player-type":"h5","x5-video-player-fullscreen":"true",oncontextmenu:"return false"},null,512),Pe(f.$slots,"default",{},void 0,!0),G(b)?(K(),se("div",_s,[W("div",ps,[z(s,{"icon-name":G(O)?"sound-close":"sound","icon-size":"24",color:"#cfcfcf",onClick:l},null,8,["icon-name"])]),W("div",ms,[z(s,{"icon-name":"full","icon-size":"20",color:"#cfcfcf",onClick:p})])])):ue("",!0)],2)}}}),st=Xt(gs,[["__scopeId","data-v-bc9b3042"]]),ys={class:"dialog-footer"},Es={name:"SetRoomPassDialog"},xs=Object.assign(Es,{props:{id:{type:String,default:""}},setup(t,{expose:e}){const n=t,a=ee(),S=ee(!1),T=ee(""),O=()=>{S.value=!1},b=()=>{T.value.trim().length===6?Qe({method:"POST",url:"room/update",data:{id:n.id,password:T.value}}).then(()=>{S.value=!1}):lt.warning("密码输入格式错误！")};return e({show:()=>S.value=!0,hide:()=>S.value=!1}),(v,y)=>{const m=Tt,c=tt,o=Sn;return K(),_e(o,{ref_key:"dialogRef",ref:a,modelValue:S.value,"onUpdate:modelValue":y[1]||(y[1]=p=>S.value=p),title:"设置密码",width:"400px","show-close":!1,"close-on-click-modal":!1},{footer:X(()=>[W("div",ys,[z(c,{onClick:O},{default:X(()=>[me("取消")]),_:1}),z(c,{type:"primary",onClick:b},{default:X(()=>[me(" 确定 ")]),_:1})])]),default:X(()=>[z(m,{modelValue:T.value,"onUpdate:modelValue":y[0]||(y[0]=p=>T.value=p),modelModifiers:{trim:!0},placeholder:"请输入6位密码"},null,8,["modelValue"])]),_:1},8,["modelValue"])}}}),bs={class:"dialog-footer"},Ss={name:"EnterRoomPassDialog"},Rs=Object.assign(Ss,{props:{id:{type:String,default:""}},emits:["onTrue","onFalse","onCancel"],setup(t,{expose:e,emit:n}){const a=t,S=ee(),T=ee(),O=()=>{n("onCancel"),T.value=!1},b=()=>{Qe({method:"POST",url:"/room/checkPassword",data:{id:a.id,password:S.value}}).then(v=>{v.data?(n("onTrue"),T.value=!1):(n("onFalse"),lt.warning("密码错误！"))})};return e({show:()=>T.value=!0,hide:()=>T.value=!1}),(v,y)=>{const m=Tt,c=tt,o=Sn;return K(),_e(o,{ref:"dialogRef",modelValue:T.value,"onUpdate:modelValue":y[1]||(y[1]=p=>T.value=p),title:"设置密码",width:"400px","show-close":!1,"close-on-click-modal":!1},{footer:X(()=>[W("div",bs,[z(c,{onClick:O},{default:X(()=>[me("取消")]),_:1}),z(c,{type:"primary",onClick:b},{default:X(()=>[me(" 确定 ")]),_:1})])]),default:X(()=>[z(m,{modelValue:S.value,"onUpdate:modelValue":y[0]||(y[0]=p=>S.value=p),modelModifiers:{trim:!0},placeholder:"请输入6位密码"},null,8,["modelValue"])]),_:1},8,["modelValue"])}}});const Gn=vr("room",()=>{const t=ee({}),e=ee([]),n=ee([]);return{info:t,peoples:e,chatList:n,GET_INFO:async(b,v)=>{var m,c;const y=await Qe({method:"GET",url:"/room/info",params:{id:b}}).catch(()=>{typeof v=="function"&&v()});t.value=((m=y==null?void 0:y.data)==null?void 0:m.info)||{},e.value=((c=y==null?void 0:y.data)==null?void 0:c.peoples)||[]},ADD_PEOPLE:b=>{e.value.findIndex(v=>v.id===b.id)===-1&&e.value.push(b)},ADD_CHAT:(...b)=>{n.value.push(...b)},REMOVE_PEOPLE:b=>{e.value=e.value.filter(v=>v.id!==b)}}}),As=["😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","😘","😗","😙","😚","😋","😛","😝","😜","🤪","🤨","🧐","🤓","😎","🤩","😏","😒","😞","😔","😟","😕","🙁","😣","😖","😫","😩","😢","😭","😮","💨","😤","😠","😡","🤬","🤯","😳","😱","😨","😰","😥","😓","🤗","🤔","🤭","🤫","🤥","😶","🌫️","😐","😑","😬","🙄","😯","😦","😧","😮","😲","😴","🤤","😪","😵","😵","💫","🤐","🤢","🤮","🤧","😷","🤒","🤕","🤑","🤠","😈","👿","👹","👺","🤡","💩","👻","💀","👽","👾","🤖","🎃","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🐶"];const Ls=t=>(yr("data-v-7328f5c9"),t=t(),Er(),t),Cs={key:0,class:"unread-dot"},Os={class:"user-name"},ws={class:"chat-content"},Ts=Ls(()=>W("div",{class:"chat-textarea-placeholder"},null,-1)),Is={class:"chat-textarea"},Ds={class:"emoji-container"},Ps=["onClick"],ks={name:"ChatButton"},Ms=Object.assign(ks,{emits:"enter",setup(t,{emit:e}){const n=ee(!1),a=ee(""),S=ee(),T=ee(),O=Gn(),{chatList:b}=Ut(O),{info:v}=Ut(Rn());It(()=>{l()});const y=f=>{if(!f.shiftKey&&f.keyCode===13){if(a.value.trim()==="")return;const h=a.value;a.value="";const s={info:{id:v.value.id,name:v.value.username},time:Date.now(),content:h};O.ADD_CHAT({...s,unread:!1}),e("enter",s),f.preventDefault()}},m=f=>{a.value+=f,T.value.focus()},c=()=>{for(let f=0;f<b.value.length;f++)b.value[f].unread=!1};At(n,async()=>{n.value&&(await we(),T.value.focus())},{flush:"post"});const o=async()=>{n.value=!0,c(),await we(),l()};At(b,()=>{l(),n.value&&c()},{flush:"post",deep:!0});const p=ge(()=>{let f=0;if(n.value)return f;for(let h of b.value)h.unread&&f++;return f}),l=async()=>{await we(),S.value&&(S.value.scrollTop=S.value.scrollHeight)};return(f,h)=>{const s=tt,i=Jt,d=gr,u=Tt,r=Xr;return K(),se(ke,null,[z(s,{onClick:o},{default:X(()=>[Pe(f.$slots,"default",{},void 0,!0),G(p)?(K(),se("span",Cs,"("+pe(G(p))+")",1)):ue("",!0)]),_:3}),z(r,{class:"chat-container","append-to-body":"",size:300,modelValue:n.value,"onUpdate:modelValue":h[1]||(h[1]=_=>n.value=_),title:"聊天室"},{default:X(()=>[W("div",{class:"chat-list",ref_key:"chatListRef",ref:S},[(K(!0),se(ke,null,Ot(G(b),_=>(K(),se("div",{class:"chat-item",key:_.info.id+"_"+_.time},[W("div",Os,pe(_.info.id===G(v).id?"我":_.info.name),1),W("div",ws,pe(_.content),1)]))),128)),Ts],512),W("div",Is,[z(d,{placement:"top-start",width:250,trigger:"click"},{reference:X(()=>[z(i,{iconName:"expression",iconSize:"30",color:"#999"})]),default:X(()=>[W("div",Ds,[(K(!0),se(ke,null,Ot(G(As),_=>(K(),se("div",{class:"emoji-item",onClick:g=>m(_),key:_},pe(_),9,Ps))),128))])]),_:1}),z(u,{ref_key:"contentRef",ref:T,type:"textarea",modelValue:a.value,"onUpdate:modelValue":h[0]||(h[0]=_=>a.value=_),placeholder:"请输入",rows:1,onKeydown:y,resize:"none"},null,8,["modelValue"])])]),_:1},8,["modelValue"])],64)}}}),Bs=Xt(Ms,[["__scopeId","data-v-7328f5c9"]]);function Fs({data:t,name:e}){const n=new Blob(t),a=document.createElement("a");a.href=URL.createObjectURL(n),a.download=e,a.click()}const Us={class:"file-name"},Ns={class:"notice-group"},js={__name:"progress",props:{type:{type:Number,default:1},percentage:{type:Number,default:0},name:{type:String,default:""},buffer:{type:Array,default:[]}},setup(t){const e=t,n=()=>{Fs({data:e.buffer,name:e.name})};return(a,S)=>{const T=tt;return K(),se(ke,null,[W("div",Us,pe(e.name),1),W("div",Ns,[e.percentage.value!=100?(K(),se(ke,{key:0},[me(" 文件"+pe(e.type===1?"发送":"接收")+"中... "+pe(e.percentage)+"% ",1)],64)):(K(),se(ke,{key:1},[me(" 文件"+pe(e.type===1?"发送":"接收")+"成功... ",1)],64)),e.percentage.value==100&&e.type===2?(K(),_e(T,{key:2,onClick:n,type:"primary",link:""},{default:X(()=>[me(" 下载 ")]),_:1})):ue("",!0)])],64)}}},pn=(t,e)=>{const n=ge(()=>Math.floor(e.value.receiveSize/e.value.maxSize*100));xi({title:t===1?"发送文件":"接收文件",duration:0,"custom-class":"progress-notice",message:xr(js,{type:t,percentage:n,name:e.value.name,buffer:e.value.buffer})})},mn=(t,e)=>{const n=JSON.parse(JSON.stringify(t));return n.name=e.name,n.maxSize=e.size,n.receiveSize=0,n.start=!0,n};const Vs={key:0,class:"container"},Ks={class:"live-name"},Gs={key:0,class:"video-main"},Ws={class:"people-video-group"},zs={class:"people-video"},Hs={key:0,class:"video-header"},$s=["title"],Ys={class:"video-tools"},Xs={class:"video-header"},Js=["title"],qs={key:1,class:"video-metting-main"},Qs={class:"screen-video"},Zs={class:"people-video-box"},eo={class:"people-video-group"},to={class:"people-video"},no={key:0,class:"video-header"},ro=["title"],io={class:"video-tools"},so={class:"video-header"},oo=["title"],ao={class:"btn-group"},lo={class:"btn-group-public"},uo={name:"Live"},fo=Object.assign(uo,{setup(t){const e=br(),n=Sr(),a=Gn(),S=Rn(),{info:T}=Ut(a),O=e.query.id,b={bundlePolicy:"balanced",iceTransportPolicy:"all",rtcpMuxPolicy:"negotiate",iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:121.36.99.231:3478",username:"ruan8",credential:"123456"}]};let v=!1,y=null;const m=ee(),c=ee(),o=ee(),p=ee(),l=ee(),f=ee(),h=ee(!0),s=ee(),i=ee(!1),d=ee(!1),u=yt(new Map),r=yt(new Map),_=yt(new Map),g=ee(1),E=ee(2),L=ee(2);let R=null,C=null,x=ee({start:!1,maxSize:0,receiveSize:0,name:"",buffer:[]}),A=ee({start:!1,maxSize:0,receiveSize:0,name:"",buffer:[]}),w=[];const I=ge(()=>a.peoples.find(F=>F.id===S.info.id)),P=ge(()=>a.peoples.filter(F=>F.id!==S.info.id)),M=()=>{le.on("initSuccessed",()=>{le.emit("join")}),le.on("joined",async function(F){let N=JSON.parse(F.info);if(a.ADD_PEOPLE(N),S.info.id!==N.id){const j=oe("video",N.id);u.set(N.id,j),R&&j.addTrack(R),j.createOffer(V=>{le.emit("offer",{offer:V,type:"video",to:N.id,from:S.info.id})})}if(C){const j=oe("display",N.id);r.set(N.id,j),j.addTrack(C),j.createOffer(V=>{le.emit("offer",{offer:V,type:"display",to:N.id,from:S.info.id})})}}),le.on("leave",function(F){F.id===T.user_id&&(y=null),u.delete(F.id),r.delete(F.id),_.delete(F.id),a.REMOVE_PEOPLE(F.id),o.value.forEach(N=>{N.id===F.id&&N.setStream(null)})}),le.on("offer",function({offer:F,type:N,from:j}){if(N==="video"){const V=u.get(j);V&&(V.addTrack(R),V.setRemoteDescription(F),V.createAnswer(Se=>{le.emit("answer",{answer:Se,type:N,to:j,from:S.info.id})}))}else y=oe(N,j),y.setRemoteDescription(F),y.createAnswer(V=>{le.emit("answer",{answer:V,type:N,to:j,from:S.info.id})})}),le.on("answer",function({answer:F,type:N,from:j}){if(N==="video"){const V=u.get(j);V&&V.setRemoteDescription(F)}else{const V=r.get(j);V&&V.setRemoteDescription(F)}}),le.on("candidate",({candidate:F,type:N,from:j})=>{if(N==="video"){const V=u.get(j);V&&V.setCandidate(F)}else if(y)y.setCandidate(F);else{const V=r.get(j);V&&V.setCandidate(F)}}),le.on("noLogin",()=>{S.SET_TOKEN(""),S.SET_LOGIN(!0,1)}),le.on("fulled",()=>{i.value=!0,He.alert("当前房间已经满人！").then(()=>{n.go(-1)}),le.close(),le.disconnect()}),le.on("closed",()=>{v=!0,He.alert("当前房间已经关闭！").then(()=>{n.replace("/"),S.SET_ROOM("")})}),le.on("rejectConn",()=>{He.alert("对方拒绝了你的连接申请！")}),le.on("played",F=>{s.value=F}),le.on("typeChange",async F=>{g.value=F,await we(),Ce()}),le.on("displayMediaEnd",async()=>{m.value.setStream(null,!0,!1),g.value=1,await we(),await Te(1)})},J=async()=>{(await Qe({method:"GET",url:"/room/isOffsite",params:{id:O}})).data?(i.value=!0,He.alert("已在其他页面打开，请不要重复打开！","温馨提醒").then(()=>{n.go(-1)})):(await fe(),R&&c.value.setStream(R,!0),await ds({query:{id:O}}),M())},Q=()=>{le.disconnect(),le.close()},$=async()=>{s.value=T.value.flv_url,g.value=a.info.type,a.peoples.forEach(F=>{const N=oe("video",F.id);u.set(F.id,N)}),await J(),d.value=!!T.value.is_public},ne=()=>{$()},ce=()=>{n.go(-1),v=!0},Y=F=>{u.forEach(N=>{var j;(j=N.dataChannel)==null||j.send(JSON.stringify({type:"chat",data:F}))})};It(async()=>{S.token&&(await a.GET_INFO(O,()=>{v=!0,i.value=!0,n.push("/")}),a.info.password&&a.info.user_id!==S.info.id?l.value.show():$())}),Rr(async(F,N,j)=>{try{v||!S.token?(Q(),j()):(await He.confirm("此操作将会退出当前房间！","温馨提醒").then(()=>{Q()}),j())}catch{j(!1)}});const re=()=>{u.forEach(F=>{var N;(N=F.dataChannel)==null||N.send("1")})},Re=()=>{p.value.show()},fe=async()=>{try{const F={video:{width:{min:200},height:{min:150},frameRate:{ideal:30,max:60}},audio:{noiseSuppression:!0,echoCancellation:!0}};navigator.mediaDevices.getUserMedia?R=await navigator.mediaDevices.getUserMedia(F):navigator.webkitGetUserMedia?R=await navigator.webkitGetUserMedia(F):navigator.mozGetUserMedia?R=await navagator.mozGetUserMedia(F):navigator.getUserMedia?R=await navigator.getUserMedia(F):lt.warning("你的浏览器不支持访问用户媒体设备！"),R.getTracks().forEach(N=>{N.enabled=!1})}catch{R=null,lt.warning("没打开摄像头和语音权限！")}},he=async()=>{try{C=await navigator.mediaDevices.getDisplayMedia({video:{width:1920,height:1080}}),C.oninactive=function(){le.emit("displayMediaEnd"),R=null,r.clear()}}catch{console.log("取消投屏！")}},xe=async(F,N)=>{u.forEach(async j=>{j.conn.getSenders().forEach(V=>{V.tarck&&V.track.kind===F&&(V.track.enabled=N)})}),R&&R.getTracks().forEach(j=>{j.kind===F&&(j.enabled=N)})},ve=(F,N)=>{try{if(!R)return;F.value==2?(xe(N,!0),R&&c.value.setStream(R,!0),F.value=1):(xe(N,!1),F.value=2)}catch(j){console.log("error：",j)}},Ee=async()=>{ve(E,"video")},Ae=()=>{ve(L,"audio")},oe=(F,N)=>new fs(b,{onTarck(j){const[V]=j.streams;if(F==="video"){let Se=o.value.find(Me=>Me.id==N);Se&&Se.setStream(V,!1),_.set(N,V)}else m.value.setStream(V,!1,!0)},onCandidate(j){j&&le.emit("candidate",{candidate:j,type:F,to:N,from:S.info.id})},onMessage(j){let V=j.data;typeof V=="string"?(V=JSON.parse(V),V.type==="file-start"?(x.value=mn(x.value,{size:V.size,name:V.name}),pn(2,x)):V.type==="file-end"?x.value.start=!1:V.type==="chat"&&a.ADD_CHAT({...V.data,unread:!0})):(x.value.receiveSize+=V.size,x.value.buffer.push(V))}}),H=async F=>{await Qe({method:"POST",url:"/room/update",data:{is_public:F?1:0,id:O}})},be=()=>{He.confirm("确认关闭房间？").then(()=>{le.emit("closeHouse")})},Le=()=>{A.value.start?lt.warning("正在分享中..."):f.value.click()},Ue=F=>{const N=F.target.files[0];if(N){const j=new FileReader;let V=1024,Se=Math.ceil(N.size/V),Me=1;const Xe=()=>{j.readAsArrayBuffer(N.slice((Me-1)*V,Me*V)),Me++};j.onload=()=>{w.forEach(Ne=>{var de;(de=u.get(Ne).dataChannel)==null||de.send(j.result)}),A.value.receiveSize+=j.result.byteLength,Me<=Se?Xe():(w.forEach(Ne=>{var de;(de=u.get(Ne).dataChannel)==null||de.send(JSON.stringify({type:"file-end",size:N.size,name:N.name}))}),A.value.start=!1)},w=[...u.keys()],w.forEach(Ne=>{var de;(de=u.get(Ne).dataChannel)==null||de.send(JSON.stringify({type:"file-start",size:N.size,name:N.name}))}),A.value=mn(A.value,{size:N.size,name:N.name}),pn(1,A),Xe()}},Ce=async()=>{var F;await we(),R&&c.value.setStream(R),(F=o==null?void 0:o.value)==null||F.forEach(N=>{const j=_.get(N.id);j&&N.setStream(j)})},Te=async F=>{await Qe({method:"POST",url:"/room/update",data:{id:O,type:F}}).then(()=>{le.emit("typeChange",F),Ce()})},Ke=async()=>{he().then(async()=>{C&&(g.value=2,await we(),await Te(2),m.value.setStream(C,!1,!0),a.peoples.forEach(F=>{r.set(F.id,oe("display",F.id))}),r.forEach((F,N)=>{F.addTrack(C),F.createOffer(j=>{le.emit("offer",{offer:j,type:"display",to:N,from:S.info.id})})}))})};return(F,N)=>{var ht,D,k,B;const j=Mr,V=Jt,Se=De("CaretBottom"),Me=Ye,Xe=Nr,Ne=Ar,de=tt;return K(),se(ke,null,[i.value?ue("",!0):(K(),se("div",Vs,[W("div",Ks,pe((ht=G(a).info)==null?void 0:ht.name)+" ("+pe(G(a).peoples.length)+pe(G(a).info.max?"/"+G(a).info.max:"")+") ",1),g.value===1?(K(),se("div",Gs,[je(W("div",Ws,[W("div",zs,[z(st,{ref_key:"videoRef",ref:c},null,512),G(I)?(K(),se("div",Hs,[G(T).user_id===((D=G(I))==null?void 0:D.id)?(K(),_e(j,{key:0,round:""},{default:X(()=>[me("房主")]),_:1})):ue("",!0),W("div",{class:"video-username",title:(k=G(I))==null?void 0:k.username},pe((B=G(I))==null?void 0:B.username),9,$s)])):ue("",!0),W("div",Ys,[z(V,{"icon-name":"shipin-"+E.value,"icon-size":"20",onClick:Ee,color:"#ffffff"},null,8,["icon-name"]),z(V,{"icon-name":"yuyin-"+L.value,"icon-size":"20",onClick:Ae,color:"#ffffff"},null,8,["icon-name"])])]),(K(!0),se(ke,null,Ot(G(P),U=>(K(),se("div",{class:"people-video",key:U.id},[W("div",Xs,[G(T).user_id===(U==null?void 0:U.id)?(K(),_e(j,{key:0,round:""},{default:X(()=>[me("房主")]),_:1})):ue("",!0),W("div",{class:"video-username",title:U==null?void 0:U.username},pe(U==null?void 0:U.username),9,Js)]),z(st,{id:U.id,ref_for:!0,ref_key:"remoteVideoRef",ref:o},null,8,["id"])]))),128))],512),[[Ve,h.value]])])):ue("",!0),g.value===2?(K(),se("div",qs,[W("div",Qs,[z(st,{ref_key:"mainVideoRef",ref:m},{default:X(()=>[W("div",Zs,[W("div",{class:te(["people-video-box-header",{rotate:h.value}]),onClick:N[0]||(N[0]=U=>h.value=!h.value)},[z(Me,{size:20},{default:X(()=>[z(Se)]),_:1})],2),z(Xe,null,{default:X(()=>{var U,q,Z;return[je(W("div",eo,[W("div",to,[z(st,{ref_key:"videoRef",ref:c},null,512),G(I)?(K(),se("div",no,[G(T).user_id===((U=G(I))==null?void 0:U.id)?(K(),_e(j,{key:0,round:""},{default:X(()=>[me("房主")]),_:1})):ue("",!0),W("div",{class:"video-username",title:(q=G(I))==null?void 0:q.username},pe((Z=G(I))==null?void 0:Z.username),9,ro)])):ue("",!0),W("div",io,[z(V,{"icon-name":"shipin-"+E.value,"icon-size":"20",onClick:Ee,color:"#ffffff"},null,8,["icon-name"]),z(V,{"icon-name":"yuyin-"+L.value,"icon-size":"20",onClick:Ae,color:"#ffffff"},null,8,["icon-name"])])]),(K(!0),se(ke,null,Ot(G(P),ae=>(K(),se("div",{class:"people-video",key:ae.id},[W("div",so,[G(T).user_id===(ae==null?void 0:ae.id)?(K(),_e(j,{key:0,round:""},{default:X(()=>[me("房主")]),_:1})):ue("",!0),W("div",{class:"video-username",title:ae==null?void 0:ae.username},pe(ae==null?void 0:ae.username),9,oo)]),z(st,{id:ae.id,ref_for:!0,ref_key:"remoteVideoRef",ref:o},null,8,["id"])]))),128))],512),[[Ve,h.value]])]}),_:1})])]),_:1},512)])])):ue("",!0),W("div",ao,[G(T).homeowner?(K(),se(ke,{key:0},[W("div",lo,[me(" 公开 "),z(Ne,{modelValue:d.value,"onUpdate:modelValue":N[1]||(N[1]=U=>d.value=U),onChange:H},null,8,["modelValue"])]),z(de,{onClick:Re},{default:X(()=>[me(" 设置密码 ")]),_:1}),z(de,{onClick:re},{default:X(()=>[me(" 一起看 ")]),_:1}),z(de,{onClick:Ke},{default:X(()=>[me(" 共享屏幕 ")]),_:1}),z(de,{onClick:Le},{default:X(()=>[me(" 分享文件 ")]),_:1}),z(de,{onClick:be},{default:X(()=>[me("关闭房间")]),_:1})],64)):ue("",!0),z(Bs,{onEnter:Y},{default:X(()=>[me("聊天室")]),_:1})])])),z(xs,{ref_key:"setRoomPassDialogRef",ref:p,id:G(O)},null,8,["id"]),z(Rs,{ref_key:"enterRoomPassDialogRef",ref:l,id:G(O),onOnTrue:ne,onOnCancel:ce},null,8,["id"]),je(W("input",{type:"file",ref_key:"fileRef",ref:f,onChange:Ue},null,544),[[Ve,!1]])],64)}}}),_o=Xt(fo,[["__scopeId","data-v-bca3f4b3"]]);export{_o as default};

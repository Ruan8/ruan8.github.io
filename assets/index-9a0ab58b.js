var Qr=Object.defineProperty;var Zr=(e,t,n)=>t in e?Qr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var zt=(e,t,n)=>(Zr(e,typeof t!="symbol"?t+"":t,n),n);import{G as ke,H as xt,f as ln,I as ei,d as He,J as ti,u as un,h as ve,o as j,c as se,b as H,r as De,n as te,e as V,y as fe,v as X,j as z,K as Ht,L as We,M as Je,l as oe,k as nt,T as ht,_ as pt,w as Wn,N as Hn,O as ni,P as ri,Q as ii,R as $n,S as Yn,U as vn,s as q,g as si,i as oi,V as ai,W as Be,X as Ve,t as ye,Y as Ge,Z as li,A as qe,E as jt,$ as ui,a0 as ci,a1 as Xn,a2 as Dt,a3 as It,a as yn,a4 as Mt,a5 as fi,a6 as Nt,a7 as di,a8 as hi,a9 as pi,aa as _i,ab as ut,ac as gt,B as xe,ad as Jn,ae as cn,af as ft,ag as Bt,ah as En,ai as mi,aj as gi,ak as xn,al as Ft,am as vi,an as Wt,ao as yi,F as Fe,ap as Ei,aq as xi,ar as Si,as as qn,m as it,at as Ci,au as fn,av as Qn,C as Ke,aw as dn,ax as bi,ay as Ri,az as $t,p as hn,x as wt,aA as Ti,aB as Li,aC as Ai,aD as Oi,aE as Pi,aF as ki,aG as Di,aH as Ii,q as Mi,aI as Bi,aJ as Sn,aK as Fi,aL as wi}from"./index-cf2fc2d5.js";function Ui(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in e)){const y=Object.getOwnPropertyDescriptor(r,i);y&&Object.defineProperty(e,i,y.get?y:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}const ji='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',Ni=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,Cn=e=>Array.from(e.querySelectorAll(ji)).filter(t=>Vi(t)&&Ni(t)),Vi=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},Yt="_trap-focus-children",Xe=[],bn=e=>{if(Xe.length===0)return;const t=Xe[Xe.length-1][Yt];if(t.length>0&&e.code===xt.tab){if(t.length===1){e.preventDefault(),document.activeElement!==t[0]&&t[0].focus();return}const n=e.shiftKey,r=e.target===t[0],i=e.target===t[t.length-1];r&&n&&(e.preventDefault(),t[t.length-1].focus()),i&&!n&&(e.preventDefault(),t[0].focus())}},Gi={beforeMount(e){e[Yt]=Cn(e),Xe.push(e),Xe.length<=1&&document.addEventListener("keydown",bn)},updated(e){ke(()=>{e[Yt]=Cn(e)})},unmounted(){Xe.shift(),Xe.length===0&&document.removeEventListener("keydown",bn)}},Ki=ln({type:{type:String,values:["success","info","warning","danger",""],default:""},closable:Boolean,disableTransitions:Boolean,hit:Boolean,color:{type:String,default:""},size:{type:String,values:ei,default:""},effect:{type:String,values:["dark","light","plain"],default:"light"},round:Boolean}),zi={close:e=>e instanceof MouseEvent,click:e=>e instanceof MouseEvent},Wi=He({name:"ElTag"}),Hi=He({...Wi,props:Ki,emits:zi,setup(e,{emit:t}){const n=e,r=ti(),i=un("tag"),y=ve(()=>{const{type:_,hit:g,effect:l,closable:o,round:s}=n;return[i.b(),i.is("closable",o),i.m(_),i.m(r.value),i.m(l),i.is("hit",g),i.is("round",s)]}),S=_=>{t("close",_)},m=_=>{t("click",_)};return(_,g)=>_.disableTransitions?(j(),se("span",{key:0,class:te(V(y)),style:nt({backgroundColor:_.color}),onClick:m},[H("span",{class:te(V(i).e("content"))},[De(_.$slots,"default")],2),_.closable?(j(),fe(V(Je),{key:0,class:te(V(i).e("close")),onClick:We(S,["stop"])},{default:X(()=>[z(V(Ht))]),_:1},8,["class","onClick"])):oe("v-if",!0)],6)):(j(),fe(ht,{key:1,name:`${V(i).namespace.value}-zoom-in-center`,appear:""},{default:X(()=>[H("span",{class:te(V(y)),style:nt({backgroundColor:_.color}),onClick:m},[H("span",{class:te(V(i).e("content"))},[De(_.$slots,"default")],2),_.closable?(j(),fe(V(Je),{key:0,class:te(V(i).e("close")),onClick:We(S,["stop"])},{default:X(()=>[z(V(Ht))]),_:1},8,["class","onClick"])):oe("v-if",!0)],6)]),_:3},8,["name"]))}});var $i=pt(Hi,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tag/src/tag.vue"]]);const Yi=Wn($i),Xi=He({name:"ElCollapseTransition"}),Ji=He({...Xi,setup(e){const t=un("collapse-transition"),n={beforeEnter(r){r.dataset||(r.dataset={}),r.dataset.oldPaddingTop=r.style.paddingTop,r.dataset.oldPaddingBottom=r.style.paddingBottom,r.style.maxHeight=0,r.style.paddingTop=0,r.style.paddingBottom=0},enter(r){r.dataset.oldOverflow=r.style.overflow,r.scrollHeight!==0?(r.style.maxHeight=`${r.scrollHeight}px`,r.style.paddingTop=r.dataset.oldPaddingTop,r.style.paddingBottom=r.dataset.oldPaddingBottom):(r.style.maxHeight=0,r.style.paddingTop=r.dataset.oldPaddingTop,r.style.paddingBottom=r.dataset.oldPaddingBottom),r.style.overflow="hidden"},afterEnter(r){r.style.maxHeight="",r.style.overflow=r.dataset.oldOverflow},beforeLeave(r){r.dataset||(r.dataset={}),r.dataset.oldPaddingTop=r.style.paddingTop,r.dataset.oldPaddingBottom=r.style.paddingBottom,r.dataset.oldOverflow=r.style.overflow,r.style.maxHeight=`${r.scrollHeight}px`,r.style.overflow="hidden"},leave(r){r.scrollHeight!==0&&(r.style.maxHeight=0,r.style.paddingTop=0,r.style.paddingBottom=0)},afterLeave(r){r.style.maxHeight="",r.style.overflow=r.dataset.oldOverflow,r.style.paddingTop=r.dataset.oldPaddingTop,r.style.paddingBottom=r.dataset.oldPaddingBottom}};return(r,i)=>(j(),fe(ht,Hn({name:V(t).b()},ni(n)),{default:X(()=>[De(r.$slots,"default")]),_:3},16,["name"]))}});var St=pt(Ji,[["__file","/home/runner/work/element-plus/element-plus/packages/components/collapse-transition/src/collapse-transition.vue"]]);St.install=e=>{e.component(St.name,St)};const qi=St,Qi=qi,Zi=ln({...ri,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0}}),es=ii,ts=He({name:"ElDrawer",components:{ElOverlay:$n,ElFocusTrap:Yn,ElIcon:Je,Close:Ht},inheritAttrs:!1,props:Zi,emits:es,setup(e,{slots:t}){vn({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},ve(()=>!!t.title)),vn({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},ve(()=>!!e.customClass));const n=q(),r=q(),i=un("drawer"),{t:y}=si(),S=ve(()=>e.direction==="rtl"||e.direction==="ltr"),m=ve(()=>oi(e.size));return{...ai(e,n),drawerRef:n,focusStartRef:r,isHorizontal:S,drawerSize:m,ns:i,t:y}}}),ns=["aria-label","aria-labelledby","aria-describedby"],rs=["id"],is=["aria-label"],ss=["id"];function os(e,t,n,r,i,y){const S=Be("close"),m=Be("el-icon"),_=Be("el-focus-trap"),g=Be("el-overlay");return j(),fe(li,{to:"body",disabled:!e.appendToBody},[z(ht,{name:e.ns.b("fade"),onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,onBeforeLeave:e.beforeLeave,persisted:""},{default:X(()=>[Ve(z(g,{mask:e.modal,"overlay-class":e.modalClass,"z-index":e.zIndex,onClick:e.onModalClick},{default:X(()=>[z(_,{loop:"",trapped:e.visible,"focus-trap-el":e.drawerRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:X(()=>[H("div",Hn({ref:"drawerRef","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:e.titleId,"aria-describedby":e.bodyId},e.$attrs,{class:[e.ns.b(),e.direction,e.visible&&"open",e.customClass],style:e.isHorizontal?"width: "+e.drawerSize:"height: "+e.drawerSize,role:"dialog",onClick:t[1]||(t[1]=We(()=>{},["stop"]))}),[H("span",{ref:"focusStartRef",class:te(e.ns.e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?(j(),se("header",{key:0,class:te(e.ns.e("header"))},[e.$slots.title?De(e.$slots,"title",{key:1},()=>[oe(" DEPRECATED SLOT ")]):De(e.$slots,"header",{key:0,close:e.handleClose,titleId:e.titleId,titleClass:e.ns.e("title")},()=>[e.$slots.title?oe("v-if",!0):(j(),se("span",{key:0,id:e.titleId,role:"heading",class:te(e.ns.e("title"))},ye(e.title),11,rs))]),e.showClose?(j(),se("button",{key:2,"aria-label":e.t("el.drawer.close"),class:te(e.ns.e("close-btn")),type:"button",onClick:t[0]||(t[0]=(...l)=>e.handleClose&&e.handleClose(...l))},[z(m,{class:te(e.ns.e("close"))},{default:X(()=>[z(S)]),_:1},8,["class"])],10,is)):oe("v-if",!0)],2)):oe("v-if",!0),e.rendered?(j(),se("div",{key:1,id:e.bodyId,class:te(e.ns.e("body"))},[De(e.$slots,"default")],10,ss)):oe("v-if",!0),e.$slots.footer?(j(),se("div",{key:2,class:te(e.ns.e("footer"))},[De(e.$slots,"footer")],2)):oe("v-if",!0)],16,ns)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[Ge,e.visible]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}var as=pt(ts,[["render",os],["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const ls=Wn(as),us=He({name:"ElMessageBox",directives:{TrapFocus:Gi},components:{ElButton:qe,ElFocusTrap:Yn,ElInput:jt,ElOverlay:$n,ElIcon:Je,...ui},inheritAttrs:!1,props:{buttonSize:{type:String,validator:ci},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,roundButton:{default:!1,type:Boolean},container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(e,{emit:t}){const{locale:n,zIndex:r,ns:i,size:y}=Xn("message-box",ve(()=>e.buttonSize)),{t:S}=n,{nextZIndex:m}=r,_=q(!1),g=Dt({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:null,inputValidator:null,inputErrorMessage:"",message:null,modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:m()}),l=ve(()=>{const k=g.type;return{[i.bm("icon",k)]:k&&It[k]}}),o=yn(),s=yn(),v=ve(()=>g.icon||It[g.type]||""),c=ve(()=>!!g.message),h=q(),E=q(),f=q(),u=q(),d=q(),p=ve(()=>g.confirmButtonClass);Mt(()=>g.inputValue,async k=>{await ke(),e.boxType==="prompt"&&k!==null&&T()},{immediate:!0}),Mt(()=>_.value,k=>{var D,M;k&&(e.boxType!=="prompt"&&(g.autofocus?f.value=(M=(D=d.value)==null?void 0:D.$el)!=null?M:h.value:f.value=h.value),g.zIndex=m()),e.boxType==="prompt"&&(k?ke().then(()=>{var J;u.value&&u.value.$el&&(g.autofocus?f.value=(J=R())!=null?J:h.value:f.value=h.value)}):(g.editorErrorMessage="",g.validateError=!1))});const a=ve(()=>e.draggable);fi(h,E,a),Nt(async()=>{await ke(),e.closeOnHashChange&&window.addEventListener("hashchange",x)}),di(()=>{e.closeOnHashChange&&window.removeEventListener("hashchange",x)});function x(){_.value&&(_.value=!1,ke(()=>{g.action&&t("action",g.action)}))}const C=()=>{e.closeOnClickModal&&O(g.distinguishCancelAndClose?"close":"cancel")},b=_i(C),L=k=>{if(g.inputType!=="textarea")return k.preventDefault(),O("confirm")},O=k=>{var D;e.boxType==="prompt"&&k==="confirm"&&!T()||(g.action=k,g.beforeClose?(D=g.beforeClose)==null||D.call(g,k,g,x):x())},T=()=>{if(e.boxType==="prompt"){const k=g.inputPattern;if(k&&!k.test(g.inputValue||""))return g.editorErrorMessage=g.inputErrorMessage||S("el.messagebox.error"),g.validateError=!0,!1;const D=g.inputValidator;if(typeof D=="function"){const M=D(g.inputValue);if(M===!1)return g.editorErrorMessage=g.inputErrorMessage||S("el.messagebox.error"),g.validateError=!0,!1;if(typeof M=="string")return g.editorErrorMessage=M,g.validateError=!0,!1}}return g.editorErrorMessage="",g.validateError=!1,!0},R=()=>{const k=u.value.$refs;return k.input||k.textarea},A=()=>{O("close")},P=()=>{e.closeOnPressEscape&&A()};return e.lockScroll&&hi(_),{...pi(g),ns:i,overlayEvent:b,visible:_,hasMessage:c,typeClass:l,contentId:o,inputId:s,btnSize:y,iconComponent:v,confirmButtonClasses:p,rootRef:h,focusStartRef:f,headerRef:E,inputRef:u,confirmRef:d,doClose:x,handleClose:A,onCloseRequested:P,handleWrapperClick:C,handleInputEnter:L,handleAction:O,t:S}}}),cs=["aria-label","aria-describedby"],fs=["aria-label"],ds=["id"];function hs(e,t,n,r,i,y){const S=Be("el-icon"),m=Be("close"),_=Be("el-input"),g=Be("el-button"),l=Be("el-focus-trap"),o=Be("el-overlay");return j(),fe(ht,{name:"fade-in-linear",onAfterLeave:t[11]||(t[11]=s=>e.$emit("vanish")),persisted:""},{default:X(()=>[Ve(z(o,{"z-index":e.zIndex,"overlay-class":[e.ns.is("message-box"),e.modalClass],mask:e.modal},{default:X(()=>[H("div",{role:"dialog","aria-label":e.title,"aria-modal":"true","aria-describedby":e.showInput?void 0:e.contentId,class:te(`${e.ns.namespace.value}-overlay-message-box`),onClick:t[8]||(t[8]=(...s)=>e.overlayEvent.onClick&&e.overlayEvent.onClick(...s)),onMousedown:t[9]||(t[9]=(...s)=>e.overlayEvent.onMousedown&&e.overlayEvent.onMousedown(...s)),onMouseup:t[10]||(t[10]=(...s)=>e.overlayEvent.onMouseup&&e.overlayEvent.onMouseup(...s))},[z(l,{loop:"",trapped:e.visible,"focus-trap-el":e.rootRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:X(()=>[H("div",{ref:"rootRef",class:te([e.ns.b(),e.customClass,e.ns.is("draggable",e.draggable),{[e.ns.m("center")]:e.center}]),style:nt(e.customStyle),tabindex:"-1",onClick:t[7]||(t[7]=We(()=>{},["stop"]))},[e.title!==null&&e.title!==void 0?(j(),se("div",{key:0,ref:"headerRef",class:te(e.ns.e("header"))},[H("div",{class:te(e.ns.e("title"))},[e.iconComponent&&e.center?(j(),fe(S,{key:0,class:te([e.ns.e("status"),e.typeClass])},{default:X(()=>[(j(),fe(ut(e.iconComponent)))]),_:1},8,["class"])):oe("v-if",!0),H("span",null,ye(e.title),1)],2),e.showClose?(j(),se("button",{key:0,type:"button",class:te(e.ns.e("headerbtn")),"aria-label":e.t("el.messagebox.close"),onClick:t[0]||(t[0]=s=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel")),onKeydown:t[1]||(t[1]=gt(We(s=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),["prevent"]),["enter"]))},[z(S,{class:te(e.ns.e("close"))},{default:X(()=>[z(m)]),_:1},8,["class"])],42,fs)):oe("v-if",!0)],2)):oe("v-if",!0),H("div",{id:e.contentId,class:te(e.ns.e("content"))},[H("div",{class:te(e.ns.e("container"))},[e.iconComponent&&!e.center&&e.hasMessage?(j(),fe(S,{key:0,class:te([e.ns.e("status"),e.typeClass])},{default:X(()=>[(j(),fe(ut(e.iconComponent)))]),_:1},8,["class"])):oe("v-if",!0),e.hasMessage?(j(),se("div",{key:1,class:te(e.ns.e("message"))},[De(e.$slots,"default",{},()=>[e.dangerouslyUseHTMLString?(j(),fe(ut(e.showInput?"label":"p"),{key:1,for:e.showInput?e.inputId:void 0,innerHTML:e.message},null,8,["for","innerHTML"])):(j(),fe(ut(e.showInput?"label":"p"),{key:0,for:e.showInput?e.inputId:void 0},{default:X(()=>[xe(ye(e.dangerouslyUseHTMLString?"":e.message),1)]),_:1},8,["for"]))])],2)):oe("v-if",!0)],2),Ve(H("div",{class:te(e.ns.e("input"))},[z(_,{id:e.inputId,ref:"inputRef",modelValue:e.inputValue,"onUpdate:modelValue":t[2]||(t[2]=s=>e.inputValue=s),type:e.inputType,placeholder:e.inputPlaceholder,"aria-invalid":e.validateError,class:te({invalid:e.validateError}),onKeydown:gt(e.handleInputEnter,["enter"])},null,8,["id","modelValue","type","placeholder","aria-invalid","class","onKeydown"]),H("div",{class:te(e.ns.e("errormsg")),style:nt({visibility:e.editorErrorMessage?"visible":"hidden"})},ye(e.editorErrorMessage),7)],2),[[Ge,e.showInput]])],10,ds),H("div",{class:te(e.ns.e("btns"))},[e.showCancelButton?(j(),fe(g,{key:0,loading:e.cancelButtonLoading,class:te([e.cancelButtonClass]),round:e.roundButton,size:e.btnSize,onClick:t[3]||(t[3]=s=>e.handleAction("cancel")),onKeydown:t[4]||(t[4]=gt(We(s=>e.handleAction("cancel"),["prevent"]),["enter"]))},{default:X(()=>[xe(ye(e.cancelButtonText||e.t("el.messagebox.cancel")),1)]),_:1},8,["loading","class","round","size"])):oe("v-if",!0),Ve(z(g,{ref:"confirmRef",type:"primary",loading:e.confirmButtonLoading,class:te([e.confirmButtonClasses]),round:e.roundButton,disabled:e.confirmButtonDisabled,size:e.btnSize,onClick:t[5]||(t[5]=s=>e.handleAction("confirm")),onKeydown:t[6]||(t[6]=gt(We(s=>e.handleAction("confirm"),["prevent"]),["enter"]))},{default:X(()=>[xe(ye(e.confirmButtonText||e.t("el.messagebox.confirm")),1)]),_:1},8,["loading","class","round","disabled","size"]),[[Ge,e.showConfirmButton]])],2)],6)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,cs)]),_:3},8,["z-index","overlay-class","mask"]),[[Ge,e.visible]])]),_:3})}var ps=pt(us,[["render",hs],["__file","/home/runner/work/element-plus/element-plus/packages/components/message-box/src/index.vue"]]);const dt=new Map,_s=e=>{let t=document.body;return e.appendTo&&(cn(e.appendTo)&&(t=document.querySelector(e.appendTo)),Ft(e.appendTo)&&(t=e.appendTo),Ft(t)||(t=document.body)),t},ms=(e,t,n=null)=>{const r=z(ps,e,xn(e.message)||ft(e.message)?{default:xn(e.message)?e.message:()=>e.message}:null);return r.appContext=n,Bt(r,t),_s(e).appendChild(t.firstElementChild),r.component},gs=()=>document.createElement("div"),vs=(e,t)=>{const n=gs();e.onVanish=()=>{Bt(null,n),dt.delete(i)},e.onAction=y=>{const S=dt.get(i);let m;e.showInput?m={value:i.inputValue,action:y}:m=y,e.callback?e.callback(m,r.proxy):y==="cancel"||y==="close"?e.distinguishCancelAndClose&&y!=="cancel"?S.reject("close"):S.reject("cancel"):S.resolve(m)};const r=ms(e,n,t),i=r.proxy;for(const y in e)En(e,y)&&!En(i.$props,y)&&(i[y]=e[y]);return i.visible=!0,i};function st(e,t=null){if(!Jn)return Promise.reject();let n;return cn(e)||ft(e)?e={message:e}:n=e.callback,new Promise((r,i)=>{const y=vs(e,t??st._context);dt.set(y,{options:e,callback:n,resolve:r,reject:i})})}const ys=["alert","confirm","prompt"],Es={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};ys.forEach(e=>{st[e]=xs(e)});function xs(e){return(t,n,r,i)=>{let y="";return mi(n)?(r=n,y=""):gi(n)?y="":y=n,st(Object.assign({title:y,message:t,type:"",...Es[e]},r,{boxType:e}),i)}}st.close=()=>{dt.forEach((e,t)=>{t.doClose()}),dt.clear()};st._context=null;const ze=st;ze.install=e=>{ze._context=e._context,e.config.globalProperties.$msgbox=ze,e.config.globalProperties.$messageBox=ze,e.config.globalProperties.$alert=ze.alert,e.config.globalProperties.$confirm=ze.confirm,e.config.globalProperties.$prompt=ze.prompt};const $e=ze,Zn=["success","info","warning","error"],Ss=ln({customClass:{type:String,default:""},dangerouslyUseHTMLString:{type:Boolean,default:!1},duration:{type:Number,default:4500},icon:{type:vi},id:{type:String,default:""},message:{type:Wt([String,Object]),default:""},offset:{type:Number,default:0},onClick:{type:Wt(Function),default:()=>{}},onClose:{type:Wt(Function),required:!0},position:{type:String,values:["top-right","top-left","bottom-right","bottom-left"],default:"top-right"},showClose:{type:Boolean,default:!0},title:{type:String,default:""},type:{type:String,values:[...Zn,""],default:""},zIndex:Number}),Cs={destroy:()=>!0},bs=["id"],Rs=["textContent"],Ts={key:0},Ls=["innerHTML"],As=He({name:"ElNotification"}),Os=He({...As,props:Ss,emits:Cs,setup(e,{expose:t}){const n=e,{ns:r,zIndex:i}=Xn("notification"),{nextZIndex:y,currentZIndex:S}=i,{Close:m}=Ei,_=q(!1);let g;const l=ve(()=>{const d=n.type;return d&&It[n.type]?r.m(d):""}),o=ve(()=>n.type&&It[n.type]||n.icon),s=ve(()=>n.position.endsWith("right")?"right":"left"),v=ve(()=>n.position.startsWith("top")?"top":"bottom"),c=ve(()=>{var d;return{[v.value]:`${n.offset}px`,zIndex:(d=n.zIndex)!=null?d:S.value}});function h(){n.duration>0&&({stop:g}=xi(()=>{_.value&&f()},n.duration))}function E(){g==null||g()}function f(){_.value=!1}function u({code:d}){d===xt.delete||d===xt.backspace?E():d===xt.esc?_.value&&f():h()}return Nt(()=>{h(),y(),_.value=!0}),yi(document,"keydown",u),t({visible:_,close:f}),(d,p)=>(j(),fe(ht,{name:V(r).b("fade"),onBeforeLeave:d.onClose,onAfterLeave:p[1]||(p[1]=a=>d.$emit("destroy")),persisted:""},{default:X(()=>[Ve(H("div",{id:d.id,class:te([V(r).b(),d.customClass,V(s)]),style:nt(V(c)),role:"alert",onMouseenter:E,onMouseleave:h,onClick:p[0]||(p[0]=(...a)=>d.onClick&&d.onClick(...a))},[V(o)?(j(),fe(V(Je),{key:0,class:te([V(r).e("icon"),V(l)])},{default:X(()=>[(j(),fe(ut(V(o))))]),_:1},8,["class"])):oe("v-if",!0),H("div",{class:te(V(r).e("group"))},[H("h2",{class:te(V(r).e("title")),textContent:ye(d.title)},null,10,Rs),Ve(H("div",{class:te(V(r).e("content")),style:nt(d.title?void 0:{margin:0})},[De(d.$slots,"default",{},()=>[d.dangerouslyUseHTMLString?(j(),se(Fe,{key:1},[oe(" Caution here, message could've been compromised, never use user's input as message "),H("p",{innerHTML:d.message},null,8,Ls)],2112)):(j(),se("p",Ts,ye(d.message),1))])],6),[[Ge,d.message]]),d.showClose?(j(),fe(V(Je),{key:0,class:te(V(r).e("closeBtn")),onClick:We(f,["stop"])},{default:X(()=>[z(V(m))]),_:1},8,["class","onClick"])):oe("v-if",!0)],2)],46,bs),[[Ge,_.value]])]),_:3},8,["name","onBeforeLeave"]))}});var Ps=pt(Os,[["__file","/home/runner/work/element-plus/element-plus/packages/components/notification/src/notification.vue"]]);const Ut={"top-left":[],"top-right":[],"bottom-left":[],"bottom-right":[]},Xt=16;let ks=1;const rt=function(e={},t=null){if(!Jn)return{close:()=>{}};(typeof e=="string"||ft(e))&&(e={message:e});const n=e.position||"top-right";let r=e.offset||0;Ut[n].forEach(({vm:l})=>{var o;r+=(((o=l.el)==null?void 0:o.offsetHeight)||0)+Xt}),r+=Xt;const i=`notification_${ks++}`,y=e.onClose,S={...e,offset:r,id:i,onClose:()=>{Ds(i,n,y)}};let m=document.body;Ft(e.appendTo)?m=e.appendTo:cn(e.appendTo)&&(m=document.querySelector(e.appendTo)),Ft(m)||(m=document.body);const _=document.createElement("div"),g=z(Ps,S,ft(S.message)?{default:()=>S.message}:null);return g.appContext=t??rt._context,g.props.onDestroy=()=>{Bt(null,_)},Bt(g,_),Ut[n].push({vm:g}),m.appendChild(_.firstElementChild),{close:()=>{g.component.exposed.visible.value=!1}}};Zn.forEach(e=>{rt[e]=(t={})=>((typeof t=="string"||ft(t))&&(t={message:t}),rt({...t,type:e}))});function Ds(e,t,n){const r=Ut[t],i=r.findIndex(({vm:g})=>{var l;return((l=g.component)==null?void 0:l.props.id)===e});if(i===-1)return;const{vm:y}=r[i];if(!y)return;n==null||n(y);const S=y.el.offsetHeight,m=t.split("-")[0];r.splice(i,1);const _=r.length;if(!(_<1))for(let g=i;g<_;g++){const{el:l,component:o}=r[g].vm,s=Number.parseInt(l.style[m],10)-S-Xt;o.props.offset=s}}function Is(){for(const e of Object.values(Ut))e.forEach(({vm:t})=>{t.component.exposed.visible.value=!1})}rt.closeAll=Is;rt._context=null;const Ms=Si(rt,"$notify");const je=Object.create(null);je.open="0";je.close="1";je.ping="2";je.pong="3";je.message="4";je.upgrade="5";je.noop="6";const Ct=Object.create(null);Object.keys(je).forEach(e=>{Ct[je[e]]=e});const Bs={type:"error",data:"parser error"},Fs=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",ws=typeof ArrayBuffer=="function",Us=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,er=({type:e,data:t},n,r)=>Fs&&t instanceof Blob?n?r(t):Rn(t,r):ws&&(t instanceof ArrayBuffer||Us(t))?n?r(t):Rn(new Blob([t]),r):r(je[e]+(t||"")),Rn=(e,t)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];t("b"+(r||""))},n.readAsDataURL(e)},Tn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ct=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<Tn.length;e++)ct[Tn.charCodeAt(e)]=e;const js=e=>{let t=e.length*.75,n=e.length,r,i=0,y,S,m,_;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const g=new ArrayBuffer(t),l=new Uint8Array(g);for(r=0;r<n;r+=4)y=ct[e.charCodeAt(r)],S=ct[e.charCodeAt(r+1)],m=ct[e.charCodeAt(r+2)],_=ct[e.charCodeAt(r+3)],l[i++]=y<<2|S>>4,l[i++]=(S&15)<<4|m>>2,l[i++]=(m&3)<<6|_&63;return g},Ns=typeof ArrayBuffer=="function",tr=(e,t)=>{if(typeof e!="string")return{type:"message",data:nr(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:Vs(e.substring(1),t)}:Ct[n]?e.length>1?{type:Ct[n],data:e.substring(1)}:{type:Ct[n]}:Bs},Vs=(e,t)=>{if(Ns){const n=js(e);return nr(n,t)}else return{base64:!0,data:e}},nr=(e,t)=>{switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}},rr=String.fromCharCode(30),Gs=(e,t)=>{const n=e.length,r=new Array(n);let i=0;e.forEach((y,S)=>{er(y,!1,m=>{r[S]=m,++i===n&&t(r.join(rr))})})},Ks=(e,t)=>{const n=e.split(rr),r=[];for(let i=0;i<n.length;i++){const y=tr(n[i],t);if(r.push(y),y.type==="error")break}return r},ir=4;function Ee(e){if(e)return zs(e)}function zs(e){for(var t in Ee.prototype)e[t]=Ee.prototype[t];return e}Ee.prototype.on=Ee.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};Ee.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};Ee.prototype.off=Ee.prototype.removeListener=Ee.prototype.removeAllListeners=Ee.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+e],this};Ee.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this};Ee.prototype.emitReserved=Ee.prototype.emit;Ee.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};Ee.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Pe=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function sr(e,...t){return t.reduce((n,r)=>(e.hasOwnProperty(r)&&(n[r]=e[r]),n),{})}const Ws=Pe.setTimeout,Hs=Pe.clearTimeout;function Vt(e,t){t.useNativeTimers?(e.setTimeoutFn=Ws.bind(Pe),e.clearTimeoutFn=Hs.bind(Pe)):(e.setTimeoutFn=Pe.setTimeout.bind(Pe),e.clearTimeoutFn=Pe.clearTimeout.bind(Pe))}const $s=1.33;function Ys(e){return typeof e=="string"?Xs(e):Math.ceil((e.byteLength||e.size)*$s)}function Xs(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}class Js extends Error{constructor(t,n,r){super(t),this.description=n,this.context=r,this.type="TransportError"}}class or extends Ee{constructor(t){super(),this.writable=!1,Vt(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,n,r){return super.emitReserved("error",new Js(t,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=tr(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}}const ar="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Jt=64,qs={};let Ln=0,vt=0,An;function On(e){let t="";do t=ar[e%Jt]+t,e=Math.floor(e/Jt);while(e>0);return t}function lr(){const e=On(+new Date);return e!==An?(Ln=0,An=e):e+"."+On(Ln++)}for(;vt<Jt;vt++)qs[ar[vt]]=vt;function ur(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function Qs(e){let t={},n=e.split("&");for(let r=0,i=n.length;r<i;r++){let y=n[r].split("=");t[decodeURIComponent(y[0])]=decodeURIComponent(y[1])}return t}let cr=!1;try{cr=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Zs=cr;function fr(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Zs))return new XMLHttpRequest}catch{}if(!t)try{return new Pe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function eo(){}const to=function(){return new fr({xdomain:!1}).responseType!=null}();class no extends or{constructor(t){if(super(t),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||i!==t.port,this.xs=t.secure!==r}const n=t&&t.forceBase64;this.supportsBinary=to&&!n}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};Ks(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Gs(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.query||{};const n=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=lr()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.opts.port&&(n==="https"&&Number(this.opts.port)!==443||n==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=ur(t),y=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(y?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Ue(this.uri(),t)}doWrite(t,n){const r=this.request({method:"POST",data:t});r.on("success",n),r.on("error",(i,y)=>{this.onError("xhr post error",i,y)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=t}}class Ue extends Ee{constructor(t,n){super(),Vt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=t,this.async=n.async!==!1,this.data=n.data!==void 0?n.data:null,this.create()}create(){const t=sr(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const n=this.xhr=new fr(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=Ue.requestsCount++,Ue.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=eo,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Ue.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Ue.requestsCount=0;Ue.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Pn);else if(typeof addEventListener=="function"){const e="onpagehide"in Pe?"pagehide":"unload";addEventListener(e,Pn,!1)}}function Pn(){for(let e in Ue.requests)Ue.requests.hasOwnProperty(e)&&Ue.requests[e].abort()}const dr=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0))(),yt=Pe.WebSocket||Pe.MozWebSocket,kn=!0,ro="arraybuffer",Dn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class io extends or{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),n=this.opts.protocols,r=Dn?{}:sr(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=kn&&!Dn?n?new yt(t,n):new yt(t):new yt(t,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||ro,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const r=t[n],i=n===t.length-1;er(r,this.supportsBinary,y=>{const S={};try{kn&&this.ws.send(y)}catch{}i&&dr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const n=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(n==="wss"&&Number(this.opts.port)!==443||n==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=lr()),this.supportsBinary||(t.b64=1);const i=ur(t),y=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(y?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!yt}}const so={websocket:io,polling:no},oo=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ao=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function qt(e){const t=e,n=e.indexOf("["),r=e.indexOf("]");n!=-1&&r!=-1&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let i=oo.exec(e||""),y={},S=14;for(;S--;)y[ao[S]]=i[S]||"";return n!=-1&&r!=-1&&(y.source=t,y.host=y.host.substring(1,y.host.length-1).replace(/;/g,":"),y.authority=y.authority.replace("[","").replace("]","").replace(/;/g,":"),y.ipv6uri=!0),y.pathNames=lo(y,y.path),y.queryKey=uo(y,y.query),y}function lo(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&r.splice(0,1),t.slice(-1)=="/"&&r.splice(r.length-1,1),r}function uo(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,y){i&&(n[i]=y)}),n}let hr=class et extends Ee{constructor(t,n={}){super(),this.writeBuffer=[],t&&typeof t=="object"&&(n=t,t=null),t?(t=qt(t),n.hostname=t.host,n.secure=t.protocol==="https"||t.protocol==="wss",n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=qt(n.host).host),Vt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Qs(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=ir,n.transport=t,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts.transportOptions[t],this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new so[t](r)}open(){let t;if(this.opts.rememberUpgrade&&et.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch{this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(t){let n=this.createTransport(t),r=!1;et.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",o=>{if(!r)if(o.type==="pong"&&o.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;et.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(l(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const s=new Error("probe error");s.transport=n.name,this.emitReserved("upgradeError",s)}}))};function y(){r||(r=!0,l(),n.close(),n=null)}const S=o=>{const s=new Error("probe error: "+o);s.transport=n.name,y(),this.emitReserved("upgradeError",s)};function m(){S("transport closed")}function _(){S("socket closed")}function g(o){n&&o.name!==n.name&&y()}const l=()=>{n.removeListener("open",i),n.removeListener("error",S),n.removeListener("close",m),this.off("close",_),this.off("upgrading",g)};n.once("open",i),n.once("error",S),n.once("close",m),this.once("close",_),this.once("upgrading",g),n.open()}onOpen(){if(this.readyState="open",et.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let t=0;const n=this.upgrades.length;for(;t<n;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=t.data,this.onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=Ys(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(t,n,r){return this.sendPacket("message",t,n,r),this}send(t,n,r){return this.sendPacket("message",t,n,r),this}sendPacket(t,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const y={type:t,data:n,options:r};this.emitReserved("packetCreate",y),this.writeBuffer.push(y),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():t()}):this.upgrading?r():t()),this}onError(t){et.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const n=[];let r=0;const i=t.length;for(;r<i;r++)~this.transports.indexOf(t[r])&&n.push(t[r]);return n}};hr.protocol=ir;function co(e,t="",n){let r=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),r=qt(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const y=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+y+":"+r.port+t,r.href=r.protocol+"://"+y+(n&&n.port===r.port?"":":"+r.port),r}const fo=typeof ArrayBuffer=="function",ho=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,pr=Object.prototype.toString,po=typeof Blob=="function"||typeof Blob<"u"&&pr.call(Blob)==="[object BlobConstructor]",_o=typeof File=="function"||typeof File<"u"&&pr.call(File)==="[object FileConstructor]";function pn(e){return fo&&(e instanceof ArrayBuffer||ho(e))||po&&e instanceof Blob||_o&&e instanceof File}function bt(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,r=e.length;n<r;n++)if(bt(e[n]))return!0;return!1}if(pn(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return bt(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&bt(e[n]))return!0;return!1}function mo(e){const t=[],n=e.data,r=e;return r.data=Qt(n,t),r.attachments=t.length,{packet:r,buffers:t}}function Qt(e,t){if(!e)return e;if(pn(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=Qt(e[r],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=Qt(e[r],t));return n}return e}function go(e,t){return e.data=Zt(e.data,t),delete e.attachments,e}function Zt(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Zt(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Zt(e[n],t));return e}const vo=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],yo=5;var ie;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(ie||(ie={}));class Eo{constructor(t){this.replacer=t}encode(t){return(t.type===ie.EVENT||t.type===ie.ACK)&&bt(t)?this.encodeAsBinary({type:t.type===ie.EVENT?ie.BINARY_EVENT:ie.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===ie.BINARY_EVENT||t.type===ie.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=mo(t),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}function In(e){return Object.prototype.toString.call(e)==="[object Object]"}class _n extends Ee{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const r=n.type===ie.BINARY_EVENT;r||n.type===ie.BINARY_ACK?(n.type=r?ie.EVENT:ie.ACK,this.reconstructor=new xo(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(pn(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const r={type:Number(t.charAt(0))};if(ie[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===ie.BINARY_EVENT||r.type===ie.BINARY_ACK){const y=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const S=t.substring(y,n);if(S!=Number(S)||t.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(S)}if(t.charAt(n+1)==="/"){const y=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););r.nsp=t.substring(y,n)}else r.nsp="/";const i=t.charAt(n+1);if(i!==""&&Number(i)==i){const y=n+1;for(;++n;){const S=t.charAt(n);if(S==null||Number(S)!=S){--n;break}if(n===t.length)break}r.id=Number(t.substring(y,n+1))}if(t.charAt(++n)){const y=this.tryParse(t.substr(n));if(_n.isPayloadValid(r.type,y))r.data=y;else throw new Error("invalid payload")}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case ie.CONNECT:return In(n);case ie.DISCONNECT:return n===void 0;case ie.CONNECT_ERROR:return typeof n=="string"||In(n);case ie.EVENT:case ie.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&vo.indexOf(n[0])===-1);case ie.ACK:case ie.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class xo{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=go(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const So=Object.freeze(Object.defineProperty({__proto__:null,Decoder:_n,Encoder:Eo,get PacketType(){return ie},protocol:yo},Symbol.toStringTag,{value:"Module"}));function Me(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Co=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class _r extends Ee{constructor(t,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Me(t,"open",this.onopen.bind(this)),Me(t,"packet",this.onpacket.bind(this)),Me(t,"error",this.onerror.bind(this)),Me(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){if(Co.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const r={type:ie.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const S=this.ids++,m=n.pop();this._registerAckCallback(S,m),r.id=S}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(t,n){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[t]=n;return}const y=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let S=0;S<this.sendBuffer.length;S++)this.sendBuffer[S].id===t&&this.sendBuffer.splice(S,1);n.call(this,new Error("operation has timed out"))},i);this.acks[t]=(...S)=>{this.io.clearTimeoutFn(y),n.apply(this,[null,...S])}}emitWithAck(t,...n){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,y)=>{n.push((S,m)=>r?S?y(S):i(m):i(S)),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...y)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...y)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:ie.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case ie.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ie.EVENT:case ie.BINARY_EVENT:this.onevent(t);break;case ie.ACK:case ie.BINARY_ACK:this.onack(t);break;case ie.DISCONNECT:this.ondisconnect();break;case ie.CONNECT_ERROR:this.destroy();const r=new Error(t.data.message);r.data=t.data.data,this.emitReserved("connect_error",r);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:ie.ACK,id:t,data:i}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(n.apply(this,t.data),delete this.acks[t.id])}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ie.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,t.data)}}}function ot(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}ot.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0};ot.prototype.reset=function(){this.attempts=0};ot.prototype.setMin=function(e){this.ms=e};ot.prototype.setMax=function(e){this.max=e};ot.prototype.setJitter=function(e){this.jitter=e};class en extends Ee{constructor(t,n){var r;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Vt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new ot({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||So;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new hr(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Me(n,"open",function(){r.onopen(),t&&t()}),y=Me(n,"error",S=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",S),t?t(S):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const S=this._timeout;S===0&&i();const m=this.setTimeoutFn(()=>{i(),n.close(),n.emit("error",new Error("timeout"))},S);this.opts.autoUnref&&m.unref(),this.subs.push(function(){clearTimeout(m)})}return this.subs.push(i),this.subs.push(y),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Me(t,"ping",this.onping.bind(this)),Me(t,"data",this.ondata.bind(this)),Me(t,"error",this.onerror.bind(this)),Me(t,"close",this.onclose.bind(this)),Me(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){dr(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let r=this.nsps[t];return r?this._autoConnect&&!r.active&&r.connect():(r=new _r(this,t,n),this.nsps[t]=r),r}_destroy(t){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let r=0;r<n.length;r++)this.engine.write(n[r],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const at={};function Rt(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=co(e,t.path||"/socket.io"),r=n.source,i=n.id,y=n.path,S=at[i]&&y in at[i].nsps,m=t.forceNew||t["force new connection"]||t.multiplex===!1||S;let _;return m?_=new en(r,t):(at[i]||(at[i]=new en(r,t)),_=at[i]),n.query&&!t.query&&(t.query=n.queryKey),_.socket(n.path,t)}Object.assign(Rt,{Manager:en,Socket:_r,io:Rt,connect:Rt});let ae=null;const bo=({query:e})=>new Promise(t=>{ae=Rt("wss://121.36.99.231:3000",{reconnection:!0,forceNew:!0,transports:["websocket"],query:e,auth:{token:"Bearer "+localStorage.getItem("live_token")}}),ae.on("connect",()=>{t(),console.log(ae.id,"监听客户端连接成功-connect")})});let mr=!0,gr=!0;function Tt(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Qe(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(S,m){if(S!==t)return i.apply(this,arguments);const _=g=>{const l=n(g);l&&(m.handleEvent?m.handleEvent(l):m(l))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(m,_),i.apply(this,[S,_])};const y=r.removeEventListener;r.removeEventListener=function(S,m){if(S!==t||!this._eventMap||!this._eventMap[t])return y.apply(this,arguments);if(!this._eventMap[t].has(m))return y.apply(this,arguments);const _=this._eventMap[t].get(m);return this._eventMap[t].delete(m),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,y.apply(this,[S,_])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(S){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),S&&this.addEventListener(t,this["_on"+t]=S)},enumerable:!0,configurable:!0})}function Ro(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(mr=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function To(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(gr=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function vr(){if(typeof window=="object"){if(mr)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function mn(e,t){gr&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Lo(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Tt(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Tt(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=Tt(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function Mn(e){return Object.prototype.toString.call(e)==="[object Object]"}function yr(e){return Mn(e)?Object.keys(e).reduce(function(t,n){const r=Mn(e[n]),i=r?yr(e[n]):e[n],y=r&&!Object.keys(i).length;return i===void 0||y?t:Object.assign(t,{[n]:i})},{}):e}function tn(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?tn(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{tn(e,e.get(i),n)})}))}function Bn(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const y=[];return e.forEach(S=>{S.type==="track"&&S.trackIdentifier===t.id&&y.push(S)}),y.forEach(S=>{e.forEach(m=>{m.type===r&&m.trackId===S.id&&tn(e,m,i)})}),i}const Fn=vr;function Er(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(m){if(typeof m!="object"||m.mandatory||m.optional)return m;const _={};return Object.keys(m).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const l=typeof m[g]=="object"?m[g]:{ideal:m[g]};l.exact!==void 0&&typeof l.exact=="number"&&(l.min=l.max=l.exact);const o=function(s,v){return s?s+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(l.ideal!==void 0){_.optional=_.optional||[];let s={};typeof l.ideal=="number"?(s[o("min",g)]=l.ideal,_.optional.push(s),s={},s[o("max",g)]=l.ideal,_.optional.push(s)):(s[o("",g)]=l.ideal,_.optional.push(s))}l.exact!==void 0&&typeof l.exact!="number"?(_.mandatory=_.mandatory||{},_.mandatory[o("",g)]=l.exact):["min","max"].forEach(s=>{l[s]!==void 0&&(_.mandatory=_.mandatory||{},_.mandatory[o(s,g)]=l[s])})}),m.advanced&&(_.optional=(_.optional||[]).concat(m.advanced)),_},i=function(m,_){if(t.version>=61)return _(m);if(m=JSON.parse(JSON.stringify(m)),m&&typeof m.audio=="object"){const g=function(l,o,s){o in l&&!(s in l)&&(l[s]=l[o],delete l[o])};m=JSON.parse(JSON.stringify(m)),g(m.audio,"autoGainControl","googAutoGainControl"),g(m.audio,"noiseSuppression","googNoiseSuppression"),m.audio=r(m.audio)}if(m&&typeof m.video=="object"){let g=m.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const l=t.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!l)){delete m.video.facingMode;let o;if(g.exact==="environment"||g.ideal==="environment"?o=["back","rear"]:(g.exact==="user"||g.ideal==="user")&&(o=["front"]),o)return n.mediaDevices.enumerateDevices().then(s=>{s=s.filter(c=>c.kind==="videoinput");let v=s.find(c=>o.some(h=>c.label.toLowerCase().includes(h)));return!v&&s.length&&o.includes("back")&&(v=s[s.length-1]),v&&(m.video.deviceId=g.exact?{exact:v.deviceId}:{ideal:v.deviceId}),m.video=r(m.video),Fn("chrome: "+JSON.stringify(m)),_(m)})}m.video=r(m.video)}return Fn("chrome: "+JSON.stringify(m)),_(m)},y=function(m){return t.version>=64?m:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[m.name]||m.name,message:m.message,constraint:m.constraint||m.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},S=function(m,_,g){i(m,l=>{n.webkitGetUserMedia(l,_,o=>{g&&g(y(o))})})};if(n.getUserMedia=S.bind(n),n.mediaDevices.getUserMedia){const m=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(_){return i(_,g=>m(g).then(l=>{if(g.audio&&!l.getAudioTracks().length||g.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(o=>{o.stop()}),new DOMException("","NotFoundError");return l},l=>Promise.reject(y(l))))}}}function Ao(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(i=>{const y=r.video&&r.video.width,S=r.video&&r.video.height,m=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:m||3}},y&&(r.video.mandatory.maxWidth=y),S&&(r.video.mandatory.maxHeight=S),e.navigator.mediaDevices.getUserMedia(r)})}}}function xr(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Sr(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let y;e.RTCPeerConnection.prototype.getReceivers?y=this.getReceivers().find(m=>m.track&&m.track.id===i.track.id):y={track:i.track};const S=new Event("track");S.track=i.track,S.receiver=y,S.transceiver={receiver:y},S.streams=[r.stream],this.dispatchEvent(S)}),r.stream.getTracks().forEach(i=>{let y;e.RTCPeerConnection.prototype.getReceivers?y=this.getReceivers().find(m=>m.track&&m.track.id===i.id):y={track:i};const S=new Event("track");S.track=i,S.receiver=y,S.transceiver={receiver:y},S.streams=[r.stream],this.dispatchEvent(S)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Qe(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Cr(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,y){return{track:y,get dtmf(){return this._dtmf===void 0&&(y.kind==="audio"?this._dtmf=i.createDTMFSender(y):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(m,_){let g=i.apply(this,arguments);return g||(g=t(this,m),this._senders.push(g)),g};const y=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(m){y.apply(this,arguments);const _=this._senders.indexOf(m);_!==-1&&this._senders.splice(_,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(y){this._senders=this._senders||[],n.apply(this,[y]),y.getTracks().forEach(S=>{this._senders.push(t(this,S))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(y){this._senders=this._senders||[],r.apply(this,[y]),y.getTracks().forEach(S=>{const m=this._senders.find(_=>_.track===S);m&&this._senders.splice(this._senders.indexOf(m),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function br(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,i,y]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const S=function(_){const g={};return _.result().forEach(o=>{const s={id:o.id,timestamp:o.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[o.type]||o.type};o.names().forEach(v=>{s[v]=o.stat(v)}),g[s.id]=s}),g},m=function(_){return new Map(Object.keys(_).map(g=>[g,_[g]]))};if(arguments.length>=2){const _=function(g){i(m(S(g)))};return t.apply(this,[_,r])}return new Promise((_,g)=>{t.apply(this,[function(l){_(m(S(l)))},g])}).then(i,y)}}function Rr(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const y=n.apply(this,[]);return y.forEach(S=>S._pc=this),y});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const y=r.apply(this,arguments);return y._pc=this,y}),e.RTCRtpSender.prototype.getStats=function(){const y=this;return this._pc.getStats().then(S=>Bn(S,y.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(y=>y._pc=this),i}),Qe(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(y=>Bn(y,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let i,y,S;return this.getSenders().forEach(m=>{m.track===r&&(i?S=!0:i=m)}),this.getReceivers().forEach(m=>(m.track===r&&(y?S=!0:y=m),m.track===r)),S||i&&y?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():y?y.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Tr(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(S=>this._shimmedLocalStreams[S][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(S,m){if(!m)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const _=t.apply(this,arguments);return this._shimmedLocalStreams[m.id]?this._shimmedLocalStreams[m.id].indexOf(_)===-1&&this._shimmedLocalStreams[m.id].push(_):this._shimmedLocalStreams[m.id]=[m,_],_};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(S){this._shimmedLocalStreams=this._shimmedLocalStreams||{},S.getTracks().forEach(g=>{if(this.getSenders().find(o=>o.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const m=this.getSenders();n.apply(this,arguments);const _=this.getSenders().filter(g=>m.indexOf(g)===-1);this._shimmedLocalStreams[S.id]=[S].concat(_)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[S.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},S&&Object.keys(this._shimmedLocalStreams).forEach(m=>{const _=this._shimmedLocalStreams[m].indexOf(S);_!==-1&&this._shimmedLocalStreams[m].splice(_,1),this._shimmedLocalStreams[m].length===1&&delete this._shimmedLocalStreams[m]}),i.apply(this,arguments)}}function Lr(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Tr(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const l=n.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(o=>this._reverseStreams[o.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(o=>{if(this.getSenders().find(v=>v.track===o))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const o=new e.MediaStream(l.getTracks());this._streams[l.id]=o,this._reverseStreams[o.id]=l,l=o}r.apply(this,[l])};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},e.RTCPeerConnection.prototype.addTrack=function(l,o){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const s=[].slice.call(arguments,1);if(s.length!==1||!s[0].getTracks().find(h=>h===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const c=this._streams[o.id];if(c)c.addTrack(l),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const h=new e.MediaStream([l]);this._streams[o.id]=h,this._reverseStreams[h.id]=o,this.addStream(h)}return this.getSenders().find(h=>h.track===l)};function y(g,l){let o=l.sdp;return Object.keys(g._reverseStreams||[]).forEach(s=>{const v=g._reverseStreams[s],c=g._streams[v.id];o=o.replace(new RegExp(c.id,"g"),v.id)}),new RTCSessionDescription({type:l.type,sdp:o})}function S(g,l){let o=l.sdp;return Object.keys(g._reverseStreams||[]).forEach(s=>{const v=g._reverseStreams[s],c=g._streams[v.id];o=o.replace(new RegExp(v.id,"g"),c.id)}),new RTCSessionDescription({type:l.type,sdp:o})}["createOffer","createAnswer"].forEach(function(g){const l=e.RTCPeerConnection.prototype[g],o={[g](){const s=arguments;return arguments.length&&typeof arguments[0]=="function"?l.apply(this,[c=>{const h=y(this,c);s[0].apply(null,[h])},c=>{s[1]&&s[1].apply(null,c)},arguments[2]]):l.apply(this,arguments).then(c=>y(this,c))}};e.RTCPeerConnection.prototype[g]=o[g]});const m=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?m.apply(this,arguments):(arguments[0]=S(this,arguments[0]),m.apply(this,arguments))};const _=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const g=_.get.apply(this);return g.type===""?g:y(this,g)}}),e.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(l._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let s;Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(h=>l.track===h)&&(s=this._streams[v])}),s&&(s.getTracks().length===1?this.removeStream(this._reverseStreams[s.id]):s.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function nn(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function Ar(e,t){Qe(e,"negotiationneeded",n=>{const r=n.target;if(!((t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const wn=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Ar,shimAddTrackRemoveTrack:Lr,shimAddTrackRemoveTrackWithNative:Tr,shimGetDisplayMedia:Ao,shimGetSendersWithDtmf:Cr,shimGetStats:br,shimGetUserMedia:Er,shimMediaStream:xr,shimOnTrack:Sr,shimPeerConnection:nn,shimSenderReceiverGetStats:Rr},Symbol.toStringTag,{value:"Module"}));function Or(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,y,S){mn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(y,S)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(S,m,_){m in S&&!(_ in S)&&(S[_]=S[m],delete S[m])},y=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(S){return typeof S=="object"&&typeof S.audio=="object"&&(S=JSON.parse(JSON.stringify(S)),i(S.audio,"autoGainControl","mozAutoGainControl"),i(S.audio,"noiseSuppression","mozNoiseSuppression")),y(S)},r&&r.prototype.getSettings){const S=r.prototype.getSettings;r.prototype.getSettings=function(){const m=S.apply(this,arguments);return i(m,"mozAutoGainControl","autoGainControl"),i(m,"mozNoiseSuppression","noiseSuppression"),m}}if(r&&r.prototype.applyConstraints){const S=r.prototype.applyConstraints;r.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),i(m,"autoGainControl","mozAutoGainControl"),i(m,"noiseSuppression","mozNoiseSuppression")),S.apply(this,[m])}}}}function Oo(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function Pr(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rn(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const y=e.RTCPeerConnection.prototype[i],S={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),y.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=S[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[y,S,m]=arguments;return r.apply(this,[y||null]).then(_=>{if(t.version<53&&!S)try{_.forEach(g=>{g.type=n[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;_.forEach((l,o)=>{_.set(o,Object.assign({},l,{type:n[l.type]||l.type}))})}return _}).then(S,m)}}function kr(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(y=>y._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Dr(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Qe(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ir(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){mn("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Mr(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Br(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(S=>{if("rid"in S&&!/^[a-z0-9]{0,16}$/i.test(S.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in S&&!(parseFloat(S.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in S&&!(parseFloat(S.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const y=t.apply(this,arguments);if(i){const{sender:S}=y,m=S.getParameters();(!("encodings"in m)||m.encodings.length===1&&Object.keys(m.encodings[0]).length===0)&&(m.encodings=r,S.sendEncodings=r,this.setParametersPromises.push(S.setParameters(m).then(()=>{delete S.sendEncodings}).catch(()=>{delete S.sendEncodings})))}return y})}function Fr(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function wr(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Ur(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const Un=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Br,shimCreateAnswer:Ur,shimCreateOffer:wr,shimGetDisplayMedia:Oo,shimGetParameters:Fr,shimGetUserMedia:Or,shimOnTrack:Pr,shimPeerConnection:rn,shimRTCDataChannel:Mr,shimReceiverGetStats:Dr,shimRemoveStream:Ir,shimSenderGetStats:kr},Symbol.toStringTag,{value:"Module"}));function jr(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>t.call(this,i,r)),r.getVideoTracks().forEach(i=>t.call(this,i,r))},e.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(y=>{this._localStreams?this._localStreams.includes(y)||this._localStreams.push(y):this._localStreams=[y]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(y=>{i.includes(y.track)&&this.removeTrack(y)})})}}function Nr(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const y=new Event("addstream");y.stream=i,this.dispatchEvent(y)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(y=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(y)>=0)return;r._remoteStreams.push(y);const S=new Event("addstream");S.stream=y,r.dispatchEvent(S)})}),t.apply(r,arguments)}}}function Vr(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,y=t.setRemoteDescription,S=t.addIceCandidate;t.createOffer=function(g,l){const o=arguments.length>=2?arguments[2]:arguments[0],s=n.apply(this,[o]);return l?(s.then(g,l),Promise.resolve()):s},t.createAnswer=function(g,l){const o=arguments.length>=2?arguments[2]:arguments[0],s=r.apply(this,[o]);return l?(s.then(g,l),Promise.resolve()):s};let m=function(_,g,l){const o=i.apply(this,[_]);return l?(o.then(g,l),Promise.resolve()):o};t.setLocalDescription=m,m=function(_,g,l){const o=y.apply(this,[_]);return l?(o.then(g,l),Promise.resolve()):o},t.setRemoteDescription=m,m=function(_,g,l){const o=S.apply(this,[_]);return l?(o.then(g,l),Promise.resolve()):o},t.addIceCandidate=m}function Gr(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(Kr(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(r,i,y){t.mediaDevices.getUserMedia(r).then(i,y)}.bind(t))}function Kr(e){return e&&e.video!==void 0?Object.assign({},e,{video:yr(e.video)}):e}function zr(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const y=[];for(let S=0;S<r.iceServers.length;S++){let m=r.iceServers[S];m.urls===void 0&&m.url?(mn("RTCIceServer.url","RTCIceServer.urls"),m=JSON.parse(JSON.stringify(m)),m.urls=m.url,delete m.url,y.push(m)):y.push(r.iceServers[S])}r.iceServers=y}return new t(r,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function Wr(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Hr(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(S=>S.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const y=this.getTransceivers().find(S=>S.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&y?y.direction==="sendrecv"?y.setDirection?y.setDirection("sendonly"):y.direction="sendonly":y.direction==="recvonly"&&(y.setDirection?y.setDirection("inactive"):y.direction="inactive"):r.offerToReceiveVideo===!0&&!y&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function $r(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const jn=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:$r,shimCallbacksAPI:Vr,shimConstraints:Kr,shimCreateOfferLegacy:Hr,shimGetUserMedia:Gr,shimLocalStreamsAPI:jr,shimRTCIceServerUrls:zr,shimRemoteStreamsAPI:Nr,shimTrackEventTransceiver:Wr},Symbol.toStringTag,{value:"Module"}));var Yr={exports:{}};(function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,y)=>(y>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let y=8;y<r.length;y+=2)switch(r[y]){case"raddr":i.relatedAddress=r[y+1];break;case"rport":i.relatedPort=parseInt(r[y+1],10);break;case"tcptype":i.tcpType=r[y+1];break;case"ufrag":i.ufrag=r[y+1],i.usernameFragment=r[y+1];break;default:i[r[y]]===void 0&&(i[r[y]]=r[y+1]);break}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const y=n.type;return r.push("typ"),r.push(y),y!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const y=n.substring(n.indexOf(" ")+1).split(";");for(let S=0;S<y.length;S++)i=y[S].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const y=[];Object.keys(n.parameters).forEach(S=>{n.parameters[S]!==void 0?y.push(S+"="+n.parameters[S]):y.push(S)}),r+="a=fmtp:"+i+" "+y.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(y=>{r+="a=rtcp-fb:"+i+" "+y.type+(y.parameter&&y.parameter.length?" "+y.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},y=n.indexOf(":",r);return y>-1?(i.attribute=n.substring(r+1,y),i.value=n.substring(y+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(y=>{i+="a=fingerprint:"+y.algorithm+" "+y.value+`\r
`}),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],y=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&y?{usernameFragment:i.substring(12),password:y.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},y=t.splitLines(n)[0].split(" ");r.profile=y[2];for(let m=3;m<y.length;m++){const _=y[m],g=t.matchPrefix(n,"a=rtpmap:"+_+" ")[0];if(g){const l=t.parseRtpMap(g),o=t.matchPrefix(n,"a=fmtp:"+_+" ");switch(l.parameters=o.length?t.parseFmtp(o[0]):{},l.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+_+" ").map(t.parseRtcpFb),r.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(l.name.toUpperCase());break}}}t.matchPrefix(n,"a=extmap:").forEach(m=>{r.headerExtensions.push(t.parseExtmap(m))});const S=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(m=>{S.forEach(_=>{m.rtcpFeedback.find(l=>l.type===_.type&&l.parameter===_.parameter)||m.rtcpFeedback.push(_)})}),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(S=>S.preferredPayloadType!==void 0?S.preferredPayloadType:S.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(S=>{i+=t.writeRtpMap(S),i+=t.writeFmtp(S),i+=t.writeRtcpFb(S)});let y=0;return r.codecs.forEach(S=>{S.maxptime>y&&(y=S.maxptime)}),y>0&&(i+="a=maxptime:"+y+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(S=>{i+=t.writeExtmap(S)}),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),y=i.fecMechanisms.indexOf("RED")!==-1,S=i.fecMechanisms.indexOf("ULPFEC")!==-1,m=t.matchPrefix(n,"a=ssrc:").map(s=>t.parseSsrcMedia(s)).filter(s=>s.attribute==="cname"),_=m.length>0&&m[0].ssrc;let g;const l=t.matchPrefix(n,"a=ssrc-group:FID").map(s=>s.substring(17).split(" ").map(c=>parseInt(c,10)));l.length>0&&l[0].length>1&&l[0][0]===_&&(g=l[0][1]),i.codecs.forEach(s=>{if(s.name.toUpperCase()==="RTX"&&s.parameters.apt){let v={ssrc:_,codecPayloadType:parseInt(s.parameters.apt,10)};_&&g&&(v.rtx={ssrc:g}),r.push(v),y&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:_,mechanism:S?"red+ulpfec":"red"},r.push(v))}}),r.length===0&&_&&r.push({ssrc:_});let o=t.matchPrefix(n,"b=");return o.length&&(o[0].indexOf("b=TIAS:")===0?o=parseInt(o[0].substring(7),10):o[0].indexOf("b=AS:")===0?o=parseInt(o[0].substring(5),10)*1e3*.95-50*40*8:o=void 0,r.forEach(s=>{s.maxBitrate=o})),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map(m=>t.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const y=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=y.length>0,r.compound=y.length===0;const S=t.matchPrefix(n,"a=rtcp-mux");return r.mux=S.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const y=t.matchPrefix(n,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="msid");if(y.length>0)return r=y[0].value.split(" "),{stream:r[0],track:r[1]}},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let y;i.length>0&&(y=parseInt(i[0].substring(19),10)),isNaN(y)&&(y=65536);const S=t.matchPrefix(n,"a=sctp-port:");if(S.length>0)return{port:parseInt(S[0].substring(12),10),protocol:r.fmt,maxMessageSize:y};const m=t.matchPrefix(n,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:y}}},t.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let y;const S=r!==void 0?r:2;return n?y=n:y=t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+y+" "+S+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let y=0;y<i.length;y++)switch(i[y]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[y].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(Yr);var Xr=Yr.exports;const tt=qn(Xr),Po=Ui({__proto__:null,default:tt},[Xr]);function Lt(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new t(r),y=tt.parseCandidate(r.candidate);for(const S in y)S in i||Object.defineProperty(i,S,{value:y[S]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,Qe(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function sn(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Qe(e,"icecandidate",t=>{if(t.candidate){const n=tt.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function At(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(m){if(!m||!m.sdp)return!1;const _=tt.splitSections(m.sdp);return _.shift(),_.some(g=>{const l=tt.parseMLine(g);return l&&l.kind==="application"&&l.protocol.indexOf("SCTP")!==-1})},r=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const g=parseInt(_[1],10);return g!==g?-1:g},i=function(m){let _=65536;return t.browser==="firefox"&&(t.version<57?m===-1?_=16384:_=2147483637:t.version<60?_=t.version===57?65535:65536:_=2147483637),_},y=function(m,_){let g=65536;t.browser==="firefox"&&t.version===57&&(g=65535);const l=tt.matchPrefix(m.sdp,"a=max-message-size:");return l.length>0?g=parseInt(l[0].substring(19),10):t.browser==="firefox"&&_!==-1&&(g=2147483637),g},S=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:_}=this.getConfiguration();_==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const _=r(arguments[0]),g=i(_),l=y(arguments[0],_);let o;g===0&&l===0?o=Number.POSITIVE_INFINITY:g===0||l===0?o=Math.max(g,l):o=Math.min(g,l);const s={};Object.defineProperty(s,"maxMessageSize",{get(){return o}}),this._sctp=s}return S.apply(this,arguments)}}function Ot(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const y=r.send;r.send=function(){const m=arguments[0],_=m.length||m.size||m.byteLength;if(r.readyState==="open"&&i.sctp&&_>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return y.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},Qe(e,"datachannel",r=>(t(r.channel,r.target),r))}function on(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const y=i.target;if(y._lastConnectionState!==y.connectionState){y._lastConnectionState=y.connectionState;const S=new Event("connectionstatechange",i);y.dispatchEvent(S)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function an(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const y=i.sdp.split(`
`).filter(S=>S.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:y}):i.sdp=y}return n.apply(this,arguments)}}function Pt(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function kt(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(S=>n.apply(this,[S]))})}const ko=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:an,shimAddIceCandidateNullOrEmpty:Pt,shimConnectionState:on,shimMaxMessageSize:At,shimParameterlessSetLocalDescription:kt,shimRTCIceCandidate:Lt,shimRTCIceCandidateRelayProtocol:sn,shimSendThrowTypeError:Ot},Symbol.toStringTag,{value:"Module"}));function Do({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=vr,r=Lo(e),i={browserDetails:r,commonShim:ko,extractVersion:Tt,disableLog:Ro,disableWarnings:To,sdp:Po};switch(r.browser){case"chrome":if(!wn||!nn||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=wn,Pt(e,r),kt(e),Er(e,r),xr(e),nn(e,r),Sr(e),Lr(e,r),Cr(e),br(e),Rr(e),Ar(e,r),Lt(e),sn(e),on(e),At(e,r),Ot(e),an(e,r);break;case"firefox":if(!Un||!rn||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Un,Pt(e,r),kt(e),Or(e,r),rn(e,r),Pr(e),Ir(e),kr(e),Dr(e),Mr(e),Br(e),Fr(e),wr(e),Ur(e),Lt(e),on(e),At(e,r),Ot(e);break;case"safari":if(!jn||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=jn,Pt(e,r),kt(e),zr(e),Hr(e),Vr(e),jr(e),Nr(e),Wr(e),Gr(e),$r(e),Lt(e),sn(e),At(e,r),Ot(e),an(e,r);break;default:n("Unsupported browser!");break}return i}Do({window:typeof window>"u"?void 0:window});const Io={bundlePolicy:"balanced",iceTransportPolicy:"all",rtcpMuxPolicy:"negotiate",iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:121.36.99.231:3478",username:"ruan8",credential:"123456"}]};class Mo{constructor({onTarck:t,onCandidate:n,onMessage:r}){zt(this,"conn",null);zt(this,"dataChannel",null);var i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;i||$e.alert("当前浏览器不支持RTCPeerConnection！"),this.conn=new i(Io),this.conn.addEventListener("icecandidate",y=>{y.candidate&&n(y.candidate)}),this.conn.addEventListener("track",t),this.conn.addEventListener("connectionstatechange",()=>{this.conn.connectionState==="connected"&&console.log("对等连接成功！")}),this.createDataChannel({onMessage:r})}createOffer(t){this.conn&&this.conn.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(n=>{this.conn.setLocalDescription(n),t(n)}).catch(()=>{console.log("创建offer失败")})}createAnswer(t){this.conn&&this.conn.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(n=>{this.conn&&this.conn.setLocalDescription(n),t(n)}).catch(()=>{console.log("创建answer失败")})}setRemoteDescription(t){var n;(n=this.conn)==null||n.setRemoteDescription(new RTCSessionDescription(t))}setCandidate(t){this.conn&&t&&this.conn.addIceCandidate(new RTCIceCandidate(t)).catch(n=>{console.log(n)})}addTrack(t){this.conn&&t&&t.getTracks().forEach(n=>{this.conn.addTrack(n,t)})}createDataChannel({onMessage:t}){if(this.dataChannel)return!1;this.dataChannel=this.conn.createDataChannel("channel",{ordered:!0,maxRetransmits:5}),this.onDataChannel({onMessage:t})}onDataChannel({onMessage:t}){this.conn.ondatachannel=n=>{var r=n.channel;r.onmessage=function(i){typeof t=="function"&&t(i)},r.onopen=function(){console.log("dataChannel open")},r.onclose=function(){console.log("dataChannel close")}}}}var Jr={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(self,function(){return function(){var n={"./node_modules/es6-promise/dist/es6-promise.js":function(S,m,_){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(g,l){S.exports=l()})(this,function(){function g(I){var B=typeof I;return I!==null&&(B==="object"||B==="function")}function l(I){return typeof I=="function"}var o=void 0;Array.isArray?o=Array.isArray:o=function(I){return Object.prototype.toString.call(I)==="[object Array]"};var s=o,v=0,c=void 0,h=void 0,E=function(B,F){A[v]=B,A[v+1]=F,v+=2,v===2&&(h?h(P):D())};function f(I){h=I}function u(I){E=I}var d=typeof window<"u"?window:void 0,p=d||{},a=p.MutationObserver||p.WebKitMutationObserver,x=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",C=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function b(){return function(){return process.nextTick(P)}}function L(){return typeof c<"u"?function(){c(P)}:R()}function O(){var I=0,B=new a(P),F=document.createTextNode("");return B.observe(F,{characterData:!0}),function(){F.data=I=++I%2}}function T(){var I=new MessageChannel;return I.port1.onmessage=P,function(){return I.port2.postMessage(0)}}function R(){var I=setTimeout;return function(){return I(P,1)}}var A=new Array(1e3);function P(){for(var I=0;I<v;I+=2){var B=A[I],F=A[I+1];B(F),A[I]=void 0,A[I+1]=void 0}v=0}function k(){try{var I=Function("return this")().require("vertx");return c=I.runOnLoop||I.runOnContext,L()}catch{return R()}}var D=void 0;x?D=b():a?D=O():C?D=T():d===void 0?D=k():D=R();function M(I,B){var F=this,K=new this.constructor($);K[Q]===void 0&&G(K);var Z=F._state;if(Z){var ee=arguments[Z-1];E(function(){return Ne(Z,K,ee,F._result)})}else Ce(F,K,I,B);return K}function J(I){var B=this;if(I&&typeof I=="object"&&I.constructor===B)return I;var F=new B($);return Re(F,I),F}var Q=Math.random().toString(36).substring(2);function $(){}var ne=void 0,ue=1,Y=2;function re(){return new TypeError("You cannot resolve a promise with itself")}function Oe(){return new TypeError("A promises callback cannot return that same promise.")}function le(I,B,F,K){try{I.call(B,F,K)}catch(Z){return Z}}function ce(I,B,F){E(function(K){var Z=!1,ee=le(F,B,function(Se){Z||(Z=!0,B!==Se?Re(K,Se):de(K,Se))},function(Se){Z||(Z=!0,W(K,Se))},"Settle: "+(K._label||" unknown promise"));!Z&&ee&&(Z=!0,W(K,ee))},I)}function be(I,B){B._state===ue?de(I,B._result):B._state===Y?W(I,B._result):Ce(B,void 0,function(F){return Re(I,F)},function(F){return W(I,F)})}function pe(I,B,F){B.constructor===I.constructor&&F===M&&B.constructor.resolve===J?be(I,B):F===void 0?de(I,B):l(F)?ce(I,B,F):de(I,B)}function Re(I,B){if(I===B)W(I,re());else if(g(B)){var F=void 0;try{F=B.then}catch(K){W(I,K);return}pe(I,B,F)}else de(I,B)}function Ie(I){I._onerror&&I._onerror(I._result),Te(I)}function de(I,B){I._state===ne&&(I._result=B,I._state=ue,I._subscribers.length!==0&&E(Te,I))}function W(I,B){I._state===ne&&(I._state=Y,I._result=B,E(Ie,I))}function Ce(I,B,F,K){var Z=I._subscribers,ee=Z.length;I._onerror=null,Z[ee]=B,Z[ee+ue]=F,Z[ee+Y]=K,ee===0&&I._state&&E(Te,I)}function Te(I){var B=I._subscribers,F=I._state;if(B.length!==0){for(var K=void 0,Z=void 0,ee=I._result,Se=0;Se<B.length;Se+=3)K=B[Se],Z=B[Se+F],K?Ne(F,K,Z,ee):Z(ee);I._subscribers.length=0}}function Ne(I,B,F,K){var Z=l(F),ee=void 0,Se=void 0,Ze=!0;if(Z){try{ee=F(K)}catch(mt){Ze=!1,Se=mt}if(B===ee){W(B,Oe());return}}else ee=K;B._state!==ne||(Z&&Ze?Re(B,ee):Ze===!1?W(B,Se):I===ue?de(B,ee):I===Y&&W(B,ee))}function N(I,B){try{B(function(K){Re(I,K)},function(K){W(I,K)})}catch(F){W(I,F)}}var w=0;function U(){return w++}function G(I){I[Q]=w++,I._state=void 0,I._result=void 0,I._subscribers=[]}function me(){return new Error("Array Methods must be provided an Array")}var ge=function(){function I(B,F){this._instanceConstructor=B,this.promise=new B($),this.promise[Q]||G(this.promise),s(F)?(this.length=F.length,this._remaining=F.length,this._result=new Array(this.length),this.length===0?de(this.promise,this._result):(this.length=this.length||0,this._enumerate(F),this._remaining===0&&de(this.promise,this._result))):W(this.promise,me())}return I.prototype._enumerate=function(F){for(var K=0;this._state===ne&&K<F.length;K++)this._eachEntry(F[K],K)},I.prototype._eachEntry=function(F,K){var Z=this._instanceConstructor,ee=Z.resolve;if(ee===J){var Se=void 0,Ze=void 0,mt=!1;try{Se=F.then}catch(Kt){mt=!0,Ze=Kt}if(Se===M&&F._state!==ne)this._settledAt(F._state,K,F._result);else if(typeof Se!="function")this._remaining--,this._result[K]=F;else if(Z===_e){var Gt=new Z($);mt?W(Gt,Ze):pe(Gt,F,Se),this._willSettleAt(Gt,K)}else this._willSettleAt(new Z(function(Kt){return Kt(F)}),K)}else this._willSettleAt(ee(F),K)},I.prototype._settledAt=function(F,K,Z){var ee=this.promise;ee._state===ne&&(this._remaining--,F===Y?W(ee,Z):this._result[K]=Z),this._remaining===0&&de(ee,this._result)},I.prototype._willSettleAt=function(F,K){var Z=this;Ce(F,void 0,function(ee){return Z._settledAt(ue,K,ee)},function(ee){return Z._settledAt(Y,K,ee)})},I}();function Le(I){return new ge(this,I).promise}function Ae(I){var B=this;return s(I)?new B(function(F,K){for(var Z=I.length,ee=0;ee<Z;ee++)B.resolve(I[ee]).then(F,K)}):new B(function(F,K){return K(new TypeError("You must pass an array to race."))})}function we(I){var B=this,F=new B($);return W(F,I),F}function he(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function _t(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var _e=function(){function I(B){this[Q]=U(),this._result=this._state=void 0,this._subscribers=[],$!==B&&(typeof B!="function"&&he(),this instanceof I?N(this,B):_t())}return I.prototype.catch=function(F){return this.then(null,F)},I.prototype.finally=function(F){var K=this,Z=K.constructor;return l(F)?K.then(function(ee){return Z.resolve(F()).then(function(){return ee})},function(ee){return Z.resolve(F()).then(function(){throw ee})}):K.then(F,F)},I}();_e.prototype.then=M,_e.all=Le,_e.race=Ae,_e.resolve=J,_e.reject=we,_e._setScheduler=f,_e._setAsap=u,_e._asap=E;function qr(){var I=void 0;if(typeof _.g<"u")I=_.g;else if(typeof self<"u")I=self;else try{I=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var B=I.Promise;if(B){var F=null;try{F=Object.prototype.toString.call(B.resolve())}catch{}if(F==="[object Promise]"&&!B.cast)return}I.Promise=_e}return _e.polyfill=qr,_e.Promise=_e,_e})},"./node_modules/events/events.js":function(S){var m=typeof Reflect=="object"?Reflect:null,_=m&&typeof m.apply=="function"?m.apply:function(R,A,P){return Function.prototype.apply.call(R,A,P)},g;m&&typeof m.ownKeys=="function"?g=m.ownKeys:Object.getOwnPropertySymbols?g=function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:g=function(R){return Object.getOwnPropertyNames(R)};function l(T){console&&console.warn&&console.warn(T)}var o=Number.isNaN||function(R){return R!==R};function s(){s.init.call(this)}S.exports=s,S.exports.once=b,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var v=10;function c(T){if(typeof T!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof T)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return v},set:function(T){if(typeof T!="number"||T<0||o(T))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+T+".");v=T}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(R){if(typeof R!="number"||R<0||o(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this};function h(T){return T._maxListeners===void 0?s.defaultMaxListeners:T._maxListeners}s.prototype.getMaxListeners=function(){return h(this)},s.prototype.emit=function(R){for(var A=[],P=1;P<arguments.length;P++)A.push(arguments[P]);var k=R==="error",D=this._events;if(D!==void 0)k=k&&D.error===void 0;else if(!k)return!1;if(k){var M;if(A.length>0&&(M=A[0]),M instanceof Error)throw M;var J=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw J.context=M,J}var Q=D[R];if(Q===void 0)return!1;if(typeof Q=="function")_(Q,this,A);else for(var $=Q.length,ne=a(Q,$),P=0;P<$;++P)_(ne[P],this,A);return!0};function E(T,R,A,P){var k,D,M;if(c(A),D=T._events,D===void 0?(D=T._events=Object.create(null),T._eventsCount=0):(D.newListener!==void 0&&(T.emit("newListener",R,A.listener?A.listener:A),D=T._events),M=D[R]),M===void 0)M=D[R]=A,++T._eventsCount;else if(typeof M=="function"?M=D[R]=P?[A,M]:[M,A]:P?M.unshift(A):M.push(A),k=h(T),k>0&&M.length>k&&!M.warned){M.warned=!0;var J=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(R)+" listeners added. Use emitter.setMaxListeners() to increase limit");J.name="MaxListenersExceededWarning",J.emitter=T,J.type=R,J.count=M.length,l(J)}return T}s.prototype.addListener=function(R,A){return E(this,R,A,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(R,A){return E(this,R,A,!0)};function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(T,R,A){var P={fired:!1,wrapFn:void 0,target:T,type:R,listener:A},k=f.bind(P);return k.listener=A,P.wrapFn=k,k}s.prototype.once=function(R,A){return c(A),this.on(R,u(this,R,A)),this},s.prototype.prependOnceListener=function(R,A){return c(A),this.prependListener(R,u(this,R,A)),this},s.prototype.removeListener=function(R,A){var P,k,D,M,J;if(c(A),k=this._events,k===void 0)return this;if(P=k[R],P===void 0)return this;if(P===A||P.listener===A)--this._eventsCount===0?this._events=Object.create(null):(delete k[R],k.removeListener&&this.emit("removeListener",R,P.listener||A));else if(typeof P!="function"){for(D=-1,M=P.length-1;M>=0;M--)if(P[M]===A||P[M].listener===A){J=P[M].listener,D=M;break}if(D<0)return this;D===0?P.shift():x(P,D),P.length===1&&(k[R]=P[0]),k.removeListener!==void 0&&this.emit("removeListener",R,J||A)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(R){var A,P,k;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[R]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[R]),this;if(arguments.length===0){var D=Object.keys(P),M;for(k=0;k<D.length;++k)M=D[k],M!=="removeListener"&&this.removeAllListeners(M);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=P[R],typeof A=="function")this.removeListener(R,A);else if(A!==void 0)for(k=A.length-1;k>=0;k--)this.removeListener(R,A[k]);return this};function d(T,R,A){var P=T._events;if(P===void 0)return[];var k=P[R];return k===void 0?[]:typeof k=="function"?A?[k.listener||k]:[k]:A?C(k):a(k,k.length)}s.prototype.listeners=function(R){return d(this,R,!0)},s.prototype.rawListeners=function(R){return d(this,R,!1)},s.listenerCount=function(T,R){return typeof T.listenerCount=="function"?T.listenerCount(R):p.call(T,R)},s.prototype.listenerCount=p;function p(T){var R=this._events;if(R!==void 0){var A=R[T];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?g(this._events):[]};function a(T,R){for(var A=new Array(R),P=0;P<R;++P)A[P]=T[P];return A}function x(T,R){for(;R+1<T.length;R++)T[R]=T[R+1];T.pop()}function C(T){for(var R=new Array(T.length),A=0;A<R.length;++A)R[A]=T[A].listener||T[A];return R}function b(T,R){return new Promise(function(A,P){function k(M){T.removeListener(R,D),P(M)}function D(){typeof T.removeListener=="function"&&T.removeListener("error",k),A([].slice.call(arguments))}O(T,R,D,{once:!0}),R!=="error"&&L(T,k,{once:!0})})}function L(T,R,A){typeof T.on=="function"&&O(T,"error",R,A)}function O(T,R,A,P){if(typeof T.on=="function")P.once?T.once(R,A):T.on(R,A);else if(typeof T.addEventListener=="function")T.addEventListener(R,function k(D){P.once&&T.removeEventListener(R,k),A(D)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof T)}},"./node_modules/webworkify-webpack/index.js":function(S,m,_){function g(f){var u={};function d(a){if(u[a])return u[a].exports;var x=u[a]={i:a,l:!1,exports:{}};return f[a].call(x.exports,x,x.exports,d),x.l=!0,x.exports}d.m=f,d.c=u,d.i=function(a){return a},d.d=function(a,x,C){d.o(a,x)||Object.defineProperty(a,x,{configurable:!1,enumerable:!0,get:C})},d.r=function(a){Object.defineProperty(a,"__esModule",{value:!0})},d.n=function(a){var x=a&&a.__esModule?function(){return a.default}:function(){return a};return d.d(x,"a",x),x},d.o=function(a,x){return Object.prototype.hasOwnProperty.call(a,x)},d.p="/",d.oe=function(a){throw console.error(a),a};var p=d(d.s=ENTRY_MODULE);return p.default||p}var l="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+l+").*?\\)";function s(f){return(f+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function v(f){return!isNaN(1*f)}function c(f,u,d){var p={};p[d]=[];var a=u.toString(),x=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!x)return p;for(var C=x[1],b=new RegExp("(\\\\n|\\W)"+s(C)+o,"g"),L;L=b.exec(a);)L[3]!=="dll-reference"&&p[d].push(L[3]);for(b=new RegExp("\\("+s(C)+'\\("(dll-reference\\s('+l+'))"\\)\\)'+o,"g");L=b.exec(a);)f[L[2]]||(p[d].push(L[1]),f[L[2]]=_(L[1]).m),p[L[2]]=p[L[2]]||[],p[L[2]].push(L[4]);for(var O=Object.keys(p),T=0;T<O.length;T++)for(var R=0;R<p[O[T]].length;R++)v(p[O[T]][R])&&(p[O[T]][R]=1*p[O[T]][R]);return p}function h(f){var u=Object.keys(f);return u.reduce(function(d,p){return d||f[p].length>0},!1)}function E(f,u){for(var d={main:[u]},p={main:[]},a={main:{}};h(d);)for(var x=Object.keys(d),C=0;C<x.length;C++){var b=x[C],L=d[b],O=L.pop();if(a[b]=a[b]||{},!(a[b][O]||!f[b][O])){a[b][O]=!0,p[b]=p[b]||[],p[b].push(O);for(var T=c(f,f[b][O],b),R=Object.keys(T),A=0;A<R.length;A++)d[R[A]]=d[R[A]]||[],d[R[A]]=d[R[A]].concat(T[R[A]])}}return p}S.exports=function(f,u){u=u||{};var d={main:_.m},p=u.all?{main:Object.keys(d.main)}:E(d,f),a="";Object.keys(p).filter(function(O){return O!=="main"}).forEach(function(O){for(var T=0;p[O][T];)T++;p[O].push(T),d[O][T]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+O+" = ("+g.toString().replace("ENTRY_MODULE",JSON.stringify(T))+")({"+p[O].map(function(R){return""+JSON.stringify(R)+": "+d[O][R].toString()}).join(",")+`});
`}),a=a+"new (("+g.toString().replace("ENTRY_MODULE",JSON.stringify(f))+")({"+p.main.map(function(O){return""+JSON.stringify(O)+": "+d.main[O].toString()}).join(",")+"}))(self);";var x=new window.Blob([a],{type:"text/javascript"});if(u.bare)return x;var C=window.URL||window.webkitURL||window.mozURL||window.msURL,b=C.createObjectURL(x),L=new window.Worker(b);return L.objectURL=b,L}},"./src/config.js":function(S,m,_){_.r(m),_.d(m,{defaultConfig:function(){return g},createDefaultConfig:function(){return l}});var g={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function l(){return Object.assign({},g)}},"./src/core/features.js":function(S,m,_){_.r(m);var g=_("./src/io/io-controller.js"),l=_("./src/config.js"),o=function(){function s(){}return s.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},s.supportNetworkStreamIO=function(){var v=new g.default({},(0,l.createDefaultConfig)()),c=v.loaderType;return v.destroy(),c=="fetch-stream-loader"||c=="xhr-moz-chunked-loader"},s.getNetworkLoaderTypeName=function(){var v=new g.default({},(0,l.createDefaultConfig)()),c=v.loaderType;return v.destroy(),c},s.supportNativeMediaPlayback=function(v){s.videoElement==null&&(s.videoElement=window.document.createElement("video"));var c=s.videoElement.canPlayType(v);return c==="probably"||c=="maybe"},s.getFeatureList=function(){var v={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return v.mseFlvPlayback=s.supportMSEH264Playback(),v.networkStreamIO=s.supportNetworkStreamIO(),v.networkLoaderName=s.getNetworkLoaderTypeName(),v.mseLiveFlvPlayback=v.mseFlvPlayback&&v.networkStreamIO,v.nativeMP4H264Playback=s.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),v.nativeWebmVP8Playback=s.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),v.nativeWebmVP9Playback=s.supportNativeMediaPlayback('video/webm; codecs="vp9"'),v},s}();m.default=o},"./src/core/media-info.js":function(S,m,_){_.r(m);var g=function(){function l(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return l.prototype.isComplete=function(){var o=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,s=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&o&&s},l.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},l.prototype.getNearestKeyframe=function(o){if(this.keyframesIndex==null)return null;var s=this.keyframesIndex,v=this._search(s.times,o);return{index:v,milliseconds:s.times[v],fileposition:s.filepositions[v]}},l.prototype._search=function(o,s){var v=0,c=o.length-1,h=0,E=0,f=c;for(s<o[0]&&(v=0,E=f+1);E<=f;)if(h=E+Math.floor((f-E)/2),h===c||s>=o[h]&&s<o[h+1]){v=h;break}else o[h]<s?E=h+1:f=h-1;return v},l}();m.default=g},"./src/core/media-segment-info.js":function(S,m,_){_.r(m),_.d(m,{SampleInfo:function(){return g},MediaSegmentInfo:function(){return l},IDRSampleList:function(){return o},MediaSegmentInfoList:function(){return s}});var g=function(){function v(c,h,E,f,u){this.dts=c,this.pts=h,this.duration=E,this.originalDts=f,this.isSyncPoint=u,this.fileposition=null}return v}(),l=function(){function v(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return v.prototype.appendSyncPoint=function(c){c.isSyncPoint=!0,this.syncPoints.push(c)},v}(),o=function(){function v(){this._list=[]}return v.prototype.clear=function(){this._list=[]},v.prototype.appendArray=function(c){var h=this._list;c.length!==0&&(h.length>0&&c[0].originalDts<h[h.length-1].originalDts&&this.clear(),Array.prototype.push.apply(h,c))},v.prototype.getLastSyncPointBeforeDts=function(c){if(this._list.length==0)return null;var h=this._list,E=0,f=h.length-1,u=0,d=0,p=f;for(c<h[0].dts&&(E=0,d=p+1);d<=p;)if(u=d+Math.floor((p-d)/2),u===f||c>=h[u].dts&&c<h[u+1].dts){E=u;break}else h[u].dts<c?d=u+1:p=u-1;return this._list[E]},v}(),s=function(){function v(c){this._type=c,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(v.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),v.prototype.isEmpty=function(){return this._list.length===0},v.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},v.prototype._searchNearestSegmentBefore=function(c){var h=this._list;if(h.length===0)return-2;var E=h.length-1,f=0,u=0,d=E,p=0;if(c<h[0].originalBeginDts)return p=-1,p;for(;u<=d;)if(f=u+Math.floor((d-u)/2),f===E||c>h[f].lastSample.originalDts&&c<h[f+1].originalBeginDts){p=f;break}else h[f].originalBeginDts<c?u=f+1:d=f-1;return p},v.prototype._searchNearestSegmentAfter=function(c){return this._searchNearestSegmentBefore(c)+1},v.prototype.append=function(c){var h=this._list,E=c,f=this._lastAppendLocation,u=0;f!==-1&&f<h.length&&E.originalBeginDts>=h[f].lastSample.originalDts&&(f===h.length-1||f<h.length-1&&E.originalBeginDts<h[f+1].originalBeginDts)?u=f+1:h.length>0&&(u=this._searchNearestSegmentBefore(E.originalBeginDts)+1),this._lastAppendLocation=u,this._list.splice(u,0,E)},v.prototype.getLastSegmentBefore=function(c){var h=this._searchNearestSegmentBefore(c);return h>=0?this._list[h]:null},v.prototype.getLastSampleBefore=function(c){var h=this.getLastSegmentBefore(c);return h!=null?h.lastSample:null},v.prototype.getLastSyncPointBefore=function(c){for(var h=this._searchNearestSegmentBefore(c),E=this._list[h].syncPoints;E.length===0&&h>0;)h--,E=this._list[h].syncPoints;return E.length>0?E[E.length-1]:null},v}()},"./src/core/mse-controller.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),l=_.n(g),o=_("./src/utils/logger.js"),s=_("./src/utils/browser.js"),v=_("./src/core/mse-events.js"),c=_("./src/core/media-segment-info.js"),h=_("./src/utils/exception.js"),E=function(){function f(u){this.TAG="MSEController",this._config=u,this._emitter=new(l()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new c.IDRSampleList}return f.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},f.prototype.on=function(u,d){this._emitter.addListener(u,d)},f.prototype.off=function(u,d){this._emitter.removeListener(u,d)},f.prototype.attachMediaElement=function(u){if(this._mediaSource)throw new h.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var d=this._mediaSource=new window.MediaSource;d.addEventListener("sourceopen",this.e.onSourceOpen),d.addEventListener("sourceended",this.e.onSourceEnded),d.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=u,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),u.src=this._mediaSourceObjectURL},f.prototype.detachMediaElement=function(){if(this._mediaSource){var u=this._mediaSource;for(var d in this._sourceBuffers){var p=this._pendingSegments[d];p.splice(0,p.length),this._pendingSegments[d]=null,this._pendingRemoveRanges[d]=null,this._lastInitSegments[d]=null;var a=this._sourceBuffers[d];if(a){if(u.readyState!=="closed"){try{u.removeSourceBuffer(a)}catch(x){o.default.e(this.TAG,x.message)}a.removeEventListener("error",this.e.onSourceBufferError),a.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[d]=null,this._sourceBuffers[d]=null}}if(u.readyState==="open")try{u.endOfStream()}catch(x){o.default.e(this.TAG,x.message)}u.removeEventListener("sourceopen",this.e.onSourceOpen),u.removeEventListener("sourceended",this.e.onSourceEnded),u.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},f.prototype.appendInitSegment=function(u,d){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(u),this._pendingSegments[u.type].push(u);return}var p=u,a=""+p.container;p.codec&&p.codec.length>0&&(a+=";codecs="+p.codec);var x=!1;if(o.default.v(this.TAG,"Received Initialization Segment, mimeType: "+a),this._lastInitSegments[p.type]=p,a!==this._mimeTypes[p.type]){if(this._mimeTypes[p.type])o.default.v(this.TAG,"Notice: "+p.type+" mimeType changed, origin: "+this._mimeTypes[p.type]+", target: "+a);else{x=!0;try{var C=this._sourceBuffers[p.type]=this._mediaSource.addSourceBuffer(a);C.addEventListener("error",this.e.onSourceBufferError),C.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(b){o.default.e(this.TAG,b.message),this._emitter.emit(v.default.ERROR,{code:b.code,msg:b.message});return}}this._mimeTypes[p.type]=a}d||this._pendingSegments[p.type].push(p),x||this._sourceBuffers[p.type]&&!this._sourceBuffers[p.type].updating&&this._doAppendSegments(),s.default.safari&&p.container==="audio/mpeg"&&p.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=p.mediaDuration/1e3,this._updateMediaSourceDuration())},f.prototype.appendMediaSegment=function(u){var d=u;this._pendingSegments[d.type].push(d),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var p=this._sourceBuffers[d.type];p&&!p.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},f.prototype.seek=function(u){for(var d in this._sourceBuffers)if(this._sourceBuffers[d]){var p=this._sourceBuffers[d];if(this._mediaSource.readyState==="open")try{p.abort()}catch(O){o.default.e(this.TAG,O.message)}this._idrList.clear();var a=this._pendingSegments[d];if(a.splice(0,a.length),this._mediaSource.readyState!=="closed"){for(var x=0;x<p.buffered.length;x++){var C=p.buffered.start(x),b=p.buffered.end(x);this._pendingRemoveRanges[d].push({start:C,end:b})}if(p.updating||this._doRemoveRanges(),s.default.safari){var L=this._lastInitSegments[d];L&&(this._pendingSegments[d].push(L),p.updating||this._doAppendSegments())}}}},f.prototype.endOfStream=function(){var u=this._mediaSource,d=this._sourceBuffers;if(!u||u.readyState!=="open"){u&&u.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}d.video&&d.video.updating||d.audio&&d.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,u.endOfStream())},f.prototype.getNearestKeyframe=function(u){return this._idrList.getLastSyncPointBeforeDts(u)},f.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var u=this._mediaElement.currentTime;for(var d in this._sourceBuffers){var p=this._sourceBuffers[d];if(p){var a=p.buffered;if(a.length>=1&&u-a.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},f.prototype._doCleanupSourceBuffer=function(){var u=this._mediaElement.currentTime;for(var d in this._sourceBuffers){var p=this._sourceBuffers[d];if(p){for(var a=p.buffered,x=!1,C=0;C<a.length;C++){var b=a.start(C),L=a.end(C);if(b<=u&&u<L+3){if(u-b>=this._config.autoCleanupMaxBackwardDuration){x=!0;var O=u-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[d].push({start:b,end:O})}}else L<u&&(x=!0,this._pendingRemoveRanges[d].push({start:b,end:L}))}x&&!p.updating&&this._doRemoveRanges()}}},f.prototype._updateMediaSourceDuration=function(){var u=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(u.video&&u.video.updating||u.audio&&u.audio.updating)){var d=this._mediaSource.duration,p=this._pendingMediaDuration;p>0&&(isNaN(d)||p>d)&&(o.default.v(this.TAG,"Update MediaSource duration from "+d+" to "+p),this._mediaSource.duration=p),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},f.prototype._doRemoveRanges=function(){for(var u in this._pendingRemoveRanges)if(!(!this._sourceBuffers[u]||this._sourceBuffers[u].updating))for(var d=this._sourceBuffers[u],p=this._pendingRemoveRanges[u];p.length&&!d.updating;){var a=p.shift();d.remove(a.start,a.end)}},f.prototype._doAppendSegments=function(){var u=this._pendingSegments;for(var d in u)if(!(!this._sourceBuffers[d]||this._sourceBuffers[d].updating)&&u[d].length>0){var p=u[d].shift();if(p.timestampOffset){var a=this._sourceBuffers[d].timestampOffset,x=p.timestampOffset/1e3,C=Math.abs(a-x);C>.1&&(o.default.v(this.TAG,"Update MPEG audio timestampOffset from "+a+" to "+x),this._sourceBuffers[d].timestampOffset=x),delete p.timestampOffset}if(!p.data||p.data.byteLength===0)continue;try{this._sourceBuffers[d].appendBuffer(p.data),this._isBufferFull=!1,d==="video"&&p.hasOwnProperty("info")&&this._idrList.appendArray(p.info.syncPoints)}catch(b){this._pendingSegments[d].unshift(p),b.code===22?(this._isBufferFull||this._emitter.emit(v.default.BUFFER_FULL),this._isBufferFull=!0):(o.default.e(this.TAG,b.message),this._emitter.emit(v.default.ERROR,{code:b.code,msg:b.message}))}}},f.prototype._onSourceOpen=function(){if(o.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var u=this._pendingSourceBufferInit;u.length;){var d=u.shift();this.appendInitSegment(d,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(v.default.SOURCE_OPEN)},f.prototype._onSourceEnded=function(){o.default.v(this.TAG,"MediaSource onSourceEnded")},f.prototype._onSourceClose=function(){o.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},f.prototype._hasPendingSegments=function(){var u=this._pendingSegments;return u.video.length>0||u.audio.length>0},f.prototype._hasPendingRemoveRanges=function(){var u=this._pendingRemoveRanges;return u.video.length>0||u.audio.length>0},f.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(v.default.UPDATE_END)},f.prototype._onSourceBufferError=function(u){o.default.e(this.TAG,"SourceBuffer Error: "+u)},f}();m.default=E},"./src/core/mse-events.js":function(S,m,_){_.r(m);var g={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};m.default=g},"./src/core/transmuxer.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),l=_.n(g),o=_("./node_modules/webworkify-webpack/index.js"),s=_.n(o),v=_("./src/utils/logger.js"),c=_("./src/utils/logging-control.js"),h=_("./src/core/transmuxing-controller.js"),E=_("./src/core/transmuxing-events.js"),f=_("./src/core/media-info.js"),u=function(){function d(p,a){if(this.TAG="Transmuxer",this._emitter=new(l()),a.enableWorker&&typeof Worker<"u")try{this._worker=s()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[p,a]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},c.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:c.default.getConfig()})}catch{v.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new h.default(p,a)}else this._controller=new h.default(p,a);if(this._controller){var x=this._controller;x.on(E.default.IO_ERROR,this._onIOError.bind(this)),x.on(E.default.DEMUX_ERROR,this._onDemuxError.bind(this)),x.on(E.default.INIT_SEGMENT,this._onInitSegment.bind(this)),x.on(E.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),x.on(E.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),x.on(E.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),x.on(E.default.MEDIA_INFO,this._onMediaInfo.bind(this)),x.on(E.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),x.on(E.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),x.on(E.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),x.on(E.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return d.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),c.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},d.prototype.on=function(p,a){this._emitter.addListener(p,a)},d.prototype.off=function(p,a){this._emitter.removeListener(p,a)},d.prototype.hasWorker=function(){return this._worker!=null},d.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},d.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},d.prototype.seek=function(p){this._worker?this._worker.postMessage({cmd:"seek",param:p}):this._controller.seek(p)},d.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},d.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},d.prototype._onInitSegment=function(p,a){var x=this;Promise.resolve().then(function(){x._emitter.emit(E.default.INIT_SEGMENT,p,a)})},d.prototype._onMediaSegment=function(p,a){var x=this;Promise.resolve().then(function(){x._emitter.emit(E.default.MEDIA_SEGMENT,p,a)})},d.prototype._onLoadingComplete=function(){var p=this;Promise.resolve().then(function(){p._emitter.emit(E.default.LOADING_COMPLETE)})},d.prototype._onRecoveredEarlyEof=function(){var p=this;Promise.resolve().then(function(){p._emitter.emit(E.default.RECOVERED_EARLY_EOF)})},d.prototype._onMediaInfo=function(p){var a=this;Promise.resolve().then(function(){a._emitter.emit(E.default.MEDIA_INFO,p)})},d.prototype._onMetaDataArrived=function(p){var a=this;Promise.resolve().then(function(){a._emitter.emit(E.default.METADATA_ARRIVED,p)})},d.prototype._onScriptDataArrived=function(p){var a=this;Promise.resolve().then(function(){a._emitter.emit(E.default.SCRIPTDATA_ARRIVED,p)})},d.prototype._onStatisticsInfo=function(p){var a=this;Promise.resolve().then(function(){a._emitter.emit(E.default.STATISTICS_INFO,p)})},d.prototype._onIOError=function(p,a){var x=this;Promise.resolve().then(function(){x._emitter.emit(E.default.IO_ERROR,p,a)})},d.prototype._onDemuxError=function(p,a){var x=this;Promise.resolve().then(function(){x._emitter.emit(E.default.DEMUX_ERROR,p,a)})},d.prototype._onRecommendSeekpoint=function(p){var a=this;Promise.resolve().then(function(){a._emitter.emit(E.default.RECOMMEND_SEEKPOINT,p)})},d.prototype._onLoggingConfigChanged=function(p){this._worker&&this._worker.postMessage({cmd:"logging_config",param:p})},d.prototype._onWorkerMessage=function(p){var a=p.data,x=a.data;if(a.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(a.msg){case E.default.INIT_SEGMENT:case E.default.MEDIA_SEGMENT:this._emitter.emit(a.msg,x.type,x.data);break;case E.default.LOADING_COMPLETE:case E.default.RECOVERED_EARLY_EOF:this._emitter.emit(a.msg);break;case E.default.MEDIA_INFO:Object.setPrototypeOf(x,f.default.prototype),this._emitter.emit(a.msg,x);break;case E.default.METADATA_ARRIVED:case E.default.SCRIPTDATA_ARRIVED:case E.default.STATISTICS_INFO:this._emitter.emit(a.msg,x);break;case E.default.IO_ERROR:case E.default.DEMUX_ERROR:this._emitter.emit(a.msg,x.type,x.info);break;case E.default.RECOMMEND_SEEKPOINT:this._emitter.emit(a.msg,x);break;case"logcat_callback":v.default.emitter.emit("log",x.type,x.logcat);break}},d}();m.default=u},"./src/core/transmuxing-controller.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),l=_.n(g),o=_("./src/utils/logger.js"),s=_("./src/utils/browser.js"),v=_("./src/core/media-info.js"),c=_("./src/demux/flv-demuxer.js"),h=_("./src/remux/mp4-remuxer.js"),E=_("./src/demux/demux-errors.js"),f=_("./src/io/io-controller.js"),u=_("./src/core/transmuxing-events.js"),d=function(){function p(a,x){this.TAG="TransmuxingController",this._emitter=new(l()),this._config=x,a.segments||(a.segments=[{duration:a.duration,filesize:a.filesize,url:a.url}]),typeof a.cors!="boolean"&&(a.cors=!0),typeof a.withCredentials!="boolean"&&(a.withCredentials=!1),this._mediaDataSource=a,this._currentSegmentIndex=0;var C=0;this._mediaDataSource.segments.forEach(function(b){b.timestampBase=C,C+=b.duration,b.cors=a.cors,b.withCredentials=a.withCredentials,x.referrerPolicy&&(b.referrerPolicy=x.referrerPolicy)}),!isNaN(C)&&this._mediaDataSource.duration!==C&&(this._mediaDataSource.duration=C),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return p.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},p.prototype.on=function(a,x){this._emitter.addListener(a,x)},p.prototype.off=function(a,x){this._emitter.removeListener(a,x)},p.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},p.prototype._loadSegment=function(a,x){this._currentSegmentIndex=a;var C=this._mediaDataSource.segments[a],b=this._ioctl=new f.default(C,this._config,a);b.onError=this._onIOException.bind(this),b.onSeeked=this._onIOSeeked.bind(this),b.onComplete=this._onIOComplete.bind(this),b.onRedirect=this._onIORedirect.bind(this),b.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),x?this._demuxer.bindDataSource(this._ioctl):b.onDataArrival=this._onInitChunkArrival.bind(this),b.open(x)},p.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},p.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},p.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},p.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},p.prototype.seek=function(a){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var x=this._searchSegmentIndexContains(a);if(x===this._currentSegmentIndex){var C=this._mediaInfo.segments[x];if(C==null)this._pendingSeekTime=a;else{var b=C.getNearestKeyframe(a);this._remuxer.seek(b.milliseconds),this._ioctl.seek(b.fileposition),this._pendingResolveSeekPoint=b.milliseconds}}else{var L=this._mediaInfo.segments[x];if(L==null)this._pendingSeekTime=a,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(x);else{var b=L.getNearestKeyframe(a);this._internalAbort(),this._remuxer.seek(a),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[x].timestampBase,this._loadSegment(x,b.fileposition),this._pendingResolveSeekPoint=b.milliseconds,this._reportSegmentMediaInfo(x)}}this._enableStatisticsReporter()}},p.prototype._searchSegmentIndexContains=function(a){for(var x=this._mediaDataSource.segments,C=x.length-1,b=0;b<x.length;b++)if(a<x[b].timestampBase){C=b-1;break}return C},p.prototype._onInitChunkArrival=function(a,x){var C=this,b=null,L=0;if(x>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,L=this._demuxer.parseChunks(a,x);else if((b=c.default.probe(a)).match){this._demuxer=new c.default(b,this._config),this._remuxer||(this._remuxer=new h.default(this._config));var O=this._mediaDataSource;O.duration!=null&&!isNaN(O.duration)&&(this._demuxer.overridedDuration=O.duration),typeof O.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=O.hasAudio),typeof O.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=O.hasVideo),this._demuxer.timestampBase=O.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),L=this._demuxer.parseChunks(a,x)}else b=null,o.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){C._internalAbort()}),this._emitter.emit(u.default.DEMUX_ERROR,E.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),L=0;return L},p.prototype._onMediaInfo=function(a){var x=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},a),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,v.default.prototype));var C=Object.assign({},a);Object.setPrototypeOf(C,v.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=C,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var b=x._pendingSeekTime;x._pendingSeekTime=null,x.seek(b)})},p.prototype._onMetaDataArrived=function(a){this._emitter.emit(u.default.METADATA_ARRIVED,a)},p.prototype._onScriptDataArrived=function(a){this._emitter.emit(u.default.SCRIPTDATA_ARRIVED,a)},p.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},p.prototype._onIOComplete=function(a){var x=a,C=x+1;C<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(C)):(this._remuxer.flushStashedSamples(),this._emitter.emit(u.default.LOADING_COMPLETE),this._disableStatisticsReporter())},p.prototype._onIORedirect=function(a){var x=this._ioctl.extraData;this._mediaDataSource.segments[x].redirectedURL=a},p.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(u.default.RECOVERED_EARLY_EOF)},p.prototype._onIOException=function(a,x){o.default.e(this.TAG,"IOException: type = "+a+", code = "+x.code+", msg = "+x.msg),this._emitter.emit(u.default.IO_ERROR,a,x),this._disableStatisticsReporter()},p.prototype._onDemuxException=function(a,x){o.default.e(this.TAG,"DemuxException: type = "+a+", info = "+x),this._emitter.emit(u.default.DEMUX_ERROR,a,x)},p.prototype._onRemuxerInitSegmentArrival=function(a,x){this._emitter.emit(u.default.INIT_SEGMENT,a,x)},p.prototype._onRemuxerMediaSegmentArrival=function(a,x){if(this._pendingSeekTime==null&&(this._emitter.emit(u.default.MEDIA_SEGMENT,a,x),this._pendingResolveSeekPoint!=null&&a==="video")){var C=x.info.syncPoints,b=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,s.default.safari&&C.length>0&&C[0].originalDts===b&&(b=C[0].pts),this._emitter.emit(u.default.RECOMMEND_SEEKPOINT,b)}},p.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},p.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},p.prototype._reportSegmentMediaInfo=function(a){var x=this._mediaInfo.segments[a],C=Object.assign({},x);C.duration=this._mediaInfo.duration,C.segmentCount=this._mediaInfo.segmentCount,delete C.segments,delete C.keyframesIndex,this._emitter.emit(u.default.MEDIA_INFO,C)},p.prototype._reportStatisticsInfo=function(){var a={};a.url=this._ioctl.currentURL,a.hasRedirect=this._ioctl.hasRedirect,a.hasRedirect&&(a.redirectedURL=this._ioctl.currentRedirectedURL),a.speed=this._ioctl.currentSpeed,a.loaderType=this._ioctl.loaderType,a.currentSegmentIndex=this._currentSegmentIndex,a.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(u.default.STATISTICS_INFO,a)},p}();m.default=d},"./src/core/transmuxing-events.js":function(S,m,_){_.r(m);var g={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};m.default=g},"./src/core/transmuxing-worker.js":function(S,m,_){_.r(m);var g=_("./src/utils/logging-control.js"),l=_("./src/utils/polyfill.js"),o=_("./src/core/transmuxing-controller.js"),s=_("./src/core/transmuxing-events.js"),v=function(c){var h=null,E=R.bind(this);l.default.install(),c.addEventListener("message",function(A){switch(A.data.cmd){case"init":h=new o.default(A.data.param[0],A.data.param[1]),h.on(s.default.IO_ERROR,L.bind(this)),h.on(s.default.DEMUX_ERROR,O.bind(this)),h.on(s.default.INIT_SEGMENT,f.bind(this)),h.on(s.default.MEDIA_SEGMENT,u.bind(this)),h.on(s.default.LOADING_COMPLETE,d.bind(this)),h.on(s.default.RECOVERED_EARLY_EOF,p.bind(this)),h.on(s.default.MEDIA_INFO,a.bind(this)),h.on(s.default.METADATA_ARRIVED,x.bind(this)),h.on(s.default.SCRIPTDATA_ARRIVED,C.bind(this)),h.on(s.default.STATISTICS_INFO,b.bind(this)),h.on(s.default.RECOMMEND_SEEKPOINT,T.bind(this));break;case"destroy":h&&(h.destroy(),h=null),c.postMessage({msg:"destroyed"});break;case"start":h.start();break;case"stop":h.stop();break;case"seek":h.seek(A.data.param);break;case"pause":h.pause();break;case"resume":h.resume();break;case"logging_config":{var P=A.data.param;g.default.applyConfig(P),P.enableCallback===!0?g.default.addLogListener(E):g.default.removeLogListener(E);break}}});function f(A,P){var k={msg:s.default.INIT_SEGMENT,data:{type:A,data:P}};c.postMessage(k,[P.data])}function u(A,P){var k={msg:s.default.MEDIA_SEGMENT,data:{type:A,data:P}};c.postMessage(k,[P.data])}function d(){var A={msg:s.default.LOADING_COMPLETE};c.postMessage(A)}function p(){var A={msg:s.default.RECOVERED_EARLY_EOF};c.postMessage(A)}function a(A){var P={msg:s.default.MEDIA_INFO,data:A};c.postMessage(P)}function x(A){var P={msg:s.default.METADATA_ARRIVED,data:A};c.postMessage(P)}function C(A){var P={msg:s.default.SCRIPTDATA_ARRIVED,data:A};c.postMessage(P)}function b(A){var P={msg:s.default.STATISTICS_INFO,data:A};c.postMessage(P)}function L(A,P){c.postMessage({msg:s.default.IO_ERROR,data:{type:A,info:P}})}function O(A,P){c.postMessage({msg:s.default.DEMUX_ERROR,data:{type:A,info:P}})}function T(A){c.postMessage({msg:s.default.RECOMMEND_SEEKPOINT,data:A})}function R(A,P){c.postMessage({msg:"logcat_callback",data:{type:A,logcat:P}})}};m.default=v},"./src/demux/amf-parser.js":function(S,m,_){_.r(m);var g=_("./src/utils/logger.js"),l=_("./src/utils/utf8-conv.js"),o=_("./src/utils/exception.js"),s=function(){var c=new ArrayBuffer(2);return new DataView(c).setInt16(0,256,!0),new Int16Array(c)[0]===256}(),v=function(){function c(){}return c.parseScriptData=function(h,E,f){var u={};try{var d=c.parseValue(h,E,f),p=c.parseValue(h,E+d.size,f-d.size);u[d.data]=p.data}catch(a){g.default.e("AMF",a.toString())}return u},c.parseObject=function(h,E,f){if(f<3)throw new o.IllegalStateException("Data not enough when parse ScriptDataObject");var u=c.parseString(h,E,f),d=c.parseValue(h,E+u.size,f-u.size),p=d.objectEnd;return{data:{name:u.data,value:d.data},size:u.size+d.size,objectEnd:p}},c.parseVariable=function(h,E,f){return c.parseObject(h,E,f)},c.parseString=function(h,E,f){if(f<2)throw new o.IllegalStateException("Data not enough when parse String");var u=new DataView(h,E,f),d=u.getUint16(0,!s),p;return d>0?p=(0,l.default)(new Uint8Array(h,E+2,d)):p="",{data:p,size:2+d}},c.parseLongString=function(h,E,f){if(f<4)throw new o.IllegalStateException("Data not enough when parse LongString");var u=new DataView(h,E,f),d=u.getUint32(0,!s),p;return d>0?p=(0,l.default)(new Uint8Array(h,E+4,d)):p="",{data:p,size:4+d}},c.parseDate=function(h,E,f){if(f<10)throw new o.IllegalStateException("Data size invalid when parse Date");var u=new DataView(h,E,f),d=u.getFloat64(0,!s),p=u.getInt16(8,!s);return d+=p*60*1e3,{data:new Date(d),size:8+2}},c.parseValue=function(h,E,f){if(f<1)throw new o.IllegalStateException("Data not enough when parse Value");var u=new DataView(h,E,f),d=1,p=u.getUint8(0),a,x=!1;try{switch(p){case 0:a=u.getFloat64(1,!s),d+=8;break;case 1:{var C=u.getUint8(1);a=!!C,d+=1;break}case 2:{var b=c.parseString(h,E+1,f-1);a=b.data,d+=b.size;break}case 3:{a={};var L=0;for((u.getUint32(f-4,!s)&16777215)===9&&(L=3);d<f-4;){var O=c.parseObject(h,E+d,f-d-L);if(O.objectEnd)break;a[O.data.name]=O.data.value,d+=O.size}if(d<=f-3){var T=u.getUint32(d-1,!s)&16777215;T===9&&(d+=3)}break}case 8:{a={},d+=4;var L=0;for((u.getUint32(f-4,!s)&16777215)===9&&(L=3);d<f-8;){var R=c.parseVariable(h,E+d,f-d-L);if(R.objectEnd)break;a[R.data.name]=R.data.value,d+=R.size}if(d<=f-3){var T=u.getUint32(d-1,!s)&16777215;T===9&&(d+=3)}break}case 9:a=void 0,d=1,x=!0;break;case 10:{a=[];var A=u.getUint32(1,!s);d+=4;for(var P=0;P<A;P++){var k=c.parseValue(h,E+d,f-d);a.push(k.data),d+=k.size}break}case 11:{var D=c.parseDate(h,E+1,f-1);a=D.data,d+=D.size;break}case 12:{var M=c.parseString(h,E+1,f-1);a=M.data,d+=M.size;break}default:d=f,g.default.w("AMF","Unsupported AMF value type "+p)}}catch(J){g.default.e("AMF",J.toString())}return{data:a,size:d,objectEnd:x}},c}();m.default=v},"./src/demux/demux-errors.js":function(S,m,_){_.r(m);var g={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};m.default=g},"./src/demux/exp-golomb.js":function(S,m,_){_.r(m);var g=_("./src/utils/exception.js"),l=function(){function o(s){this.TAG="ExpGolomb",this._buffer=s,this._buffer_index=0,this._total_bytes=s.byteLength,this._total_bits=s.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return o.prototype.destroy=function(){this._buffer=null},o.prototype._fillCurrentWord=function(){var s=this._total_bytes-this._buffer_index;if(s<=0)throw new g.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var v=Math.min(4,s),c=new Uint8Array(4);c.set(this._buffer.subarray(this._buffer_index,this._buffer_index+v)),this._current_word=new DataView(c.buffer).getUint32(0,!1),this._buffer_index+=v,this._current_word_bits_left=v*8},o.prototype.readBits=function(s){if(s>32)throw new g.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(s<=this._current_word_bits_left){var v=this._current_word>>>32-s;return this._current_word<<=s,this._current_word_bits_left-=s,v}var c=this._current_word_bits_left?this._current_word:0;c=c>>>32-this._current_word_bits_left;var h=s-this._current_word_bits_left;this._fillCurrentWord();var E=Math.min(h,this._current_word_bits_left),f=this._current_word>>>32-E;return this._current_word<<=E,this._current_word_bits_left-=E,c=c<<E|f,c},o.prototype.readBool=function(){return this.readBits(1)===1},o.prototype.readByte=function(){return this.readBits(8)},o.prototype._skipLeadingZero=function(){var s;for(s=0;s<this._current_word_bits_left;s++)if(this._current_word&2147483648>>>s)return this._current_word<<=s,this._current_word_bits_left-=s,s;return this._fillCurrentWord(),s+this._skipLeadingZero()},o.prototype.readUEG=function(){var s=this._skipLeadingZero();return this.readBits(s+1)-1},o.prototype.readSEG=function(){var s=this.readUEG();return s&1?s+1>>>1:-1*(s>>>1)},o}();m.default=l},"./src/demux/flv-demuxer.js":function(S,m,_){_.r(m);var g=_("./src/utils/logger.js"),l=_("./src/demux/amf-parser.js"),o=_("./src/demux/sps-parser.js"),s=_("./src/demux/demux-errors.js"),v=_("./src/core/media-info.js"),c=_("./src/utils/exception.js");function h(f,u){return f[u]<<24|f[u+1]<<16|f[u+2]<<8|f[u+3]}var E=function(){function f(u,d){this.TAG="FLVDemuxer",this._config=d,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=u.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=u.hasAudioTrack,this._hasVideo=u.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new v.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var p=new ArrayBuffer(2);return new DataView(p).setInt16(0,256,!0),new Int16Array(p)[0]===256}()}return f.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},f.probe=function(u){var d=new Uint8Array(u),p={match:!1};if(d[0]!==70||d[1]!==76||d[2]!==86||d[3]!==1)return p;var a=(d[4]&4)>>>2!==0,x=(d[4]&1)!==0,C=h(d,5);return C<9?p:{match:!0,consumed:C,dataOffset:C,hasAudioTrack:a,hasVideoTrack:x}},f.prototype.bindDataSource=function(u){return u.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(f.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(u){this._onTrackMetadata=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(u){this._onMediaInfo=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(u){this._onMetaDataArrived=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(u){this._onScriptDataArrived=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onError",{get:function(){return this._onError},set:function(u){this._onError=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(u){this._onDataAvailable=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(u){this._timestampBase=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"overridedDuration",{get:function(){return this._duration},set:function(u){this._durationOverrided=!0,this._duration=u,this._mediaInfo.duration=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"overridedHasAudio",{set:function(u){this._hasAudioFlagOverrided=!0,this._hasAudio=u,this._mediaInfo.hasAudio=u},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"overridedHasVideo",{set:function(u){this._hasVideoFlagOverrided=!0,this._hasVideo=u,this._mediaInfo.hasVideo=u},enumerable:!1,configurable:!0}),f.prototype.resetMediaInfo=function(){this._mediaInfo=new v.default},f.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},f.prototype.parseChunks=function(u,d){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new c.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var p=0,a=this._littleEndian;if(d===0)if(u.byteLength>13){var x=f.probe(u);p=x.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,d+p!==this._dataOffset&&g.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var C=new DataView(u,p),b=C.getUint32(0,!a);b!==0&&g.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),p+=4}for(;p<u.byteLength;){this._dispatch=!0;var C=new DataView(u,p);if(p+11+4>u.byteLength)break;var L=C.getUint8(0),O=C.getUint32(0,!a)&16777215;if(p+11+O+4>u.byteLength)break;if(L!==8&&L!==9&&L!==18){g.default.w(this.TAG,"Unsupported tag type "+L+", skipped"),p+=11+O+4;continue}var T=C.getUint8(4),R=C.getUint8(5),A=C.getUint8(6),P=C.getUint8(7),k=A|R<<8|T<<16|P<<24,D=C.getUint32(7,!a)&16777215;D!==0&&g.default.w(this.TAG,"Meet tag which has StreamID != 0!");var M=p+11;switch(L){case 8:this._parseAudioData(u,M,O,k);break;case 9:this._parseVideoData(u,M,O,k,d+p);break;case 18:this._parseScriptData(u,M,O);break}var J=C.getUint32(11+O,!a);J!==11+O&&g.default.w(this.TAG,"Invalid PrevTagSize "+J),p+=11+O+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),p},f.prototype._parseScriptData=function(u,d,p){var a=l.default.parseScriptData(u,d,p);if(a.hasOwnProperty("onMetaData")){if(a.onMetaData==null||typeof a.onMetaData!="object"){g.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&g.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=a;var x=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},x)),typeof x.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=x.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof x.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=x.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof x.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=x.audiodatarate),typeof x.videodatarate=="number"&&(this._mediaInfo.videoDataRate=x.videodatarate),typeof x.width=="number"&&(this._mediaInfo.width=x.width),typeof x.height=="number"&&(this._mediaInfo.height=x.height),typeof x.duration=="number"){if(!this._durationOverrided){var C=Math.floor(x.duration*this._timescale);this._duration=C,this._mediaInfo.duration=C}}else this._mediaInfo.duration=0;if(typeof x.framerate=="number"){var b=Math.floor(x.framerate*1e3);if(b>0){var L=b/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=L,this._referenceFrameRate.fps_num=b,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=L}}if(typeof x.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var O=x.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(O),x.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=x,g.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(a).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},a))},f.prototype._parseKeyframesIndex=function(u){for(var d=[],p=[],a=1;a<u.times.length;a++){var x=this._timestampBase+Math.floor(u.times[a]*1e3);d.push(x),p.push(u.filepositions[a])}return{times:d,filepositions:p}},f.prototype._parseAudioData=function(u,d,p,a){if(p<=1){g.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var x=new DataView(u,d,p),C=x.getUint8(0),b=C>>>4;if(b!==2&&b!==10){this._onError(s.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+b);return}var L=0,O=(C&12)>>>2;if(O>=0&&O<=4)L=this._flvSoundRateTable[O];else{this._onError(s.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+O);return}var T=C&1,R=this._audioMetadata,A=this._audioTrack;if(R||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),R=this._audioMetadata={},R.type="audio",R.id=A.id,R.timescale=this._timescale,R.duration=this._duration,R.audioSampleRate=L,R.channelCount=T===0?1:2),b===10){var P=this._parseAACAudioData(u,d+1,p-1);if(P==null)return;if(P.packetType===0){R.config&&g.default.w(this.TAG,"Found another AudioSpecificConfig!");var k=P.data;R.audioSampleRate=k.samplingRate,R.channelCount=k.channelCount,R.codec=k.codec,R.originalCodec=k.originalCodec,R.config=k.config,R.refSampleDuration=1024/R.audioSampleRate*R.timescale,g.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",R);var D=this._mediaInfo;D.audioCodec=R.originalCodec,D.audioSampleRate=R.audioSampleRate,D.audioChannelCount=R.channelCount,D.hasVideo?D.videoCodec!=null&&(D.mimeType='video/x-flv; codecs="'+D.videoCodec+","+D.audioCodec+'"'):D.mimeType='video/x-flv; codecs="'+D.audioCodec+'"',D.isComplete()&&this._onMediaInfo(D)}else if(P.packetType===1){var M=this._timestampBase+a,J={unit:P.data,length:P.data.byteLength,dts:M,pts:M};A.samples.push(J),A.length+=P.data.length}else g.default.e(this.TAG,"Flv: Unsupported AAC data type "+P.packetType)}else if(b===2){if(!R.codec){var k=this._parseMP3AudioData(u,d+1,p-1,!0);if(k==null)return;R.audioSampleRate=k.samplingRate,R.channelCount=k.channelCount,R.codec=k.codec,R.originalCodec=k.originalCodec,R.refSampleDuration=1152/R.audioSampleRate*R.timescale,g.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",R);var D=this._mediaInfo;D.audioCodec=R.codec,D.audioSampleRate=R.audioSampleRate,D.audioChannelCount=R.channelCount,D.audioDataRate=k.bitRate,D.hasVideo?D.videoCodec!=null&&(D.mimeType='video/x-flv; codecs="'+D.videoCodec+","+D.audioCodec+'"'):D.mimeType='video/x-flv; codecs="'+D.audioCodec+'"',D.isComplete()&&this._onMediaInfo(D)}var Q=this._parseMP3AudioData(u,d+1,p-1,!1);if(Q==null)return;var M=this._timestampBase+a,$={unit:Q,length:Q.byteLength,dts:M,pts:M};A.samples.push($),A.length+=Q.length}}},f.prototype._parseAACAudioData=function(u,d,p){if(p<=1){g.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var a={},x=new Uint8Array(u,d,p);return a.packetType=x[0],x[0]===0?a.data=this._parseAACAudioSpecificConfig(u,d+1,p-1):a.data=x.subarray(1),a},f.prototype._parseAACAudioSpecificConfig=function(u,d,p){var a=new Uint8Array(u,d,p),x=null,C=0,b=0,L=0,O=null;if(C=b=a[0]>>>3,L=(a[0]&7)<<1|a[1]>>>7,L<0||L>=this._mpegSamplingRates.length){this._onError(s.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var T=this._mpegSamplingRates[L],R=(a[1]&120)>>>3;if(R<0||R>=8){this._onError(s.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}C===5&&(O=(a[1]&7)<<1|a[2]>>>7,(a[2]&124)>>>2);var A=self.navigator.userAgent.toLowerCase();return A.indexOf("firefox")!==-1?L>=6?(C=5,x=new Array(4),O=L-3):(C=2,x=new Array(2),O=L):A.indexOf("android")!==-1?(C=2,x=new Array(2),O=L):(C=5,O=L,x=new Array(4),L>=6?O=L-3:R===1&&(C=2,x=new Array(2),O=L)),x[0]=C<<3,x[0]|=(L&15)>>>1,x[1]=(L&15)<<7,x[1]|=(R&15)<<3,C===5&&(x[1]|=(O&15)>>>1,x[2]=(O&1)<<7,x[2]|=8,x[3]=0),{config:x,samplingRate:T,channelCount:R,codec:"mp4a.40."+C,originalCodec:"mp4a.40."+b}},f.prototype._parseMP3AudioData=function(u,d,p,a){if(p<4){g.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var x=new Uint8Array(u,d,p),C=null;if(a){if(x[0]!==255)return;var b=x[1]>>>3&3,L=(x[1]&6)>>1,O=(x[2]&240)>>>4,T=(x[2]&12)>>>2,R=x[3]>>>6&3,A=R!==3?2:1,P=0,k=0,D="mp3";switch(b){case 0:P=this._mpegAudioV25SampleRateTable[T];break;case 2:P=this._mpegAudioV20SampleRateTable[T];break;case 3:P=this._mpegAudioV10SampleRateTable[T];break}switch(L){case 1:O<this._mpegAudioL3BitRateTable.length&&(k=this._mpegAudioL3BitRateTable[O]);break;case 2:O<this._mpegAudioL2BitRateTable.length&&(k=this._mpegAudioL2BitRateTable[O]);break;case 3:O<this._mpegAudioL1BitRateTable.length&&(k=this._mpegAudioL1BitRateTable[O]);break}C={bitRate:k,samplingRate:P,channelCount:A,codec:D,originalCodec:D}}else C=x;return C},f.prototype._parseVideoData=function(u,d,p,a,x){if(p<=1){g.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var C=new Uint8Array(u,d,p)[0],b=(C&240)>>>4,L=C&15;if(L!==7){this._onError(s.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+L);return}this._parseAVCVideoPacket(u,d+1,p-1,a,x,b)}},f.prototype._parseAVCVideoPacket=function(u,d,p,a,x,C){if(p<4){g.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var b=this._littleEndian,L=new DataView(u,d,p),O=L.getUint8(0),T=L.getUint32(0,!b)&16777215,R=T<<8>>8;if(O===0)this._parseAVCDecoderConfigurationRecord(u,d+4,p-4);else if(O===1)this._parseAVCVideoData(u,d+4,p-4,a,x,C,R);else if(O!==2){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid video packet type "+O);return}},f.prototype._parseAVCDecoderConfigurationRecord=function(u,d,p){if(p<7){g.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var a=this._videoMetadata,x=this._videoTrack,C=this._littleEndian,b=new DataView(u,d,p);a?typeof a.avcc<"u"&&g.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),a=this._videoMetadata={},a.type="video",a.id=x.id,a.timescale=this._timescale,a.duration=this._duration);var L=b.getUint8(0),O=b.getUint8(1);if(b.getUint8(2),b.getUint8(3),L!==1||O===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(b.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(s.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var T=b.getUint8(5)&31;if(T===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else T>1&&g.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+T);for(var R=6,A=0;A<T;A++){var P=b.getUint16(R,!C);if(R+=2,P!==0){var k=new Uint8Array(u,d+R,P);R+=P;var D=o.default.parseSPS(k);if(A===0){a.codecWidth=D.codec_size.width,a.codecHeight=D.codec_size.height,a.presentWidth=D.present_size.width,a.presentHeight=D.present_size.height,a.profile=D.profile_string,a.level=D.level_string,a.bitDepth=D.bit_depth,a.chromaFormat=D.chroma_format,a.sarRatio=D.sar_ratio,a.frameRate=D.frame_rate,(D.frame_rate.fixed===!1||D.frame_rate.fps_num===0||D.frame_rate.fps_den===0)&&(a.frameRate=this._referenceFrameRate);var M=a.frameRate.fps_den,J=a.frameRate.fps_num;a.refSampleDuration=a.timescale*(M/J);for(var Q=k.subarray(1,4),$="avc1.",ne=0;ne<3;ne++){var ue=Q[ne].toString(16);ue.length<2&&(ue="0"+ue),$+=ue}a.codec=$;var Y=this._mediaInfo;Y.width=a.codecWidth,Y.height=a.codecHeight,Y.fps=a.frameRate.fps,Y.profile=a.profile,Y.level=a.level,Y.refFrames=D.ref_frames,Y.chromaFormat=D.chroma_format_string,Y.sarNum=a.sarRatio.width,Y.sarDen=a.sarRatio.height,Y.videoCodec=$,Y.hasAudio?Y.audioCodec!=null&&(Y.mimeType='video/x-flv; codecs="'+Y.videoCodec+","+Y.audioCodec+'"'):Y.mimeType='video/x-flv; codecs="'+Y.videoCodec+'"',Y.isComplete()&&this._onMediaInfo(Y)}}}var re=b.getUint8(R);if(re===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else re>1&&g.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+re);R++;for(var A=0;A<re;A++){var P=b.getUint16(R,!C);R+=2,P!==0&&(R+=P)}a.avcc=new Uint8Array(p),a.avcc.set(new Uint8Array(u,d,p),0),g.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",a)},f.prototype._parseAVCVideoData=function(u,d,p,a,x,C,b){for(var L=this._littleEndian,O=new DataView(u,d,p),T=[],R=0,A=0,P=this._naluLengthSize,k=this._timestampBase+a,D=C===1;A<p;){if(A+4>=p){g.default.w(this.TAG,"Malformed Nalu near timestamp "+k+", offset = "+A+", dataSize = "+p);break}var M=O.getUint32(A,!L);if(P===3&&(M>>>=8),M>p-P){g.default.w(this.TAG,"Malformed Nalus near timestamp "+k+", NaluSize > DataSize!");return}var J=O.getUint8(A+P)&31;J===5&&(D=!0);var Q=new Uint8Array(u,d+A,P+M),$={type:J,data:Q};T.push($),R+=Q.byteLength,A+=P+M}if(T.length){var ne=this._videoTrack,ue={units:T,length:R,isKeyframe:D,dts:k,cts:b,pts:k+b};D&&(ue.fileposition=x),ne.samples.push(ue),ne.length+=R}},f}();m.default=E},"./src/demux/sps-parser.js":function(S,m,_){_.r(m);var g=_("./src/demux/exp-golomb.js"),l=function(){function o(){}return o._ebsp2rbsp=function(s){for(var v=s,c=v.byteLength,h=new Uint8Array(c),E=0,f=0;f<c;f++)f>=2&&v[f]===3&&v[f-1]===0&&v[f-2]===0||(h[E]=v[f],E++);return new Uint8Array(h.buffer,0,E)},o.parseSPS=function(s){var v=o._ebsp2rbsp(s),c=new g.default(v);c.readByte();var h=c.readByte();c.readByte();var E=c.readByte();c.readUEG();var f=o.getProfileString(h),u=o.getLevelString(E),d=1,p=420,a=[0,420,422,444],x=8;if((h===100||h===110||h===122||h===244||h===44||h===83||h===86||h===118||h===128||h===138||h===144)&&(d=c.readUEG(),d===3&&c.readBits(1),d<=3&&(p=a[d]),x=c.readUEG()+8,c.readUEG(),c.readBits(1),c.readBool()))for(var C=d!==3?8:12,b=0;b<C;b++)c.readBool()&&(b<6?o._skipScalingList(c,16):o._skipScalingList(c,64));c.readUEG();var L=c.readUEG();if(L===0)c.readUEG();else if(L===1){c.readBits(1),c.readSEG(),c.readSEG();for(var O=c.readUEG(),b=0;b<O;b++)c.readSEG()}var T=c.readUEG();c.readBits(1);var R=c.readUEG(),A=c.readUEG(),P=c.readBits(1);P===0&&c.readBits(1),c.readBits(1);var k=0,D=0,M=0,J=0,Q=c.readBool();Q&&(k=c.readUEG(),D=c.readUEG(),M=c.readUEG(),J=c.readUEG());var $=1,ne=1,ue=0,Y=!0,re=0,Oe=0,le=c.readBool();if(le){if(c.readBool()){var ce=c.readByte(),be=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],pe=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];ce>0&&ce<16?($=be[ce-1],ne=pe[ce-1]):ce===255&&($=c.readByte()<<8|c.readByte(),ne=c.readByte()<<8|c.readByte())}if(c.readBool()&&c.readBool(),c.readBool()&&(c.readBits(4),c.readBool()&&c.readBits(24)),c.readBool()&&(c.readUEG(),c.readUEG()),c.readBool()){var Re=c.readBits(32),Ie=c.readBits(32);Y=c.readBool(),re=Ie,Oe=Re*2,ue=re/Oe}}var de=1;($!==1||ne!==1)&&(de=$/ne);var W=0,Ce=0;if(d===0)W=1,Ce=2-P;else{var Te=d===3?1:2,Ne=d===1?2:1;W=Te,Ce=Ne*(2-P)}var N=(R+1)*16,w=(2-P)*((A+1)*16);N-=(k+D)*W,w-=(M+J)*Ce;var U=Math.ceil(N*de);return c.destroy(),c=null,{profile_string:f,level_string:u,bit_depth:x,ref_frames:T,chroma_format:p,chroma_format_string:o.getChromaFormatString(p),frame_rate:{fixed:Y,fps:ue,fps_den:Oe,fps_num:re},sar_ratio:{width:$,height:ne},codec_size:{width:N,height:w},present_size:{width:U,height:w}}},o._skipScalingList=function(s,v){for(var c=8,h=8,E=0,f=0;f<v;f++)h!==0&&(E=s.readSEG(),h=(c+E+256)%256),c=h===0?c:h},o.getProfileString=function(s){switch(s){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},o.getLevelString=function(s){return(s/10).toFixed(1)},o.getChromaFormatString=function(s){switch(s){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},o}();m.default=l},"./src/flv.js":function(S,m,_){_.r(m);var g=_("./src/utils/polyfill.js"),l=_("./src/core/features.js"),o=_("./src/io/loader.js"),s=_("./src/player/flv-player.js"),v=_("./src/player/native-player.js"),c=_("./src/player/player-events.js"),h=_("./src/player/player-errors.js"),E=_("./src/utils/logging-control.js"),f=_("./src/utils/exception.js");g.default.install();function u(x,C){var b=x;if(b==null||typeof b!="object")throw new f.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!b.hasOwnProperty("type"))throw new f.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(b.type){case"flv":return new s.default(b,C);default:return new v.default(b,C)}}function d(){return l.default.supportMSEH264Playback()}function p(){return l.default.getFeatureList()}var a={};a.createPlayer=u,a.isSupported=d,a.getFeatureList=p,a.BaseLoader=o.BaseLoader,a.LoaderStatus=o.LoaderStatus,a.LoaderErrors=o.LoaderErrors,a.Events=c.default,a.ErrorTypes=h.ErrorTypes,a.ErrorDetails=h.ErrorDetails,a.FlvPlayer=s.default,a.NativePlayer=v.default,a.LoggingControl=E.default,Object.defineProperty(a,"version",{enumerable:!0,get:function(){return"1.6.2"}}),m.default=a},"./src/index.js":function(S,m,_){S.exports=_("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(S,m,_){_.r(m);var g=_("./src/utils/browser.js"),l=_("./src/io/loader.js"),o=_("./src/utils/exception.js"),s=function(){var c=function(h,E){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(f[d]=u[d])},c(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");c(h,E);function f(){this.constructor=h}h.prototype=E===null?Object.create(E):(f.prototype=E.prototype,new f)}}(),v=function(c){s(h,c);function h(E,f){var u=c.call(this,"fetch-stream-loader")||this;return u.TAG="FetchStreamLoader",u._seekHandler=E,u._config=f,u._needStash=!0,u._requestAbort=!1,u._contentLength=null,u._receivedLength=0,u}return h.isSupported=function(){try{var E=g.default.msedge&&g.default.version.minor>=15048,f=g.default.msedge?E:!0;return self.fetch&&self.ReadableStream&&f}catch{return!1}},h.prototype.destroy=function(){this.isWorking()&&this.abort(),c.prototype.destroy.call(this)},h.prototype.open=function(E,f){var u=this;this._dataSource=E,this._range=f;var d=E.url;this._config.reuseRedirectedURL&&E.redirectedURL!=null&&(d=E.redirectedURL);var p=this._seekHandler.getConfig(d,f),a=new self.Headers;if(typeof p.headers=="object"){var x=p.headers;for(var C in x)x.hasOwnProperty(C)&&a.append(C,x[C])}var b={method:"GET",headers:a,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var C in this._config.headers)a.append(C,this._config.headers[C]);E.cors===!1&&(b.mode="same-origin"),E.withCredentials&&(b.credentials="include"),E.referrerPolicy&&(b.referrerPolicy=E.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,b.signal=this._abortController.signal),this._status=l.LoaderStatus.kConnecting,self.fetch(p.url,b).then(function(L){if(u._requestAbort){u._status=l.LoaderStatus.kIdle,L.body.cancel();return}if(L.ok&&L.status>=200&&L.status<=299){if(L.url!==p.url&&u._onURLRedirect){var O=u._seekHandler.removeURLParameters(L.url);u._onURLRedirect(O)}var T=L.headers.get("Content-Length");return T!=null&&(u._contentLength=parseInt(T),u._contentLength!==0&&u._onContentLengthKnown&&u._onContentLengthKnown(u._contentLength)),u._pump.call(u,L.body.getReader())}else if(u._status=l.LoaderStatus.kError,u._onError)u._onError(l.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:L.status,msg:L.statusText});else throw new o.RuntimeException("FetchStreamLoader: Http code invalid, "+L.status+" "+L.statusText)}).catch(function(L){if(!(u._abortController&&u._abortController.signal.aborted))if(u._status=l.LoaderStatus.kError,u._onError)u._onError(l.LoaderErrors.EXCEPTION,{code:-1,msg:L.message});else throw L})},h.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==l.LoaderStatus.kBuffering||!g.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},h.prototype._pump=function(E){var f=this;return E.read().then(function(u){if(u.done)if(f._contentLength!==null&&f._receivedLength<f._contentLength){f._status=l.LoaderStatus.kError;var d=l.LoaderErrors.EARLY_EOF,p={code:-1,msg:"Fetch stream meet Early-EOF"};if(f._onError)f._onError(d,p);else throw new o.RuntimeException(p.msg)}else f._status=l.LoaderStatus.kComplete,f._onComplete&&f._onComplete(f._range.from,f._range.from+f._receivedLength-1);else{if(f._abortController&&f._abortController.signal.aborted){f._status=l.LoaderStatus.kComplete;return}else if(f._requestAbort===!0)return f._status=l.LoaderStatus.kComplete,E.cancel();f._status=l.LoaderStatus.kBuffering;var a=u.value.buffer,x=f._range.from+f._receivedLength;f._receivedLength+=a.byteLength,f._onDataArrival&&f._onDataArrival(a,x,f._receivedLength),f._pump(E)}}).catch(function(u){if(f._abortController&&f._abortController.signal.aborted){f._status=l.LoaderStatus.kComplete;return}if(!(u.code===11&&g.default.msedge)){f._status=l.LoaderStatus.kError;var d=0,p=null;if((u.code===19||u.message==="network error")&&(f._contentLength===null||f._contentLength!==null&&f._receivedLength<f._contentLength)?(d=l.LoaderErrors.EARLY_EOF,p={code:u.code,msg:"Fetch stream meet Early-EOF"}):(d=l.LoaderErrors.EXCEPTION,p={code:u.code,msg:u.message}),f._onError)f._onError(d,p);else throw new o.RuntimeException(p.msg)}})},h}(l.BaseLoader);m.default=v},"./src/io/io-controller.js":function(S,m,_){_.r(m);var g=_("./src/utils/logger.js"),l=_("./src/io/speed-sampler.js"),o=_("./src/io/loader.js"),s=_("./src/io/fetch-stream-loader.js"),v=_("./src/io/xhr-moz-chunked-loader.js"),c=_("./src/io/xhr-range-loader.js"),h=_("./src/io/websocket-loader.js"),E=_("./src/io/range-seek-handler.js"),f=_("./src/io/param-seek-handler.js"),u=_("./src/utils/exception.js"),d=function(){function p(a,x,C){this.TAG="IOController",this._config=x,this._extraData=C,this._stashInitialSize=1024*384,x.stashInitialSize!=null&&x.stashInitialSize>0&&(this._stashInitialSize=x.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,x.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=a,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(a.url),this._refTotalLength=a.filesize?a.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new l.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return p.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},p.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},p.prototype.isPaused=function(){return this._paused},Object.defineProperty(p.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"extraData",{get:function(){return this._extraData},set:function(a){this._extraData=a},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(a){this._onDataArrival=a},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(a){this._onSeeked=a},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onError",{get:function(){return this._onError},set:function(a){this._onError=a},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onComplete",{get:function(){return this._onComplete},set:function(a){this._onComplete=a},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(a){this._onRedirect=a},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(a){this._onRecoveredEarlyEof=a},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"currentSpeed",{get:function(){return this._loaderClass===c.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),p.prototype._selectSeekHandler=function(){var a=this._config;if(a.seekType==="range")this._seekHandler=new E.default(this._config.rangeLoadZeroStart);else if(a.seekType==="param"){var x=a.seekParamStart||"bstart",C=a.seekParamEnd||"bend";this._seekHandler=new f.default(x,C)}else if(a.seekType==="custom"){if(typeof a.customSeekHandler!="function")throw new u.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new a.customSeekHandler}else throw new u.InvalidArgumentException("Invalid seekType in config: "+a.seekType)},p.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=h.default;else if(s.default.isSupported())this._loaderClass=s.default;else if(v.default.isSupported())this._loaderClass=v.default;else if(c.default.isSupported())this._loaderClass=c.default;else throw new u.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},p.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},p.prototype.open=function(a){this._currentRange={from:0,to:-1},a&&(this._currentRange.from=a),this._speedSampler.reset(),a||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},p.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},p.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},p.prototype.resume=function(){if(this._paused){this._paused=!1;var a=this._resumeFrom;this._resumeFrom=0,this._internalSeek(a,!0)}},p.prototype.seek=function(a){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(a,!0)},p.prototype._internalSeek=function(a,x){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(x),this._loader.destroy(),this._loader=null;var C={from:a,to:-1};this._currentRange={from:C.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,C),this._onSeeked&&this._onSeeked()},p.prototype.updateUrl=function(a){if(!a||typeof a!="string"||a.length===0)throw new u.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=a},p.prototype._expandBuffer=function(a){for(var x=this._stashSize;x+1024*1024*1<a;)x*=2;if(x+=1024*1024*1,x!==this._bufferSize){var C=new ArrayBuffer(x);if(this._stashUsed>0){var b=new Uint8Array(this._stashBuffer,0,this._stashUsed),L=new Uint8Array(C,0,x);L.set(b,0)}this._stashBuffer=C,this._bufferSize=x}},p.prototype._normalizeSpeed=function(a){var x=this._speedNormalizeList,C=x.length-1,b=0,L=0,O=C;if(a<x[0])return x[0];for(;L<=O;){if(b=L+Math.floor((O-L)/2),b===C||a>=x[b]&&a<x[b+1])return x[b];x[b]<a?L=b+1:O=b-1}},p.prototype._adjustStashSize=function(a){var x=0;this._config.isLive||a<512?x=a:a>=512&&a<=1024?x=Math.floor(a*1.5):x=a*2,x>8192&&(x=8192);var C=x*1024+1024*1024*1;this._bufferSize<C&&this._expandBuffer(C),this._stashSize=x*1024},p.prototype._dispatchChunks=function(a,x){return this._currentRange.to=x+a.byteLength-1,this._onDataArrival(a,x)},p.prototype._onURLRedirect=function(a){this._redirectedURL=a,this._onRedirect&&this._onRedirect(a)},p.prototype._onContentLengthKnown=function(a){a&&this._fullRequestFlag&&(this._totalLength=a,this._fullRequestFlag=!1)},p.prototype._onLoaderChunkArrival=function(a,x,C){if(!this._onDataArrival)throw new u.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(a.byteLength);var b=this._speedSampler.lastSecondKBps;if(b!==0){var L=this._normalizeSpeed(b);this._speedNormalized!==L&&(this._speedNormalized=L,this._adjustStashSize(L))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=x),this._stashUsed+a.byteLength<=this._stashSize){var R=new Uint8Array(this._stashBuffer,0,this._stashSize);R.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength}else{var R=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var P=this._stashBuffer.slice(0,this._stashUsed),O=this._dispatchChunks(P,this._stashByteStart);if(O<P.byteLength){if(O>0){var A=new Uint8Array(P,O);R.set(A,0),this._stashUsed=A.byteLength,this._stashByteStart+=O}}else this._stashUsed=0,this._stashByteStart+=O;this._stashUsed+a.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+a.byteLength),R=new Uint8Array(this._stashBuffer,0,this._bufferSize)),R.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength}else{var O=this._dispatchChunks(a,x);if(O<a.byteLength){var T=a.byteLength-O;T>this._bufferSize&&(this._expandBuffer(T),R=new Uint8Array(this._stashBuffer,0,this._bufferSize)),R.set(new Uint8Array(a,O),0),this._stashUsed+=T,this._stashByteStart=x+O}}}else if(this._stashUsed===0){var O=this._dispatchChunks(a,x);if(O<a.byteLength){var T=a.byteLength-O;T>this._bufferSize&&this._expandBuffer(T);var R=new Uint8Array(this._stashBuffer,0,this._bufferSize);R.set(new Uint8Array(a,O),0),this._stashUsed+=T,this._stashByteStart=x+O}}else{this._stashUsed+a.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+a.byteLength);var R=new Uint8Array(this._stashBuffer,0,this._bufferSize);R.set(new Uint8Array(a),this._stashUsed),this._stashUsed+=a.byteLength;var O=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(O<this._stashUsed&&O>0){var A=new Uint8Array(this._stashBuffer,O);R.set(A,0)}this._stashUsed-=O,this._stashByteStart+=O}}},p.prototype._flushStashBuffer=function(a){if(this._stashUsed>0){var x=this._stashBuffer.slice(0,this._stashUsed),C=this._dispatchChunks(x,this._stashByteStart),b=x.byteLength-C;if(C<x.byteLength)if(a)g.default.w(this.TAG,b+" bytes unconsumed data remain when flush buffer, dropped");else{if(C>0){var L=new Uint8Array(this._stashBuffer,0,this._bufferSize),O=new Uint8Array(x,C);L.set(O,0),this._stashUsed=O.byteLength,this._stashByteStart+=C}return 0}return this._stashUsed=0,this._stashByteStart=0,b}return 0},p.prototype._onLoaderComplete=function(a,x){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},p.prototype._onLoaderError=function(a,x){switch(g.default.e(this.TAG,"Loader error, code = "+x.code+", msg = "+x.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,a=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF),a){case o.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var C=this._currentRange.to+1;C<this._totalLength&&(g.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(C,!1));return}a=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case o.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case o.LoaderErrors.CONNECTING_TIMEOUT:case o.LoaderErrors.HTTP_STATUS_CODE_INVALID:case o.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(a,x);else throw new u.RuntimeException("IOException: "+x.msg)},p}();m.default=d},"./src/io/loader.js":function(S,m,_){_.r(m),_.d(m,{LoaderStatus:function(){return l},LoaderErrors:function(){return o},BaseLoader:function(){return s}});var g=_("./src/utils/exception.js"),l={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},o={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},s=function(){function v(c){this._type=c||"undefined",this._status=l.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return v.prototype.destroy=function(){this._status=l.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},v.prototype.isWorking=function(){return this._status===l.kConnecting||this._status===l.kBuffering},Object.defineProperty(v.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(c){this._onContentLengthKnown=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(c){this._onURLRedirect=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(c){this._onDataArrival=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onError",{get:function(){return this._onError},set:function(c){this._onError=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onComplete",{get:function(){return this._onComplete},set:function(c){this._onComplete=c},enumerable:!1,configurable:!0}),v.prototype.open=function(c,h){throw new g.NotImplementedException("Unimplemented abstract function!")},v.prototype.abort=function(){throw new g.NotImplementedException("Unimplemented abstract function!")},v}()},"./src/io/param-seek-handler.js":function(S,m,_){_.r(m);var g=function(){function l(o,s){this._startName=o,this._endName=s}return l.prototype.getConfig=function(o,s){var v=o;if(s.from!==0||s.to!==-1){var c=!0;v.indexOf("?")===-1&&(v+="?",c=!1),c&&(v+="&"),v+=this._startName+"="+s.from.toString(),s.to!==-1&&(v+="&"+this._endName+"="+s.to.toString())}return{url:v,headers:{}}},l.prototype.removeURLParameters=function(o){var s=o.split("?")[0],v=void 0,c=o.indexOf("?");c!==-1&&(v=o.substring(c+1));var h="";if(v!=null&&v.length>0)for(var E=v.split("&"),f=0;f<E.length;f++){var u=E[f].split("="),d=f>0;u[0]!==this._startName&&u[0]!==this._endName&&(d&&(h+="&"),h+=E[f])}return h.length===0?s:s+"?"+h},l}();m.default=g},"./src/io/range-seek-handler.js":function(S,m,_){_.r(m);var g=function(){function l(o){this._zeroStart=o||!1}return l.prototype.getConfig=function(o,s){var v={};if(s.from!==0||s.to!==-1){var c=void 0;s.to!==-1?c="bytes="+s.from.toString()+"-"+s.to.toString():c="bytes="+s.from.toString()+"-",v.Range=c}else this._zeroStart&&(v.Range="bytes=0-");return{url:o,headers:v}},l.prototype.removeURLParameters=function(o){return o},l}();m.default=g},"./src/io/speed-sampler.js":function(S,m,_){_.r(m);var g=function(){function l(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return l.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},l.prototype.addBytes=function(o){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=o,this._totalBytes+=o):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=o,this._totalBytes+=o):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=o,this._totalBytes+=o,this._lastCheckpoint=this._now())},Object.defineProperty(l.prototype,"currentKBps",{get:function(){this.addBytes(0);var o=(this._now()-this._lastCheckpoint)/1e3;return o==0&&(o=1),this._intervalBytes/o/1024},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"averageKBps",{get:function(){var o=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/o/1024},enumerable:!1,configurable:!0}),l}();m.default=g},"./src/io/websocket-loader.js":function(S,m,_){_.r(m);var g=_("./src/io/loader.js"),l=_("./src/utils/exception.js"),o=function(){var v=function(c,h){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,f){E.__proto__=f}||function(E,f){for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&(E[u]=f[u])},v(c,h)};return function(c,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");v(c,h);function E(){this.constructor=c}c.prototype=h===null?Object.create(h):(E.prototype=h.prototype,new E)}}(),s=function(v){o(c,v);function c(){var h=v.call(this,"websocket-loader")||this;return h.TAG="WebSocketLoader",h._needStash=!0,h._ws=null,h._requestAbort=!1,h._receivedLength=0,h}return c.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},c.prototype.destroy=function(){this._ws&&this.abort(),v.prototype.destroy.call(this)},c.prototype.open=function(h){try{var E=this._ws=new self.WebSocket(h.url);E.binaryType="arraybuffer",E.onopen=this._onWebSocketOpen.bind(this),E.onclose=this._onWebSocketClose.bind(this),E.onmessage=this._onWebSocketMessage.bind(this),E.onerror=this._onWebSocketError.bind(this),this._status=g.LoaderStatus.kConnecting}catch(u){this._status=g.LoaderStatus.kError;var f={code:u.code,msg:u.message};if(this._onError)this._onError(g.LoaderErrors.EXCEPTION,f);else throw new l.RuntimeException(f.msg)}},c.prototype.abort=function(){var h=this._ws;h&&(h.readyState===0||h.readyState===1)&&(this._requestAbort=!0,h.close()),this._ws=null,this._status=g.LoaderStatus.kComplete},c.prototype._onWebSocketOpen=function(h){this._status=g.LoaderStatus.kBuffering},c.prototype._onWebSocketClose=function(h){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=g.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},c.prototype._onWebSocketMessage=function(h){var E=this;if(h.data instanceof ArrayBuffer)this._dispatchArrayBuffer(h.data);else if(h.data instanceof Blob){var f=new FileReader;f.onload=function(){E._dispatchArrayBuffer(f.result)},f.readAsArrayBuffer(h.data)}else{this._status=g.LoaderStatus.kError;var u={code:-1,msg:"Unsupported WebSocket message type: "+h.data.constructor.name};if(this._onError)this._onError(g.LoaderErrors.EXCEPTION,u);else throw new l.RuntimeException(u.msg)}},c.prototype._dispatchArrayBuffer=function(h){var E=h,f=this._receivedLength;this._receivedLength+=E.byteLength,this._onDataArrival&&this._onDataArrival(E,f,this._receivedLength)},c.prototype._onWebSocketError=function(h){this._status=g.LoaderStatus.kError;var E={code:h.code,msg:h.message};if(this._onError)this._onError(g.LoaderErrors.EXCEPTION,E);else throw new l.RuntimeException(E.msg)},c}(g.BaseLoader);m.default=s},"./src/io/xhr-moz-chunked-loader.js":function(S,m,_){_.r(m);var g=_("./src/utils/logger.js"),l=_("./src/io/loader.js"),o=_("./src/utils/exception.js"),s=function(){var c=function(h,E){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(f[d]=u[d])},c(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");c(h,E);function f(){this.constructor=h}h.prototype=E===null?Object.create(E):(f.prototype=E.prototype,new f)}}(),v=function(c){s(h,c);function h(E,f){var u=c.call(this,"xhr-moz-chunked-loader")||this;return u.TAG="MozChunkedLoader",u._seekHandler=E,u._config=f,u._needStash=!0,u._xhr=null,u._requestAbort=!1,u._contentLength=null,u._receivedLength=0,u}return h.isSupported=function(){try{var E=new XMLHttpRequest;return E.open("GET","https://example.com",!0),E.responseType="moz-chunked-arraybuffer",E.responseType==="moz-chunked-arraybuffer"}catch(f){return g.default.w("MozChunkedLoader",f.message),!1}},h.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),c.prototype.destroy.call(this)},h.prototype.open=function(E,f){this._dataSource=E,this._range=f;var u=E.url;this._config.reuseRedirectedURL&&E.redirectedURL!=null&&(u=E.redirectedURL);var d=this._seekHandler.getConfig(u,f);this._requestURL=d.url;var p=this._xhr=new XMLHttpRequest;if(p.open("GET",d.url,!0),p.responseType="moz-chunked-arraybuffer",p.onreadystatechange=this._onReadyStateChange.bind(this),p.onprogress=this._onProgress.bind(this),p.onloadend=this._onLoadEnd.bind(this),p.onerror=this._onXhrError.bind(this),E.withCredentials&&(p.withCredentials=!0),typeof d.headers=="object"){var a=d.headers;for(var x in a)a.hasOwnProperty(x)&&p.setRequestHeader(x,a[x])}if(typeof this._config.headers=="object"){var a=this._config.headers;for(var x in a)a.hasOwnProperty(x)&&p.setRequestHeader(x,a[x])}this._status=l.LoaderStatus.kConnecting,p.send()},h.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=l.LoaderStatus.kComplete},h.prototype._onReadyStateChange=function(E){var f=E.target;if(f.readyState===2){if(f.responseURL!=null&&f.responseURL!==this._requestURL&&this._onURLRedirect){var u=this._seekHandler.removeURLParameters(f.responseURL);this._onURLRedirect(u)}if(f.status!==0&&(f.status<200||f.status>299))if(this._status=l.LoaderStatus.kError,this._onError)this._onError(l.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:f.status,msg:f.statusText});else throw new o.RuntimeException("MozChunkedLoader: Http code invalid, "+f.status+" "+f.statusText);else this._status=l.LoaderStatus.kBuffering}},h.prototype._onProgress=function(E){if(this._status!==l.LoaderStatus.kError){this._contentLength===null&&E.total!==null&&E.total!==0&&(this._contentLength=E.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var f=E.target.response,u=this._range.from+this._receivedLength;this._receivedLength+=f.byteLength,this._onDataArrival&&this._onDataArrival(f,u,this._receivedLength)}},h.prototype._onLoadEnd=function(E){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===l.LoaderStatus.kError)return;this._status=l.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},h.prototype._onXhrError=function(E){this._status=l.LoaderStatus.kError;var f=0,u=null;if(this._contentLength&&E.loaded<this._contentLength?(f=l.LoaderErrors.EARLY_EOF,u={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(f=l.LoaderErrors.EXCEPTION,u={code:-1,msg:E.constructor.name+" "+E.type}),this._onError)this._onError(f,u);else throw new o.RuntimeException(u.msg)},h}(l.BaseLoader);m.default=v},"./src/io/xhr-range-loader.js":function(S,m,_){_.r(m);var g=_("./src/utils/logger.js"),l=_("./src/io/speed-sampler.js"),o=_("./src/io/loader.js"),s=_("./src/utils/exception.js"),v=function(){var h=function(E,f){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var p in d)Object.prototype.hasOwnProperty.call(d,p)&&(u[p]=d[p])},h(E,f)};return function(E,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");h(E,f);function u(){this.constructor=E}E.prototype=f===null?Object.create(f):(u.prototype=f.prototype,new u)}}(),c=function(h){v(E,h);function E(f,u){var d=h.call(this,"xhr-range-loader")||this;return d.TAG="RangeLoader",d._seekHandler=f,d._config=u,d._needStash=!1,d._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],d._currentChunkSizeKB=384,d._currentSpeedNormalized=0,d._zeroSpeedChunkCount=0,d._xhr=null,d._speedSampler=new l.default,d._requestAbort=!1,d._waitForTotalLength=!1,d._totalLengthReceived=!1,d._currentRequestURL=null,d._currentRedirectedURL=null,d._currentRequestRange=null,d._totalLength=null,d._contentLength=null,d._receivedLength=0,d._lastTimeLoaded=0,d}return E.isSupported=function(){try{var f=new XMLHttpRequest;return f.open("GET","https://example.com",!0),f.responseType="arraybuffer",f.responseType==="arraybuffer"}catch(u){return g.default.w("RangeLoader",u.message),!1}},E.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),h.prototype.destroy.call(this)},Object.defineProperty(E.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),E.prototype.open=function(f,u){this._dataSource=f,this._range=u,this._status=o.LoaderStatus.kConnecting;var d=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(d=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!d?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},E.prototype._openSubRange=function(){var f=this._currentChunkSizeKB*1024,u=this._range.from+this._receivedLength,d=u+f;this._contentLength!=null&&d-this._range.from>=this._contentLength&&(d=this._range.from+this._contentLength-1),this._currentRequestRange={from:u,to:d},this._internalOpen(this._dataSource,this._currentRequestRange)},E.prototype._internalOpen=function(f,u){this._lastTimeLoaded=0;var d=f.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?d=this._currentRedirectedURL:f.redirectedURL!=null&&(d=f.redirectedURL));var p=this._seekHandler.getConfig(d,u);this._currentRequestURL=p.url;var a=this._xhr=new XMLHttpRequest;if(a.open("GET",p.url,!0),a.responseType="arraybuffer",a.onreadystatechange=this._onReadyStateChange.bind(this),a.onprogress=this._onProgress.bind(this),a.onload=this._onLoad.bind(this),a.onerror=this._onXhrError.bind(this),f.withCredentials&&(a.withCredentials=!0),typeof p.headers=="object"){var x=p.headers;for(var C in x)x.hasOwnProperty(C)&&a.setRequestHeader(C,x[C])}if(typeof this._config.headers=="object"){var x=this._config.headers;for(var C in x)x.hasOwnProperty(C)&&a.setRequestHeader(C,x[C])}a.send()},E.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=o.LoaderStatus.kComplete},E.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},E.prototype._onReadyStateChange=function(f){var u=f.target;if(u.readyState===2){if(u.responseURL!=null){var d=this._seekHandler.removeURLParameters(u.responseURL);u.responseURL!==this._currentRequestURL&&d!==this._currentRedirectedURL&&(this._currentRedirectedURL=d,this._onURLRedirect&&this._onURLRedirect(d))}if(u.status>=200&&u.status<=299){if(this._waitForTotalLength)return;this._status=o.LoaderStatus.kBuffering}else if(this._status=o.LoaderStatus.kError,this._onError)this._onError(o.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:u.status,msg:u.statusText});else throw new s.RuntimeException("RangeLoader: Http code invalid, "+u.status+" "+u.statusText)}},E.prototype._onProgress=function(f){if(this._status!==o.LoaderStatus.kError){if(this._contentLength===null){var u=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,u=!0;var d=f.total;this._internalAbort(),d!=null&d!==0&&(this._totalLength=d)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,u){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var p=f.loaded-this._lastTimeLoaded;this._lastTimeLoaded=f.loaded,this._speedSampler.addBytes(p)}},E.prototype._normalizeSpeed=function(f){var u=this._chunkSizeKBList,d=u.length-1,p=0,a=0,x=d;if(f<u[0])return u[0];for(;a<=x;){if(p=a+Math.floor((x-a)/2),p===d||f>=u[p]&&f<u[p+1])return u[p];u[p]<f?a=p+1:x=p-1}},E.prototype._onLoad=function(f){if(this._status!==o.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var u=this._speedSampler.lastSecondKBps;if(u===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(u=this._speedSampler.currentKBps)),u!==0){var d=this._normalizeSpeed(u);this._currentSpeedNormalized!==d&&(this._currentSpeedNormalized=d,this._currentChunkSizeKB=d)}var p=f.target.response,a=this._range.from+this._receivedLength;this._receivedLength+=p.byteLength;var x=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():x=!0,this._onDataArrival&&this._onDataArrival(p,a,this._receivedLength),x&&(this._status=o.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},E.prototype._onXhrError=function(f){this._status=o.LoaderStatus.kError;var u=0,d=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(u=o.LoaderErrors.EARLY_EOF,d={code:-1,msg:"RangeLoader meet Early-Eof"}):(u=o.LoaderErrors.EXCEPTION,d={code:-1,msg:f.constructor.name+" "+f.type}),this._onError)this._onError(u,d);else throw new s.RuntimeException(d.msg)},E}(o.BaseLoader);m.default=c},"./src/player/flv-player.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),l=_.n(g),o=_("./src/utils/logger.js"),s=_("./src/utils/browser.js"),v=_("./src/player/player-events.js"),c=_("./src/core/transmuxer.js"),h=_("./src/core/transmuxing-events.js"),E=_("./src/core/mse-controller.js"),f=_("./src/core/mse-events.js"),u=_("./src/player/player-errors.js"),d=_("./src/config.js"),p=_("./src/utils/exception.js"),a=function(){function x(C,b){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(l()),this._config=(0,d.createDefaultConfig)(),typeof b=="object"&&Object.assign(this._config,b),C.type.toLowerCase()!=="flv")throw new p.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");C.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=C,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var L=s.default.chrome&&(s.default.version.major<50||s.default.version.major===50&&s.default.version.build<2661);this._alwaysSeekKeyframe=!!(L||s.default.msedge||s.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return x.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},x.prototype.on=function(C,b){var L=this;C===v.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){L._emitter.emit(v.default.MEDIA_INFO,L.mediaInfo)}):C===v.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){L._emitter.emit(v.default.STATISTICS_INFO,L.statisticsInfo)}),this._emitter.addListener(C,b)},x.prototype.off=function(C,b){this._emitter.removeListener(C,b)},x.prototype.attachMediaElement=function(C){var b=this;if(this._mediaElement=C,C.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),C.addEventListener("seeking",this.e.onvSeeking),C.addEventListener("canplay",this.e.onvCanPlay),C.addEventListener("stalled",this.e.onvStalled),C.addEventListener("progress",this.e.onvProgress),this._msectl=new E.default(this._config),this._msectl.on(f.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(f.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(f.default.SOURCE_OPEN,function(){b._mseSourceOpened=!0,b._hasPendingLoad&&(b._hasPendingLoad=!1,b.load())}),this._msectl.on(f.default.ERROR,function(L){b._emitter.emit(v.default.ERROR,u.ErrorTypes.MEDIA_ERROR,u.ErrorDetails.MEDIA_MSE_ERROR,L)}),this._msectl.attachMediaElement(C),this._pendingSeekTime!=null)try{C.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},x.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},x.prototype.load=function(){var C=this;if(!this._mediaElement)throw new p.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new p.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new c.default(this._mediaDataSource,this._config),this._transmuxer.on(h.default.INIT_SEGMENT,function(b,L){C._msectl.appendInitSegment(L)}),this._transmuxer.on(h.default.MEDIA_SEGMENT,function(b,L){if(C._msectl.appendMediaSegment(L),C._config.lazyLoad&&!C._config.isLive){var O=C._mediaElement.currentTime;L.info.endDts>=(O+C._config.lazyLoadMaxDuration)*1e3&&C._progressChecker==null&&(o.default.v(C.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),C._suspendTransmuxer())}}),this._transmuxer.on(h.default.LOADING_COMPLETE,function(){C._msectl.endOfStream(),C._emitter.emit(v.default.LOADING_COMPLETE)}),this._transmuxer.on(h.default.RECOVERED_EARLY_EOF,function(){C._emitter.emit(v.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(h.default.IO_ERROR,function(b,L){C._emitter.emit(v.default.ERROR,u.ErrorTypes.NETWORK_ERROR,b,L)}),this._transmuxer.on(h.default.DEMUX_ERROR,function(b,L){C._emitter.emit(v.default.ERROR,u.ErrorTypes.MEDIA_ERROR,b,{code:-1,msg:L})}),this._transmuxer.on(h.default.MEDIA_INFO,function(b){C._mediaInfo=b,C._emitter.emit(v.default.MEDIA_INFO,Object.assign({},b))}),this._transmuxer.on(h.default.METADATA_ARRIVED,function(b){C._emitter.emit(v.default.METADATA_ARRIVED,b)}),this._transmuxer.on(h.default.SCRIPTDATA_ARRIVED,function(b){C._emitter.emit(v.default.SCRIPTDATA_ARRIVED,b)}),this._transmuxer.on(h.default.STATISTICS_INFO,function(b){C._statisticsInfo=C._fillStatisticsInfo(b),C._emitter.emit(v.default.STATISTICS_INFO,Object.assign({},C._statisticsInfo))}),this._transmuxer.on(h.default.RECOMMEND_SEEKPOINT,function(b){C._mediaElement&&!C._config.accurateSeek&&(C._requestSetTime=!0,C._mediaElement.currentTime=b/1e3)}),this._transmuxer.open()}},x.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},x.prototype.play=function(){return this._mediaElement.play()},x.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(x.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(C){this._mediaElement.volume=C},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(C){this._mediaElement.muted=C},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(C){this._mediaElement?this._internalSeek(C):this._pendingSeekTime=C},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),x.prototype._fillStatisticsInfo=function(C){if(C.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return C;var b=!0,L=0,O=0;if(this._mediaElement.getVideoPlaybackQuality){var T=this._mediaElement.getVideoPlaybackQuality();L=T.totalVideoFrames,O=T.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(L=this._mediaElement.webkitDecodedFrameCount,O=this._mediaElement.webkitDroppedFrameCount):b=!1;return b&&(C.decodedFrames=L,C.droppedFrames=O),C},x.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var C=this._mediaElement.buffered,b=this._mediaElement.currentTime,L=0,O=0;O<C.length;O++){var T=C.start(O),R=C.end(O);if(T<=b&&b<R){L=R;break}}L>=b+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(o.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},x.prototype._onmseBufferFull=function(){o.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},x.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},x.prototype._checkProgressAndResume=function(){for(var C=this._mediaElement.currentTime,b=this._mediaElement.buffered,L=!1,O=0;O<b.length;O++){var T=b.start(O),R=b.end(O);if(C>=T&&C<R){C>=R-this._config.lazyLoadRecoverDuration&&(L=!0);break}}L&&(window.clearInterval(this._progressChecker),this._progressChecker=null,L&&(o.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},x.prototype._isTimepointBuffered=function(C){for(var b=this._mediaElement.buffered,L=0;L<b.length;L++){var O=b.start(L),T=b.end(L);if(C>=O&&C<T)return!0}return!1},x.prototype._internalSeek=function(C){var b=this._isTimepointBuffered(C),L=!1,O=0;if(C<1&&this._mediaElement.buffered.length>0){var T=this._mediaElement.buffered.start(0);(T<1&&C<T||s.default.safari)&&(L=!0,O=s.default.safari?.1:T)}if(L)this._requestSetTime=!0,this._mediaElement.currentTime=O;else if(b){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=C;else{var R=this._msectl.getNearestKeyframe(Math.floor(C*1e3));this._requestSetTime=!0,R!=null?this._mediaElement.currentTime=R.dts/1e3:this._mediaElement.currentTime=C}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(C),this._transmuxer.seek(Math.floor(C*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=C)},x.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var C=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(C)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(C),this._transmuxer.seek(Math.floor(C*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=C))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},x.prototype._checkAndResumeStuckPlayback=function(C){var b=this._mediaElement;if(C||!this._receivedCanPlay||b.readyState<2){var L=b.buffered;L.length>0&&b.currentTime<L.start(0)&&(o.default.w(this.TAG,"Playback seems stuck at "+b.currentTime+", seek to "+L.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=L.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},x.prototype._onvLoadedMetadata=function(C){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},x.prototype._onvSeeking=function(C){var b=this._mediaElement.currentTime,L=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(b<1&&L.length>0){var O=L.start(0);if(O<1&&b<O||s.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=s.default.safari?.1:O;return}}if(this._isTimepointBuffered(b)){if(this._alwaysSeekKeyframe){var T=this._msectl.getNearestKeyframe(Math.floor(b*1e3));T!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=T.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:b,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},x.prototype._onvCanPlay=function(C){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},x.prototype._onvStalled=function(C){this._checkAndResumeStuckPlayback(!0)},x.prototype._onvProgress=function(C){this._checkAndResumeStuckPlayback()},x}();m.default=a},"./src/player/native-player.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),l=_.n(g),o=_("./src/player/player-events.js"),s=_("./src/config.js"),v=_("./src/utils/exception.js"),c=function(){function h(E,f){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(l()),this._config=(0,s.createDefaultConfig)(),typeof f=="object"&&Object.assign(this._config,f),E.type.toLowerCase()==="flv")throw new v.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(E.hasOwnProperty("segments"))throw new v.InvalidArgumentException("NativePlayer("+E.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=E,this._mediaElement=null}return h.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},h.prototype.on=function(E,f){var u=this;E===o.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){u._emitter.emit(o.default.MEDIA_INFO,u.mediaInfo)}):E===o.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){u._emitter.emit(o.default.STATISTICS_INFO,u.statisticsInfo)}),this._emitter.addListener(E,f)},h.prototype.off=function(E,f){this._emitter.removeListener(E,f)},h.prototype.attachMediaElement=function(E){if(this._mediaElement=E,E.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{E.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},h.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},h.prototype.load=function(){if(!this._mediaElement)throw new v.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},h.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},h.prototype.play=function(){return this._mediaElement.play()},h.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(h.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(E){this._mediaElement.volume=E},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(E){this._mediaElement.muted=E},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(E){this._mediaElement?this._mediaElement.currentTime=E:this._pendingSeekTime=E},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"mediaInfo",{get:function(){var E=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",f={mimeType:E+this._mediaDataSource.type};return this._mediaElement&&(f.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(f.width=this._mediaElement.videoWidth,f.height=this._mediaElement.videoHeight)),f},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"statisticsInfo",{get:function(){var E={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return E;var f=!0,u=0,d=0;if(this._mediaElement.getVideoPlaybackQuality){var p=this._mediaElement.getVideoPlaybackQuality();u=p.totalVideoFrames,d=p.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(u=this._mediaElement.webkitDecodedFrameCount,d=this._mediaElement.webkitDroppedFrameCount):f=!1;return f&&(E.decodedFrames=u,E.droppedFrames=d),E},enumerable:!1,configurable:!0}),h.prototype._onvLoadedMetadata=function(E){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(o.default.MEDIA_INFO,this.mediaInfo)},h.prototype._reportStatisticsInfo=function(){this._emitter.emit(o.default.STATISTICS_INFO,this.statisticsInfo)},h}();m.default=c},"./src/player/player-errors.js":function(S,m,_){_.r(m),_.d(m,{ErrorTypes:function(){return o},ErrorDetails:function(){return s}});var g=_("./src/io/loader.js"),l=_("./src/demux/demux-errors.js"),o={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},s={NETWORK_EXCEPTION:g.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:g.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:g.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:g.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:l.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:l.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:l.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(S,m,_){_.r(m);var g={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};m.default=g},"./src/remux/aac-silent.js":function(S,m,_){_.r(m);var g=function(){function l(){}return l.getSilentFrame=function(o,s){if(o==="mp4a.40.2"){if(s===1)return new Uint8Array([0,200,0,128,35,128]);if(s===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(s===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(s===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(s===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(s===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(s===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},l}();m.default=g},"./src/remux/mp4-generator.js":function(S,m,_){_.r(m);var g=function(){function l(){}return l.init=function(){l.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var o in l.types)l.types.hasOwnProperty(o)&&(l.types[o]=[o.charCodeAt(0),o.charCodeAt(1),o.charCodeAt(2),o.charCodeAt(3)]);var s=l.constants={};s.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),s.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),s.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),s.STSC=s.STCO=s.STTS,s.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),s.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),s.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),s.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},l.box=function(o){for(var s=8,v=null,c=Array.prototype.slice.call(arguments,1),h=c.length,E=0;E<h;E++)s+=c[E].byteLength;v=new Uint8Array(s),v[0]=s>>>24&255,v[1]=s>>>16&255,v[2]=s>>>8&255,v[3]=s&255,v.set(o,4);for(var f=8,E=0;E<h;E++)v.set(c[E],f),f+=c[E].byteLength;return v},l.generateInitSegment=function(o){var s=l.box(l.types.ftyp,l.constants.FTYP),v=l.moov(o),c=new Uint8Array(s.byteLength+v.byteLength);return c.set(s,0),c.set(v,s.byteLength),c},l.moov=function(o){var s=l.mvhd(o.timescale,o.duration),v=l.trak(o),c=l.mvex(o);return l.box(l.types.moov,s,v,c)},l.mvhd=function(o,s){return l.box(l.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},l.trak=function(o){return l.box(l.types.trak,l.tkhd(o),l.mdia(o))},l.tkhd=function(o){var s=o.id,v=o.duration,c=o.presentWidth,h=o.presentHeight;return l.box(l.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,v&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,c>>>8&255,c&255,0,0,h>>>8&255,h&255,0,0]))},l.mdia=function(o){return l.box(l.types.mdia,l.mdhd(o),l.hdlr(o),l.minf(o))},l.mdhd=function(o){var s=o.timescale,v=o.duration;return l.box(l.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,v>>>24&255,v>>>16&255,v>>>8&255,v&255,85,196,0,0]))},l.hdlr=function(o){var s=null;return o.type==="audio"?s=l.constants.HDLR_AUDIO:s=l.constants.HDLR_VIDEO,l.box(l.types.hdlr,s)},l.minf=function(o){var s=null;return o.type==="audio"?s=l.box(l.types.smhd,l.constants.SMHD):s=l.box(l.types.vmhd,l.constants.VMHD),l.box(l.types.minf,s,l.dinf(),l.stbl(o))},l.dinf=function(){var o=l.box(l.types.dinf,l.box(l.types.dref,l.constants.DREF));return o},l.stbl=function(o){var s=l.box(l.types.stbl,l.stsd(o),l.box(l.types.stts,l.constants.STTS),l.box(l.types.stsc,l.constants.STSC),l.box(l.types.stsz,l.constants.STSZ),l.box(l.types.stco,l.constants.STCO));return s},l.stsd=function(o){return o.type==="audio"?o.codec==="mp3"?l.box(l.types.stsd,l.constants.STSD_PREFIX,l.mp3(o)):l.box(l.types.stsd,l.constants.STSD_PREFIX,l.mp4a(o)):l.box(l.types.stsd,l.constants.STSD_PREFIX,l.avc1(o))},l.mp3=function(o){var s=o.channelCount,v=o.audioSampleRate,c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,v>>>8&255,v&255,0,0]);return l.box(l.types[".mp3"],c)},l.mp4a=function(o){var s=o.channelCount,v=o.audioSampleRate,c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,v>>>8&255,v&255,0,0]);return l.box(l.types.mp4a,c,l.esds(o))},l.esds=function(o){var s=o.config||[],v=s.length,c=new Uint8Array([0,0,0,0,3,23+v,0,1,0,4,15+v,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([v]).concat(s).concat([6,1,2]));return l.box(l.types.esds,c)},l.avc1=function(o){var s=o.avcc,v=o.codecWidth,c=o.codecHeight,h=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,v>>>8&255,v&255,c>>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return l.box(l.types.avc1,h,l.box(l.types.avcC,s))},l.mvex=function(o){return l.box(l.types.mvex,l.trex(o))},l.trex=function(o){var s=o.id,v=new Uint8Array([0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return l.box(l.types.trex,v)},l.moof=function(o,s){return l.box(l.types.moof,l.mfhd(o.sequenceNumber),l.traf(o,s))},l.mfhd=function(o){var s=new Uint8Array([0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255]);return l.box(l.types.mfhd,s)},l.traf=function(o,s){var v=o.id,c=l.box(l.types.tfhd,new Uint8Array([0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,v&255])),h=l.box(l.types.tfdt,new Uint8Array([0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255])),E=l.sdtp(o),f=l.trun(o,E.byteLength+16+16+8+16+8+8);return l.box(l.types.traf,c,h,f,E)},l.sdtp=function(o){for(var s=o.samples||[],v=s.length,c=new Uint8Array(4+v),h=0;h<v;h++){var E=s[h].flags;c[h+4]=E.isLeading<<6|E.dependsOn<<4|E.isDependedOn<<2|E.hasRedundancy}return l.box(l.types.sdtp,c)},l.trun=function(o,s){var v=o.samples||[],c=v.length,h=12+16*c,E=new Uint8Array(h);s+=8+h,E.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,c&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255],0);for(var f=0;f<c;f++){var u=v[f].duration,d=v[f].size,p=v[f].flags,a=v[f].cts;E.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.isNonSync,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255],12+16*f)}return l.box(l.types.trun,E)},l.mdat=function(o){return l.box(l.types.mdat,o)},l}();g.init(),m.default=g},"./src/remux/mp4-remuxer.js":function(S,m,_){_.r(m);var g=_("./src/utils/logger.js"),l=_("./src/remux/mp4-generator.js"),o=_("./src/remux/aac-silent.js"),s=_("./src/utils/browser.js"),v=_("./src/core/media-segment-info.js"),c=_("./src/utils/exception.js"),h=function(){function E(f){this.TAG="MP4Remuxer",this._config=f,this._isLive=f.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new v.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new v.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(s.default.chrome&&(s.default.version.major<50||s.default.version.major===50&&s.default.version.build<2661)),this._fillSilentAfterSeek=s.default.msedge||s.default.msie,this._mp3UseMpegAudio=!s.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return E.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},E.prototype.bindDataSource=function(f){return f.onDataAvailable=this.remux.bind(this),f.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(E.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(f){this._onInitSegment=f},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(f){this._onMediaSegment=f},enumerable:!1,configurable:!0}),E.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},E.prototype.seek=function(f){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},E.prototype.remux=function(f,u){if(!this._onMediaSegment)throw new c.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(f,u),this._remuxVideo(u),this._remuxAudio(f)},E.prototype._onTrackMetadataReceived=function(f,u){var d=null,p="mp4",a=u.codec;if(f==="audio")this._audioMeta=u,u.codec==="mp3"&&this._mp3UseMpegAudio?(p="mpeg",a="",d=new Uint8Array):d=l.default.generateInitSegment(u);else if(f==="video")this._videoMeta=u,d=l.default.generateInitSegment(u);else return;if(!this._onInitSegment)throw new c.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(f,{type:f,data:d.buffer,codec:a,container:f+"/"+p,mediaDuration:u.duration})},E.prototype._calculateDtsBase=function(f,u){this._dtsBaseInited||(f.samples&&f.samples.length&&(this._audioDtsBase=f.samples[0].dts),u.samples&&u.samples.length&&(this._videoDtsBase=u.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},E.prototype.flushStashedSamples=function(){var f=this._videoStashedLastSample,u=this._audioStashedLastSample,d={type:"video",id:1,sequenceNumber:0,samples:[],length:0};f!=null&&(d.samples.push(f),d.length=f.length);var p={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};u!=null&&(p.samples.push(u),p.length=u.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(d,!0),this._remuxAudio(p,!0)},E.prototype._remuxAudio=function(f,u){if(this._audioMeta!=null){var d=f,p=d.samples,a=void 0,x=-1,C=-1,b=this._audioMeta.refSampleDuration,L=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,O=this._dtsBaseInited&&this._audioNextDts===void 0,T=!1;if(!(!p||p.length===0)&&!(p.length===1&&!u)){var R=0,A=null,P=0;L?(R=0,P=d.length):(R=8,P=8+d.length);var k=null;if(p.length>1&&(k=p.pop(),P-=k.length),this._audioStashedLastSample!=null){var D=this._audioStashedLastSample;this._audioStashedLastSample=null,p.unshift(D),P+=D.length}k!=null&&(this._audioStashedLastSample=k);var M=p[0].dts-this._dtsBase;if(this._audioNextDts)a=M-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())a=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(T=!0);else{var J=this._audioSegmentInfoList.getLastSampleBefore(M);if(J!=null){var Q=M-(J.originalDts+J.duration);Q<=3&&(Q=0);var $=J.dts+J.duration+Q;a=M-$}else a=0}if(T){var ne=M-a,ue=this._videoSegmentInfoList.getLastSegmentBefore(M);if(ue!=null&&ue.beginDts<ne){var Y=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(Y){var re=ue.beginDts,Oe=ne-ue.beginDts;g.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+re+", duration: "+Oe),p.unshift({unit:Y,dts:re,pts:re}),P+=Y.byteLength}}else T=!1}for(var le=[],ce=0;ce<p.length;ce++){var D=p[ce],be=D.unit,pe=D.dts-this._dtsBase,re=pe,Re=!1,Ie=null,de=0;if(!(pe<-.001)){if(this._audioMeta.codec!=="mp3"){var W=pe,Ce=3;if(this._audioNextDts&&(W=this._audioNextDts),a=pe-W,a<=-Ce*b){g.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+pe+" ms ,curRefDts: "+W+" ms)  due to dtsCorrection: "+a+" ms overlap.");continue}else if(a>=Ce*b&&this._fillAudioTimestampGap&&!s.default.safari){Re=!0;var Te=Math.floor(a/b);g.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+pe+" ms, curRefDts: "+W+" ms, ")+("dtsCorrection: "+Math.round(a)+" ms, generate: "+Te+" frames")),re=Math.floor(W),de=Math.floor(W+b)-re;var Y=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);Y==null&&(g.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),Y=be),Ie=[];for(var Ne=0;Ne<Te;Ne++){W=W+b;var N=Math.floor(W),w=Math.floor(W+b)-N,U={dts:N,pts:N,cts:0,unit:Y,size:Y.byteLength,duration:w,originalDts:pe,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};Ie.push(U),P+=U.size}this._audioNextDts=W+b}else re=Math.floor(W),de=Math.floor(W+b)-re,this._audioNextDts=W+b}else{if(re=pe-a,ce!==p.length-1){var G=p[ce+1].dts-this._dtsBase-a;de=G-re}else if(k!=null){var G=k.dts-this._dtsBase-a;de=G-re}else le.length>=1?de=le[le.length-1].duration:de=Math.floor(b);this._audioNextDts=re+de}x===-1&&(x=re),le.push({dts:re,pts:re,cts:0,unit:D.unit,size:D.unit.byteLength,duration:de,originalDts:pe,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Re&&le.push.apply(le,Ie)}}if(le.length===0){d.samples=[],d.length=0;return}L?A=new Uint8Array(P):(A=new Uint8Array(P),A[0]=P>>>24&255,A[1]=P>>>16&255,A[2]=P>>>8&255,A[3]=P&255,A.set(l.default.types.mdat,4));for(var ce=0;ce<le.length;ce++){var be=le[ce].unit;A.set(be,R),R+=be.byteLength}var me=le[le.length-1];C=me.dts+me.duration;var ge=new v.MediaSegmentInfo;ge.beginDts=x,ge.endDts=C,ge.beginPts=x,ge.endPts=C,ge.originalBeginDts=le[0].originalDts,ge.originalEndDts=me.originalDts+me.duration,ge.firstSample=new v.SampleInfo(le[0].dts,le[0].pts,le[0].duration,le[0].originalDts,!1),ge.lastSample=new v.SampleInfo(me.dts,me.pts,me.duration,me.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(ge),d.samples=le,d.sequenceNumber++;var Le=null;L?Le=new Uint8Array:Le=l.default.moof(d,x),d.samples=[],d.length=0;var Ae={type:"audio",data:this._mergeBoxes(Le,A).buffer,sampleCount:le.length,info:ge};L&&O&&(Ae.timestampOffset=x),this._onMediaSegment("audio",Ae)}}},E.prototype._remuxVideo=function(f,u){if(this._videoMeta!=null){var d=f,p=d.samples,a=void 0,x=-1,C=-1,b=-1,L=-1;if(!(!p||p.length===0)&&!(p.length===1&&!u)){var O=8,T=null,R=8+f.length,A=null;if(p.length>1&&(A=p.pop(),R-=A.length),this._videoStashedLastSample!=null){var P=this._videoStashedLastSample;this._videoStashedLastSample=null,p.unshift(P),R+=P.length}A!=null&&(this._videoStashedLastSample=A);var k=p[0].dts-this._dtsBase;if(this._videoNextDts)a=k-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())a=0;else{var D=this._videoSegmentInfoList.getLastSampleBefore(k);if(D!=null){var M=k-(D.originalDts+D.duration);M<=3&&(M=0);var J=D.dts+D.duration+M;a=k-J}else a=0}for(var Q=new v.MediaSegmentInfo,$=[],ne=0;ne<p.length;ne++){var P=p[ne],ue=P.dts-this._dtsBase,Y=P.isKeyframe,re=ue-a,Oe=P.cts,le=re+Oe;x===-1&&(x=re,b=le);var ce=0;if(ne!==p.length-1){var be=p[ne+1].dts-this._dtsBase-a;ce=be-re}else if(A!=null){var be=A.dts-this._dtsBase-a;ce=be-re}else $.length>=1?ce=$[$.length-1].duration:ce=Math.floor(this._videoMeta.refSampleDuration);if(Y){var pe=new v.SampleInfo(re,le,ce,P.dts,!0);pe.fileposition=P.fileposition,Q.appendSyncPoint(pe)}$.push({dts:re,pts:le,cts:Oe,units:P.units,size:P.length,isKeyframe:Y,duration:ce,originalDts:ue,flags:{isLeading:0,dependsOn:Y?2:1,isDependedOn:Y?1:0,hasRedundancy:0,isNonSync:Y?0:1}})}T=new Uint8Array(R),T[0]=R>>>24&255,T[1]=R>>>16&255,T[2]=R>>>8&255,T[3]=R&255,T.set(l.default.types.mdat,4);for(var ne=0;ne<$.length;ne++)for(var Re=$[ne].units;Re.length;){var Ie=Re.shift(),de=Ie.data;T.set(de,O),O+=de.byteLength}var W=$[$.length-1];if(C=W.dts+W.duration,L=W.pts+W.duration,this._videoNextDts=C,Q.beginDts=x,Q.endDts=C,Q.beginPts=b,Q.endPts=L,Q.originalBeginDts=$[0].originalDts,Q.originalEndDts=W.originalDts+W.duration,Q.firstSample=new v.SampleInfo($[0].dts,$[0].pts,$[0].duration,$[0].originalDts,$[0].isKeyframe),Q.lastSample=new v.SampleInfo(W.dts,W.pts,W.duration,W.originalDts,W.isKeyframe),this._isLive||this._videoSegmentInfoList.append(Q),d.samples=$,d.sequenceNumber++,this._forceFirstIDR){var Ce=$[0].flags;Ce.dependsOn=2,Ce.isNonSync=0}var Te=l.default.moof(d,x);d.samples=[],d.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(Te,T).buffer,sampleCount:$.length,info:Q})}}},E.prototype._mergeBoxes=function(f,u){var d=new Uint8Array(f.byteLength+u.byteLength);return d.set(f,0),d.set(u,f.byteLength),d},E}();m.default=h},"./src/utils/browser.js":function(S,m,_){_.r(m);var g={};function l(){var o=self.navigator.userAgent.toLowerCase(),s=/(edge)\/([\w.]+)/.exec(o)||/(opr)[\/]([\w.]+)/.exec(o)||/(chrome)[ \/]([\w.]+)/.exec(o)||/(iemobile)[\/]([\w.]+)/.exec(o)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+)/.exec(o)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(o)||/(msie) ([\w.]+)/.exec(o)||o.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(o)||o.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(o)||[],v=/(ipad)/.exec(o)||/(ipod)/.exec(o)||/(windows phone)/.exec(o)||/(iphone)/.exec(o)||/(kindle)/.exec(o)||/(android)/.exec(o)||/(windows)/.exec(o)||/(mac)/.exec(o)||/(linux)/.exec(o)||/(cros)/.exec(o)||[],c={browser:s[5]||s[3]||s[1]||"",version:s[2]||s[4]||"0",majorVersion:s[4]||s[2]||"0",platform:v[0]||""},h={};if(c.browser){h[c.browser]=!0;var E=c.majorVersion.split(".");h.version={major:parseInt(c.majorVersion,10),string:c.version},E.length>1&&(h.version.minor=parseInt(E[1],10)),E.length>2&&(h.version.build=parseInt(E[2],10))}if(c.platform&&(h[c.platform]=!0),(h.chrome||h.opr||h.safari)&&(h.webkit=!0),h.rv||h.iemobile){h.rv&&delete h.rv;var f="msie";c.browser=f,h[f]=!0}if(h.edge){delete h.edge;var u="msedge";c.browser=u,h[u]=!0}if(h.opr){var d="opera";c.browser=d,h[d]=!0}if(h.safari&&h.android){var p="android";c.browser=p,h[p]=!0}h.name=c.browser,h.platform=c.platform;for(var a in g)g.hasOwnProperty(a)&&delete g[a];Object.assign(g,h)}l(),m.default=g},"./src/utils/exception.js":function(S,m,_){_.r(m),_.d(m,{RuntimeException:function(){return l},IllegalStateException:function(){return o},InvalidArgumentException:function(){return s},NotImplementedException:function(){return v}});var g=function(){var c=function(h,E){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(f[d]=u[d])},c(h,E)};return function(h,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");c(h,E);function f(){this.constructor=h}h.prototype=E===null?Object.create(E):(f.prototype=E.prototype,new f)}}(),l=function(){function c(h){this._message=h}return Object.defineProperty(c.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),c.prototype.toString=function(){return this.name+": "+this.message},c}(),o=function(c){g(h,c);function h(E){return c.call(this,E)||this}return Object.defineProperty(h.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),h}(l),s=function(c){g(h,c);function h(E){return c.call(this,E)||this}return Object.defineProperty(h.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),h}(l),v=function(c){g(h,c);function h(E){return c.call(this,E)||this}return Object.defineProperty(h.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),h}(l)},"./src/utils/logger.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),l=_.n(g),o=function(){function s(){}return s.e=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var h="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","error",h),s.ENABLE_ERROR&&(console.error?console.error(h):console.warn?console.warn(h):console.log(h))},s.i=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var h="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","info",h),s.ENABLE_INFO&&(console.info?console.info(h):console.log(h))},s.w=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var h="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","warn",h),s.ENABLE_WARN&&(console.warn?console.warn(h):console.log(h))},s.d=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var h="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","debug",h),s.ENABLE_DEBUG&&(console.debug?console.debug(h):console.log(h))},s.v=function(v,c){(!v||s.FORCE_GLOBAL_TAG)&&(v=s.GLOBAL_TAG);var h="["+v+"] > "+c;s.ENABLE_CALLBACK&&s.emitter.emit("log","verbose",h),s.ENABLE_VERBOSE&&console.log(h)},s}();o.GLOBAL_TAG="flv.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new(l()),m.default=o},"./src/utils/logging-control.js":function(S,m,_){_.r(m);var g=_("./node_modules/events/events.js"),l=_.n(g),o=_("./src/utils/logger.js"),s=function(){function v(){}return Object.defineProperty(v,"forceGlobalTag",{get:function(){return o.default.FORCE_GLOBAL_TAG},set:function(c){o.default.FORCE_GLOBAL_TAG=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"globalTag",{get:function(){return o.default.GLOBAL_TAG},set:function(c){o.default.GLOBAL_TAG=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableAll",{get:function(){return o.default.ENABLE_VERBOSE&&o.default.ENABLE_DEBUG&&o.default.ENABLE_INFO&&o.default.ENABLE_WARN&&o.default.ENABLE_ERROR},set:function(c){o.default.ENABLE_VERBOSE=c,o.default.ENABLE_DEBUG=c,o.default.ENABLE_INFO=c,o.default.ENABLE_WARN=c,o.default.ENABLE_ERROR=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableDebug",{get:function(){return o.default.ENABLE_DEBUG},set:function(c){o.default.ENABLE_DEBUG=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableVerbose",{get:function(){return o.default.ENABLE_VERBOSE},set:function(c){o.default.ENABLE_VERBOSE=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableInfo",{get:function(){return o.default.ENABLE_INFO},set:function(c){o.default.ENABLE_INFO=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableWarn",{get:function(){return o.default.ENABLE_WARN},set:function(c){o.default.ENABLE_WARN=c,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableError",{get:function(){return o.default.ENABLE_ERROR},set:function(c){o.default.ENABLE_ERROR=c,v._notifyChange()},enumerable:!1,configurable:!0}),v.getConfig=function(){return{globalTag:o.default.GLOBAL_TAG,forceGlobalTag:o.default.FORCE_GLOBAL_TAG,enableVerbose:o.default.ENABLE_VERBOSE,enableDebug:o.default.ENABLE_DEBUG,enableInfo:o.default.ENABLE_INFO,enableWarn:o.default.ENABLE_WARN,enableError:o.default.ENABLE_ERROR,enableCallback:o.default.ENABLE_CALLBACK}},v.applyConfig=function(c){o.default.GLOBAL_TAG=c.globalTag,o.default.FORCE_GLOBAL_TAG=c.forceGlobalTag,o.default.ENABLE_VERBOSE=c.enableVerbose,o.default.ENABLE_DEBUG=c.enableDebug,o.default.ENABLE_INFO=c.enableInfo,o.default.ENABLE_WARN=c.enableWarn,o.default.ENABLE_ERROR=c.enableError,o.default.ENABLE_CALLBACK=c.enableCallback},v._notifyChange=function(){var c=v.emitter;if(c.listenerCount("change")>0){var h=v.getConfig();c.emit("change",h)}},v.registerListener=function(c){v.emitter.addListener("change",c)},v.removeListener=function(c){v.emitter.removeListener("change",c)},v.addLogListener=function(c){o.default.emitter.addListener("log",c),o.default.emitter.listenerCount("log")>0&&(o.default.ENABLE_CALLBACK=!0,v._notifyChange())},v.removeLogListener=function(c){o.default.emitter.removeListener("log",c),o.default.emitter.listenerCount("log")===0&&(o.default.ENABLE_CALLBACK=!1,v._notifyChange())},v}();s.emitter=new(l()),m.default=s},"./src/utils/polyfill.js":function(S,m,_){_.r(m);var g=function(){function l(){}return l.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(o,s){return o.__proto__=s,o},Object.assign=Object.assign||function(o){if(o==null)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(o),v=1;v<arguments.length;v++){var c=arguments[v];if(c!=null)for(var h in c)c.hasOwnProperty(h)&&(s[h]=c[h])}return s},typeof self.Promise!="function"&&_("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},l}();g.install(),m.default=g},"./src/utils/utf8-conv.js":function(S,m,_){_.r(m);function g(o,s,v){var c=o;if(s+v<c.length){for(;v--;)if((c[++s]&192)!==128)return!1;return!0}else return!1}function l(o){for(var s=[],v=o,c=0,h=o.length;c<h;){if(v[c]<128){s.push(String.fromCharCode(v[c])),++c;continue}else if(!(v[c]<192)){if(v[c]<224){if(g(v,c,1)){var E=(v[c]&31)<<6|v[c+1]&63;if(E>=128){s.push(String.fromCharCode(E&65535)),c+=2;continue}}}else if(v[c]<240){if(g(v,c,2)){var E=(v[c]&15)<<12|(v[c+1]&63)<<6|v[c+2]&63;if(E>=2048&&(E&63488)!==55296){s.push(String.fromCharCode(E&65535)),c+=3;continue}}}else if(v[c]<248&&g(v,c,3)){var E=(v[c]&7)<<18|(v[c+1]&63)<<12|(v[c+2]&63)<<6|v[c+3]&63;if(E>65536&&E<1114112){E-=65536,s.push(String.fromCharCode(E>>>10|55296)),s.push(String.fromCharCode(E&1023|56320)),c+=4;continue}}}s.push(String.fromCharCode(65533)),++c}return s.join("")}m.default=l}},r={};function i(S){var m=r[S];if(m!==void 0)return m.exports;var _=r[S]={exports:{}};return n[S].call(_.exports,_,_.exports,i),_.exports}i.m=n,function(){i.n=function(S){var m=S&&S.__esModule?function(){return S.default}:function(){return S};return i.d(m,{a:m}),m}}(),function(){i.d=function(S,m){for(var _ in m)i.o(m,_)&&!i.o(S,_)&&Object.defineProperty(S,_,{enumerable:!0,get:m[_]})}}(),function(){i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){i.o=function(S,m){return Object.prototype.hasOwnProperty.call(S,m)}}(),function(){i.r=function(S){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(S,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(S,"__esModule",{value:!0})}}();var y=i("./src/index.js");return y}()})})(Jr);var Bo=Jr.exports;const Fo=qn(Bo);const wo={class:"video-container"},Uo={key:0,class:"controls"},jo={class:"left"},No={class:"right"},Vo={name:"Video"},Go=Object.assign(Vo,{props:{flv:{type:Boolean,default:!1},url:{type:String,default:""},id:{type:String,default:""}},setup(e,{expose:t}){const n=e,r=q(null),i=q(null);let y=q(!1),S=q(!0),m=q(!1),_=null;const g=()=>{_=Fo.createPlayer({type:"flv",isLive:!0,url:n.url}),_.attachMediaElement(r==null?void 0:r.value),_.load(),_.play()};Ci(()=>{n.flv&&n.url&&g()});const l=(h,E,f)=>{h&&(r.value.srcObject=h,r.value.muted=E,S.value=E,m.value=f)},o=h=>{h.requestFullscreen?h.requestFullscreen():ele.mozRequestFullScreen?h.mozRequestFullScreen():ele.webkitRequestFullScreen&&h.webkitRequestFullScreen()};function s(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}const v=()=>{y.value?(s(),y.value=!1):(o(i==null?void 0:i.value),y.value=!0)},c=()=>{let h=!r.value.muted;S.value=h,r.value.muted=h};return t({setStream:l,id:n.id}),(h,E)=>{const f=fn;return j(),se("div",{class:te(["live-video",{"is-full":V(y)}]),ref_key:"videoContainerRef",ref:i},[H("div",wo,[H("video",{class:"video",ref_key:"videoRef",ref:r,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:"","x-webkit-airplay":"allow","x5-video-player-type":"h5","x5-video-player-fullscreen":"true",oncontextmenu:"return false"},null,512),De(h.$slots,"default",{},void 0,!0),V(m)?(j(),se("div",Uo,[H("div",jo,[z(f,{"icon-name":V(S)?"sound-close":"sound","icon-size":"24",color:"#cfcfcf",onClick:c},null,8,["icon-name"])]),H("div",No,[z(f,{"icon-name":"full","icon-size":"20",color:"#cfcfcf",onClick:v})])])):oe("",!0)])],2)}}}),lt=it(Go,[["__scopeId","data-v-36ccba5e"]]);const Ko={class:"user-video-control"},zo={__name:"control",props:{state:{type:Object,required:!0}},emits:"control",setup(e,{emit:t}){const n=e,r=i=>{t("control",{state:n.state[i],type:i})};return(i,y)=>{const S=fn;return j(),se("div",Ko,[z(S,{"icon-name":"shipin-"+n.state.video,"icon-size":"20",onClick:y[0]||(y[0]=m=>r("video")),color:"#ffffff"},null,8,["icon-name"]),z(S,{"icon-name":"yuyin-"+n.state.audio,"icon-size":"20",onClick:y[1]||(y[1]=m=>r("audio")),color:"#ffffff"},null,8,["icon-name"])])}}},Nn=it(zo,[["__scopeId","data-v-8d6a64ce"]]);const Wo={class:"user-video-header"},Ho=["title"],$o={__name:"header",props:{homeowner:{type:Boolean,default:!1},name:{type:String,default:""}},setup(e){const t=e;return(n,r)=>{const i=Yi;return j(),se("div",Wo,[t.homeowner?(j(),fe(i,{key:0,round:""},{default:X(()=>[xe("房主")]),_:1})):oe("",!0),H("div",{class:"video-username",title:t.name},ye(t.name),9,Ho)])}}},Et=it($o,[["__scopeId","data-v-ffe85a09"]]),Yo={class:"dialog-footer"},Xo={name:"SetRoomPassDialog"},Jo=Object.assign(Xo,{props:{id:{type:String,default:""}},setup(e,{expose:t}){const n=e,r=q(),i=q(!1),y=q(""),S=()=>{i.value=!1},m=()=>{y.value.trim().length===6||y.value.length===0?Qn({method:"POST",url:"room/update",data:{id:n.id,password:y.value}}).then(()=>{i.value=!1,y.value.length===0?Ke.success("密码已设置为空！"):Ke.success("密码设置成功！")}):Ke.warning("密码输入格式错误！")};return t({show:()=>i.value=!0,hide:()=>i.value=!1}),(_,g)=>{const l=jt,o=qe,s=dn;return j(),fe(s,{ref_key:"dialogRef",ref:r,modelValue:i.value,"onUpdate:modelValue":g[1]||(g[1]=v=>i.value=v),title:"设置密码",width:"400px","show-close":!1,"close-on-click-modal":!1},{footer:X(()=>[H("div",Yo,[z(o,{onClick:S},{default:X(()=>[xe("取消")]),_:1}),z(o,{type:"primary",onClick:m},{default:X(()=>[xe(" 确定 ")]),_:1})])]),default:X(()=>[z(l,{modelValue:y.value,"onUpdate:modelValue":g[0]||(g[0]=v=>y.value=v),modelModifiers:{trim:!0},placeholder:"请输入6位密码"},null,8,["modelValue"])]),_:1},8,["modelValue"])}}}),qo={class:"dialog-footer"},Qo={name:"EnterRoomPassDialog"},Zo=Object.assign(Qo,{props:{id:{type:String,default:""}},emits:["onTrue","onFalse","onCancel"],setup(e,{expose:t,emit:n}){const r=e,i=q(),y=q(),S=()=>{n("onCancel"),y.value=!1},m=()=>{Qn({method:"POST",url:"/room/checkPassword",data:{id:r.id,password:i.value}}).then(_=>{_.data?(n("onTrue"),y.value=!1):(n("onFalse"),Ke.warning("密码错误！"))})};return t({show:()=>y.value=!0,hide:()=>y.value=!1}),(_,g)=>{const l=jt,o=qe,s=dn;return j(),fe(s,{ref:"dialogRef",modelValue:y.value,"onUpdate:modelValue":g[1]||(g[1]=v=>y.value=v),title:"设置密码",width:"400px","show-close":!1,"close-on-click-modal":!1},{footer:X(()=>[H("div",qo,[z(o,{onClick:S},{default:X(()=>[xe("取消")]),_:1}),z(o,{type:"primary",onClick:m},{default:X(()=>[xe(" 确定 ")]),_:1})])]),default:X(()=>[z(l,{modelValue:i.value,"onUpdate:modelValue":g[0]||(g[0]=v=>i.value=v),modelModifiers:{trim:!0},placeholder:"请输入6位密码"},null,8,["modelValue"])]),_:1},8,["modelValue"])}}});const gn=bi("room",()=>{const e=q({}),t=q([]),n=q([]);return{info:e,peoples:t,chatList:n,GET_INFO:async(m,_)=>{var l,o;const g=await Ri({id:m}).catch(()=>{typeof _=="function"&&_()});e.value=((l=g==null?void 0:g.data)==null?void 0:l.info)||{},t.value=((o=g==null?void 0:g.data)==null?void 0:o.peoples)||[]},ADD_PEOPLE:m=>{t.value.findIndex(_=>_.id===m.id)===-1&&t.value.push(m)},ADD_CHAT:(...m)=>{n.value.push(...m)},REMOVE_PEOPLE:m=>{t.value=t.value.filter(_=>_.id!==m)}}}),ea=["😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","😘","😗","😙","😚","😋","😛","😝","😜","🤪","🤨","🧐","🤓","😎","🤩","😏","😒","😞","😔","😟","😕","🙁","😣","😖","😫","😩","😢","😭","😮","💨","😤","😠","😡","🤬","🤯","😳","😱","😨","😰","😥","😓","🤗","🤔","🤭","🤫","🤥","😶","🌫️","😐","😑","😬","🙄","😯","😦","😧","😮","😲","😴","🤤","😪","😵","😵","💫","🤐","🤢","🤮","🤧","😷","🤒","🤕","🤑","🤠","😈","👿","👹","👺","🤡","💩","👻","💀","👽","👾","🤖","🎃","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🐶"];const ta=e=>(Li("data-v-7328f5c9"),e=e(),Ai(),e),na={key:0,class:"unread-dot"},ra={class:"user-name"},ia={class:"chat-content"},sa=ta(()=>H("div",{class:"chat-textarea-placeholder"},null,-1)),oa={class:"chat-textarea"},aa={class:"emoji-container"},la=["onClick"],ua={name:"ChatButton"},ca=Object.assign(ua,{emits:"enter",setup(e,{emit:t}){const n=q(!1),r=q(""),i=q(),y=q(),S=gn(),{chatList:m}=$t(S),{info:_}=$t(hn());Nt(()=>{c()});const g=h=>{if(!h.shiftKey&&h.keyCode===13){if(r.value.trim()==="")return;const E=r.value;r.value="";const f={info:{id:_.value.id,name:_.value.username},time:Date.now(),content:E};S.ADD_CHAT({...f,unread:!1}),t("enter",f),h.preventDefault()}},l=h=>{r.value+=h,y.value.focus()},o=()=>{for(let h=0;h<m.value.length;h++)m.value[h].unread=!1};Mt(n,async()=>{n.value&&(await ke(),y.value.focus())},{flush:"post"});const s=async()=>{n.value=!0,o(),await ke(),c()};Mt(m,()=>{c(),n.value&&o()},{flush:"post",deep:!0});const v=ve(()=>{let h=0;if(n.value)return h;for(let E of m.value)E.unread&&h++;return h}),c=async()=>{await ke(),i.value&&(i.value.scrollTop=i.value.scrollHeight)};return(h,E)=>{const f=qe,u=fn,d=Ti,p=jt,a=ls;return j(),se(Fe,null,[z(f,{onClick:s},{default:X(()=>[De(h.$slots,"default",{},void 0,!0),V(v)?(j(),se("span",na,"("+ye(V(v))+")",1)):oe("",!0)]),_:3}),z(a,{class:"chat-container","append-to-body":"",size:300,modelValue:n.value,"onUpdate:modelValue":E[1]||(E[1]=x=>n.value=x),title:"聊天室"},{default:X(()=>[H("div",{class:"chat-list",ref_key:"chatListRef",ref:i},[(j(!0),se(Fe,null,wt(V(m),x=>(j(),se("div",{class:"chat-item",key:x.info.id+"_"+x.time},[H("div",ra,ye(x.info.id===V(_).id?"我":x.info.name),1),H("div",ia,ye(x.content),1)]))),128)),sa],512),H("div",oa,[z(d,{placement:"top-start",width:250,trigger:"click"},{reference:X(()=>[z(u,{iconName:"expression",iconSize:"30",color:"#999"})]),default:X(()=>[H("div",aa,[(j(!0),se(Fe,null,wt(V(ea),x=>(j(),se("div",{class:"emoji-item",onClick:C=>l(x),key:x},ye(x),9,la))),128))])]),_:1}),z(p,{ref_key:"contentRef",ref:y,type:"textarea",modelValue:r.value,"onUpdate:modelValue":E[0]||(E[0]=x=>r.value=x),placeholder:"请输入",rows:1,onKeydown:g,resize:"none"},null,8,["modelValue"])])]),_:1},8,["modelValue"])],64)}}}),fa=it(ca,[["__scopeId","data-v-7328f5c9"]]);const da={class:"link"},ha={key:0,class:"pwd"},pa={class:"btn-group"},_a={__name:"index",props:{id:{type:String,required:!0}},setup(e){const t=e,n=q(!1),r=location.href,i=q("");Oi({id:t.id}).then(S=>{i.value=S.data});const y=()=>{Pi(`房间链接：${r}`+(i.value?`  房间密码：${i.value}`:"")),Ke.success("复制成功！"),n.value=!1};return(S,m)=>{const _=qe,g=dn;return j(),se(Fe,null,[z(_,{onClick:m[0]||(m[0]=l=>n.value=!0)},{default:X(()=>[De(S.$slots,"default",{},void 0,!0)]),_:3}),z(g,{modelValue:n.value,"onUpdate:modelValue":m[1]||(m[1]=l=>n.value=l),width:"500",title:"分享房间"},{default:X(()=>[H("div",da,"房间链接："+ye(V(r)),1),i.value?(j(),se("div",ha,"密码："+ye(i.value),1)):oe("",!0),H("div",pa,[z(_,{type:"primary",onClick:y},{default:X(()=>[xe("复制")]),_:1})])]),_:1},8,["modelValue"])],64)}}},ma=it(_a,[["__scopeId","data-v-54382612"]]),ga={class:"file-name"},va={class:"notice-group"},ya={__name:"progress",props:{type:{type:Number,default:1},percentage:{type:Number,default:0},name:{type:String,default:""},buffer:{type:Array,default:[]}},setup(e){const t=e,n=()=>{ki({data:t.buffer,name:t.name})};return(r,i)=>{const y=qe;return j(),se(Fe,null,[H("div",ga,ye(t.name),1),H("div",va,[t.percentage.value!=100?(j(),se(Fe,{key:0},[xe(" 文件"+ye(t.type===1?"发送":"接收")+"中... "+ye(t.percentage)+"% ",1)],64)):(j(),se(Fe,{key:1},[xe(" 文件"+ye(t.type===1?"发送":"接收")+"成功... ",1)],64)),t.percentage.value==100&&t.type===2?(j(),fe(y,{key:2,onClick:n,type:"primary",link:""},{default:X(()=>[xe(" 下载 ")]),_:1})):oe("",!0)])],64)}}},Vn=(e,t)=>{const n=ve(()=>Math.floor(t.value.receiveSize/t.value.maxSize*100));Ms({title:e===1?"发送文件":"接收文件",duration:0,"custom-class":"progress-notice",message:Di(ya,{type:e,percentage:n,name:t.value.name,buffer:t.value.buffer})})},Ye=gn(),Gn=hn();q(null);const Kn=(e,t)=>{const n=JSON.parse(JSON.stringify(e));return n.name=t.name,n.maxSize=t.size,n.receiveSize=0,n.start=!0,n},Ea=()=>{const e=ve(()=>Ye.peoples.find(n=>n.id===Gn.info.id)),t=ve(()=>Ye.peoples.filter(n=>n.id!==Gn.info.id));return[e,t]},xa=()=>ve(()=>Ye.info.name?Ye.info.name+" ("+Ye.peoples.length+(Ye.info.max?"/"+Ye.info.max:"")+")":""),Sa=async()=>{let e=null;try{const t={video:{width:{min:200},height:{min:150},frameRate:{ideal:30,max:60}},audio:{noiseSuppression:!0,echoCancellation:!0}};return navigator.mediaDevices.getUserMedia?e=await navigator.mediaDevices.getUserMedia(t):navigator.webkitGetUserMedia?e=await navigator.webkitGetUserMedia(t):navigator.mozGetUserMedia?e=await navagator.mozGetUserMedia(t):navigator.getUserMedia?e=await navigator.getUserMedia(t):Ke.warning("你的浏览器不支持访问用户媒体设备！"),e.getTracks().forEach(n=>{n.enabled=!1}),Promise.resolve(e)}catch{return Ke.warning("没打开摄像头和语音权限！"),Promise.reject()}},Ca=e=>{const t=q(e);return[t,r=>t.value=r]},ba=async e=>{try{const t=await navigator.mediaDevices.getDisplayMedia({video:{width:1920,height:1080}});return t.oninactive=e,t}catch{console.log("取消投屏！")}},zn=()=>{const e=Dt(new Map);return{list:e,set:(i,y)=>e.set(i,y),get:(i,y)=>{const S=e.get(i);S&&typeof y=="function"&&y(S)},del:i=>e.delete(i)}};const Ra={key:0,class:"container"},Ta={class:"live-name"},La={key:0,class:"video-main"},Aa={class:"people-video-group"},Oa={class:"people-video"},Pa={key:1,class:"video-metting-main"},ka={class:"screen-video"},Da={class:"people-video-box"},Ia={class:"people-video-group"},Ma={class:"people-video"},Ba={class:"btn-group"},Fa={key:0,class:"btn-group-public"},wa={class:"btn-group-right"},Ua={name:"Room"},ja=Object.assign(Ua,{setup(e){const t=Ii(),n=Mi(),r=gn(),i=hn(),{info:y}=$t(r),S=t.query.id,m=xa();let _=!1,g=null;const l=q(),o=q(),s=q(),v=q(),c=q(),h=q(),E=q(!0),f=q(!1),u=q(!1),d=zn(),p=zn(),a=Dt(new Map),[x,C]=Ca(1),b=Dt({video:2,audio:2}),[L,O]=Ea();let T=null,R=null,A=null;const P={start:!1,maxSize:0,receiveSize:0,name:"",buffer:[]},k=q(P),D=q(P);let M=[];const J=()=>{ae.on("initSuccessed",()=>{ae.emit("join")}),ae.on("joined",async function(N){let w=JSON.parse(N.info);if(r.ADD_PEOPLE(w),i.info.id!==w.id){const U=pe("video",w.id);d.set(w.id,U),U.addTrack(T),U.createOffer(G=>{ae.emit("offer",{offer:G,type:"video",to:w.id,from:i.info.id})})}if(R){const U=pe("display",w.id);p.set(w.id,U),U.addTrack(R),U.createOffer(G=>{ae.emit("offer",{offer:G,type:"display",to:w.id,from:i.info.id})})}}),ae.on("leave",function(N){N.id===y.user_id&&(g=null),d.del(N.id),p.del(N.id),a.delete(N.id),r.REMOVE_PEOPLE(N.id),s.value.forEach(w=>{w.id===N.id&&w.setStream(null)})}),ae.on("offer",function({offer:N,type:w,from:U}){w==="video"?d.get(U,G=>{G.addTrack(T),G.setRemoteDescription(N),G.createAnswer(me=>{ae.emit("answer",{answer:me,type:w,to:U,from:i.info.id})})}):(g=pe(w,U),g.setRemoteDescription(N),g.createAnswer(G=>{ae.emit("answer",{answer:G,type:w,to:U,from:i.info.id})}))}),ae.on("answer",function({answer:N,type:w,from:U}){w==="video"?d.get(U,G=>{G.setRemoteDescription(N)}):p.get(U,G=>{G.setRemoteDescription(N)})}),ae.on("candidate",({candidate:N,type:w,from:U})=>{w==="video"?d.get(U,G=>{G.setCandidate(N)}):g?g.setCandidate(N):p.get(U,G=>{G.setCandidate(N)})}),ae.on("noLogin",()=>{i.SET_TOKEN(""),i.SET_LOGIN(!0,1)}),ae.on("fulled",()=>{f.value=!0,$e.alert("当前房间已经满人！").then(()=>{n.go(-1)}),ae.close(),ae.disconnect()}),ae.on("closed",()=>{_=!0,$e.alert("当前房间已经关闭！").then(()=>{n.replace("/"),i.SET_ROOM("")})}),ae.on("rejectConn",()=>{$e.alert("对方拒绝了你的连接申请！")}),ae.on("typeChange",async N=>{C(N),await ke(),Ce(),A&&l.value.setStream(A,!1,!0)}),ae.on("displayMediaEnd",async()=>{l.value.setStream(null,!0,!1),C(1),await ke(),await Te(1)})},Q=async()=>{(await wi({id:S})).data?(f.value=!0,$e.alert("已在其他页面打开，请不要重复打开！","温馨提醒").then(()=>{n.go(-1)})):(Sa().then(w=>{T=w}),o.value.setStream(T,!0),await bo({query:{id:S}}),J())},$=()=>{ae.disconnect(),ae.close()},ne=N=>{N&&N.getTracks().forEach(w=>{w.stop()})},ue=async()=>{C(r.info.type),r.peoples.forEach(N=>{const w=pe("video",N.id);d.set(N.id,w)}),await Q(),u.value=!!y.value.is_public},Y=()=>{ue()},re=()=>{n.go(-1),_=!0},Oe=N=>{d.list.forEach(w=>{var U;(U=w.dataChannel)==null||U.send(JSON.stringify({type:"chat",data:N}))})};Nt(async()=>{i.token&&(await r.GET_INFO(S,()=>{_=!0,f.value=!0,n.push("/")}),r.info.password&&r.info.user_id!==i.info.id?c.value.show():ue())}),Bi(async(N,w,U)=>{try{_||!i.token?($(),ne(T),U()):(await $e.confirm("此操作将会退出当前房间！","温馨提醒").then(()=>{$(),ne(T)}),U())}catch{U(!1)}});const le=()=>{v.value.show()},ce=async(N,w)=>{d.list.forEach(async U=>{U.conn.getSenders().forEach(G=>{G.tarck&&G.track.kind===N&&(G.track.enabled=w)})}),T&&T.getTracks().forEach(U=>{U.kind===N&&(U.enabled=w)})},be=({state:N,type:w})=>{try{if(!T)return;N===2?(ce(w,!0),o.value.setStream(T,!0),b[w]=1):(ce(w,!1),b[w]=2)}catch(U){console.log("error：",U)}},pe=(N,w)=>new Mo({async onTarck(U){const[G]=U.streams;if(N==="video"){let me=s.value.find(ge=>ge.id==w);me&&me.setStream(G,!1),a.set(w,G)}else l.value?l.value.setStream(G,!1,!0):A=G},onCandidate(U){U&&ae.emit("candidate",{candidate:U,type:N,to:w,from:i.info.id})},onMessage(U){let G=U.data;typeof G=="string"?(G=JSON.parse(G),G.type==="file-start"?(k.value=Kn(k.value,{size:G.size,name:G.name}),Vn(2,k)):G.type==="file-end"?k.value.start=!1:G.type==="chat"&&r.ADD_CHAT({...G.data,unread:!0})):(k.value.receiveSize+=G.size,k.value.buffer.push(G))}}),Re=async N=>{await Sn({is_public:N?1:0,id:S})},Ie=()=>{$e.confirm("确认关闭房间？").then(()=>{ae.emit("closeHouse")})},de=()=>{d.list.length?D.value.start?Ke.warning("正在分享中..."):h.value.click():Ke.warning("当前房间不存在其他人...")},W=N=>{const w=N.target.files[0];if(w){const U=new FileReader;let G=1024,me=Math.ceil(w.size/G),ge=1;const Le=()=>{U.readAsArrayBuffer(w.slice((ge-1)*G,ge*G)),ge++};U.onload=()=>{M.forEach(Ae=>{d.get(Ae,we=>{var he;(he=we.dataChannel)==null||he.send(U.result)})}),D.value.receiveSize+=U.result.byteLength,ge<=me?Le():(M.forEach(Ae=>{d.get(Ae,we=>{var he;(he=we.dataChannel)==null||he.send(JSON.stringify({type:"file-end",size:w.size,name:w.name}))})}),D.value.start=!1)},M=[...d.list.keys()],M.forEach(Ae=>{d.get(Ae,we=>{var he;(he=we.dataChannel)==null||he.send(JSON.stringify({type:"file-start",size:w.size,name:w.name}))})}),D.value=Kn(D.value,{size:w.size,name:w.name}),Vn(1,D),Le()}},Ce=async()=>{var N;await ke(),o.value.setStream(T),(N=s==null?void 0:s.value)==null||N.forEach(w=>{const U=a.get(w.id);U&&w.setStream(U)})},Te=async N=>{Sn({id:S,type:N}).then(()=>{A=null,ae.emit("typeChange",N),Ce()})},Ne=async()=>{ba(()=>{ae.emit("displayMediaEnd"),R=null,p.list.clear()}).then(async w=>{w&&(R=w,C(2),await ke(),await Te(2),l.value.setStream(w,!1,!0),r.peoples.forEach(U=>{p.set(U.id,pe("display",U.id))}),p.list.forEach((U,G)=>{U.addTrack(w),U.createOffer(me=>{ae.emit("offer",{offer:me,type:"display",to:G,from:i.info.id})})}))})};return(N,w)=>{var Ae,we;const U=Be("CaretBottom"),G=Je,me=Qi,ge=Fi,Le=qe;return j(),se(Fe,null,[f.value?oe("",!0):(j(),se("div",Ra,[H("div",Ta,ye(V(m)),1),V(x)===1?(j(),se("div",La,[Ve(H("div",Aa,[H("div",Oa,[z(lt,{ref_key:"videoRef",ref:o},null,512),V(L)?(j(),fe(Et,{key:0,homeowner:V(y).user_id===((Ae=V(L))==null?void 0:Ae.id),name:(we=V(L))==null?void 0:we.username},null,8,["homeowner","name"])):oe("",!0),z(Nn,{state:b,onControl:be},null,8,["state"])]),(j(!0),se(Fe,null,wt(V(O),he=>(j(),se("div",{class:"people-video",key:he.id},[z(Et,{homeowner:V(y).user_id===(he==null?void 0:he.id),name:he==null?void 0:he.username},null,8,["homeowner","name"]),z(lt,{id:he.id,ref_for:!0,ref_key:"remoteVideoRef",ref:s},null,8,["id"])]))),128))],512),[[Ge,E.value]])])):oe("",!0),V(x)===2?(j(),se("div",Pa,[H("div",ka,[z(lt,{ref_key:"mainVideoRef",ref:l},{default:X(()=>[H("div",Da,[H("div",{class:te(["people-video-box-header",{rotate:E.value}]),onClick:w[0]||(w[0]=he=>E.value=!E.value)},[z(G,{size:20},{default:X(()=>[z(U)]),_:1})],2),z(me,null,{default:X(()=>{var he,_t;return[Ve(H("div",Ia,[H("div",Ma,[z(lt,{ref_key:"videoRef",ref:o},null,512),V(L)?(j(),fe(Et,{key:0,homeowner:V(y).user_id===((he=V(L))==null?void 0:he.id),name:(_t=V(L))==null?void 0:_t.username},null,8,["homeowner","name"])):oe("",!0),z(Nn,{state:b,onControl:be},null,8,["state"])]),(j(!0),se(Fe,null,wt(V(O),_e=>(j(),se("div",{class:"people-video",key:_e.id},[z(Et,{homeowner:V(y).user_id===(_e==null?void 0:_e.id),name:_e==null?void 0:_e.username},null,8,["homeowner","name"]),z(lt,{id:_e.id,ref_for:!0,ref_key:"remoteVideoRef",ref:s},null,8,["id"])]))),128))],512),[[Ge,E.value]])]}),_:1})])]),_:1},512)])])):oe("",!0),H("div",Ba,[V(y).homeowner?(j(),se("div",Fa,[xe(" 公开 "),z(ge,{modelValue:u.value,"onUpdate:modelValue":w[1]||(w[1]=he=>u.value=he),onChange:Re},null,8,["modelValue"])])):oe("",!0),V(y).homeowner?(j(),fe(Le,{key:1,onClick:le},{default:X(()=>[xe(" 设置密码 ")]),_:1})):oe("",!0),V(y).homeowner?(j(),fe(Le,{key:2,onClick:Ne},{default:X(()=>[xe(" 共享屏幕 ")]),_:1})):oe("",!0),H("div",wa,[z(Le,{onClick:de},{default:X(()=>[xe(" 分享文件 ")]),_:1}),V(y).homeowner?(j(),fe(ma,{key:0,id:V(S)},{default:X(()=>[xe(" 分享房间 ")]),_:1},8,["id"])):oe("",!0),z(fa,{onEnter:Oe},{default:X(()=>[xe("聊天室")]),_:1}),V(y).homeowner?(j(),fe(Le,{key:1,onClick:Ie},{default:X(()=>[xe(" 关闭房间 ")]),_:1})):oe("",!0)])])])),z(Jo,{ref_key:"setRoomPassDialogRef",ref:v,id:V(S)},null,8,["id"]),z(Zo,{ref_key:"enterRoomPassDialogRef",ref:c,id:V(S),onOnTrue:Y,onOnCancel:re},null,8,["id"]),Ve(H("input",{type:"file",ref_key:"fileRef",ref:h,onChange:W},null,544),[[Ge,!1]])],64)}}}),Ga=it(ja,[["__scopeId","data-v-7d9c32b9"]]);export{Ga as default};
